<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mikuscore</title>
  <link rel="stylesheet" href="src/css/md3/token-spec.css" />
  <link rel="stylesheet" href="src/css/md3/core-spec.css" />
  <link rel="stylesheet" href="src/css/app.css" />
</head>
<body class="md-page">
  <main class="md-shell">
    <section class="md-card ms-app">
      <header class="ms-hero">
        <div class="ms-hero-top">
          <p class="ms-hero-eyebrow">LOCAL SCORE TOOL</p>
          <span class="md-chip ms-hero-chip">v0.1.0</span>
        </div>
        <h1 class="md-headline ms-hero-title">
          <span class="ms-hero-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 3v12.4a3.6 3.6 0 1 1-1.2-2.7V6.2l9-2.2v9.6a3.6 3.6 0 1 1-1.2-2.7V5.6L9 7.1Z" />
            </svg>
          </span>
          <span>mikuscore</span>
          <span class="md-tooltip-group">
            <span class="md-info-chip" aria-label="mikuscore の詳細説明">
              <svg aria-hidden="true" viewBox="0 0 24 24" class="md-info-icon" fill="none">
                <circle cx="12" cy="12" r="9" fill="#cbbcf0"></circle>
                <rect x="11" y="10" width="2" height="7" rx="1" fill="#ffffff"></rect>
                <circle cx="12" cy="7.5" r="1" fill="#ffffff"></circle>
              </svg>
            </span>
            <span class="md-tooltip-content md-tooltip md-tooltip--rich md-tooltip--wide">
              mikuscore は、MusicXML の既存構造をできるだけ保持しながら編集することを重視したローカル完結型エディタです。
              入力（ファイル/ソース）から譜面プレビュー、ノート編集、再生確認、保存/ダウンロードまでを一画面で行えます。
              操作手順: 1) 入力を選んで読み込み 2) 譜面プレビューで選択 3) ノートを編集 4) 再生で確認して保存 / ダウンロード。
              まず読み込み後に譜面をクリックして対象ノートを選び、音高・音価を調整してください。
            </span>
          </span>
        </h1>
        <p class="md-subtitle ms-hero-subtitle">
          ブラウザ上で完結し、既存MusicXMLを壊さずに編集することを重視したスコアエディタです。
        </p>
      </header>

      <div class="ms-flow">
        <section class="md-section ms-flow-step">
          <h2 class="md-section-title"><span class="ms-step-no">1</span>MusicXML入力</h2>
          <div class="ms-radio-group" role="radiogroup" aria-label="入力方式">
            <label class="md-radio"><input id="inputModeFile" type="radio" name="inputMode" value="file" checked /> ファイル読込</label>
            <label class="md-radio"><input id="inputModeSource" type="radio" name="inputMode" value="source" /> ソース入力</label>
          </div>

          <div id="fileInputBlock" class="ms-block">
            <button id="fileSelectBtn" type="button" class="md-button md-button--tonal">ファイルを選択</button>
            <span id="fileNameText" class="ms-file-name">未選択</span>
            <input id="fileInput" type="file" accept=".musicxml,.xml,text/xml,application/xml" hidden />
          </div>

          <div id="sourceInputBlock" class="ms-block md-hidden">
            <label for="xmlInput" class="md-label">MusicXML</label>
            <textarea id="xmlInput" rows="12" spellcheck="false" class="md-textarea"></textarea>
          </div>

          <div class="ms-actions">
            <button id="loadBtn" type="button" class="md-button md-button--primary">読み込み</button>
          </div>
        </section>

        <section class="md-section ms-flow-step">
          <h2 class="md-section-title"><span class="ms-step-no">2</span>譜面プレビュー（クリックで選択）</h2>
          <p class="md-label">Verovioレンダリング上の音符をクリックすると、編集対象として選択します。</p>
          <p id="debugScoreMeta" class="ms-debug-meta">未描画</p>
          <div id="debugScoreWrap" class="ms-debug-wrap">
            <div id="debugScoreArea" class="ms-debug-score"></div>
          </div>
        </section>

        <section class="md-section ms-flow-step">
          <h2 class="md-section-title"><span class="ms-step-no">3</span>編集</h2>
          <p id="statusText" class="ms-status">未ロード</p>
          <label for="noteSelect" class="md-label">ノート選択 (nodeId)</label>
          <select id="noteSelect" class="md-select"></select>

          <div class="ms-grid">
            <label class="ms-field">音名(step)
              <select id="pitchStep" class="md-select">
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
                <option value="A">A</option>
                <option value="B">B</option>
              </select>
            </label>
            <label class="ms-field">変化記号(alter)
              <select id="pitchAlter" class="md-select">
                <option value="">none</option>
                <option value="-2">-2</option>
                <option value="-1">-1</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
              </select>
            </label>
            <label class="ms-field">オクターブ(octave)
              <input id="pitchOctave" type="number" min="0" max="9" step="1" value="4" class="md-input" />
            </label>
            <label class="ms-field">音価(duration)
              <input id="durationInput" type="number" min="1" step="1" value="1" class="md-input" />
            </label>
          </div>

          <div class="ms-actions">
            <button id="changePitchBtn" type="button" class="md-button md-button--primary">音高変更</button>
            <button id="changeDurationBtn" type="button" class="md-button md-button--primary">音価変更</button>
            <button id="insertAfterBtn" type="button" class="md-button md-button--tonal">後ろに音符追加</button>
            <button id="deleteBtn" type="button" class="md-button md-button--surface">音符削除</button>
          </div>
        </section>

        <section class="md-section ms-flow-step">
          <h2 class="md-section-title"><span class="ms-step-no">4</span>検証 / 保存</h2>
          <div class="ms-actions">
            <button id="playBtn" type="button" class="md-button md-button--primary">再生</button>
            <button id="stopBtn" type="button" class="md-button md-button--surface" disabled>停止</button>
            <button id="saveBtn" type="button" class="md-button md-button--tonal">保存</button>
            <button id="downloadBtn" type="button" class="md-button md-button--secondary" disabled>XMLダウンロード</button>
          </div>
          <p id="playbackText" class="ms-status">再生: 停止中</p>
          <p class="ms-status">保存モード: <span id="saveModeText">-</span></p>
          <label for="outputXml" class="md-label">出力XML</label>
          <textarea id="outputXml" rows="12" readonly class="md-textarea"></textarea>
        </section>
      </div>

      <details class="ms-dev">
        <summary>詳細情報</summary>
        <section class="md-section">
          <h2 class="md-section-title">診断</h2>
          <div id="diagArea" aria-live="polite"></div>
        </section>
      </details>
    </section>
  </main>

  <script src="src/js/verovio.js"></script>
  <script src="src/js/midi-writer.js"></script>
  <script src="src/js/main.js"></script>
</body>
</html>
