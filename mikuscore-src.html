<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mikuscore</title>
  <link rel="stylesheet" href="src/css/app.css" />
</head>
<body>
  <main class="ms-shell">
    <section class="ms-card">
      <h1 class="ms-title">mikuscore</h1>
      <p class="ms-intro">
        ブラウザ上で完結し、既存MusicXMLを壊さずに編集することを重視したスコアエディタです。
      </p>
      <ol class="ms-steps">
        <li>入力を選んで読み込み</li>
        <li>譜面プレビューで選択</li>
        <li>ノートを編集</li>
        <li>再生で確認して保存 / ダウンロード</li>
      </ol>
      <div class="ms-flow">
        <section class="ms-section ms-flow-step">
          <h2><span class="ms-step-no">1</span>MusicXML入力</h2>
          <div class="ms-radio-group" role="radiogroup" aria-label="入力方式">
            <label><input id="inputModeFile" type="radio" name="inputMode" value="file" checked /> ファイル読込</label>
            <label><input id="inputModeSource" type="radio" name="inputMode" value="source" /> ソース入力</label>
          </div>

          <div id="fileInputBlock" class="ms-block">
            <button id="fileSelectBtn" type="button">ファイルを選択</button>
            <span id="fileNameText">未選択</span>
            <input id="fileInput" type="file" accept=".musicxml,.xml,text/xml,application/xml" hidden />
          </div>

          <div id="sourceInputBlock" class="ms-block ms-hidden">
            <label for="xmlInput" class="ms-label">MusicXML</label>
            <textarea id="xmlInput" rows="12" spellcheck="false"></textarea>
          </div>

          <div class="ms-actions">
            <button id="loadBtn" type="button">読み込み</button>
          </div>
        </section>

        <section class="ms-section ms-flow-step">
          <h2><span class="ms-step-no">2</span>譜面プレビュー（クリックで選択）</h2>
          <p class="ms-label">Verovioレンダリング上の音符をクリックすると、編集対象として選択します。</p>
          <div class="ms-actions">
            <label class="ms-inline-check">
              <input id="debugLongSvgMode" type="checkbox" checked disabled />
              <span>改ページ抑制（ON固定）</span>
            </label>
            <button id="renderDebugScoreBtn" type="button">譜面再描画</button>
          </div>
          <p id="debugScoreMeta" class="ms-debug-meta">未描画</p>
          <div id="debugScoreWrap" class="ms-debug-wrap">
            <div id="debugScoreArea" class="ms-debug-score"></div>
          </div>
        </section>

        <section class="ms-section ms-flow-step">
          <h2><span class="ms-step-no">3</span>編集</h2>
          <p id="statusText">未ロード</p>
          <label for="noteSelect" class="ms-label">ノート選択 (nodeId)</label>
          <select id="noteSelect"></select>

          <div class="ms-grid">
            <label>音名(step)
              <select id="pitchStep">
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
                <option value="A">A</option>
                <option value="B">B</option>
              </select>
            </label>
            <label>変化記号(alter)
              <select id="pitchAlter">
                <option value="">none</option>
                <option value="-2">-2</option>
                <option value="-1">-1</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
              </select>
            </label>
            <label>オクターブ(octave)
              <input id="pitchOctave" type="number" min="0" max="9" step="1" value="4" />
            </label>
            <label>音価(duration)
              <input id="durationInput" type="number" min="1" step="1" value="1" />
            </label>
          </div>

          <div class="ms-actions">
            <button id="changePitchBtn" type="button">音高変更</button>
            <button id="changeDurationBtn" type="button">音価変更</button>
            <button id="insertAfterBtn" type="button">後ろに音符追加</button>
            <button id="deleteBtn" type="button">音符削除</button>
          </div>
        </section>

        <section class="ms-section ms-flow-step">
          <h2><span class="ms-step-no">4</span>検証 / 保存</h2>
          <div class="ms-actions">
            <button id="playBtn" type="button">再生</button>
            <button id="stopBtn" type="button" disabled>停止</button>
            <button id="saveBtn" type="button">保存</button>
            <button id="downloadBtn" type="button" disabled>XMLダウンロード</button>
          </div>
          <p id="playbackText">再生: 停止中</p>
          <p>保存モード: <span id="saveModeText">-</span></p>
          <label for="outputXml" class="ms-label">出力XML</label>
          <textarea id="outputXml" rows="12" readonly></textarea>
        </section>
      </div>

      <details class="ms-dev">
        <summary>詳細情報</summary>

        <section class="ms-section">
          <h2>診断</h2>
          <div id="diagArea" aria-live="polite"></div>
        </section>
      </details>
    </section>
  </main>

  <script src="src/js/verovio.js"></script>
  <script src="src/js/midi-writer.js"></script>
  <script src="src/js/main.js"></script>
</body>
</html>
