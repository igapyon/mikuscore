(function () {
const modules = {
  "src/ts/main.js": function (require, module, exports) {
"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
const ScoreCore_1 = require("../../core/ScoreCore");
const timeIndex_1 = require("../../core/timeIndex");
const abc_io_1 = require("./abc-io");
const mei_io_1 = require("./mei-io");
const lilypond_io_1 = require("./lilypond-io");
const musescore_io_1 = require("./musescore-io");
const vsqx_io_1 = require("./vsqx-io");
const musicxml_io_1 = require("./musicxml-io");
const download_flow_1 = require("./download-flow");
const midi_musescore_io_1 = require("./midi-musescore-io");
const load_flow_1 = require("./load-flow");
const mxl_io_1 = require("./mxl-io");
const playback_flow_1 = require("./playback-flow");
const preview_flow_1 = require("./preview-flow");
const sampleXml_1 = require("./sampleXml");
const sampleXml2_1 = require("./sampleXml2");
const midi_io_1 = require("./midi-io");
const DEFAULT_VOICE = "1";
const q = (selector) => {
    const el = document.querySelector(selector);
    if (!el)
        throw new Error(`Missing element: ${selector}`);
    return el;
};
const qo = (selector) => {
    return document.querySelector(selector);
};
const inputEntryFile = q("#inputEntryFile");
const inputEntrySource = q("#inputEntrySource");
const inputEntryNew = q("#inputEntryNew");
const sourceTypeBlock = q("#sourceTypeBlock");
const sourceTypeXml = q("#sourceTypeXml");
const sourceTypeMuseScore = q("#sourceTypeMuseScore");
const sourceTypeVsqx = q("#sourceTypeVsqx");
const sourceTypeAbc = q("#sourceTypeAbc");
const sourceTypeMei = q("#sourceTypeMei");
const sourceTypeLilyPond = q("#sourceTypeLilyPond");
const newInputBlock = q("#newInputBlock");
const newTemplatePianoGrandStaff = q("#newTemplatePianoGrandStaff");
const newPartCountInput = q("#newPartCount");
const newKeyFifthsSelect = q("#newKeyFifths");
const newTimeBeatsInput = q("#newTimeBeats");
const newTimeBeatTypeSelect = q("#newTimeBeatType");
const newPartClefList = q("#newPartClefList");
const fileInputBlock = q("#fileInputBlock");
const sourceXmlInputBlock = q("#sourceXmlInputBlock");
const abcInputBlock = q("#abcInputBlock");
const museScoreInputBlock = q("#museScoreInputBlock");
const vsqxInputBlock = q("#vsqxInputBlock");
const meiInputBlock = q("#meiInputBlock");
const lilyPondInputBlock = q("#lilyPondInputBlock");
const xmlInput = q("#xmlInput");
const abcInput = q("#abcInput");
const museScoreInput = q("#museScoreInput");
const vsqxInput = q("#vsqxInput");
const meiInput = q("#meiInput");
const lilyPondInput = q("#lilyPondInput");
const localDraftNotice = q("#localDraftNotice");
const localDraftText = q("#localDraftText");
const discardDraftExportBtn = q("#discardDraftExportBtn");
const loadSampleBtn1 = q("#loadSampleBtn1");
const loadSample2Btn = q("#loadSample2Btn");
const fileSelectBtn = q("#fileSelectBtn");
const fileInput = q("#fileInput");
const fileNameText = q("#fileNameText");
const zipEntrySelectBlock = q("#zipEntrySelectBlock");
const zipEntrySelect = q("#zipEntrySelect");
const fileLoadOverlay = q("#fileLoadOverlay");
const loadBtn = q("#loadBtn");
const noteSelect = qo("#noteSelect");
const statusText = qo("#statusText");
const pitchStep = q("#pitchStep");
const pitchStepValue = q("#pitchStepValue");
const pitchStepDownBtn = q("#pitchStepDownBtn");
const pitchStepUpBtn = q("#pitchStepUpBtn");
const pitchAlter = q("#pitchAlter");
const pitchAlterBtns = Array.from(document.querySelectorAll(".ms-alter-btn"));
const pitchOctave = q("#pitchOctave");
const durationPreset = q("#durationPreset");
const splitNoteBtn = q("#splitNoteBtn");
const convertRestBtn = q("#convertRestBtn");
const deleteBtn = q("#deleteBtn");
const playBtn = q("#playBtn");
const stopBtn = q("#stopBtn");
const scoreEditBtn = q("#scoreEditBtn");
const exportPlayBtn = q("#exportPlayBtn");
const exportStopBtn = q("#exportStopBtn");
const downloadSvgBtn = q("#downloadSvgBtn");
const playbackWaveform = q("#playbackWaveform");
const playbackUseMidiLike = q("#playbackUseMidiLike");
const graceTimingModeSelect = q("#graceTimingMode");
const metricAccentEnabledInput = q("#metricAccentEnabled");
const metricAccentProfileSelect = q("#metricAccentProfile");
const midiProgramSelect = q("#midiProgramSelect");
const midiExportProfileSelect = q("#midiExportProfile");
const midiImportQuantizeGridSelect = q("#midiImportQuantizeGrid");
const midiImportTripletAware = q("#midiImportTripletAware");
const forceMidiProgramOverride = q("#forceMidiProgramOverride");
const keepMksMetaMetadataInMusicXml = q("#keepMksMetaMetadataInMusicXml");
const keepMksSrcMetadataInMusicXml = q("#keepMksSrcMetadataInMusicXml");
const keepMksDbgMetadataInMusicXml = q("#keepMksDbgMetadataInMusicXml");
const exportMusicXmlAsXmlExtension = q("#exportMusicXmlAsXmlExtension");
const compressXmlMuseScoreExport = q("#compressXmlMuseScoreExport");
const generalSettingsAccordion = q("#generalSettingsAccordion");
const settingsAccordion = q("#settingsAccordion");
const resetPlaybackSettingsBtn = q("#resetPlaybackSettingsBtn");
const downloadBtn = q("#downloadBtn");
const downloadMidiBtn = q("#downloadMidiBtn");
const downloadVsqxBtn = q("#downloadVsqxBtn");
const downloadAbcBtn = q("#downloadAbcBtn");
const downloadMeiBtn = q("#downloadMeiBtn");
const downloadLilyPondBtn = q("#downloadLilyPondBtn");
const downloadMuseScoreBtn = q("#downloadMuseScoreBtn");
const downloadAllBtn = q("#downloadAllBtn");
const saveModeText = qo("#saveModeText");
const playbackText = qo("#playbackText");
const outputXml = qo("#outputXml");
const diagArea = qo("#diagArea");
const debugScoreMeta = qo("#debugScoreMeta");
const debugScoreArea = q("#debugScoreArea");
const scoreHeaderMetaText = q("#scoreHeaderMetaText");
const inputUiMessage = q("#inputUiMessage");
const uiMessage = q("#uiMessage");
const measurePartNameText = q("#measurePartNameText");
const measureEmptyState = q("#measureEmptyState");
const measureSelectGuideBtn = q("#measureSelectGuideBtn");
const measureEditorWrap = q("#measureEditorWrap");
const measureEditorArea = q("#measureEditorArea");
const editSubTabList = q("#editSubTabList");
const editSubTabEditorBtn = q("#editSubTabEditorBtn");
const editSubTabXmlBtn = q("#editSubTabXmlBtn");
const editSubTabEditorPanel = q("#editSubTabEditorPanel");
const editSubTabXmlPanel = q("#editSubTabXmlPanel");
const measureXmlInspector = q("#measureXmlInspector");
const measureXmlMeasureViewer = q("#measureXmlMeasureViewer");
const measureXmlDocumentViewer = q("#measureXmlDocumentViewer");
const measureApplyBtn = q("#measureApplyBtn");
const measureDiscardBtn = q("#measureDiscardBtn");
const measureNavLeftBtn = q("#measureNavLeftBtn");
const measureNavDownBtn = q("#measureNavDownBtn");
const measureNavUpBtn = q("#measureNavUpBtn");
const measureNavRightBtn = q("#measureNavRightBtn");
const appendMeasureBtn = q("#appendMeasureBtn");
const playMeasureBtn = q("#playMeasureBtn");
const downloadMeasureMusicXmlBtn = q("#downloadMeasureMusicXmlBtn");
const downloadMeasureMidiBtn = q("#downloadMeasureMidiBtn");
const topTabButtons = Array.from(document.querySelectorAll(".ms-top-tab"));
const topTabPanels = Array.from(document.querySelectorAll(".ms-tab-panel"));
const core = new ScoreCore_1.ScoreCore();
const state = {
    loaded: false,
    selectedNodeId: null,
    noteNodeIds: [],
    lastDispatchResult: null,
    lastSaveResult: null,
    lastSuccessfulSaveXml: "",
    importWarningSummary: "",
};
let isPlaying = false;
const DEBUG_LOG = false;
let verovioRenderSeq = 0;
let currentSvgIdToNodeId = new Map();
let nodeIdToLocation = new Map();
let partIdToName = new Map();
let partOrder = [];
let measureNumbersByPart = new Map();
let scoreTitleText = "";
let scoreComposerText = "";
let selectedMeasure = null;
let draftCore = null;
let draftNoteNodeIds = [];
let draftSvgIdToNodeId = new Map();
let activeEditSubTab = "editor";
let selectedDraftVoice = DEFAULT_VOICE;
let selectedDraftNoteIsRest = false;
let suppressDurationPresetEvent = false;
let selectedDraftDurationValue = null;
let isFileLoadInProgress = false;
const NOTE_CLICK_SNAP_PX = 170;
const DEFAULT_DIVISIONS = 480;
const MAX_NEW_PARTS = 16;
const LOCAL_DRAFT_STORAGE_KEY = "mikuscore.localDraft.v1";
const PLAYBACK_SETTINGS_STORAGE_KEY = "mikuscore.playbackSettings.v1";
const DEFAULT_MIDI_PROGRAM = "electric_piano_2";
const DEFAULT_PLAYBACK_WAVEFORM = "triangle";
const DEFAULT_PLAYBACK_USE_MIDI_LIKE = true;
const DEFAULT_FORCE_MIDI_PROGRAM_OVERRIDE = false;
const DEFAULT_MIDI_EXPORT_PROFILE = "musescore_parity";
const ZIP_IMPORT_EXTENSIONS = [
    ".musicxml",
    ".xml",
    ".mxl",
    ".abc",
    ".mid",
    ".midi",
    ".vsqx",
    ".mei",
    ".ly",
    ".mscx",
    ".mscz",
];
let selectedZipEntryVirtualFile = null;
const DEFAULT_MIDI_IMPORT_QUANTIZE_GRID = "1/64";
const DEFAULT_MIDI_IMPORT_TRIPLET_AWARE = true;
const DEFAULT_KEEP_MKS_META_METADATA_IN_MUSICXML = true;
const DEFAULT_KEEP_MKS_SRC_METADATA_IN_MUSICXML = true;
const DEFAULT_KEEP_MKS_DBG_METADATA_IN_MUSICXML = true;
const DEFAULT_EXPORT_MUSICXML_AS_XML_EXTENSION = false;
const DEFAULT_COMPRESS_XML_MUSESCORE_EXPORT = true;
const DEFAULT_GRACE_TIMING_MODE = "before_beat";
const DEFAULT_METRIC_ACCENT_ENABLED = true;
const DEFAULT_METRIC_ACCENT_PROFILE = "subtle";
const DEFAULT_VSQX_LYRIC = "ã‚‰";
const normalizeMidiProgram = (value) => {
    switch (value) {
        case "acoustic_grand_piano":
        case "electric_piano_1":
        case "electric_piano_2":
        case "honky_tonk_piano":
        case "harpsichord":
        case "clavinet":
        case "drawbar_organ":
        case "acoustic_guitar_nylon":
        case "acoustic_bass":
        case "violin":
        case "string_ensemble_1":
        case "synth_brass_1":
            return value;
        default:
            return DEFAULT_MIDI_PROGRAM;
    }
};
const normalizeWaveformSetting = (value) => {
    if (value === "triangle" || value === "square")
        return value;
    return DEFAULT_PLAYBACK_WAVEFORM;
};
const normalizeForceMidiProgramOverride = (value) => {
    return value === true;
};
const normalizeKeepMksMetadataInMusicXml = (value) => {
    return value !== false;
};
const normalizeCompressXmlMuseScoreExport = (value) => {
    return value === true;
};
const normalizeExportMusicXmlAsXmlExtension = (value) => {
    return value === true;
};
const normalizeUseMidiLikePlayback = (value) => {
    return value !== false;
};
const normalizeGraceTimingMode = (value) => {
    if (value === "on_beat" || value === "classical_equal")
        return value;
    return DEFAULT_GRACE_TIMING_MODE;
};
const normalizeMetricAccentEnabled = (value) => {
    return value === true;
};
const normalizeMetricAccentProfile = (value) => {
    if (value === "balanced" || value === "strong")
        return value;
    return DEFAULT_METRIC_ACCENT_PROFILE;
};
const normalizeMidiImportQuantizeGrid = (value) => {
    if (value === "1/8" || value === "1/16" || value === "1/32" || value === "1/64")
        return value;
    return DEFAULT_MIDI_IMPORT_QUANTIZE_GRID;
};
const normalizeMidiImportTripletAware = (value) => {
    return value !== false;
};
const readPlaybackSettings = () => {
    var _a, _b;
    try {
        const raw = localStorage.getItem(PLAYBACK_SETTINGS_STORAGE_KEY);
        if (!raw)
            return null;
        const parsed = JSON.parse(raw);
        const legacyKeepMetadataInMusicXml = normalizeKeepMksMetadataInMusicXml(parsed.keepMetadataInMusicXml);
        return {
            midiProgram: normalizeMidiProgram(String((_a = parsed.midiProgram) !== null && _a !== void 0 ? _a : "")),
            waveform: normalizeWaveformSetting(String((_b = parsed.waveform) !== null && _b !== void 0 ? _b : "")),
            useMidiLikePlayback: normalizeUseMidiLikePlayback(parsed.useMidiLikePlayback),
            graceTimingMode: normalizeGraceTimingMode(parsed.graceTimingMode),
            metricAccentEnabled: normalizeMetricAccentEnabled(parsed.metricAccentEnabled),
            metricAccentProfile: normalizeMetricAccentProfile(parsed.metricAccentProfile),
            midiExportProfile: (0, midi_musescore_io_1.normalizeMidiExportProfile)(parsed.midiExportProfile),
            midiImportQuantizeGrid: normalizeMidiImportQuantizeGrid(parsed.midiImportQuantizeGrid),
            midiImportTripletAware: normalizeMidiImportTripletAware(parsed.midiImportTripletAware),
            forceMidiProgramOverride: normalizeForceMidiProgramOverride(parsed.forceMidiProgramOverride),
            keepMksMetaMetadataInMusicXml: parsed.keepMksMetaMetadataInMusicXml === undefined
                ? legacyKeepMetadataInMusicXml
                : normalizeKeepMksMetadataInMusicXml(parsed.keepMksMetaMetadataInMusicXml),
            keepMksSrcMetadataInMusicXml: parsed.keepMksSrcMetadataInMusicXml === undefined
                ? legacyKeepMetadataInMusicXml
                : normalizeKeepMksMetadataInMusicXml(parsed.keepMksSrcMetadataInMusicXml),
            keepMksDbgMetadataInMusicXml: parsed.keepMksDbgMetadataInMusicXml === undefined
                ? legacyKeepMetadataInMusicXml
                : normalizeKeepMksMetadataInMusicXml(parsed.keepMksDbgMetadataInMusicXml),
            exportMusicXmlAsXmlExtension: normalizeExportMusicXmlAsXmlExtension(parsed.exportMusicXmlAsXmlExtension),
            compressXmlMuseScoreExport: normalizeCompressXmlMuseScoreExport(parsed.compressXmlMuseScoreExport),
            generalSettingsExpanded: Boolean(parsed.generalSettingsExpanded),
            settingsExpanded: Boolean(parsed.settingsExpanded),
        };
    }
    catch (_c) {
        return null;
    }
};
const writePlaybackSettings = () => {
    syncGeneralExportSettings();
    try {
        const payload = {
            midiProgram: normalizeMidiProgram(midiProgramSelect.value),
            waveform: normalizeWaveformSetting(playbackWaveform.value),
            useMidiLikePlayback: playbackUseMidiLike.checked,
            graceTimingMode: normalizeGraceTimingMode(graceTimingModeSelect.value),
            metricAccentEnabled: metricAccentEnabledInput.checked,
            metricAccentProfile: normalizeMetricAccentProfile(metricAccentProfileSelect.value),
            midiExportProfile: (0, midi_musescore_io_1.normalizeMidiExportProfile)(midiExportProfileSelect.value),
            midiImportQuantizeGrid: normalizeMidiImportQuantizeGrid(midiImportQuantizeGridSelect.value),
            midiImportTripletAware: midiImportTripletAware.checked,
            forceMidiProgramOverride: forceMidiProgramOverride.checked,
            keepMksMetaMetadataInMusicXml: keepMksMetaMetadataInMusicXml.checked,
            keepMksSrcMetadataInMusicXml: keepMksSrcMetadataInMusicXml.checked,
            keepMksDbgMetadataInMusicXml: keepMksDbgMetadataInMusicXml.checked,
            exportMusicXmlAsXmlExtension: exportMusicXmlAsXmlExtension.checked,
            compressXmlMuseScoreExport: compressXmlMuseScoreExport.checked,
            generalSettingsExpanded: generalSettingsAccordion.open,
            settingsExpanded: settingsAccordion.open,
        };
        localStorage.setItem(PLAYBACK_SETTINGS_STORAGE_KEY, JSON.stringify(payload));
    }
    catch (_a) {
        // Ignore quota/security errors in MVP.
    }
};
const syncGeneralExportSettings = () => {
    const useXmlExtension = exportMusicXmlAsXmlExtension.checked;
    if (useXmlExtension) {
        compressXmlMuseScoreExport.checked = false;
    }
};
const applyInitialPlaybackSettings = () => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
    const stored = readPlaybackSettings();
    midiProgramSelect.value = (_a = stored === null || stored === void 0 ? void 0 : stored.midiProgram) !== null && _a !== void 0 ? _a : DEFAULT_MIDI_PROGRAM;
    playbackWaveform.value = (_b = stored === null || stored === void 0 ? void 0 : stored.waveform) !== null && _b !== void 0 ? _b : DEFAULT_PLAYBACK_WAVEFORM;
    playbackUseMidiLike.checked = (_c = stored === null || stored === void 0 ? void 0 : stored.useMidiLikePlayback) !== null && _c !== void 0 ? _c : DEFAULT_PLAYBACK_USE_MIDI_LIKE;
    graceTimingModeSelect.value = (_d = stored === null || stored === void 0 ? void 0 : stored.graceTimingMode) !== null && _d !== void 0 ? _d : DEFAULT_GRACE_TIMING_MODE;
    metricAccentEnabledInput.checked = (_e = stored === null || stored === void 0 ? void 0 : stored.metricAccentEnabled) !== null && _e !== void 0 ? _e : DEFAULT_METRIC_ACCENT_ENABLED;
    metricAccentProfileSelect.value = (_f = stored === null || stored === void 0 ? void 0 : stored.metricAccentProfile) !== null && _f !== void 0 ? _f : DEFAULT_METRIC_ACCENT_PROFILE;
    midiExportProfileSelect.value = (_g = stored === null || stored === void 0 ? void 0 : stored.midiExportProfile) !== null && _g !== void 0 ? _g : DEFAULT_MIDI_EXPORT_PROFILE;
    midiImportQuantizeGridSelect.value =
        (_h = stored === null || stored === void 0 ? void 0 : stored.midiImportQuantizeGrid) !== null && _h !== void 0 ? _h : DEFAULT_MIDI_IMPORT_QUANTIZE_GRID;
    midiImportTripletAware.checked =
        (_j = stored === null || stored === void 0 ? void 0 : stored.midiImportTripletAware) !== null && _j !== void 0 ? _j : DEFAULT_MIDI_IMPORT_TRIPLET_AWARE;
    forceMidiProgramOverride.checked =
        (_k = stored === null || stored === void 0 ? void 0 : stored.forceMidiProgramOverride) !== null && _k !== void 0 ? _k : DEFAULT_FORCE_MIDI_PROGRAM_OVERRIDE;
    keepMksMetaMetadataInMusicXml.checked =
        (_l = stored === null || stored === void 0 ? void 0 : stored.keepMksMetaMetadataInMusicXml) !== null && _l !== void 0 ? _l : DEFAULT_KEEP_MKS_META_METADATA_IN_MUSICXML;
    keepMksSrcMetadataInMusicXml.checked =
        (_m = stored === null || stored === void 0 ? void 0 : stored.keepMksSrcMetadataInMusicXml) !== null && _m !== void 0 ? _m : DEFAULT_KEEP_MKS_SRC_METADATA_IN_MUSICXML;
    keepMksDbgMetadataInMusicXml.checked =
        (_o = stored === null || stored === void 0 ? void 0 : stored.keepMksDbgMetadataInMusicXml) !== null && _o !== void 0 ? _o : DEFAULT_KEEP_MKS_DBG_METADATA_IN_MUSICXML;
    exportMusicXmlAsXmlExtension.checked =
        (_p = stored === null || stored === void 0 ? void 0 : stored.exportMusicXmlAsXmlExtension) !== null && _p !== void 0 ? _p : DEFAULT_EXPORT_MUSICXML_AS_XML_EXTENSION;
    compressXmlMuseScoreExport.checked =
        (_q = stored === null || stored === void 0 ? void 0 : stored.compressXmlMuseScoreExport) !== null && _q !== void 0 ? _q : DEFAULT_COMPRESS_XML_MUSESCORE_EXPORT;
    syncGeneralExportSettings();
    generalSettingsAccordion.open = (_r = stored === null || stored === void 0 ? void 0 : stored.generalSettingsExpanded) !== null && _r !== void 0 ? _r : false;
    settingsAccordion.open = (_s = stored === null || stored === void 0 ? void 0 : stored.settingsExpanded) !== null && _s !== void 0 ? _s : false;
};
const onResetPlaybackSettings = () => {
    midiProgramSelect.value = DEFAULT_MIDI_PROGRAM;
    playbackWaveform.value = DEFAULT_PLAYBACK_WAVEFORM;
    playbackUseMidiLike.checked = DEFAULT_PLAYBACK_USE_MIDI_LIKE;
    graceTimingModeSelect.value = DEFAULT_GRACE_TIMING_MODE;
    metricAccentEnabledInput.checked = DEFAULT_METRIC_ACCENT_ENABLED;
    metricAccentProfileSelect.value = DEFAULT_METRIC_ACCENT_PROFILE;
    midiExportProfileSelect.value = DEFAULT_MIDI_EXPORT_PROFILE;
    midiImportQuantizeGridSelect.value = DEFAULT_MIDI_IMPORT_QUANTIZE_GRID;
    midiImportTripletAware.checked = DEFAULT_MIDI_IMPORT_TRIPLET_AWARE;
    forceMidiProgramOverride.checked = DEFAULT_FORCE_MIDI_PROGRAM_OVERRIDE;
    keepMksMetaMetadataInMusicXml.checked = DEFAULT_KEEP_MKS_META_METADATA_IN_MUSICXML;
    keepMksSrcMetadataInMusicXml.checked = DEFAULT_KEEP_MKS_SRC_METADATA_IN_MUSICXML;
    keepMksDbgMetadataInMusicXml.checked = DEFAULT_KEEP_MKS_DBG_METADATA_IN_MUSICXML;
    exportMusicXmlAsXmlExtension.checked = DEFAULT_EXPORT_MUSICXML_AS_XML_EXTENSION;
    compressXmlMuseScoreExport.checked = DEFAULT_COMPRESS_XML_MUSESCORE_EXPORT;
    syncGeneralExportSettings();
    writePlaybackSettings();
    renderControlState();
};
const getMksMetadataOutputSettings = () => {
    return {
        keepMeta: keepMksMetaMetadataInMusicXml.checked,
        keepSrc: keepMksSrcMetadataInMusicXml.checked,
        keepDbg: keepMksDbgMetadataInMusicXml.checked,
    };
};
const shouldRemoveMksField = (fieldName, settings) => {
    const lowered = fieldName.trim().toLowerCase();
    if (!lowered.startsWith("mks:"))
        return false;
    if (lowered.startsWith("mks:meta:"))
        return !settings.keepMeta;
    if (lowered.startsWith("mks:src:"))
        return !settings.keepSrc;
    if (lowered.startsWith("mks:dbg:"))
        return !settings.keepDbg;
    return false;
};
const stripMetadataFromMusicXml = (xml, settings) => {
    var _a;
    if (settings.keepMeta && settings.keepSrc && settings.keepDbg)
        return xml;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!doc)
        return xml;
    const fields = Array.from(doc.querySelectorAll('part > measure > attributes > miscellaneous > miscellaneous-field[name^="mks:"]'));
    for (const field of fields) {
        const name = (_a = field.getAttribute("name")) !== null && _a !== void 0 ? _a : "";
        if (!shouldRemoveMksField(name, settings))
            continue;
        field.remove();
    }
    for (const misc of Array.from(doc.querySelectorAll("part > measure > attributes > miscellaneous"))) {
        if (misc.querySelector("miscellaneous-field"))
            continue;
        misc.remove();
    }
    for (const attributes of Array.from(doc.querySelectorAll("part > measure > attributes"))) {
        if (attributes.children.length > 0)
            continue;
        attributes.remove();
    }
    return (0, musicxml_io_1.serializeMusicXmlDocument)(doc);
};
const summarizeImportedDiagWarnings = (xml) => {
    var _a, _b, _c;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!doc)
        return "";
    let overfullReflowCount = 0;
    let parserWarningCount = 0;
    const fields = Array.from(doc.querySelectorAll('miscellaneous-field[name^="mks:diag:"]'));
    for (const field of fields) {
        const name = (field.getAttribute("name") || "").trim().toLowerCase();
        if (name === "mks:diag:count")
            continue;
        const payload = (_b = (_a = field.textContent) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        const m = payload.match(/(?:^|;)code=([^;]+)/);
        const code = ((_c = m === null || m === void 0 ? void 0 : m[1]) !== null && _c !== void 0 ? _c : "").trim().toUpperCase();
        if (code === "OVERFULL_REFLOWED")
            overfullReflowCount += 1;
        if (code === "ABC_IMPORT_WARNING")
            parserWarningCount += 1;
    }
    const parts = [];
    if (overfullReflowCount > 0)
        parts.push(`ABC overfull auto-reflow: ${overfullReflowCount}`);
    if (parserWarningCount > 0)
        parts.push(`ABC parser warnings: ${parserWarningCount}`);
    return parts.join(" / ");
};
const resolveMusicXmlOutput = () => {
    if (!state.lastSuccessfulSaveXml)
        return "";
    return stripMetadataFromMusicXml(state.lastSuccessfulSaveXml, getMksMetadataOutputSettings());
};
const logDiagnostics = (phase, diagnostics, warnings = []) => {
    if (!DEBUG_LOG)
        return;
    for (const d of diagnostics) {
        console.error(`[mikuscore][${phase}][${d.code}] ${d.message}`);
    }
    for (const w of warnings) {
        console.warn(`[mikuscore][${phase}][${w.code}] ${w.message}`);
    }
};
const dumpOverfullContext = (xml, voice) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    if (!DEBUG_LOG)
        return;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!doc) {
        console.error("[mikuscore][debug] XML parse failed while dumping overfull context.");
        return;
    }
    const measures = Array.from(doc.querySelectorAll("part > measure"));
    let found = false;
    for (const measure of measures) {
        const number = (_a = measure.getAttribute("number")) !== null && _a !== void 0 ? _a : "(no-number)";
        const divisionsText = (_d = (_c = (_b = measure.querySelector("attributes > divisions")) === null || _b === void 0 ? void 0 : _b.textContent) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "(inherit)";
        const beatsText = (_g = (_f = (_e = measure.querySelector("attributes > time > beats")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) !== null && _g !== void 0 ? _g : "(inherit)";
        const beatTypeText = (_k = (_j = (_h = measure.querySelector("attributes > time > beat-type")) === null || _h === void 0 ? void 0 : _h.textContent) === null || _j === void 0 ? void 0 : _j.trim()) !== null && _k !== void 0 ? _k : "(inherit)";
        const noteRows = [];
        const occupied = (0, timeIndex_1.getOccupiedTime)(measure, voice);
        Array.from(measure.children).forEach((child, idx) => {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
            if (child.tagName !== "note")
                return;
            const noteVoice = (_c = (_b = (_a = child.querySelector("voice")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
            const duration = Number((_f = (_e = (_d = child.querySelector("duration")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "");
            const isRest = Boolean(child.querySelector("rest"));
            const step = (_j = (_h = (_g = child.querySelector("pitch > step")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "";
            const alter = (_l = (_k = child.querySelector("pitch > alter")) === null || _k === void 0 ? void 0 : _k.textContent) === null || _l === void 0 ? void 0 : _l.trim();
            const octave = (_p = (_o = (_m = child.querySelector("pitch > octave")) === null || _m === void 0 ? void 0 : _m.textContent) === null || _o === void 0 ? void 0 : _o.trim()) !== null && _p !== void 0 ? _p : "";
            const alterText = alter ? `${alter >= "0" ? "+" : ""}${alter}` : "";
            const pitch = isRest ? "rest" : `${step}${alterText}${octave ? octave : ""}`;
            noteRows.push({
                idx,
                voice: noteVoice || "(none)",
                duration: Number.isFinite(duration) ? duration : NaN,
                pitch,
                isRest,
            });
        });
        const capacity = (0, timeIndex_1.getMeasureCapacity)(measure);
        if (capacity === null)
            continue;
        if (occupied <= capacity)
            continue;
        found = true;
        console.groupCollapsed(`[mikuscore][debug][MEASURE_OVERFULL] measure=${number} occupied=${occupied} capacity=${capacity}`);
        console.log({
            measure: number,
            voice,
            divisions: divisionsText,
            beats: beatsText,
            beatType: beatTypeText,
            occupied,
            capacity,
        });
        console.table(noteRows);
        console.groupEnd();
    }
    if (!found) {
        console.warn("[mikuscore][debug] no overfull measure found while dumping context.");
    }
};
const readLocalDraft = () => {
    try {
        const raw = localStorage.getItem(LOCAL_DRAFT_STORAGE_KEY);
        if (!raw)
            return null;
        const parsed = JSON.parse(raw);
        if (typeof parsed.xml !== "string" || !parsed.xml.trim())
            return null;
        if (!Number.isFinite(parsed.updatedAt))
            return null;
        return {
            xml: parsed.xml,
            updatedAt: Number(parsed.updatedAt),
        };
    }
    catch (_a) {
        return null;
    }
};
const writeLocalDraft = (xml) => {
    const normalized = String(xml || "").trim();
    if (!normalized)
        return;
    try {
        const payload = {
            xml: normalized,
            updatedAt: Date.now(),
        };
        localStorage.setItem(LOCAL_DRAFT_STORAGE_KEY, JSON.stringify(payload));
    }
    catch (_a) {
        // Ignore quota/security errors in MVP.
    }
};
const clearLocalDraft = () => {
    try {
        localStorage.removeItem(LOCAL_DRAFT_STORAGE_KEY);
    }
    catch (_a) {
        // Ignore quota/security errors in MVP.
    }
};
const formatLocalDraftTime = (timestamp) => {
    if (!Number.isFinite(timestamp) || timestamp <= 0)
        return "unknown";
    const date = new Date(timestamp);
    if (Number.isNaN(date.getTime()))
        return "unknown";
    try {
        return new Intl.DateTimeFormat("en-US", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            hour12: false,
        }).format(date);
    }
    catch (_a) {
        return date.toISOString();
    }
};
const renderLocalDraftUi = () => {
    const draft = readLocalDraft();
    const hasDraft = Boolean(draft);
    const inputPanelVisible = topTabPanels.some((panel) => panel.dataset.tabPanel === "input" && !panel.hidden);
    const showNotice = hasDraft && inputPanelVisible;
    localDraftNotice.classList.toggle("md-hidden", !showNotice);
    discardDraftExportBtn.classList.remove("md-hidden");
    discardDraftExportBtn.disabled = !hasDraft;
    if (!showNotice || !draft) {
        localDraftText.textContent = "";
        return;
    }
    localDraftText.textContent = `Local draft exists (saved at ${formatLocalDraftTime(draft.updatedAt)}).`;
};
const applyInitialXmlInputValue = () => {
    const draft = readLocalDraft();
    if (draft) {
        xmlInput.value = draft.xml;
        return;
    }
    xmlInput.value = sampleXml_1.sampleXml;
};
const getSelectedSourceType = () => {
    if (sourceTypeMuseScore.checked)
        return "musescore";
    if (sourceTypeVsqx.checked)
        return "vsqx";
    if (sourceTypeAbc.checked)
        return "abc";
    if (sourceTypeMei.checked)
        return "mei";
    if (sourceTypeLilyPond.checked)
        return "lilypond";
    return "xml";
};
const renderInputMode = () => {
    const isNewEntry = inputEntryNew.checked;
    const isFileEntry = inputEntryFile.checked;
    const isSourceEntry = inputEntrySource.checked;
    const sourceType = getSelectedSourceType();
    newInputBlock.classList.toggle("md-hidden", !isNewEntry);
    sourceTypeBlock.classList.toggle("md-hidden", !isSourceEntry);
    fileInputBlock.classList.toggle("md-hidden", !isFileEntry);
    sourceXmlInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "xml");
    museScoreInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "musescore");
    vsqxInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "vsqx");
    abcInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "abc");
    meiInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "mei");
    lilyPondInputBlock.classList.toggle("md-hidden", !isSourceEntry || sourceType !== "lilypond");
    sourceTypeXml.disabled = !isSourceEntry;
    sourceTypeMuseScore.disabled = !isSourceEntry;
    sourceTypeVsqx.disabled = !isSourceEntry;
    sourceTypeAbc.disabled = !isSourceEntry;
    sourceTypeMei.disabled = !isSourceEntry;
    sourceTypeLilyPond.disabled = !isSourceEntry;
    fileSelectBtn.classList.toggle("md-hidden", !isFileEntry);
    loadBtn.classList.toggle("md-hidden", isFileEntry);
    const loadLabel = loadBtn.querySelector("span");
    if (loadLabel) {
        loadLabel.textContent = isNewEntry ? "Create" : "Load";
    }
};
const resetZipEntrySelectionUi = () => {
    zipEntrySelect.innerHTML = "";
    zipEntrySelectBlock.classList.add("md-hidden");
    selectedZipEntryVirtualFile = null;
};
const setFileLoadInProgress = (inProgress) => {
    isFileLoadInProgress = inProgress;
    fileSelectBtn.disabled = inProgress;
    loadBtn.disabled = inProgress;
    zipEntrySelect.disabled = inProgress;
    fileInputBlock.setAttribute("aria-busy", inProgress ? "true" : "false");
    fileLoadOverlay.classList.toggle("md-hidden", !inProgress);
    fileLoadOverlay.setAttribute("aria-hidden", inProgress ? "false" : "true");
};
const waitForNextPaint = async () => {
    await new Promise((resolve) => {
        requestAnimationFrame(() => resolve());
    });
};
const isZipFileName = (name) => {
    return name.toLowerCase().endsWith(".zip");
};
const loadZipEntryAsVirtualFile = async (archive, entryPath) => {
    const entryBytes = await (0, mxl_io_1.extractZipEntryBytesByPath)(await archive.arrayBuffer(), entryPath);
    const copiedBuffer = new ArrayBuffer(entryBytes.byteLength);
    new Uint8Array(copiedBuffer).set(entryBytes);
    return new File([copiedBuffer], entryPath, { type: "application/octet-stream" });
};
const prepareZipEntrySelection = async (archive) => {
    resetZipEntrySelectionUi();
    let entryPaths = [];
    try {
        entryPaths = await (0, mxl_io_1.listZipRootEntryPathsByExtensions)(await archive.arrayBuffer(), [...ZIP_IMPORT_EXTENSIONS]);
    }
    catch (error) {
        return {
            ok: false,
            message: `Failed to parse ZIP: ${error instanceof Error ? error.message : String(error)}`,
        };
    }
    if (!entryPaths.length) {
        return {
            ok: false,
            message: "No supported root files were found in ZIP. Use root-level .musicxml, .xml, .mxl, .abc, .mid, .midi, .vsqx, .mei, .ly, .mscx, or .mscz.",
        };
    }
    zipEntrySelectBlock.classList.remove("md-hidden");
    if (entryPaths.length === 1) {
        const onlyOption = document.createElement("option");
        onlyOption.value = entryPaths[0];
        onlyOption.textContent = entryPaths[0];
        zipEntrySelect.appendChild(onlyOption);
        try {
            selectedZipEntryVirtualFile = await loadZipEntryAsVirtualFile(archive, entryPaths[0]);
            return { ok: true, autoLoad: true };
        }
        catch (error) {
            return {
                ok: false,
                message: `Failed to read ZIP entry: ${error instanceof Error ? error.message : String(error)}`,
            };
        }
    }
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "Select a ZIP root entry";
    placeholder.disabled = true;
    placeholder.selected = true;
    zipEntrySelect.appendChild(placeholder);
    for (const path of entryPaths) {
        const option = document.createElement("option");
        option.value = path;
        option.textContent = path;
        zipEntrySelect.appendChild(option);
    }
    selectedZipEntryVirtualFile = null;
    return { ok: true, autoLoad: false };
};
const normalizeNewPartCount = () => {
    const raw = Number(newPartCountInput.value);
    const bounded = Number.isFinite(raw) ? Math.max(1, Math.min(MAX_NEW_PARTS, Math.round(raw))) : 1;
    newPartCountInput.value = String(bounded);
    return bounded;
};
const normalizeNewTimeBeats = () => {
    const raw = Number(newTimeBeatsInput.value);
    const bounded = Number.isFinite(raw) ? Math.max(1, Math.min(16, Math.round(raw))) : 4;
    newTimeBeatsInput.value = String(bounded);
    return bounded;
};
const normalizeNewTimeBeatType = () => {
    const raw = Number(newTimeBeatTypeSelect.value);
    const allowed = new Set([2, 4, 8, 16]);
    const normalized = allowed.has(raw) ? raw : 4;
    newTimeBeatTypeSelect.value = String(normalized);
    return normalized;
};
const normalizeClefKeyword = (raw) => {
    const clef = String(raw || "").trim().toLowerCase();
    if (clef === "treble" || clef === "alto" || clef === "bass")
        return clef;
    return "treble";
};
const listCurrentNewPartClefs = () => {
    return Array.from(newPartClefList.querySelectorAll("select[data-part-clef]")).map((select) => normalizeClefKeyword(select.value));
};
const renderNewPartClefControls = () => {
    var _a;
    const usePianoGrandStaffTemplate = newTemplatePianoGrandStaff.checked;
    newPartCountInput.disabled = usePianoGrandStaffTemplate;
    if (usePianoGrandStaffTemplate) {
        newPartClefList.innerHTML = "";
        const message = document.createElement("div");
        message.className = "ms-field-label";
        message.textContent = "Template: single part with 2 staves (staff 1: treble, staff 2: bass).";
        newPartClefList.appendChild(message);
        return;
    }
    const count = normalizeNewPartCount();
    const previous = listCurrentNewPartClefs();
    newPartClefList.innerHTML = "";
    for (let i = 0; i < count; i += 1) {
        const row = document.createElement("div");
        row.className = "ms-form-row";
        const label = document.createElement("label");
        label.className = "ms-field";
        label.textContent = `Part ${i + 1} clef`;
        const select = document.createElement("select");
        select.className = "md-select";
        select.setAttribute("data-part-clef", "true");
        const options = [
            { value: "treble", label: "Treble clef" },
            { value: "alto", label: "Alto clef" },
            { value: "bass", label: "Bass clef" },
        ];
        for (const optionDef of options) {
            const option = document.createElement("option");
            option.value = optionDef.value;
            option.textContent = optionDef.label;
            select.appendChild(option);
        }
        select.value = normalizeClefKeyword((_a = previous[i]) !== null && _a !== void 0 ? _a : "treble");
        label.appendChild(select);
        row.appendChild(label);
        newPartClefList.appendChild(row);
    }
};
const renderStatus = () => {
    if (!statusText)
        return;
    const dirty = core.isDirty();
    statusText.textContent = state.loaded
        ? `Loaded / dirty=${dirty}  / notes=${state.noteNodeIds.length}`
        : "Not loaded (please load first)";
};
const renderScoreHeaderMeta = () => {
    if (!state.loaded) {
        scoreHeaderMetaText.textContent = "";
        scoreHeaderMetaText.classList.add("md-hidden");
        return;
    }
    const title = scoreTitleText || "Untitled";
    const composer = scoreComposerText || "Unknown";
    scoreHeaderMetaText.textContent = `Title: ${title} / Composer: ${composer}`;
    scoreHeaderMetaText.classList.remove("md-hidden");
};
const renderNotes = () => {
    const selectedNodeId = state.selectedNodeId && draftNoteNodeIds.includes(state.selectedNodeId)
        ? state.selectedNodeId
        : null;
    state.selectedNodeId = selectedNodeId;
    if (!noteSelect)
        return;
    noteSelect.innerHTML = "";
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = draftNoteNodeIds.length === 0 ? "(No notes)" : "(Select one)";
    noteSelect.appendChild(placeholder);
    for (const nodeId of draftNoteNodeIds) {
        const option = document.createElement("option");
        option.value = nodeId;
        option.textContent = nodeId;
        noteSelect.appendChild(option);
    }
    if (selectedNodeId) {
        noteSelect.value = selectedNodeId;
    }
    else {
        noteSelect.value = "";
    }
};
const isPitchStepValue = (value) => {
    return value === "A" || value === "B" || value === "C" || value === "D" || value === "E" || value === "F" || value === "G";
};
const renderPitchStepValue = () => {
    const step = pitchStep.value.trim();
    if (isPitchStepValue(step)) {
        pitchStepValue.textContent = step;
    }
    else {
        pitchStepValue.textContent = "Rest";
    }
};
const normalizeAlterValue = (value) => {
    const v = value.trim();
    if (v === "none")
        return "none";
    if (v === "-2" || v === "-1" || v === "0" || v === "1" || v === "2")
        return v;
    if (v === "")
        return "none";
    return "none";
};
const resolveEffectiveDivisionsForMeasure = (doc, targetMeasure) => {
    var _a, _b, _c;
    if (!targetMeasure)
        return DEFAULT_DIVISIONS;
    const part = targetMeasure.closest("part");
    if (!part)
        return DEFAULT_DIVISIONS;
    let divisions = null;
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const divisionsText = (_c = (_b = (_a = measure.querySelector(":scope > attributes > divisions")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
        const parsed = Number(divisionsText);
        if (Number.isInteger(parsed) && parsed > 0) {
            divisions = parsed;
        }
        if (measure === targetMeasure)
            break;
    }
    return divisions !== null && divisions !== void 0 ? divisions : DEFAULT_DIVISIONS;
};
const rebuildDurationPresetOptions = (divisions) => {
    const safeDivisions = Number.isInteger(divisions) && divisions > 0 ? divisions : DEFAULT_DIVISIONS;
    const defs = [
        { label: "Whole note", num: 4, den: 1 },
        { label: "Dotted half note", num: 3, den: 1 },
        { label: "Half note", num: 2, den: 1 },
        { label: "Half-note triplet (1 note)", num: 4, den: 3 },
        { label: "Dotted quarter note", num: 3, den: 2 },
        { label: "Quarter note", num: 1, den: 1 },
        { label: "Quarter-note triplet (1 note)", num: 2, den: 3 },
        { label: "Dotted eighth note", num: 3, den: 4 },
        { label: "Eighth note", num: 1, den: 2 },
        { label: "Eighth-note triplet (1 note)", num: 1, den: 3 },
        { label: "Dotted sixteenth note", num: 3, den: 8 },
        { label: "Sixteenth note", num: 1, den: 4 },
        { label: "Sixteenth-note triplet (1 note)", num: 1, den: 6 },
        { label: "3Half note", num: 1, den: 8 },
        { label: "6Quarter note", num: 1, den: 16 },
    ];
    durationPreset.innerHTML = "";
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "(Select duration)";
    durationPreset.appendChild(placeholder);
    const used = new Set();
    for (const def of defs) {
        const raw = (safeDivisions * def.num) / def.den;
        if (!Number.isInteger(raw) || raw <= 0)
            continue;
        if (used.has(raw))
            continue;
        used.add(raw);
        const option = document.createElement("option");
        option.value = String(raw);
        option.textContent = `${def.label}(${raw})`;
        durationPreset.appendChild(option);
    }
};
const hasDurationPresetValue = (duration) => {
    return Array.from(durationPreset.options).some((opt) => Number(opt.value) === duration);
};
const setDurationPresetFromValue = (duration) => {
    suppressDurationPresetEvent = true;
    Array.from(durationPreset.querySelectorAll("option.ms-duration-custom")).forEach((opt) => opt.remove());
    if (!Number.isInteger(duration) || (duration !== null && duration !== void 0 ? duration : 0) <= 0) {
        durationPreset.value = "";
        suppressDurationPresetEvent = false;
        return;
    }
    if (hasDurationPresetValue(duration)) {
        durationPreset.value = String(duration);
        suppressDurationPresetEvent = false;
        return;
    }
    const custom = document.createElement("option");
    custom.value = String(duration);
    custom.textContent = `Custom(${duration})`;
    custom.className = "ms-duration-custom";
    durationPreset.appendChild(custom);
    durationPreset.value = custom.value;
    suppressDurationPresetEvent = false;
};
const durationValueIsTriplet = (duration, divisions) => {
    if (!Number.isInteger(duration) || duration <= 0)
        return false;
    if (!Number.isInteger(divisions) || divisions <= 0)
        return false;
    return (duration === (divisions * 4) / 3 ||
        duration === (divisions * 2) / 3 ||
        duration === divisions / 3 ||
        duration === divisions / 6);
};
const noteHasTupletContextInMeasure = (note) => {
    var _a, _b, _c, _d, _e, _f;
    const measure = note.closest("measure");
    if (!measure)
        return false;
    const voice = (_c = (_b = (_a = note.querySelector(":scope > voice")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
    if (!voice)
        return false;
    const notes = Array.from(measure.children).filter((child) => child.tagName === "note");
    for (const candidate of notes) {
        const candidateVoice = (_f = (_e = (_d = candidate.querySelector(":scope > voice")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
        if (candidateVoice !== voice)
            continue;
        if (candidate.querySelector(":scope > time-modification"))
            return true;
        if (candidate.querySelector(":scope > notations > tuplet"))
            return true;
    }
    return false;
};
const applyDurationPresetAvailability = (selectedNote, divisions) => {
    var _a, _b;
    const hasTupletContext = noteHasTupletContextInMeasure(selectedNote);
    for (const option of Array.from(durationPreset.options)) {
        if (!option.value) {
            option.disabled = false;
            continue;
        }
        const value = Number(option.value);
        const isTriplet = durationValueIsTriplet(value, divisions);
        const unavailable = isTriplet && !hasTupletContext;
        option.disabled = unavailable;
        const baseLabel = (_b = (_a = option.textContent) === null || _a === void 0 ? void 0 : _a.replace(" (not allowed in this measure)", "").trim()) !== null && _b !== void 0 ? _b : "";
        option.textContent = unavailable ? `${baseLabel} (not allowed in this measure)` : baseLabel;
    }
};
const renderAlterButtons = () => {
    var _a;
    const active = normalizeAlterValue(pitchAlter.value);
    pitchAlter.value = active;
    for (const btn of pitchAlterBtns) {
        const value = normalizeAlterValue((_a = btn.dataset.alter) !== null && _a !== void 0 ? _a : "");
        const isActive = value === active;
        btn.classList.toggle("is-active", isActive);
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
    }
};
const syncStepFromSelectedDraftNote = () => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
    selectedDraftVoice = DEFAULT_VOICE;
    selectedDraftNoteIsRest = false;
    pitchStep.disabled = false;
    pitchStep.title = "";
    pitchOctave.title = "Automatically adjusted with pitch step up/down.";
    for (const btn of pitchAlterBtns) {
        btn.disabled = false;
        btn.title = "";
    }
    if (!draftCore || !state.selectedNodeId) {
        selectedDraftVoice = DEFAULT_VOICE;
        selectedDraftDurationValue = null;
        rebuildDurationPresetOptions(DEFAULT_DIVISIONS);
        setDurationPresetFromValue(null);
        pitchStep.value = "";
        pitchAlter.value = "none";
        renderPitchStepValue();
        renderAlterButtons();
        return;
    }
    const xml = draftCore.debugSerializeCurrentXml();
    if (!xml) {
        selectedDraftVoice = DEFAULT_VOICE;
        selectedDraftDurationValue = null;
        rebuildDurationPresetOptions(DEFAULT_DIVISIONS);
        setDurationPresetFromValue(null);
        pitchStep.value = "";
        pitchAlter.value = "none";
        renderPitchStepValue();
        renderAlterButtons();
        return;
    }
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!doc) {
        selectedDraftVoice = DEFAULT_VOICE;
        selectedDraftDurationValue = null;
        rebuildDurationPresetOptions(DEFAULT_DIVISIONS);
        setDurationPresetFromValue(null);
        pitchStep.value = "";
        pitchAlter.value = "none";
        renderPitchStepValue();
        renderAlterButtons();
        return;
    }
    const notes = Array.from(doc.querySelectorAll("note"));
    const count = Math.min(notes.length, draftNoteNodeIds.length);
    for (let i = 0; i < count; i += 1) {
        if (draftNoteNodeIds[i] !== state.selectedNodeId)
            continue;
        selectedDraftVoice = ((_b = (_a = notes[i].querySelector(":scope > voice")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || DEFAULT_VOICE;
        const measure = notes[i].closest("measure");
        const divisions = resolveEffectiveDivisionsForMeasure(doc, measure);
        rebuildDurationPresetOptions(divisions);
        applyDurationPresetAvailability(notes[i], divisions);
        const durationText = (_e = (_d = (_c = notes[i].querySelector(":scope > duration")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) !== null && _e !== void 0 ? _e : "";
        const durationNumber = Number(durationText);
        if (Number.isInteger(durationNumber) && durationNumber > 0) {
            selectedDraftDurationValue = durationNumber;
            setDurationPresetFromValue(durationNumber);
        }
        else {
            selectedDraftDurationValue = null;
            setDurationPresetFromValue(null);
        }
        const alterText = (_h = (_g = (_f = notes[i].querySelector(":scope > pitch > alter")) === null || _f === void 0 ? void 0 : _f.textContent) === null || _g === void 0 ? void 0 : _g.trim()) !== null && _h !== void 0 ? _h : "";
        const accidentalText = (_l = (_k = (_j = notes[i].querySelector(":scope > accidental")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) !== null && _l !== void 0 ? _l : "";
        const alterNumber = Number(alterText);
        if (alterText === "") {
            if (accidentalText === "natural") {
                pitchAlter.value = "0";
            }
            else if (accidentalText === "flat") {
                pitchAlter.value = "-1";
            }
            else if (accidentalText === "flat-flat") {
                pitchAlter.value = "-2";
            }
            else if (accidentalText === "sharp") {
                pitchAlter.value = "1";
            }
            else if (accidentalText === "double-sharp") {
                pitchAlter.value = "2";
            }
            else {
                pitchAlter.value = "none";
            }
        }
        else if (Number.isInteger(alterNumber) && alterNumber >= -2 && alterNumber <= 2) {
            pitchAlter.value = String(alterNumber);
        }
        else {
            pitchAlter.value = "none";
        }
        if (notes[i].querySelector(":scope > rest")) {
            selectedDraftNoteIsRest = true;
            pitchStep.value = "";
            pitchStep.disabled = true;
            pitchStep.title = "Rests do not have pitch. Pitch changes are disabled.";
            for (const btn of pitchAlterBtns) {
                btn.disabled = true;
                btn.title = "Rests do not have pitch. Pitch changes are disabled.";
            }
            pitchOctave.title = "Automatically adjusted with pitch step up/down.";
            renderPitchStepValue();
            renderAlterButtons();
            return;
        }
        const stepText = (_p = (_o = (_m = notes[i].querySelector(":scope > pitch > step")) === null || _m === void 0 ? void 0 : _m.textContent) === null || _o === void 0 ? void 0 : _o.trim()) !== null && _p !== void 0 ? _p : "";
        if (isPitchStepValue(stepText)) {
            pitchStep.value = stepText;
        }
        const octaveText = (_s = (_r = (_q = notes[i].querySelector(":scope > pitch > octave")) === null || _q === void 0 ? void 0 : _q.textContent) === null || _r === void 0 ? void 0 : _r.trim()) !== null && _s !== void 0 ? _s : "";
        const octaveNumber = Number(octaveText);
        if (Number.isInteger(octaveNumber) && octaveNumber >= 0 && octaveNumber <= 9) {
            pitchOctave.value = String(octaveNumber);
        }
        renderPitchStepValue();
        renderAlterButtons();
        return;
    }
    selectedDraftVoice = DEFAULT_VOICE;
    selectedDraftDurationValue = null;
    rebuildDurationPresetOptions(DEFAULT_DIVISIONS);
    setDurationPresetFromValue(null);
    renderPitchStepValue();
    renderAlterButtons();
};
const renderMeasureEditorState = () => {
    var _a;
    if (!selectedMeasure || !draftCore) {
        measurePartNameText.textContent = "";
        measurePartNameText.classList.add("md-hidden");
        measureEmptyState.classList.remove("md-hidden");
        measureEditorWrap.classList.add("md-hidden");
        measureXmlMeasureViewer.value = "";
        measureXmlDocumentViewer.value = "";
        renderEditSubTabState(false);
        measureApplyBtn.disabled = true;
        measureDiscardBtn.disabled = true;
        return;
    }
    const partName = (_a = partIdToName.get(selectedMeasure.partId)) !== null && _a !== void 0 ? _a : selectedMeasure.partId;
    measurePartNameText.textContent = partName;
    measurePartNameText.classList.remove("md-hidden");
    measureEmptyState.classList.add("md-hidden");
    measureEditorWrap.classList.remove("md-hidden");
    renderEditSubTabState(true);
    const inspectorText = buildMeasureXmlInspectorText();
    measureXmlMeasureViewer.value = inspectorText.measureOnly;
    measureXmlDocumentViewer.value = inspectorText.selfContainedDocument;
    const hasDirtyDraft = draftCore.isDirty();
    measureDiscardBtn.disabled = !hasDirtyDraft;
    measureApplyBtn.disabled = !hasDirtyDraft;
};
const serializeElementXml = (element) => {
    return new XMLSerializer().serializeToString(element);
};
const collectEffectiveSrcFieldsForSelectedMeasure = () => {
    var _a, _b, _c, _d, _e;
    if (!selectedMeasure)
        return [];
    const xml = (_a = core.debugSerializeCurrentXml()) !== null && _a !== void 0 ? _a : "";
    if (!xml)
        return [];
    const sourceDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!sourceDoc)
        return [];
    const part = sourceDoc.querySelector(`score-partwise > part[id="${CSS.escape(selectedMeasure.partId)}"]`);
    if (!part)
        return [];
    const latestByName = new Map();
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const attrs = measure.querySelector(":scope > attributes");
        if (attrs) {
            const srcFields = attrs.querySelectorAll(':scope > miscellaneous > miscellaneous-field[name^="mks:src:mei:"]');
            for (const field of Array.from(srcFields)) {
                const name = ((_b = field.getAttribute("name")) !== null && _b !== void 0 ? _b : "").trim();
                if (!name)
                    continue;
                latestByName.set(name, (_d = (_c = field.textContent) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "");
            }
        }
        if (((_e = measure.getAttribute("number")) !== null && _e !== void 0 ? _e : "") === selectedMeasure.measureNumber) {
            break;
        }
    }
    return Array.from(latestByName.entries()).map(([name, value]) => ({ name, value }));
};
const injectSrcFieldsIntoSelfContainedXml = (selfContainedXml, fields) => {
    if (fields.length === 0)
        return selfContainedXml;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(selfContainedXml);
    if (!doc)
        return selfContainedXml;
    const measure = doc.querySelector("part > measure");
    if (!measure)
        return selfContainedXml;
    let attrs = measure.querySelector(":scope > attributes");
    if (!attrs) {
        attrs = doc.createElement("attributes");
        measure.insertBefore(attrs, measure.firstChild);
    }
    let miscellaneous = attrs.querySelector(":scope > miscellaneous");
    if (!miscellaneous) {
        miscellaneous = doc.createElement("miscellaneous");
        attrs.appendChild(miscellaneous);
    }
    const existingNames = new Set(Array.from(miscellaneous.querySelectorAll(":scope > miscellaneous-field"))
        .map((field) => { var _a; return ((_a = field.getAttribute("name")) !== null && _a !== void 0 ? _a : "").trim(); })
        .filter(Boolean));
    for (const field of fields) {
        if (existingNames.has(field.name))
            continue;
        const node = doc.createElement("miscellaneous-field");
        node.setAttribute("name", field.name);
        node.textContent = field.value;
        miscellaneous.appendChild(node);
        existingNames.add(field.name);
    }
    return (0, musicxml_io_1.serializeMusicXmlDocument)(doc);
};
const buildMeasureXmlInspectorText = () => {
    var _a, _b;
    if (!draftCore) {
        return { measureOnly: "", selfContainedDocument: "" };
    }
    const draftXml = (_a = draftCore.debugSerializeCurrentXml()) !== null && _a !== void 0 ? _a : "";
    const draftDoc = (0, musicxml_io_1.parseMusicXmlDocument)(draftXml);
    const measureOnly = draftDoc
        ? (0, musicxml_io_1.prettyPrintMusicXmlText)(serializeElementXml((_b = draftDoc.querySelector("part > measure")) !== null && _b !== void 0 ? _b : draftDoc.documentElement)).trim()
        : draftXml;
    const srcFields = collectEffectiveSrcFieldsForSelectedMeasure();
    const xmlWithSrc = injectSrcFieldsIntoSelfContainedXml(draftXml, srcFields);
    const prettyDoc = (0, musicxml_io_1.prettyPrintMusicXmlText)(xmlWithSrc).trim();
    return {
        measureOnly: measureOnly || draftXml,
        selfContainedDocument: prettyDoc || xmlWithSrc,
    };
};
const activateEditSubTab = (tabName) => {
    activeEditSubTab = tabName;
    renderEditSubTabState(Boolean(selectedMeasure && draftCore));
};
const renderEditSubTabState = (hasMeasure) => {
    editSubTabList.classList.remove("md-hidden");
    editSubTabEditorBtn.disabled = false;
    editSubTabEditorPanel.classList.toggle("md-hidden", !hasMeasure || activeEditSubTab !== "editor");
    editSubTabXmlPanel.classList.toggle("md-hidden", activeEditSubTab !== "xml");
    measureXmlInspector.classList.toggle("md-hidden", activeEditSubTab !== "xml");
    const editorActive = hasMeasure && activeEditSubTab === "editor";
    const xmlActive = activeEditSubTab === "xml";
    editSubTabEditorBtn.classList.toggle("is-active", editorActive);
    editSubTabXmlBtn.classList.toggle("is-active", xmlActive);
    editSubTabEditorBtn.setAttribute("aria-selected", editorActive ? "true" : "false");
    editSubTabXmlBtn.setAttribute("aria-selected", xmlActive ? "true" : "false");
};
const highlightSelectedDraftNoteInEditor = () => {
    measureEditorArea
        .querySelectorAll(".ms-note-selected")
        .forEach((el) => el.classList.remove("ms-note-selected"));
    if (!state.selectedNodeId || draftSvgIdToNodeId.size === 0)
        return;
    for (const [svgId, nodeId] of draftSvgIdToNodeId.entries()) {
        if (nodeId !== state.selectedNodeId)
            continue;
        const target = document.getElementById(svgId);
        if (!target || !measureEditorArea.contains(target))
            continue;
        target.classList.add("ms-note-selected");
        const group = target.closest("g");
        if (group && measureEditorArea.contains(group)) {
            group.classList.add("ms-note-selected");
        }
    }
};
const highlightSelectedMeasureInMainPreview = () => {
    debugScoreArea
        .querySelectorAll(".ms-measure-selected")
        .forEach((el) => el.classList.remove("ms-measure-selected"));
    if (!selectedMeasure || currentSvgIdToNodeId.size === 0)
        return;
    for (const [svgId, nodeId] of currentSvgIdToNodeId.entries()) {
        const location = nodeIdToLocation.get(nodeId);
        if (!location)
            continue;
        if (location.partId !== selectedMeasure.partId || location.measureNumber !== selectedMeasure.measureNumber) {
            continue;
        }
        const target = document.getElementById(svgId);
        if (!target || !debugScoreArea.contains(target))
            continue;
        target.classList.add("ms-measure-selected");
        const group = target.closest("g");
        if (group && debugScoreArea.contains(group)) {
            group.classList.add("ms-measure-selected");
        }
    }
};
const renderDiagnostics = () => {
    if (!diagArea)
        return;
    diagArea.innerHTML = "";
    const dispatch = state.lastDispatchResult;
    const save = state.lastSaveResult;
    if (!dispatch && !save) {
        diagArea.textContent = "No diagnostics";
        return;
    }
    if (dispatch) {
        for (const diagnostic of dispatch.diagnostics) {
            const line = document.createElement("div");
            line.className = "diag-error";
            line.textContent = `[dispatch][${diagnostic.code}] ${diagnostic.message}`;
            diagArea.appendChild(line);
        }
        for (const warning of dispatch.warnings) {
            const line = document.createElement("div");
            line.className = "diag-warning";
            line.textContent = `[dispatch][${warning.code}] ${warning.message}`;
            diagArea.appendChild(line);
        }
    }
    if (save) {
        for (const diagnostic of save.diagnostics) {
            const line = document.createElement("div");
            line.className = "diag-error";
            line.textContent = `[save][${diagnostic.code}] ${diagnostic.message}`;
            diagArea.appendChild(line);
        }
    }
    if (!diagArea.firstChild) {
        diagArea.textContent = "No diagnostics";
    }
};
const renderUiMessage = () => {
    const messageTargets = [inputUiMessage, uiMessage];
    for (const target of messageTargets) {
        target.classList.remove("ms-ui-message--error", "ms-ui-message--warning");
        target.textContent = "";
    }
    const showMessage = (kind, text) => {
        const className = kind === "error" ? "ms-ui-message--error" : "ms-ui-message--warning";
        for (const target of messageTargets) {
            target.textContent = text;
            target.classList.add(className);
            target.classList.remove("md-hidden");
        }
    };
    const dispatch = state.lastDispatchResult;
    if (dispatch) {
        if (!dispatch.ok && dispatch.diagnostics.length > 0) {
            const d = dispatch.diagnostics[0];
            showMessage("error", `Error: ${d.message} (${d.code})`);
            return;
        }
        if (dispatch.warnings.length > 0) {
            const w = dispatch.warnings[0];
            showMessage("warning", `Warning: ${w.message} (${w.code})`);
            return;
        }
    }
    const save = state.lastSaveResult;
    if (save && !save.ok && save.diagnostics.length > 0) {
        const d = save.diagnostics[0];
        showMessage("error", `Error: ${d.message} (${d.code})`);
        return;
    }
    if (state.importWarningSummary) {
        showMessage("warning", `Warning: ${state.importWarningSummary}`);
        return;
    }
    for (const target of messageTargets) {
        target.classList.add("md-hidden");
    }
};
const renderOutput = () => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    if (saveModeText) {
        saveModeText.textContent = state.lastSaveResult ? state.lastSaveResult.mode : "-";
    }
    if (outputXml) {
        outputXml.value = ((_a = state.lastSaveResult) === null || _a === void 0 ? void 0 : _a.ok) ? resolveMusicXmlOutput() : "";
    }
    downloadBtn.disabled = !((_b = state.lastSaveResult) === null || _b === void 0 ? void 0 : _b.ok);
    downloadMidiBtn.disabled = !((_c = state.lastSaveResult) === null || _c === void 0 ? void 0 : _c.ok);
    downloadVsqxBtn.disabled = !((_d = state.lastSaveResult) === null || _d === void 0 ? void 0 : _d.ok);
    downloadAbcBtn.disabled = !((_e = state.lastSaveResult) === null || _e === void 0 ? void 0 : _e.ok);
    downloadMeiBtn.disabled = !((_f = state.lastSaveResult) === null || _f === void 0 ? void 0 : _f.ok);
    downloadLilyPondBtn.disabled = !((_g = state.lastSaveResult) === null || _g === void 0 ? void 0 : _g.ok);
    downloadMuseScoreBtn.disabled = !((_h = state.lastSaveResult) === null || _h === void 0 ? void 0 : _h.ok);
    downloadAllBtn.disabled = !((_j = state.lastSaveResult) === null || _j === void 0 ? void 0 : _j.ok);
};
const renderControlState = () => {
    const hasDraft = Boolean(draftCore);
    const hasSelection = Boolean(state.selectedNodeId);
    if (noteSelect) {
        noteSelect.disabled = !hasDraft;
    }
    pitchStepDownBtn.disabled = !hasDraft || !hasSelection || selectedDraftNoteIsRest;
    pitchStepUpBtn.disabled = !hasDraft || !hasSelection || selectedDraftNoteIsRest;
    for (const btn of pitchAlterBtns) {
        btn.disabled = !hasDraft || !hasSelection || selectedDraftNoteIsRest;
    }
    splitNoteBtn.disabled = !hasDraft || !hasSelection || selectedDraftNoteIsRest;
    convertRestBtn.disabled = !hasDraft || !hasSelection || !selectedDraftNoteIsRest;
    deleteBtn.disabled = !hasDraft || !hasSelection || selectedDraftNoteIsRest;
    playMeasureBtn.disabled = !hasDraft || isPlaying;
    downloadMeasureMusicXmlBtn.disabled = !hasDraft;
    downloadMeasureMidiBtn.disabled = !hasDraft;
    playBtn.disabled = !state.loaded || isPlaying;
    stopBtn.disabled = !isPlaying;
    scoreEditBtn.disabled = !state.loaded || !selectedMeasure;
    exportPlayBtn.disabled = !state.loaded || isPlaying;
    exportStopBtn.disabled = !isPlaying;
    downloadSvgBtn.disabled = !state.loaded;
    playbackWaveform.disabled = isPlaying;
    playbackUseMidiLike.disabled = isPlaying;
    metricAccentEnabledInput.disabled = isPlaying;
    metricAccentProfileSelect.disabled = isPlaying || !metricAccentEnabledInput.checked;
    appendMeasureBtn.disabled = !state.loaded || isPlaying;
    const navLeftTarget = getMeasureNavigationTarget(selectedMeasure, "left");
    const navRightTarget = getMeasureNavigationTarget(selectedMeasure, "right");
    const navUpTarget = getMeasureNavigationTarget(selectedMeasure, "up");
    const navDownTarget = getMeasureNavigationTarget(selectedMeasure, "down");
    measureNavLeftBtn.disabled = !state.loaded || isPlaying || !selectedMeasure || !navLeftTarget;
    measureNavRightBtn.disabled = !state.loaded || isPlaying || !selectedMeasure || !navRightTarget;
    measureNavUpBtn.disabled = !state.loaded || isPlaying || !selectedMeasure || !navUpTarget;
    measureNavDownBtn.disabled = !state.loaded || isPlaying || !selectedMeasure || !navDownTarget;
};
const renderAll = () => {
    renderInputMode();
    renderLocalDraftUi();
    renderNotes();
    syncStepFromSelectedDraftNote();
    renderStatus();
    renderScoreHeaderMeta();
    renderUiMessage();
    renderDiagnostics();
    renderOutput();
    renderMeasureEditorState();
    renderControlState();
    highlightSelectedMeasureInMainPreview();
    highlightSelectedDraftNoteInEditor();
};
const setUiMappingDiagnostic = (message) => {
    if (DEBUG_LOG) {
        console.warn(`[mikuscore][click-map][MVP_TARGET_NOT_FOUND] ${message}`);
    }
    state.lastDispatchResult = {
        ok: false,
        dirtyChanged: false,
        changedNodeIds: [],
        affectedMeasureNumbers: [],
        diagnostics: [{ code: "MVP_TARGET_NOT_FOUND", message }],
        warnings: [],
    };
    renderAll();
};
const rebuildNodeLocationMap = (doc) => {
    var _a, _b;
    nodeIdToLocation = new Map();
    const notes = Array.from(doc.querySelectorAll("part > measure > note"));
    const count = Math.min(notes.length, state.noteNodeIds.length);
    for (let i = 0; i < count; i += 1) {
        const note = notes[i];
        const part = note.closest("part");
        const measure = note.closest("measure");
        if (!part || !measure)
            continue;
        const nodeId = state.noteNodeIds[i];
        const partId = (_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "";
        const measureNumber = (_b = measure.getAttribute("number")) !== null && _b !== void 0 ? _b : "";
        if (!partId || !measureNumber)
            continue;
        nodeIdToLocation.set(nodeId, { partId, measureNumber });
    }
};
const rebuildPartNameMap = (doc) => {
    var _a, _b, _c, _d, _e, _f;
    partIdToName = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("score-partwise > part-list > score-part"))) {
        const partId = (_b = (_a = scorePart.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        const partName = ((_d = (_c = scorePart.querySelector(":scope > part-name")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) ||
            ((_f = (_e = scorePart.querySelector(":scope > part-abbreviation")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) ||
            partId;
        partIdToName.set(partId, partName);
    }
};
const rebuildMeasureStructureMap = (doc) => {
    var _a, _b;
    partOrder = [];
    measureNumbersByPart = new Map();
    for (const part of Array.from(doc.querySelectorAll("score-partwise > part"))) {
        const partId = (_b = (_a = part.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        partOrder.push(partId);
        const numbers = Array.from(part.querySelectorAll(":scope > measure"))
            .map((measure) => { var _a, _b; return (_b = (_a = measure.getAttribute("number")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : ""; })
            .filter((number) => number.length > 0);
        measureNumbersByPart.set(partId, Array.from(new Set(numbers)));
    }
};
const rebuildScoreHeaderMeta = (doc) => {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    const title = ((_b = (_a = doc.querySelector("score-partwise > work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim())
        || ((_d = (_c = doc.querySelector("score-partwise > movement-title")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim())
        || "";
    const composer = ((_f = (_e = doc.querySelector('score-partwise > identification > creator[type="composer"]')) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim())
        || ((_h = (_g = doc.querySelector("score-partwise > identification > creator")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim())
        || "";
    scoreTitleText = title;
    scoreComposerText = composer;
};
const getMeasureNavigationTarget = (current, direction) => {
    var _a, _b;
    if (!current)
        return null;
    if (direction === "left" || direction === "right") {
        const measures = (_a = measureNumbersByPart.get(current.partId)) !== null && _a !== void 0 ? _a : [];
        const index = measures.indexOf(current.measureNumber);
        if (index < 0)
            return null;
        const nextIndex = direction === "left" ? index - 1 : index + 1;
        if (nextIndex < 0 || nextIndex >= measures.length)
            return null;
        return { partId: current.partId, measureNumber: measures[nextIndex] };
    }
    const partIndex = partOrder.indexOf(current.partId);
    if (partIndex < 0)
        return null;
    const nextPartIndex = direction === "up" ? partIndex - 1 : partIndex + 1;
    if (nextPartIndex < 0 || nextPartIndex >= partOrder.length)
        return null;
    const nextPartId = partOrder[nextPartIndex];
    const nextMeasures = (_b = measureNumbersByPart.get(nextPartId)) !== null && _b !== void 0 ? _b : [];
    if (!nextMeasures.includes(current.measureNumber))
        return null;
    return { partId: nextPartId, measureNumber: current.measureNumber };
};
const navigateSelectedMeasure = (direction) => {
    if (!state.loaded || !selectedMeasure)
        return;
    if (draftCore && draftCore.isDirty()) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [
                {
                    code: "MVP_COMMAND_EXECUTION_FAILED",
                    message: "Apply or discard current measure edits before moving to another measure.",
                },
            ],
            warnings: [],
        };
        renderAll();
        return;
    }
    const next = getMeasureNavigationTarget(selectedMeasure, direction);
    if (!next)
        return;
    initializeMeasureEditor(next);
    // Keep Score-tab measure highlight synced even while navigating from Edit tab.
    highlightSelectedMeasureInMainPreview();
};
const normalizeTextForRenderKey = (value) => {
    return (value !== null && value !== void 0 ? value : "").replace(/\s+/g, " ").trim().toLowerCase();
};
const localNameOf = (el) => (el.localName || el.tagName || "").toLowerCase();
const directChildrenByName = (parent, name) => Array.from(parent.children).filter((child) => localNameOf(child) === name.toLowerCase());
const firstDescendantByName = (parent, name) => {
    const nsHit = parent.getElementsByTagNameNS("*", name).item(0);
    if (nsHit)
        return nsHit;
    return parent.getElementsByTagName(name).item(0);
};
const extractTempoDirectionRenderKey = (direction) => {
    var _a, _b, _c;
    const directSound = (_a = directChildrenByName(direction, "sound")[0]) !== null && _a !== void 0 ? _a : null;
    const directionType = (_b = directChildrenByName(direction, "direction-type")[0]) !== null && _b !== void 0 ? _b : null;
    const metronome = directionType ? firstDescendantByName(directionType, "metronome") : null;
    const wordsEl = directionType ? firstDescendantByName(directionType, "words") : null;
    const perMinuteEl = metronome ? firstDescendantByName(metronome, "per-minute") : null;
    const beatUnitEl = metronome ? firstDescendantByName(metronome, "beat-unit") : null;
    const directOffset = (_c = directChildrenByName(direction, "offset")[0]) !== null && _c !== void 0 ? _c : null;
    const soundTempo = normalizeTextForRenderKey(directSound === null || directSound === void 0 ? void 0 : directSound.getAttribute("tempo"));
    const perMinute = normalizeTextForRenderKey(perMinuteEl === null || perMinuteEl === void 0 ? void 0 : perMinuteEl.textContent);
    const beatUnit = normalizeTextForRenderKey(beatUnitEl === null || beatUnitEl === void 0 ? void 0 : beatUnitEl.textContent);
    const words = normalizeTextForRenderKey(wordsEl === null || wordsEl === void 0 ? void 0 : wordsEl.textContent);
    const hasTempoSignal = Boolean(soundTempo || perMinute || words);
    if (!hasTempoSignal)
        return null;
    const offset = normalizeTextForRenderKey((directOffset === null || directOffset === void 0 ? void 0 : directOffset.textContent) || "0");
    return `off=${offset}|sound=${soundTempo}|pm=${perMinute}|unit=${beatUnit}|words=${words}`;
};
const dedupeGlobalTempoDirectionsInRenderDoc = (doc) => {
    var _a;
    const root = doc.documentElement;
    if (!root || localNameOf(root) !== "score-partwise")
        return;
    const parts = directChildrenByName(root, "part");
    if (parts.length <= 1)
        return;
    const seen = new Set();
    for (let pi = 0; pi < parts.length; pi += 1) {
        const part = parts[pi];
        const measures = directChildrenByName(part, "measure");
        for (const measure of measures) {
            const measureNo = ((_a = measure.getAttribute("number")) !== null && _a !== void 0 ? _a : "").trim();
            const directions = directChildrenByName(measure, "direction");
            for (const direction of directions) {
                const tempoKey = extractTempoDirectionRenderKey(direction);
                if (!tempoKey)
                    continue;
                const dedupeKey = `m=${measureNo}|${tempoKey}`;
                if (seen.has(dedupeKey)) {
                    direction.remove();
                    continue;
                }
                seen.add(dedupeKey);
            }
        }
    }
};
const buildRenderXmlForVerovio = (xml) => {
    const sourceDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!sourceDoc) {
        return {
            renderDoc: null,
            svgIdToNodeId: new Map(),
            noteCount: 0,
        };
    }
    if (!state.loaded) {
        dedupeGlobalTempoDirectionsInRenderDoc(sourceDoc);
        return {
            renderDoc: sourceDoc,
            svgIdToNodeId: new Map(),
            noteCount: 0,
        };
    }
    const renderBundle = (0, musicxml_io_1.buildRenderDocWithNodeIds)(sourceDoc, state.noteNodeIds.slice(), "mks-main");
    if (renderBundle.renderDoc) {
        dedupeGlobalTempoDirectionsInRenderDoc(renderBundle.renderDoc);
    }
    return renderBundle;
};
const deriveRenderedNoteIds = (root) => {
    const direct = Array.from(root.querySelectorAll('[id^="mks-"], [id*="mks-"]')).map((el) => el.id);
    if (direct.length > 0) {
        return Array.from(new Set(direct));
    }
    const fallback = Array.from(root.querySelectorAll("[id]"))
        .filter((el) => {
        var _a;
        const id = el.id || "";
        const className = (_a = el.getAttribute("class")) !== null && _a !== void 0 ? _a : "";
        return id.startsWith("note-") || /\bnote\b/.test(className);
    })
        .map((el) => el.id);
    return Array.from(new Set(fallback));
};
const buildFallbackSvgIdMap = (sourceNodeIds, renderedNoteIds) => {
    const map = new Map();
    const count = Math.min(sourceNodeIds.length, renderedNoteIds.length);
    for (let i = 0; i < count; i += 1) {
        map.set(renderedNoteIds[i], sourceNodeIds[i]);
    }
    return map;
};
const resolveNodeIdFromCandidateIds = (candidateIds, svgIdMap) => {
    for (const entry of candidateIds) {
        const exact = svgIdMap.get(entry);
        if (exact)
            return exact;
    }
    for (const entry of candidateIds) {
        for (const [knownSvgId, nodeId] of svgIdMap.entries()) {
            if (entry.startsWith(`${knownSvgId}-`) || knownSvgId.startsWith(`${entry}-`)) {
                return nodeId;
            }
        }
    }
    return null;
};
const collectCandidateIdsFromElement = (base) => {
    if (!base)
        return [];
    const candidateIds = [];
    const pushId = (value) => {
        if (!value)
            return;
        const id = value.startsWith("#") ? value.slice(1) : value;
        if (!id)
            return;
        if (!candidateIds.includes(id))
            candidateIds.push(id);
    };
    let cursor = base;
    let depth = 0;
    while (cursor && depth < 16) {
        pushId(cursor.getAttribute("id"));
        pushId(cursor.getAttribute("href"));
        pushId(cursor.getAttribute("xlink:href"));
        cursor = cursor.parentElement;
        depth += 1;
    }
    return candidateIds;
};
const resolveNodeIdFromSvgTarget = (target, clickEvent) => {
    if (!target || !(target instanceof Element))
        return null;
    const directCandidates = collectCandidateIdsFromElement(target);
    const resolvedFromDirect = resolveNodeIdFromCandidateIds(directCandidates, currentSvgIdToNodeId);
    if (resolvedFromDirect)
        return resolvedFromDirect;
    if (clickEvent && typeof document.elementsFromPoint === "function") {
        const hitElements = document.elementsFromPoint(clickEvent.clientX, clickEvent.clientY);
        for (const hit of hitElements) {
            if (!(hit instanceof Element))
                continue;
            const hitCandidates = collectCandidateIdsFromElement(hit);
            const resolvedFromHit = resolveNodeIdFromCandidateIds(hitCandidates, currentSvgIdToNodeId);
            if (resolvedFromHit)
                return resolvedFromHit;
        }
    }
    if (DEBUG_LOG) {
        console.warn("[mikuscore][click-map] unresolved candidates:", {
            tag: target.tagName,
            className: target.getAttribute("class"),
            candidates: directCandidates,
        });
    }
    return null;
};
const resolveDraftNodeIdFromSvgTarget = (target, clickEvent) => {
    if (!target || !(target instanceof Element))
        return null;
    const directCandidates = collectCandidateIdsFromElement(target);
    const resolvedFromDirect = resolveNodeIdFromCandidateIds(directCandidates, draftSvgIdToNodeId);
    if (resolvedFromDirect)
        return resolvedFromDirect;
    if (clickEvent && typeof document.elementsFromPoint === "function") {
        const hitElements = document.elementsFromPoint(clickEvent.clientX, clickEvent.clientY);
        for (const hit of hitElements) {
            if (!(hit instanceof Element))
                continue;
            const hitCandidates = collectCandidateIdsFromElement(hit);
            const resolvedFromHit = resolveNodeIdFromCandidateIds(hitCandidates, draftSvgIdToNodeId);
            if (resolvedFromHit)
                return resolvedFromHit;
        }
    }
    return null;
};
const resolveNodeIdFromNearestPointInArea = (clickEvent, area, svgIdToNodeId, snapPx = NOTE_CLICK_SNAP_PX) => {
    let bestNodeId = null;
    let bestScore = Number.POSITIVE_INFINITY;
    for (const [svgId, nodeId] of svgIdToNodeId.entries()) {
        const el = area.querySelector(`#${CSS.escape(svgId)}`);
        if (!el)
            continue;
        const rect = el.getBoundingClientRect();
        if (!Number.isFinite(rect.left) || rect.width <= 0 || rect.height <= 0)
            continue;
        const dx = clickEvent.clientX < rect.left
            ? rect.left - clickEvent.clientX
            : clickEvent.clientX > rect.right
                ? clickEvent.clientX - rect.right
                : 0;
        const dy = clickEvent.clientY < rect.top
            ? rect.top - clickEvent.clientY
            : clickEvent.clientY > rect.bottom
                ? clickEvent.clientY - rect.bottom
                : 0;
        const score = Math.hypot(dx, dy);
        if (score < bestScore) {
            bestScore = score;
            bestNodeId = nodeId;
        }
    }
    return bestScore <= snapPx ? bestNodeId : null;
};
const resolveNodeIdFromNearestPoint = (clickEvent) => {
    return resolveNodeIdFromNearestPointInArea(clickEvent, debugScoreArea, currentSvgIdToNodeId, NOTE_CLICK_SNAP_PX);
};
const resolveDraftNodeIdFromNearestPoint = (clickEvent) => {
    return resolveNodeIdFromNearestPointInArea(clickEvent, measureEditorArea, draftSvgIdToNodeId, NOTE_CLICK_SNAP_PX);
};
const extractMeasureEditorXml = (xml, partId, measureNumber) => {
    const sourceDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xml);
    if (!sourceDoc)
        return null;
    const extractedDoc = (0, musicxml_io_1.extractMeasureEditorDocument)(sourceDoc, partId, measureNumber);
    if (!extractedDoc)
        return null;
    return (0, musicxml_io_1.serializeMusicXmlDocument)(extractedDoc);
};
const initializeMeasureEditor = (location) => {
    var _a;
    const xml = core.debugSerializeCurrentXml();
    if (!xml)
        return;
    const extracted = extractMeasureEditorXml(xml, location.partId, location.measureNumber);
    if (!extracted) {
        setUiMappingDiagnostic("Failed to extract selected measure.");
        return;
    }
    const nextDraft = new ScoreCore_1.ScoreCore();
    try {
        nextDraft.load(extracted);
    }
    catch (error) {
        setUiMappingDiagnostic(`Failed to load the selected measure: ${error instanceof Error ? error.message : String(error)}`);
        return;
    }
    draftCore = nextDraft;
    draftNoteNodeIds = nextDraft.listNoteNodeIds();
    state.selectedNodeId = (_a = draftNoteNodeIds[0]) !== null && _a !== void 0 ? _a : null;
    selectedMeasure = location;
    state.lastDispatchResult = null;
    draftSvgIdToNodeId = new Map();
    renderAll();
    renderMeasureEditorPreview();
};
const onVerovioScoreClick = (event) => {
    var _a, _b;
    if (!state.loaded)
        return;
    const nodeId = (_a = resolveNodeIdFromSvgTarget(event.target, event)) !== null && _a !== void 0 ? _a : resolveNodeIdFromNearestPoint(event);
    if (DEBUG_LOG) {
        const clicked = event.target instanceof Element ? event.target.closest("[id]") : null;
        console.warn("[mikuscore][click-map] resolution:", {
            clickedId: (_b = clicked === null || clicked === void 0 ? void 0 : clicked.getAttribute("id")) !== null && _b !== void 0 ? _b : null,
            mappedNodeId: nodeId,
            mapSize: currentSvgIdToNodeId.size,
        });
    }
    if (!nodeId) {
        setUiMappingDiagnostic("Could not resolve a note from the clicked position.");
        return;
    }
    if (!state.noteNodeIds.includes(nodeId)) {
        setUiMappingDiagnostic(`No nodeId matched the clicked element: ${nodeId}`);
        return;
    }
    const location = nodeIdToLocation.get(nodeId);
    if (!location) {
        setUiMappingDiagnostic(`Could not resolve track/measure from nodeId: ${nodeId}`);
        return;
    }
    initializeMeasureEditor(location);
};
const onMeasureEditorClick = (event) => {
    var _a;
    if (!draftCore)
        return;
    const nodeId = (_a = resolveDraftNodeIdFromSvgTarget(event.target, event)) !== null && _a !== void 0 ? _a : resolveDraftNodeIdFromNearestPoint(event);
    if (!nodeId || !draftNoteNodeIds.includes(nodeId))
        return;
    state.selectedNodeId = nodeId;
    state.lastDispatchResult = null;
    renderAll();
};
const renderScorePreview = () => {
    var _a, _b;
    const renderSeq = ++verovioRenderSeq;
    const xml = (_b = (_a = (state.loaded ? core.debugSerializeCurrentXml() : null)) !== null && _a !== void 0 ? _a : xmlInput.value.trim()) !== null && _b !== void 0 ? _b : "";
    void (0, preview_flow_1.renderScorePreview)({
        renderSeq,
        isRenderSeqCurrent: (seq) => seq === verovioRenderSeq,
        xml,
        noteNodeIds: state.noteNodeIds,
        setMetaText: (text) => {
            if (debugScoreMeta) {
                debugScoreMeta.textContent = text;
            }
        },
        setSvgHtml: (svgHtml) => {
            debugScoreArea.innerHTML = svgHtml;
        },
        setSvgIdMap: (map) => {
            currentSvgIdToNodeId = map;
        },
        buildRenderXmlForVerovio,
        deriveRenderedNoteIds,
        buildFallbackSvgIdMap,
        onRendered: () => {
            highlightSelectedMeasureInMainPreview();
        },
        debugLog: DEBUG_LOG,
        renderedRoot: debugScoreArea,
    });
};
const renderMeasureEditorPreview = () => {
    var _a;
    void (0, preview_flow_1.renderMeasureEditorPreview)({
        hasDraft: Boolean(draftCore && selectedMeasure),
        xml: (_a = draftCore === null || draftCore === void 0 ? void 0 : draftCore.debugSerializeCurrentXml()) !== null && _a !== void 0 ? _a : "",
        draftNoteNodeIds,
        setHtml: (html) => {
            measureEditorArea.innerHTML = html;
        },
        setSvgIdMap: (map) => {
            draftSvgIdToNodeId = map;
        },
        buildRenderDocWithNodeIds: musicxml_io_1.buildRenderDocWithNodeIds,
        parseMusicXmlDocument: musicxml_io_1.parseMusicXmlDocument,
        deriveRenderedNoteIds,
        buildFallbackSvgIdMap,
        onRendered: () => {
            highlightSelectedDraftNoteInEditor();
        },
        renderedRoot: measureEditorArea,
    });
};
const refreshNotesFromCore = () => {
    state.noteNodeIds = core.listNoteNodeIds();
    const currentXml = core.debugSerializeCurrentXml();
    if (currentXml) {
        const currentDoc = (0, musicxml_io_1.parseMusicXmlDocument)(currentXml);
        if (currentDoc) {
            rebuildNodeLocationMap(currentDoc);
            rebuildPartNameMap(currentDoc);
            rebuildMeasureStructureMap(currentDoc);
            rebuildScoreHeaderMeta(currentDoc);
        }
        else {
            nodeIdToLocation = new Map();
            partIdToName = new Map();
            partOrder = [];
            measureNumbersByPart = new Map();
            scoreTitleText = "";
            scoreComposerText = "";
        }
    }
    else {
        nodeIdToLocation = new Map();
        partIdToName = new Map();
        partOrder = [];
        measureNumbersByPart = new Map();
        scoreTitleText = "";
        scoreComposerText = "";
    }
};
const synthEngine = (0, playback_flow_1.createBasicWaveSynthEngine)({ ticksPerQuarter: playback_flow_1.PLAYBACK_TICKS_PER_QUARTER });
const unlockAudioOnGesture = () => {
    void synthEngine.unlockFromUserGesture();
};
const installGlobalAudioUnlock = () => {
    const unlockOnce = () => {
        void synthEngine.unlockFromUserGesture().then((ok) => {
            if (!ok)
                return;
            window.removeEventListener("pointerdown", unlockOnce);
            window.removeEventListener("touchstart", unlockOnce);
            window.removeEventListener("keydown", unlockOnce);
        });
    };
    window.addEventListener("pointerdown", unlockOnce, { passive: true });
    window.addEventListener("touchstart", unlockOnce, { passive: true });
    window.addEventListener("keydown", unlockOnce);
};
const playbackFlowOptions = {
    engine: synthEngine,
    ticksPerQuarter: playback_flow_1.PLAYBACK_TICKS_PER_QUARTER,
    editableVoice: DEFAULT_VOICE,
    getPlaybackWaveform: () => {
        return normalizeWaveformSetting(playbackWaveform.value);
    },
    getUseMidiLikePlayback: () => playbackUseMidiLike.checked,
    getGraceTimingMode: () => normalizeGraceTimingMode(graceTimingModeSelect.value),
    getMetricAccentEnabled: () => metricAccentEnabledInput.checked,
    getMetricAccentProfile: () => normalizeMetricAccentProfile(metricAccentProfileSelect.value),
    debugLog: DEBUG_LOG,
    getIsPlaying: () => isPlaying,
    setIsPlaying: (playing) => {
        isPlaying = playing;
    },
    setPlaybackText: (text) => {
        if (playbackText) {
            playbackText.textContent = text;
        }
    },
    renderControlState,
    renderAll,
    logDiagnostics: (scope, diagnostics) => {
        logDiagnostics(scope, diagnostics);
    },
    dumpOverfullContext,
    onFullSaveResult: (saveResult) => {
        state.lastSaveResult = saveResult;
    },
    onMeasureSaveDiagnostics: (diagnostics) => {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics,
            warnings: [],
        };
    },
};
const stopPlayback = () => {
    (0, playback_flow_1.stopPlayback)(playbackFlowOptions);
};
const unlockAudioForPlayback = async () => {
    const ok = await synthEngine.unlockFromUserGesture();
    if (!ok && playbackText) {
        playbackText.textContent = "Playback: audio unlock failed";
    }
    return ok;
};
const startPlayback = async () => {
    const ok = await unlockAudioForPlayback();
    if (!ok)
        return;
    await (0, playback_flow_1.startPlayback)(playbackFlowOptions, {
        isLoaded: state.loaded,
        core,
        startFromMeasure: selectedMeasure,
    });
};
const startMeasurePlayback = async () => {
    const ok = await unlockAudioForPlayback();
    if (!ok)
        return;
    await (0, playback_flow_1.startMeasurePlayback)(playbackFlowOptions, { draftCore });
};
const readSelectedPitch = () => {
    const step = pitchStep.value.trim();
    if (!isPitchStepValue(step))
        return null;
    const octave = Number(pitchOctave.value);
    if (!Number.isInteger(octave))
        return null;
    const alterText = normalizeAlterValue(pitchAlter.value);
    const base = {
        step,
        octave,
    };
    if (alterText === "none") {
        return base;
    }
    const alter = Number(alterText);
    if (!Number.isInteger(alter) || alter < -2 || alter > 2)
        return null;
    return { ...base, alter: alter };
};
const readDuration = () => {
    const duration = Number(durationPreset.value);
    if (!Number.isInteger(duration) || duration <= 0)
        return null;
    return duration;
};
const commandVoiceForSelection = () => {
    const voice = String(selectedDraftVoice || "").trim();
    return voice || DEFAULT_VOICE;
};
const onDurationPresetChange = () => {
    if (suppressDurationPresetEvent)
        return;
    const preset = Number(durationPreset.value);
    if (!Number.isInteger(preset) || preset <= 0)
        return;
    if (Number.isInteger(selectedDraftDurationValue) && selectedDraftDurationValue === preset)
        return;
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const command = {
        type: "change_duration",
        targetNodeId,
        voice: commandVoiceForSelection(),
        duration: preset,
    };
    const result = runCommand(command);
    if (!result || result.ok)
        return;
    const first = result.diagnostics[0];
    if ((first === null || first === void 0 ? void 0 : first.code) === "MEASURE_OVERFULL") {
        state.lastDispatchResult = {
            ...result,
            diagnostics: [
                {
                    code: first.code,
                    message: "This duration is not allowed. It exceeds the measure capacity.",
                },
            ],
        };
        renderAll();
    }
};
const runCommand = (command) => {
    var _a;
    if (!draftCore)
        return null;
    state.lastDispatchResult = draftCore.dispatch(command);
    if (!state.lastDispatchResult.ok || state.lastDispatchResult.warnings.length > 0) {
        logDiagnostics("dispatch", state.lastDispatchResult.diagnostics, state.lastDispatchResult.warnings);
    }
    if (state.lastDispatchResult.ok) {
        draftNoteNodeIds = draftCore.listNoteNodeIds();
        if (state.selectedNodeId && !draftNoteNodeIds.includes(state.selectedNodeId)) {
            state.selectedNodeId = (_a = draftNoteNodeIds[0]) !== null && _a !== void 0 ? _a : null;
        }
    }
    renderAll();
    renderMeasureEditorPreview();
    return state.lastDispatchResult;
};
const autoSaveCurrentXml = (persistLocalDraft = false) => {
    if (!state.loaded)
        return;
    const result = core.save();
    state.lastSaveResult = result;
    if (!result.ok) {
        logDiagnostics("save", result.diagnostics);
        if (result.diagnostics.some((d) => d.code === "MEASURE_OVERFULL")) {
            const debugXml = core.debugSerializeCurrentXml();
            if (debugXml) {
                dumpOverfullContext(debugXml, DEFAULT_VOICE);
            }
            else if (DEBUG_LOG) {
                console.warn("[mikuscore][debug] no in-memory XML to dump.");
            }
        }
        return;
    }
    state.lastSuccessfulSaveXml = result.xml;
    if (persistLocalDraft) {
        writeLocalDraft(result.xml);
    }
};
const loadFromText = (xml) => {
    try {
        core.load(xml);
    }
    catch (err) {
        if (DEBUG_LOG) {
            console.error("[mikuscore][load] load failed:", err);
        }
        state.loaded = false;
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [
                {
                    code: "MVP_COMMAND_EXECUTION_FAILED",
                    message: err instanceof Error ? err.message : "Load failed.",
                },
            ],
            warnings: [],
        };
        state.lastSaveResult = null;
        logDiagnostics("load", state.lastDispatchResult.diagnostics);
        renderAll();
        return;
    }
    state.loaded = true;
    state.selectedNodeId = null;
    state.lastDispatchResult = null;
    state.lastSaveResult = null;
    state.lastSuccessfulSaveXml = "";
    selectedMeasure = null;
    draftCore = null;
    draftNoteNodeIds = [];
    draftSvgIdToNodeId = new Map();
    refreshNotesFromCore();
    autoSaveCurrentXml(false);
    renderAll();
    renderScorePreview();
};
const onLoadClick = async () => {
    var _a, _b;
    if (isFileLoadInProgress)
        return;
    const isFileMode = inputEntryFile.checked;
    if (isFileMode) {
        setFileLoadInProgress(true);
        // Ensure progress UI is painted before heavy parsing/conversion starts.
        await waitForNextPaint();
    }
    try {
        const selectedSourceType = getSelectedSourceType();
        const metadataOutputSettings = getMksMetadataOutputSettings();
        const keepSourceMetadata = metadataOutputSettings.keepSrc;
        const keepDebugMetadata = metadataOutputSettings.keepDbg;
        const selectedRawFile = (_b = (_a = fileInput.files) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : null;
        let selectedFile = selectedZipEntryVirtualFile !== null && selectedZipEntryVirtualFile !== void 0 ? selectedZipEntryVirtualFile : selectedRawFile;
        if (inputEntryFile.checked &&
            selectedRawFile &&
            isZipFileName(selectedRawFile.name) &&
            !selectedZipEntryVirtualFile) {
            const prepared = await prepareZipEntrySelection(selectedRawFile);
            if (!prepared.ok) {
                state.importWarningSummary = "";
                state.lastDispatchResult = {
                    ok: false,
                    dirtyChanged: false,
                    changedNodeIds: [],
                    affectedMeasureNumbers: [],
                    diagnostics: [{ code: "MVP_INVALID_COMMAND_PAYLOAD", message: prepared.message }],
                    warnings: [],
                };
                renderAll();
                return;
            }
            if (!prepared.autoLoad) {
                return;
            }
            selectedFile = selectedZipEntryVirtualFile !== null && selectedZipEntryVirtualFile !== void 0 ? selectedZipEntryVirtualFile : selectedRawFile;
        }
        const result = await (0, load_flow_1.resolveLoadFlow)({
            isNewType: inputEntryNew.checked,
            sourceType: selectedSourceType,
            isFileMode: inputEntryFile.checked,
            selectedFile,
            xmlSourceText: xmlInput.value,
            museScoreSourceText: museScoreInput.value,
            vsqxSourceText: vsqxInput.value,
            abcSourceText: abcInput.value,
            meiSourceText: meiInput.value,
            lilyPondSourceText: lilyPondInput.value,
            createNewMusicXml,
            formatImportedMusicXml: musicxml_io_1.normalizeImportedMusicXmlText,
            convertAbcToMusicXml: (abcSource) => (0, abc_io_1.convertAbcToMusicXml)(abcSource, {
                sourceMetadata: keepSourceMetadata,
                debugMetadata: keepDebugMetadata,
                overfullCompatibilityMode: true,
            }),
            convertMeiToMusicXml: (meiSource) => (0, mei_io_1.convertMeiToMusicXml)(meiSource, {
                sourceMetadata: keepSourceMetadata,
                debugMetadata: keepDebugMetadata,
            }),
            convertLilyPondToMusicXml: (lilySource) => (0, lilypond_io_1.convertLilyPondToMusicXml)(lilySource, {
                sourceMetadata: keepSourceMetadata,
                debugMetadata: keepDebugMetadata,
            }),
            convertMuseScoreToMusicXml: (musescoreSource) => (0, musescore_io_1.convertMuseScoreToMusicXml)(musescoreSource, {
                sourceMetadata: keepSourceMetadata,
                debugMetadata: keepDebugMetadata,
            }),
            convertVsqxToMusicXml: (vsqxSource) => (0, vsqx_io_1.convertVsqxToMusicXml)(vsqxSource, {
                defaultLyric: DEFAULT_VSQX_LYRIC,
            }),
            convertMidiToMusicXml: (midiBytes) => (0, midi_io_1.convertMidiToMusicXml)(midiBytes, {
                quantizeGrid: normalizeMidiImportQuantizeGrid(midiImportQuantizeGridSelect.value),
                tripletAwareQuantize: midiImportTripletAware.checked,
                sourceMetadata: keepSourceMetadata,
                debugMetadata: keepDebugMetadata,
            }),
        });
        if (!result.ok) {
            state.importWarningSummary = "";
            state.lastDispatchResult = {
                ok: false,
                dirtyChanged: false,
                changedNodeIds: [],
                affectedMeasureNumbers: [],
                diagnostics: [{ code: result.diagnosticCode, message: result.diagnosticMessage }],
                warnings: [],
            };
            renderAll();
            return;
        }
        if (result.nextAbcInputText !== undefined) {
            abcInput.value = result.nextAbcInputText;
        }
        if (result.nextXmlInputText !== undefined) {
            xmlInput.value = result.nextXmlInputText;
        }
        state.importWarningSummary =
            selectedSourceType === "abc" ? summarizeImportedDiagWarnings(result.xmlToLoad) : "";
        // Persist immediately on explicit load actions (Load / Load sample).
        writeLocalDraft(result.xmlToLoad);
        loadFromText(result.xmlToLoad);
        activateTopTab("score");
    }
    finally {
        if (isFileMode)
            setFileLoadInProgress(false);
    }
};
const onDiscardLocalDraft = () => {
    clearLocalDraft();
    renderLocalDraftUi();
};
const createNewMusicXml = () => {
    const usePianoGrandStaffTemplate = newTemplatePianoGrandStaff.checked;
    const partCount = usePianoGrandStaffTemplate ? 1 : normalizeNewPartCount();
    const parsedFifths = Number(newKeyFifthsSelect.value);
    const fifths = Number.isFinite(parsedFifths) ? Math.max(-7, Math.min(7, Math.round(parsedFifths))) : 0;
    const beats = normalizeNewTimeBeats();
    const beatType = normalizeNewTimeBeatType();
    const divisions = 480;
    const measureCount = 8;
    const measureDuration = Math.max(1, Math.round(divisions * beats * (4 / beatType)));
    const clefs = usePianoGrandStaffTemplate ? ["treble"] : listCurrentNewPartClefs();
    const partListXml = Array.from({ length: partCount }, (_, i) => {
        const partId = `P${i + 1}`;
        const midiChannel = ((i % 16) + 1 === 10) ? 11 : ((i % 16) + 1);
        const midiProgram = usePianoGrandStaffTemplate ? 1 : 6;
        const partName = usePianoGrandStaffTemplate ? "Piano" : `Part ${i + 1}`;
        return [
            `<score-part id="${partId}">`,
            `<part-name>${partName}</part-name>`,
            `<midi-instrument id="${partId}-I1">`,
            `<midi-channel>${midiChannel}</midi-channel>`,
            `<midi-program>${midiProgram}</midi-program>`,
            "</midi-instrument>",
            "</score-part>",
        ].join("");
    }).join("");
    const partsXml = Array.from({ length: partCount }, (_, i) => {
        var _a;
        const partId = `P${i + 1}`;
        const clefKeyword = normalizeClefKeyword((_a = clefs[i]) !== null && _a !== void 0 ? _a : "treble");
        const clefXml = (0, abc_io_1.clefXmlFromAbcClef)(clefKeyword);
        const measuresXml = Array.from({ length: measureCount }, (_unused, m) => {
            const number = m + 1;
            const attrs = m === 0
                ? [
                    "<attributes>",
                    `<divisions>${divisions}</divisions>`,
                    `<key><fifths>${fifths}</fifths><mode>major</mode></key>`,
                    `<time><beats>${beats}</beats><beat-type>${beatType}</beat-type></time>`,
                    usePianoGrandStaffTemplate
                        ? "<staves>2</staves><clef number=\"1\"><sign>G</sign><line>2</line></clef><clef number=\"2\"><sign>F</sign><line>4</line></clef>"
                        : clefXml,
                    "</attributes>",
                ].join("")
                : "";
            const measureBody = usePianoGrandStaffTemplate
                ? `<note><rest measure="yes"/><duration>${measureDuration}</duration><voice>1</voice><staff>1</staff></note><backup><duration>${measureDuration}</duration></backup><note><rest measure="yes"/><duration>${measureDuration}</duration><voice>1</voice><staff>2</staff></note>`
                : `<note><rest measure="yes"/><duration>${measureDuration}</duration><voice>1</voice></note>`;
            return [
                `<measure number="${number}">`,
                attrs,
                measureBody,
                "</measure>",
            ].join("");
        }).join("");
        return [
            `<part id="${partId}">`,
            measuresXml,
            "</part>",
        ].join("");
    }).join("");
    return `<?xml version="1.0" encoding="UTF-8"?>
<score-partwise version="3.1">
  <work>
    <work-title>Untitled</work-title>
  </work>
  <identification>
    <creator type="composer">Unknown</creator>
  </identification>
  <part-list>${partListXml}</part-list>
  ${partsXml}
</score-partwise>`;
};
const requireSelectedNode = () => {
    if (!draftCore) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [{ code: "MVP_COMMAND_TARGET_MISSING", message: "Select a measure first." }],
            warnings: [],
        };
        renderAll();
        return null;
    }
    const nodeId = state.selectedNodeId;
    if (nodeId)
        return nodeId;
    state.lastDispatchResult = {
        ok: false,
        dirtyChanged: false,
        changedNodeIds: [],
        affectedMeasureNumbers: [],
        diagnostics: [{ code: "MVP_COMMAND_TARGET_MISSING", message: "Select a note." }],
        warnings: [],
    };
    renderAll();
    return null;
};
const onChangePitch = () => {
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const pitch = readSelectedPitch();
    if (!pitch) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [{ code: "MVP_INVALID_COMMAND_PAYLOAD", message: "Invalid pitch input." }],
            warnings: [],
        };
        renderAll();
        return;
    }
    const command = {
        type: "change_to_pitch",
        targetNodeId,
        voice: commandVoiceForSelection(),
        pitch,
    };
    runCommand(command);
};
const onPitchStepAutoChange = () => {
    if (!draftCore || !state.selectedNodeId || selectedDraftNoteIsRest)
        return;
    onChangePitch();
};
const onAlterAutoChange = () => {
    if (!draftCore || !state.selectedNodeId || selectedDraftNoteIsRest)
        return;
    renderAlterButtons();
    onChangePitch();
};
const shiftPitchStep = (delta) => {
    if (!draftCore || !state.selectedNodeId || selectedDraftNoteIsRest)
        return;
    const order = ["C", "D", "E", "F", "G", "A", "B"];
    const current = pitchStep.value.trim();
    if (!isPitchStepValue(current))
        return;
    const index = order.indexOf(current);
    if (index < 0)
        return;
    // Clamp lower bound to A0.
    if (delta === -1) {
        const currentOctave = Number(pitchOctave.value);
        if (Number.isInteger(currentOctave) && currentOctave === 0 && current !== "B") {
            return;
        }
    }
    const rawNext = index + delta;
    let nextIndex = rawNext;
    let octave = Number(pitchOctave.value);
    if (!Number.isInteger(octave))
        octave = 4;
    if (rawNext < 0) {
        if (octave <= 0) {
            return;
        }
        octave -= 1;
        nextIndex = order.length - 1;
    }
    else if (rawNext >= order.length) {
        if (octave >= 9) {
            return;
        }
        octave += 1;
        nextIndex = 0;
    }
    pitchOctave.value = String(octave);
    pitchStep.value = order[nextIndex];
    renderPitchStepValue();
    onPitchStepAutoChange();
};
const flashStepButton = (button) => {
    pitchStepUpBtn.classList.remove("is-pressed");
    pitchStepDownBtn.classList.remove("is-pressed");
    button.classList.add("is-pressed");
    window.setTimeout(() => {
        button.classList.remove("is-pressed");
    }, 140);
};
const replaceMeasureInMainXml = (sourceXml, partId, measureNumber, measureXml) => {
    const mainDoc = (0, musicxml_io_1.parseMusicXmlDocument)(sourceXml);
    const measureDoc = (0, musicxml_io_1.parseMusicXmlDocument)(measureXml);
    if (!mainDoc || !measureDoc)
        return null;
    const mergedDoc = (0, musicxml_io_1.replaceMeasureInMainDocument)(mainDoc, partId, measureNumber, measureDoc);
    if (!mergedDoc)
        return null;
    return (0, musicxml_io_1.serializeMusicXmlDocument)(mergedDoc);
};
const toPositiveInteger = (value) => {
    if (!Number.isFinite(value))
        return null;
    const rounded = Math.round(value);
    return rounded > 0 ? rounded : null;
};
const resolveEffectiveStavesAtEnd = (part) => {
    var _a, _b, _c;
    const measures = Array.from(part.querySelectorAll(":scope > measure"));
    let staves = 1;
    for (const measure of measures) {
        const text = (_c = (_b = (_a = measure.querySelector(":scope > attributes > staves")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
        const parsed = Number(text);
        if (Number.isInteger(parsed) && parsed > 0)
            staves = parsed;
    }
    return staves;
};
const resolveHasTrebleBassGrandStaffAtEnd = (part) => {
    var _a, _b, _c, _d, _e, _f;
    const measures = Array.from(part.querySelectorAll(":scope > measure"));
    let clef1 = "";
    let clef2 = "";
    for (const measure of measures) {
        const nextClef1 = (_c = (_b = (_a = measure.querySelector(':scope > attributes > clef[number="1"] > sign')) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
        const nextClef2 = (_f = (_e = (_d = measure.querySelector(':scope > attributes > clef[number="2"] > sign')) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
        if (nextClef1)
            clef1 = nextClef1;
        if (nextClef2)
            clef2 = nextClef2;
    }
    return clef1 === "G" && clef2 === "F";
};
const createMeasureRestNoteXml = (duration, voice, staff) => {
    return [
        "<note>",
        '<rest measure="yes"/>',
        `<duration>${duration}</duration>`,
        `<voice>${voice}</voice>`,
        staff ? `<staff>${staff}</staff>` : "",
        "</note>",
    ].join("");
};
const deriveNextMeasureNumber = (part) => {
    var _a, _b, _c;
    const measures = Array.from(part.querySelectorAll(":scope > measure"));
    const lastMeasure = (_a = measures[measures.length - 1]) !== null && _a !== void 0 ? _a : null;
    if (!lastMeasure)
        return "1";
    const raw = (_c = (_b = lastMeasure.getAttribute("number")) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
    const numeric = Number(raw);
    if (Number.isInteger(numeric) && numeric >= 0)
        return String(numeric + 1);
    return String(measures.length + 1);
};
const appendMeasureToMainXml = (sourceXml) => {
    var _a, _b, _c, _d, _e;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(sourceXml);
    if (!doc)
        return null;
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    if (!parts.length)
        return null;
    for (const part of parts) {
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        const lastMeasure = (_a = measures[measures.length - 1]) !== null && _a !== void 0 ? _a : null;
        if (!lastMeasure)
            continue;
        const capacity = (_b = toPositiveInteger((0, timeIndex_1.getMeasureCapacity)(lastMeasure))) !== null && _b !== void 0 ? _b : 3840;
        const nextNumber = deriveNextMeasureNumber(part);
        const staves = resolveEffectiveStavesAtEnd(part);
        const isGrandStaff = staves >= 2 && resolveHasTrebleBassGrandStaffAtEnd(part);
        const measure = doc.createElement("measure");
        measure.setAttribute("number", nextNumber);
        if (isGrandStaff) {
            const lane1 = (_c = (0, musicxml_io_1.parseMusicXmlDocument)(createMeasureRestNoteXml(capacity, "1", "1"))) === null || _c === void 0 ? void 0 : _c.querySelector("note");
            const backup = doc.createElement("backup");
            const backupDur = doc.createElement("duration");
            backupDur.textContent = String(capacity);
            backup.appendChild(backupDur);
            const lane2 = (_d = (0, musicxml_io_1.parseMusicXmlDocument)(createMeasureRestNoteXml(capacity, "1", "2"))) === null || _d === void 0 ? void 0 : _d.querySelector("note");
            if (lane1)
                measure.appendChild(doc.importNode(lane1, true));
            measure.appendChild(backup);
            if (lane2)
                measure.appendChild(doc.importNode(lane2, true));
        }
        else {
            const rest = (_e = (0, musicxml_io_1.parseMusicXmlDocument)(createMeasureRestNoteXml(capacity, "1", null))) === null || _e === void 0 ? void 0 : _e.querySelector("note");
            if (rest)
                measure.appendChild(doc.importNode(rest, true));
        }
        part.appendChild(measure);
    }
    return (0, musicxml_io_1.serializeMusicXmlDocument)(doc);
};
const onAppendMeasureAtEnd = () => {
    if (!state.loaded)
        return;
    if (draftCore && draftCore.isDirty()) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [
                {
                    code: "MVP_COMMAND_EXECUTION_FAILED",
                    message: "Apply or discard current measure edits before adding a new measure.",
                },
            ],
            warnings: [],
        };
        renderAll();
        return;
    }
    const mainXml = core.debugSerializeCurrentXml();
    if (!mainXml)
        return;
    const nextXml = appendMeasureToMainXml(mainXml);
    if (!nextXml) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [{ code: "MVP_COMMAND_EXECUTION_FAILED", message: "Failed to append measure." }],
            warnings: [],
        };
        renderAll();
        return;
    }
    loadFromText(nextXml);
    writeLocalDraft(nextXml);
    if (selectedMeasure) {
        initializeMeasureEditor(selectedMeasure);
    }
};
const onMeasureApply = () => {
    if (!draftCore || !selectedMeasure)
        return;
    const draftSave = draftCore.save();
    if (!draftSave.ok) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: draftSave.diagnostics,
            warnings: [],
        };
        renderAll();
        return;
    }
    const mainXml = core.debugSerializeCurrentXml();
    if (!mainXml)
        return;
    const merged = replaceMeasureInMainXml(mainXml, selectedMeasure.partId, selectedMeasure.measureNumber, draftSave.xml);
    if (!merged) {
        setUiMappingDiagnostic("Failed to apply measure changes.");
        return;
    }
    try {
        core.load(merged);
    }
    catch (error) {
        setUiMappingDiagnostic(`Failed to reload after applying measure changes: ${error instanceof Error ? error.message : String(error)}`);
        return;
    }
    state.loaded = true;
    state.lastDispatchResult = null;
    refreshNotesFromCore();
    autoSaveCurrentXml(true);
    renderAll();
    renderScorePreview();
    initializeMeasureEditor(selectedMeasure);
};
const onMeasureDiscard = () => {
    if (!selectedMeasure)
        return;
    initializeMeasureEditor(selectedMeasure);
};
const onChangeDuration = () => {
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const duration = readDuration();
    if (!duration) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [{ code: "MVP_INVALID_COMMAND_PAYLOAD", message: "Invalid duration input." }],
            warnings: [],
        };
        renderAll();
        return;
    }
    const command = {
        type: "change_duration",
        targetNodeId,
        voice: commandVoiceForSelection(),
        duration,
    };
    runCommand(command);
};
const onInsertAfter = () => {
    const anchorNodeId = requireSelectedNode();
    if (!anchorNodeId)
        return;
    const duration = readDuration();
    const pitch = readSelectedPitch();
    if (!duration || !pitch) {
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [{ code: "MVP_INVALID_COMMAND_PAYLOAD", message: "Invalid inserted note input." }],
            warnings: [],
        };
        renderAll();
        return;
    }
    const command = {
        type: "insert_note_after",
        anchorNodeId,
        voice: commandVoiceForSelection(),
        note: { duration, pitch },
    };
    runCommand(command);
};
const onDelete = () => {
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const command = {
        type: "delete_note",
        targetNodeId,
        voice: commandVoiceForSelection(),
    };
    runCommand(command);
};
const onSplitNote = () => {
    if (selectedDraftNoteIsRest)
        return;
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const command = {
        type: "split_note",
        targetNodeId,
        voice: commandVoiceForSelection(),
    };
    runCommand(command);
};
const onConvertRestToNote = () => {
    if (!selectedDraftNoteIsRest)
        return;
    const targetNodeId = requireSelectedNode();
    if (!targetNodeId)
        return;
    const pitch = { step: "C", octave: 4 };
    const command = {
        type: "change_to_pitch",
        targetNodeId,
        voice: commandVoiceForSelection(),
        pitch,
    };
    runCommand(command);
};
const failExport = (format, reason) => {
    const message = `${format} export failed: ${reason}`;
    console.error(`[mikuscore][export][${format.toLowerCase()}] ${reason}`);
    state.lastDispatchResult = {
        ok: false,
        dirtyChanged: false,
        changedNodeIds: [],
        affectedMeasureNumbers: [],
        diagnostics: [{ code: "MVP_COMMAND_EXECUTION_FAILED", message }],
        warnings: [],
    };
    renderAll();
};
const onDownload = async () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("MusicXML", "No valid saved XML is available.");
        return;
    }
    try {
        const payload = await (0, download_flow_1.createMusicXmlDownloadPayload)(xmlText, {
            compressed: compressXmlMuseScoreExport.checked,
            useXmlExtension: exportMusicXmlAsXmlExtension.checked,
        });
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("MusicXML", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadMidi = () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("MIDI", "No valid saved XML is available.");
        return;
    }
    const sourceDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!sourceDoc) {
        failExport("MIDI", "Current MusicXML could not be parsed.");
        return;
    }
    const parsedForCheck = (0, midi_io_1.buildPlaybackEventsFromMusicXmlDoc)(sourceDoc, playback_flow_1.PLAYBACK_TICKS_PER_QUARTER, {
        mode: "midi",
        graceTimingMode: normalizeGraceTimingMode(graceTimingModeSelect.value),
        metricAccentEnabled: metricAccentEnabledInput.checked,
        metricAccentProfile: normalizeMetricAccentProfile(metricAccentProfileSelect.value),
    });
    if (parsedForCheck.events.length === 0) {
        failExport("MIDI", "No notes to export (MIDI events are empty).");
        return;
    }
    const payload = (0, download_flow_1.createMidiDownloadPayload)(xmlText, playback_flow_1.PLAYBACK_TICKS_PER_QUARTER, normalizeMidiProgram(midiProgramSelect.value), forceMidiProgramOverride.checked, normalizeGraceTimingMode(graceTimingModeSelect.value), metricAccentEnabledInput.checked, normalizeMetricAccentProfile(metricAccentProfileSelect.value), (0, midi_musescore_io_1.normalizeMidiExportProfile)(midiExportProfileSelect.value));
    if (!payload) {
        failExport("MIDI", "Could not build MIDI payload from current MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("MIDI", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadVsqx = () => {
    var _a, _b;
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("VSQX", "No valid saved XML is available.");
        return;
    }
    const converted = (0, vsqx_io_1.convertMusicXmlToVsqx)(xmlText, { musicXml: { defaultLyric: DEFAULT_VSQX_LYRIC } });
    if (!converted.ok) {
        failExport("VSQX", (_b = (_a = converted.diagnostic) === null || _a === void 0 ? void 0 : _a.message) !== null && _b !== void 0 ? _b : "MusicXML to VSQX conversion failed.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)((0, download_flow_1.createVsqxDownloadPayload)(converted.vsqx));
    }
    catch (err) {
        failExport("VSQX", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadAbc = () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("ABC", "No valid saved XML is available.");
        return;
    }
    const payload = (0, download_flow_1.createAbcDownloadPayload)(xmlText, abc_io_1.exportMusicXmlDomToAbc);
    if (!payload) {
        failExport("ABC", "Could not build ABC payload from current MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("ABC", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadMei = () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("MEI", "No valid saved XML is available.");
        return;
    }
    const payload = (0, download_flow_1.createMeiDownloadPayload)(xmlText, mei_io_1.exportMusicXmlDomToMei);
    if (!payload) {
        failExport("MEI", "Could not build MEI payload from current MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("MEI", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadLilyPond = () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("LilyPond", "No valid saved XML is available.");
        return;
    }
    const payload = (0, download_flow_1.createLilyPondDownloadPayload)(xmlText, lilypond_io_1.exportMusicXmlDomToLilyPond);
    if (!payload) {
        failExport("LilyPond", "Could not build LilyPond payload from current MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("LilyPond", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadMuseScore = async () => {
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("MuseScore", "No valid saved XML is available.");
        return;
    }
    const payload = await (0, download_flow_1.createMuseScoreDownloadPayload)(xmlText, musescore_io_1.exportMusicXmlDomToMuseScore, {
        compressed: compressXmlMuseScoreExport.checked,
    });
    if (!payload) {
        failExport("MuseScore", "Could not build MuseScore payload from current MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("MuseScore", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadAll = async () => {
    var _a, _b;
    const xmlText = resolveMusicXmlOutput();
    if (!xmlText) {
        failExport("All", "No valid saved XML is available.");
        return;
    }
    try {
        const musicXmlPayload = await (0, download_flow_1.createMusicXmlDownloadPayload)(xmlText, {
            compressed: compressXmlMuseScoreExport.checked,
            useXmlExtension: exportMusicXmlAsXmlExtension.checked,
        });
        const museScorePayload = await (0, download_flow_1.createMuseScoreDownloadPayload)(xmlText, musescore_io_1.exportMusicXmlDomToMuseScore, {
            compressed: compressXmlMuseScoreExport.checked,
        });
        if (!museScorePayload) {
            failExport("All", "Could not build MuseScore payload from current MusicXML.");
            return;
        }
        const midiPayload = (0, download_flow_1.createMidiDownloadPayload)(xmlText, playback_flow_1.PLAYBACK_TICKS_PER_QUARTER, normalizeMidiProgram(midiProgramSelect.value), forceMidiProgramOverride.checked, normalizeGraceTimingMode(graceTimingModeSelect.value), metricAccentEnabledInput.checked, normalizeMetricAccentProfile(metricAccentProfileSelect.value), (0, midi_musescore_io_1.normalizeMidiExportProfile)(midiExportProfileSelect.value));
        if (!midiPayload) {
            failExport("All", "Could not build MIDI payload from current MusicXML.");
            return;
        }
        const convertedVsqx = (0, vsqx_io_1.convertMusicXmlToVsqx)(xmlText, { musicXml: { defaultLyric: DEFAULT_VSQX_LYRIC } });
        if (!convertedVsqx.ok) {
            failExport("All", (_b = (_a = convertedVsqx.diagnostic) === null || _a === void 0 ? void 0 : _a.message) !== null && _b !== void 0 ? _b : "MusicXML to VSQX conversion failed.");
            return;
        }
        const vsqxPayload = (0, download_flow_1.createVsqxDownloadPayload)(convertedVsqx.vsqx);
        const abcPayload = (0, download_flow_1.createAbcDownloadPayload)(xmlText, abc_io_1.exportMusicXmlDomToAbc);
        if (!abcPayload) {
            failExport("All", "Could not build ABC payload from current MusicXML.");
            return;
        }
        const meiPayload = (0, download_flow_1.createMeiDownloadPayload)(xmlText, mei_io_1.exportMusicXmlDomToMei);
        if (!meiPayload) {
            failExport("All", "Could not build MEI payload from current MusicXML.");
            return;
        }
        const lilyPondPayload = (0, download_flow_1.createLilyPondDownloadPayload)(xmlText, lilypond_io_1.exportMusicXmlDomToLilyPond);
        if (!lilyPondPayload) {
            failExport("All", "Could not build LilyPond payload from current MusicXML.");
            return;
        }
        const svgNode = debugScoreArea.querySelector("svg");
        if (!svgNode) {
            failExport("All", "No rendered SVG preview is available.");
            return;
        }
        const svgPayload = (0, download_flow_1.createSvgDownloadPayload)(new XMLSerializer().serializeToString(svgNode));
        const allPayload = await (0, download_flow_1.createZipBundleDownloadPayload)([
            musicXmlPayload,
            museScorePayload,
            midiPayload,
            vsqxPayload,
            abcPayload,
            meiPayload,
            lilyPondPayload,
            svgPayload,
        ]);
        (0, download_flow_1.triggerFileDownload)(allPayload);
    }
    catch (err) {
        failExport("All", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadSvg = () => {
    const svgNode = debugScoreArea.querySelector("svg");
    if (!svgNode) {
        failExport("SVG", "No rendered SVG preview is available.");
        return;
    }
    try {
        const svgText = new XMLSerializer().serializeToString(svgNode);
        (0, download_flow_1.triggerFileDownload)((0, download_flow_1.createSvgDownloadPayload)(svgText));
    }
    catch (err) {
        failExport("SVG", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadMeasureMusicXml = () => {
    var _a, _b, _c;
    const xmlText = (_a = draftCore === null || draftCore === void 0 ? void 0 : draftCore.debugSerializeCurrentXml()) !== null && _a !== void 0 ? _a : "";
    if (!xmlText) {
        failExport("MusicXML", "No editable measure XML is available.");
        return;
    }
    const ts = new Date().toISOString().replace(/[-:TZ.]/g, "").slice(0, 12);
    const partId = (_b = selectedMeasure === null || selectedMeasure === void 0 ? void 0 : selectedMeasure.partId) !== null && _b !== void 0 ? _b : "part";
    const measureNumber = (_c = selectedMeasure === null || selectedMeasure === void 0 ? void 0 : selectedMeasure.measureNumber) !== null && _c !== void 0 ? _c : "measure";
    const safePartId = partId.replace(/[^a-zA-Z0-9._-]/g, "_");
    const safeMeasureNumber = measureNumber.replace(/[^a-zA-Z0-9._-]/g, "_");
    try {
        (0, download_flow_1.triggerFileDownload)({
            fileName: `mikuscore-measure-${safePartId}-${safeMeasureNumber}-${ts}.musicxml`,
            blob: new Blob([(0, musicxml_io_1.prettyPrintMusicXmlText)(xmlText)], { type: "application/xml;charset=utf-8" }),
        });
    }
    catch (err) {
        failExport("MusicXML", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const onDownloadMeasureMidi = () => {
    var _a;
    const xmlText = (_a = draftCore === null || draftCore === void 0 ? void 0 : draftCore.debugSerializeCurrentXml()) !== null && _a !== void 0 ? _a : "";
    if (!xmlText) {
        failExport("MIDI", "No editable measure XML is available.");
        return;
    }
    const sourceDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!sourceDoc) {
        failExport("MIDI", "Current measure MusicXML could not be parsed.");
        return;
    }
    const parsedForCheck = (0, midi_io_1.buildPlaybackEventsFromMusicXmlDoc)(sourceDoc, playback_flow_1.PLAYBACK_TICKS_PER_QUARTER, {
        mode: "midi",
        graceTimingMode: normalizeGraceTimingMode(graceTimingModeSelect.value),
        metricAccentEnabled: metricAccentEnabledInput.checked,
        metricAccentProfile: normalizeMetricAccentProfile(metricAccentProfileSelect.value),
    });
    if (parsedForCheck.events.length === 0) {
        failExport("MIDI", "No notes to export (MIDI events are empty).");
        return;
    }
    const payload = (0, download_flow_1.createMidiDownloadPayload)(xmlText, playback_flow_1.PLAYBACK_TICKS_PER_QUARTER, normalizeMidiProgram(midiProgramSelect.value), forceMidiProgramOverride.checked, normalizeGraceTimingMode(graceTimingModeSelect.value), metricAccentEnabledInput.checked, normalizeMetricAccentProfile(metricAccentProfileSelect.value), (0, midi_musescore_io_1.normalizeMidiExportProfile)(midiExportProfileSelect.value));
    if (!payload) {
        failExport("MIDI", "Could not build MIDI payload from current measure MusicXML.");
        return;
    }
    try {
        (0, download_flow_1.triggerFileDownload)(payload);
    }
    catch (err) {
        failExport("MIDI", err instanceof Error ? err.message : "Unknown download error.");
    }
};
const activateTopTab = (tabName) => {
    const activeIndex = topTabButtons.findIndex((button) => button.dataset.tab === tabName);
    for (const button of topTabButtons) {
        const currentIndex = topTabButtons.indexOf(button);
        const active = button.dataset.tab === tabName;
        button.classList.toggle("is-active", active);
        button.classList.toggle("is-complete", activeIndex >= 0 && currentIndex < activeIndex);
        button.setAttribute("aria-selected", active ? "true" : "false");
    }
    for (const panel of topTabPanels) {
        panel.hidden = panel.dataset.tabPanel !== tabName;
    }
    if (tabName !== "input") {
        localDraftNotice.classList.add("md-hidden");
    }
    renderLocalDraftUi();
};
if (topTabButtons.length > 0 && topTabPanels.length > 0) {
    for (const button of topTabButtons) {
        button.setAttribute("role", "tab");
        button.setAttribute("aria-selected", button.classList.contains("is-active") ? "true" : "false");
        button.addEventListener("click", () => {
            activateTopTab(button.dataset.tab || "input");
        });
    }
    activateTopTab(((_a = topTabButtons.find((button) => button.classList.contains("is-active"))) === null || _a === void 0 ? void 0 : _a.dataset.tab) || "input");
}
measureSelectGuideBtn.addEventListener("click", () => {
    activateTopTab("score");
});
inputEntryFile.addEventListener("change", () => {
    if (!inputEntryFile.checked) {
        resetZipEntrySelectionUi();
    }
    renderInputMode();
});
inputEntrySource.addEventListener("change", () => {
    if (inputEntrySource.checked) {
        resetZipEntrySelectionUi();
    }
    renderInputMode();
});
inputEntryNew.addEventListener("change", () => {
    if (inputEntryNew.checked) {
        resetZipEntrySelectionUi();
    }
    renderInputMode();
});
sourceTypeXml.addEventListener("change", renderInputMode);
sourceTypeMuseScore.addEventListener("change", renderInputMode);
sourceTypeVsqx.addEventListener("change", renderInputMode);
sourceTypeAbc.addEventListener("change", renderInputMode);
sourceTypeMei.addEventListener("change", renderInputMode);
sourceTypeLilyPond.addEventListener("change", renderInputMode);
newPartCountInput.addEventListener("change", renderNewPartClefControls);
newPartCountInput.addEventListener("input", renderNewPartClefControls);
newTemplatePianoGrandStaff.addEventListener("change", renderNewPartClefControls);
fileSelectBtn.addEventListener("click", () => {
    // Clear selection so choosing the same file again still fires `change`.
    resetZipEntrySelectionUi();
    fileInput.value = "";
    fileInput.click();
});
fileInput.addEventListener("change", async () => {
    var _a;
    const f = (_a = fileInput.files) === null || _a === void 0 ? void 0 : _a[0];
    fileNameText.textContent = f ? f.name : "No file selected";
    fileNameText.classList.toggle("md-hidden", !f);
    if (!f) {
        resetZipEntrySelectionUi();
        return;
    }
    inputEntryFile.checked = true;
    inputEntrySource.checked = false;
    inputEntryNew.checked = false;
    if (!isZipFileName(f.name)) {
        resetZipEntrySelectionUi();
    }
    renderInputMode();
    if (inputEntryNew.checked || !inputEntryFile.checked)
        return;
    await onLoadClick();
});
zipEntrySelect.addEventListener("change", async () => {
    var _a;
    const archive = (_a = fileInput.files) === null || _a === void 0 ? void 0 : _a[0];
    const entryPath = zipEntrySelect.value;
    if (!archive || !entryPath || !isZipFileName(archive.name))
        return;
    try {
        selectedZipEntryVirtualFile = await loadZipEntryAsVirtualFile(archive, entryPath);
    }
    catch (error) {
        state.importWarningSummary = "";
        state.lastDispatchResult = {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [
                {
                    code: "MVP_INVALID_COMMAND_PAYLOAD",
                    message: `Failed to read ZIP entry: ${error instanceof Error ? error.message : String(error)}`,
                },
            ],
            warnings: [],
        };
        renderAll();
        return;
    }
    await onLoadClick();
});
loadBtn.addEventListener("click", () => {
    void onLoadClick();
});
discardDraftExportBtn.addEventListener("click", onDiscardLocalDraft);
const loadBuiltInSample = (xml) => {
    inputEntryFile.checked = false;
    inputEntrySource.checked = true;
    inputEntryNew.checked = false;
    sourceTypeXml.checked = true;
    sourceTypeMuseScore.checked = false;
    sourceTypeVsqx.checked = false;
    sourceTypeAbc.checked = false;
    sourceTypeMei.checked = false;
    sourceTypeLilyPond.checked = false;
    xmlInput.value = xml;
    renderInputMode();
    renderLocalDraftUi();
    void onLoadClick();
};
loadSampleBtn1.addEventListener("click", () => {
    loadBuiltInSample(sampleXml_1.sampleXml);
});
loadSample2Btn.addEventListener("click", () => {
    loadBuiltInSample(sampleXml2_1.sampleXml2);
});
if (noteSelect) {
    noteSelect.addEventListener("change", () => {
        state.selectedNodeId = noteSelect.value || null;
        renderAll();
    });
}
durationPreset.addEventListener("change", () => {
    onDurationPresetChange();
});
durationPreset.addEventListener("input", () => {
    onDurationPresetChange();
});
pitchStepDownBtn.addEventListener("click", () => {
    flashStepButton(pitchStepDownBtn);
    shiftPitchStep(-1);
});
pitchStepUpBtn.addEventListener("click", () => {
    flashStepButton(pitchStepUpBtn);
    shiftPitchStep(1);
});
for (const btn of pitchAlterBtns) {
    btn.addEventListener("click", () => {
        var _a;
        pitchAlter.value = normalizeAlterValue((_a = btn.dataset.alter) !== null && _a !== void 0 ? _a : "");
        onAlterAutoChange();
    });
}
deleteBtn.addEventListener("click", onDelete);
splitNoteBtn.addEventListener("click", onSplitNote);
convertRestBtn.addEventListener("click", onConvertRestToNote);
playBtn.addEventListener("click", () => {
    void startPlayback();
});
playBtn.addEventListener("pointerdown", unlockAudioOnGesture, { passive: true });
playBtn.addEventListener("touchstart", unlockAudioOnGesture, { passive: true });
exportPlayBtn.addEventListener("click", () => {
    void startPlayback();
});
exportPlayBtn.addEventListener("pointerdown", unlockAudioOnGesture, { passive: true });
exportPlayBtn.addEventListener("touchstart", unlockAudioOnGesture, { passive: true });
stopBtn.addEventListener("click", stopPlayback);
scoreEditBtn.addEventListener("click", () => {
    if (!selectedMeasure)
        return;
    activateTopTab("edit");
});
exportStopBtn.addEventListener("click", stopPlayback);
downloadBtn.addEventListener("click", onDownload);
downloadMidiBtn.addEventListener("click", onDownloadMidi);
downloadVsqxBtn.addEventListener("click", onDownloadVsqx);
downloadAbcBtn.addEventListener("click", onDownloadAbc);
downloadMeiBtn.addEventListener("click", onDownloadMei);
downloadLilyPondBtn.addEventListener("click", onDownloadLilyPond);
downloadMuseScoreBtn.addEventListener("click", onDownloadMuseScore);
downloadAllBtn.addEventListener("click", () => {
    void onDownloadAll();
});
downloadSvgBtn.addEventListener("click", onDownloadSvg);
resetPlaybackSettingsBtn.addEventListener("click", onResetPlaybackSettings);
midiProgramSelect.addEventListener("change", writePlaybackSettings);
midiExportProfileSelect.addEventListener("change", writePlaybackSettings);
midiImportQuantizeGridSelect.addEventListener("change", writePlaybackSettings);
midiImportTripletAware.addEventListener("change", writePlaybackSettings);
forceMidiProgramOverride.addEventListener("change", writePlaybackSettings);
playbackWaveform.addEventListener("change", writePlaybackSettings);
playbackUseMidiLike.addEventListener("change", writePlaybackSettings);
graceTimingModeSelect.addEventListener("change", writePlaybackSettings);
metricAccentEnabledInput.addEventListener("change", () => {
    writePlaybackSettings();
    renderControlState();
});
metricAccentProfileSelect.addEventListener("change", writePlaybackSettings);
keepMksMetaMetadataInMusicXml.addEventListener("change", () => {
    writePlaybackSettings();
    renderOutput();
});
keepMksSrcMetadataInMusicXml.addEventListener("change", () => {
    writePlaybackSettings();
    renderOutput();
});
keepMksDbgMetadataInMusicXml.addEventListener("change", () => {
    writePlaybackSettings();
    renderOutput();
});
exportMusicXmlAsXmlExtension.addEventListener("change", writePlaybackSettings);
compressXmlMuseScoreExport.addEventListener("change", () => {
    if (compressXmlMuseScoreExport.checked) {
        exportMusicXmlAsXmlExtension.checked = false;
    }
    writePlaybackSettings();
});
generalSettingsAccordion.addEventListener("toggle", writePlaybackSettings);
settingsAccordion.addEventListener("toggle", writePlaybackSettings);
debugScoreArea.addEventListener("click", onVerovioScoreClick);
measureEditorArea.addEventListener("click", onMeasureEditorClick);
editSubTabEditorBtn.addEventListener("click", () => {
    activateEditSubTab("editor");
});
editSubTabXmlBtn.addEventListener("click", () => {
    activateEditSubTab("xml");
});
measureApplyBtn.addEventListener("click", onMeasureApply);
measureDiscardBtn.addEventListener("click", onMeasureDiscard);
measureNavLeftBtn.addEventListener("click", () => navigateSelectedMeasure("left"));
measureNavRightBtn.addEventListener("click", () => navigateSelectedMeasure("right"));
measureNavUpBtn.addEventListener("click", () => navigateSelectedMeasure("up"));
measureNavDownBtn.addEventListener("click", () => navigateSelectedMeasure("down"));
appendMeasureBtn.addEventListener("click", onAppendMeasureAtEnd);
playMeasureBtn.addEventListener("click", () => {
    void startMeasurePlayback();
});
downloadMeasureMusicXmlBtn.addEventListener("click", onDownloadMeasureMusicXml);
downloadMeasureMidiBtn.addEventListener("click", onDownloadMeasureMidi);
playMeasureBtn.addEventListener("pointerdown", unlockAudioOnGesture, { passive: true });
playMeasureBtn.addEventListener("touchstart", unlockAudioOnGesture, { passive: true });
renderNewPartClefControls();
applyInitialXmlInputValue();
applyInitialPlaybackSettings();
(0, vsqx_io_1.installVsqxMusicXmlNormalizationHook)((xml) => (0, musicxml_io_1.applyImplicitBeamsToMusicXmlText)((0, musicxml_io_1.normalizeImportedMusicXmlText)(xml)));
installGlobalAudioUnlock();
loadFromText(xmlInput.value);

  },
  "src/ts/midi-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildPlaybackEventsFromXml = exports.buildPlaybackEventsFromMusicXmlDoc = exports.convertMidiToMusicXml = exports.buildMidiBytesForPlayback = exports.collectMidiKeySignatureEventsFromMusicXmlDoc = exports.collectMidiTimeSignatureEventsFromMusicXmlDoc = exports.collectMidiTempoEventsFromMusicXmlDoc = exports.collectMidiControlEventsFromMusicXmlDoc = exports.collectMidiProgramOverridesFromMusicXmlDoc = void 0;
const beam_common_1 = require("./beam-common");
const staffClefPolicy_1 = require("../../core/staffClefPolicy");
const normalizeLeadingPickupTimeSignatureEvents = (events, ticksPerQuarter) => {
    if (events.length < 2)
        return { events, normalized: false, pickupTicks: 0 };
    const sorted = events
        .map((event) => ({
        ...event,
        tick: Math.max(0, Math.round(event.tick)),
        beats: Math.max(1, Math.round(event.beats)),
        beatType: Math.max(1, Math.round(event.beatType)),
    }))
        .sort((a, b) => a.tick - b.tick);
    const first = sorted[0];
    const second = sorted[1];
    const firstMeasureTicks = Math.max(1, Math.round((Math.max(1, Math.round(ticksPerQuarter)) * 4 * first.beats) / Math.max(1, first.beatType)));
    const isPickupPrelude = first.tick === 0 &&
        first.beats === 1 &&
        second.tick === firstMeasureTicks &&
        second.beats > 1 &&
        second.beatType === first.beatType;
    if (!isPickupPrelude)
        return { events: sorted, normalized: false, pickupTicks: 0 };
    const normalized = [{ ...second, tick: 0 }, ...sorted.slice(2)];
    return { events: normalized, normalized: true, pickupTicks: firstMeasureTicks };
};
const instrumentByPreset = {
    electric_piano_2: 5, // Existing default in this app.
    acoustic_grand_piano: 1,
    electric_piano_1: 4,
    honky_tonk_piano: 3,
    harpsichord: 6,
    clavinet: 7,
    drawbar_organ: 16,
    acoustic_guitar_nylon: 24,
    acoustic_bass: 32,
    violin: 40,
    string_ensemble_1: 48,
    synth_brass_1: 62,
};
const clampTempo = (tempo) => {
    if (!Number.isFinite(tempo))
        return 120;
    return Math.max(20, Math.min(300, Math.round(tempo)));
};
const clampVelocity = (velocity) => {
    if (!Number.isFinite(velocity))
        return 80;
    return Math.max(1, Math.min(127, Math.round(velocity)));
};
const mod12 = (value) => {
    const rounded = Math.round(value);
    return ((rounded % 12) + 12) % 12;
};
const keyTonicPitchClassFromFifths = (fifths, mode) => {
    const majorTonic = mod12(7 * Math.max(-7, Math.min(7, Math.round(fifths))));
    return mode === "minor" ? mod12(majorTonic + 9) : majorTonic;
};
const keyScalePitchClasses = (fifths, mode) => {
    const tonic = keyTonicPitchClassFromFifths(fifths, mode);
    const intervals = mode === "minor" ? [0, 2, 3, 5, 7, 8, 10] : [0, 2, 4, 5, 7, 9, 11];
    return new Set(intervals.map((interval) => mod12(tonic + interval)));
};
const inferKeySignatureFromImportedNotes = (notes) => {
    var _a, _b, _c, _d, _e, _f;
    if (!notes.length)
        return null;
    const pitchClassWeights = new Array(12).fill(0);
    for (const note of notes) {
        const pitchClass = mod12(note.midi);
        const duration = Math.max(1, Math.round(note.endTick) - Math.round(note.startTick));
        pitchClassWeights[pitchClass] += duration;
    }
    const totalWeight = pitchClassWeights.reduce((sum, value) => sum + value, 0);
    if (totalWeight <= 0)
        return null;
    const uniquePitchClasses = pitchClassWeights.filter((weight) => weight > 0).length;
    if (notes.length < 3 || uniquePitchClasses < 3)
        return null;
    const sortedNotes = notes
        .slice()
        .sort((a, b) => (a.startTick === b.startTick ? a.midi - b.midi : a.startTick - b.startTick));
    const firstPitchClass = mod12((_b = (_a = sortedNotes[0]) === null || _a === void 0 ? void 0 : _a.midi) !== null && _b !== void 0 ? _b : 0);
    const lastPitchClass = mod12((_d = (_c = sortedNotes[sortedNotes.length - 1]) === null || _c === void 0 ? void 0 : _c.midi) !== null && _d !== void 0 ? _d : 0);
    let best = null;
    for (let fifths = -7; fifths <= 7; fifths += 1) {
        for (const mode of ["major", "minor"]) {
            const inScale = keyScalePitchClasses(fifths, mode);
            const tonicPitchClass = keyTonicPitchClassFromFifths(fifths, mode);
            let score = 0;
            for (let pitchClass = 0; pitchClass < 12; pitchClass += 1) {
                const weight = (_e = pitchClassWeights[pitchClass]) !== null && _e !== void 0 ? _e : 0;
                if (weight <= 0)
                    continue;
                score += inScale.has(pitchClass) ? weight : -weight * 0.55;
            }
            score += ((_f = pitchClassWeights[tonicPitchClass]) !== null && _f !== void 0 ? _f : 0) * 0.2;
            if (firstPitchClass === tonicPitchClass)
                score += totalWeight * 0.08;
            if (lastPitchClass === tonicPitchClass)
                score += totalWeight * 0.12;
            if (!best || score > best.score) {
                best = { fifths, mode, score };
                continue;
            }
            if (score === best.score && Math.abs(fifths) < Math.abs(best.fifths)) {
                best = { fifths, mode, score };
                continue;
            }
            if (score === best.score && Math.abs(fifths) === Math.abs(best.fifths) && mode === "major") {
                best = { fifths, mode, score };
            }
        }
    }
    return best ? { fifths: best.fifths, mode: best.mode } : null;
};
const DRUM_NAME_HINT_TO_GM_NOTE = [
    { pattern: /kick|bass drum|bd/i, midi: 36 },
    { pattern: /snare|sd/i, midi: 38 },
    { pattern: /rim/i, midi: 37 },
    { pattern: /clap/i, midi: 39 },
    { pattern: /closed hihat|closed hi-hat|chh|hh closed/i, midi: 42 },
    { pattern: /pedal hihat|pedal hi-hat/i, midi: 44 },
    { pattern: /open hihat|open hi-hat|ohh|hh open/i, midi: 46 },
    { pattern: /low tom|floor tom/i, midi: 45 },
    { pattern: /mid tom|middle tom/i, midi: 47 },
    { pattern: /high tom/i, midi: 50 },
    { pattern: /crash/i, midi: 49 },
    { pattern: /ride/i, midi: 51 },
    { pattern: /cowbell/i, midi: 56 },
    { pattern: /tambourine/i, midi: 54 },
    { pattern: /shaker|maracas/i, midi: 70 },
    { pattern: /conga/i, midi: 64 },
    { pattern: /bongo/i, midi: 60 },
    { pattern: /timbale/i, midi: 65 },
    { pattern: /agogo/i, midi: 67 },
    { pattern: /triangle/i, midi: 81 },
];
const DYNAMICS_TO_VELOCITY = {
    pppp: 20,
    ppp: 28,
    pp: 38,
    p: 50,
    mp: 64,
    mf: 80,
    f: 96,
    ff: 112,
    fff: 120,
    ffff: 126,
    sfz: 110,
    sf: 108,
    rfz: 106,
};
const DEFAULT_DETACHE_DURATION_RATIO = 0.93;
const DEFAULT_GRACE_TIMING_MODE = "before_beat";
const DEFAULT_METRIC_ACCENT_PROFILE = "subtle";
const DEFAULT_MIDI_IMPORT_QUANTIZE_GRID = "1/64";
const METRIC_ACCENT_PROFILE_DELTAS = {
    subtle: { strong: 2, medium: 1 },
    balanced: { strong: 4, medium: 2 },
    strong: { strong: 6, medium: 3 },
};
const normalizeMetricAccentProfile = (value) => {
    if (value === "balanced" || value === "strong")
        return value;
    return DEFAULT_METRIC_ACCENT_PROFILE;
};
const readDirectionVelocity = (directionNode, fallback) => {
    var _a, _b, _c;
    const soundDynamicsText = (_c = (_b = (_a = directionNode.querySelector(":scope > sound")) === null || _a === void 0 ? void 0 : _a.getAttribute("dynamics")) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
    if (soundDynamicsText) {
        const parsed = Number(soundDynamicsText);
        if (Number.isFinite(parsed) && parsed > 0)
            return clampVelocity((parsed / 100) * 127);
    }
    const dynamicsNode = directionNode.querySelector("direction-type > dynamics");
    if (!dynamicsNode)
        return fallback;
    for (const child of Array.from(dynamicsNode.children)) {
        const tag = child.tagName.toLowerCase();
        if (DYNAMICS_TO_VELOCITY[tag] !== undefined) {
            return DYNAMICS_TO_VELOCITY[tag];
        }
    }
    return fallback;
};
const getNoteArticulationAdjustments = (noteNode) => {
    let velocityDelta = 0;
    let durationRatio = 1;
    let hasTenuto = false;
    const articulations = Array.from(noteNode.querySelectorAll("notations > articulations > *"));
    for (const articulation of articulations) {
        const tag = articulation.tagName.toLowerCase();
        if (tag === "strong-accent")
            velocityDelta += 24;
        if (tag === "accent")
            velocityDelta += 14;
        if (tag === "staccatissimo")
            durationRatio = Math.min(durationRatio, 0.35);
        if (tag === "staccato")
            durationRatio = Math.min(durationRatio, 0.55);
        if (tag === "tenuto") {
            hasTenuto = true;
            durationRatio = Math.max(durationRatio, 1);
        }
    }
    return { velocityDelta, durationRatio, hasTenuto };
};
const getTieFlags = (noteNode) => {
    var _a;
    const directTieNodes = Array.from(noteNode.children).filter((child) => child.tagName === "tie");
    const notationTieNodes = Array.from(noteNode.querySelectorAll("notations > tied"));
    const allTieNodes = [...directTieNodes, ...notationTieNodes];
    let start = false;
    let stop = false;
    for (const tieNode of allTieNodes) {
        const tieType = (_a = tieNode.getAttribute("type")) === null || _a === void 0 ? void 0 : _a.trim().toLowerCase();
        if (tieType === "start")
            start = true;
        if (tieType === "stop")
            stop = true;
    }
    return { start, stop };
};
const getSlurNumbers = (noteNode) => {
    var _a, _b, _c;
    const starts = [];
    const stops = [];
    const slurNodes = Array.from(noteNode.querySelectorAll("notations > slur"));
    for (const slurNode of slurNodes) {
        const slurType = (_b = (_a = slurNode.getAttribute("type")) === null || _a === void 0 ? void 0 : _a.trim().toLowerCase()) !== null && _b !== void 0 ? _b : "";
        const slurNumber = ((_c = slurNode.getAttribute("number")) === null || _c === void 0 ? void 0 : _c.trim()) || "1";
        if (slurType === "start")
            starts.push(slurNumber);
        if (slurType === "stop")
            stops.push(slurNumber);
    }
    return { starts, stops };
};
const getTemporalExpressionAdjustments = (noteNode, baseDurTicks, ticksPerQuarter) => {
    const hasFermata = Boolean(noteNode.querySelector("notations > fermata"));
    const hasCaesura = Boolean(noteNode.querySelector("notations > articulations > caesura")) ||
        Boolean(noteNode.querySelector("notations > caesura"));
    if (!hasFermata && !hasCaesura) {
        return { durationExtraTicks: 0, postPauseTicks: 0 };
    }
    let durationExtraTicks = 0;
    let postPauseTicks = 0;
    if (hasFermata) {
        durationExtraTicks += Math.max(Math.round(baseDurTicks * 0.35), Math.max(1, Math.round(ticksPerQuarter / 8)));
        postPauseTicks += Math.max(1, Math.round(ticksPerQuarter / 6));
    }
    if (hasCaesura) {
        durationExtraTicks += Math.max(0, Math.round(baseDurTicks * 0.12));
        postPauseTicks += Math.max(1, Math.round(ticksPerQuarter / 4));
    }
    return { durationExtraTicks, postPauseTicks };
};
const buildMetricAccentPattern = (beats, beatType, profile) => {
    const deltas = METRIC_ACCENT_PROFILE_DELTAS[normalizeMetricAccentProfile(profile)];
    const strong = deltas.strong;
    const medium = deltas.medium;
    if (beats === 4 && beatType === 4) {
        return [strong, 0, medium, 0];
    }
    if (beats === 6 && beatType === 8) {
        return [strong, 0, 0, medium, 0, 0];
    }
    if (beats === 3) {
        return [strong, 0, 0];
    }
    if (beats === 5) {
        return [strong, 0, medium, 0, 0];
    }
    return [strong, ...Array.from({ length: Math.max(0, beats - 1) }, () => 0)];
};
const getMetricAccentVelocityDelta = (startDiv, divisions, beats, beatType, profile) => {
    var _a;
    if (!Number.isFinite(startDiv) || !Number.isFinite(divisions) || !Number.isFinite(beats) || !Number.isFinite(beatType)) {
        return 0;
    }
    if (divisions <= 0 || beats <= 0 || beatType <= 0)
        return 0;
    const beatUnitDiv = (divisions * 4) / beatType;
    if (!Number.isFinite(beatUnitDiv) || beatUnitDiv <= 0)
        return 0;
    const measureDiv = beatUnitDiv * beats;
    if (!Number.isFinite(measureDiv) || measureDiv <= 0)
        return 0;
    const normalizedStartDiv = ((startDiv % measureDiv) + measureDiv) % measureDiv;
    const beatIndex = Math.max(0, Math.min(beats - 1, Math.floor(normalizedStartDiv / beatUnitDiv)));
    const pattern = buildMetricAccentPattern(Math.round(beats), Math.round(beatType), normalizeMetricAccentProfile(profile));
    if (pattern.length === 0)
        return 0;
    return (_a = pattern[beatIndex % pattern.length]) !== null && _a !== void 0 ? _a : 0;
};
const readDirectionWedgeDirective = (directionNode) => {
    var _a, _b, _c;
    const starts = [];
    const stops = new Set();
    const wedgeNodes = Array.from(directionNode.querySelectorAll("direction-type > wedge"));
    for (const wedgeNode of wedgeNodes) {
        const wedgeType = (_b = (_a = wedgeNode.getAttribute("type")) === null || _a === void 0 ? void 0 : _a.trim().toLowerCase()) !== null && _b !== void 0 ? _b : "";
        const wedgeNumber = ((_c = wedgeNode.getAttribute("number")) === null || _c === void 0 ? void 0 : _c.trim()) || "1";
        if (wedgeType === "crescendo" || wedgeType === "diminuendo") {
            starts.push({ number: wedgeNumber, kind: wedgeType });
        }
        if (wedgeType === "stop") {
            stops.add(wedgeNumber);
        }
    }
    return { starts, stops };
};
const splitTicks = (totalTicks, parts) => {
    const safeParts = Math.max(1, Math.round(parts));
    const base = Math.floor(totalTicks / safeParts);
    const rest = totalTicks - base * safeParts;
    return Array.from({ length: safeParts }, (_, i) => base + (i < rest ? 1 : 0));
};
const splitTicksWeighted = (totalTicks, rawWeights) => {
    const weights = rawWeights.map((w) => (Number.isFinite(w) && w > 0 ? w : 1));
    const count = weights.length;
    if (count === 0)
        return [];
    const safeTotal = Math.max(count, Math.round(totalTicks));
    const weightSum = weights.reduce((sum, w) => sum + w, 0) || count;
    const provisional = weights.map((w) => (safeTotal * w) / weightSum);
    const floors = provisional.map((v) => Math.max(1, Math.floor(v)));
    let assigned = floors.reduce((sum, n) => sum + n, 0);
    if (assigned > safeTotal) {
        let overflow = assigned - safeTotal;
        for (let i = count - 1; i >= 0 && overflow > 0; i -= 1) {
            const canRemove = Math.max(0, floors[i] - 1);
            const take = Math.min(canRemove, overflow);
            floors[i] -= take;
            overflow -= take;
        }
        return floors;
    }
    let remaining = safeTotal - assigned;
    const order = provisional
        .map((v, i) => ({ i, frac: v - Math.floor(v) }))
        .sort((a, b) => (b.frac === a.frac ? a.i - b.i : b.frac - a.frac));
    let index = 0;
    while (remaining > 0) {
        floors[order[index % order.length].i] += 1;
        remaining -= 1;
        index += 1;
    }
    return floors;
};
const stepOrder = ["C", "D", "E", "F", "G", "A", "B"];
const resolveNeighborPitch = (direction, step, octave, keyAlterMap, measureAccidentalByStepOctave) => {
    var _a, _b;
    const currentIndex = stepOrder.indexOf(step);
    if (currentIndex < 0)
        return null;
    const delta = direction === "up" ? 1 : -1;
    const rawIndex = currentIndex + delta;
    const wrappedIndex = (rawIndex + stepOrder.length) % stepOrder.length;
    const neighborStep = stepOrder[wrappedIndex];
    let neighborOctave = octave;
    if (direction === "up" && step === "B")
        neighborOctave += 1;
    if (direction === "down" && step === "C")
        neighborOctave -= 1;
    const stepOctaveKey = `${neighborStep}${neighborOctave}`;
    const alter = measureAccidentalByStepOctave.has(stepOctaveKey)
        ? (_a = measureAccidentalByStepOctave.get(stepOctaveKey)) !== null && _a !== void 0 ? _a : 0
        : (_b = keyAlterMap[neighborStep]) !== null && _b !== void 0 ? _b : 0;
    return { step: neighborStep, octave: neighborOctave, alter };
};
const buildOrnamentMidiSequence = (noteNode, baseMidi, durTicks, ticksPerQuarter, context) => {
    var _a, _b;
    if (durTicks < 2)
        return [baseMidi];
    const ornamentTags = new Set(Array.from(noteNode.querySelectorAll("notations > ornaments > *")).map((node) => node.tagName.toLowerCase()));
    if (ornamentTags.size === 0)
        return [baseMidi];
    const upperNeighbor = resolveNeighborPitch("up", context.step, context.octave, context.keyAlterMap, context.measureAccidentalByStepOctave);
    const lowerNeighbor = resolveNeighborPitch("down", context.step, context.octave, context.keyAlterMap, context.measureAccidentalByStepOctave);
    const upperMidi = upperNeighbor
        ? (_a = pitchToMidi(upperNeighbor.step, upperNeighbor.alter, upperNeighbor.octave)) !== null && _a !== void 0 ? _a : Math.min(127, baseMidi + 2)
        : Math.min(127, baseMidi + 2);
    const lowerMidi = lowerNeighbor
        ? (_b = pitchToMidi(lowerNeighbor.step, lowerNeighbor.alter, lowerNeighbor.octave)) !== null && _b !== void 0 ? _b : Math.max(0, baseMidi - 2)
        : Math.max(0, baseMidi - 2);
    if (ornamentTags.has("trill-mark") || ornamentTags.has("shake")) {
        const segmentTicks = Math.max(1, Math.round(ticksPerQuarter / 8));
        const count = Math.max(2, Math.min(16, Math.floor(durTicks / segmentTicks)));
        return Array.from({ length: count }, (_, i) => (i % 2 === 0 ? baseMidi : upperMidi));
    }
    if (ornamentTags.has("turn")) {
        return [upperMidi, baseMidi, lowerMidi, baseMidi];
    }
    if (ornamentTags.has("inverted-turn")) {
        return [lowerMidi, baseMidi, upperMidi, baseMidi];
    }
    if (ornamentTags.has("mordent")) {
        return [baseMidi, lowerMidi, baseMidi];
    }
    if (ornamentTags.has("inverted-mordent")) {
        return [baseMidi, upperMidi, baseMidi];
    }
    return [baseMidi];
};
const pitchToMidi = (step, alter, octave) => {
    const semitoneMap = {
        C: 0,
        D: 2,
        E: 4,
        F: 5,
        G: 7,
        A: 9,
        B: 11,
    };
    const base = semitoneMap[step];
    if (base === undefined)
        return null;
    return (octave + 1) * 12 + base + alter;
};
const keySignatureAlterByStep = (fifths) => {
    const map = { C: 0, D: 0, E: 0, F: 0, G: 0, A: 0, B: 0 };
    const sharpOrder = ["F", "C", "G", "D", "A", "E", "B"];
    const flatOrder = ["B", "E", "A", "D", "G", "C", "F"];
    const safeFifths = Math.max(-7, Math.min(7, Math.round(fifths)));
    if (safeFifths > 0) {
        for (let i = 0; i < safeFifths; i += 1)
            map[sharpOrder[i]] = 1;
    }
    else if (safeFifths < 0) {
        for (let i = 0; i < Math.abs(safeFifths); i += 1)
            map[flatOrder[i]] = -1;
    }
    return map;
};
const accidentalTextToAlter = (text) => {
    const normalized = text.trim().toLowerCase();
    if (!normalized)
        return null;
    if (normalized === "sharp")
        return 1;
    if (normalized === "flat")
        return -1;
    if (normalized === "natural")
        return 0;
    if (normalized === "double-sharp")
        return 2;
    if (normalized === "flat-flat")
        return -2;
    return null;
};
const getFirstNumber = (el, selector) => {
    var _a, _b;
    const text = (_b = (_a = el.querySelector(selector)) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim();
    if (!text)
        return null;
    const n = Number(text);
    return Number.isFinite(n) ? n : null;
};
const midiToPitchText = (midiNumber) => {
    const names = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const n = Math.max(0, Math.min(127, Math.round(midiNumber)));
    const octave = Math.floor(n / 12) - 1;
    return `${names[n % 12]}${octave}`;
};
const getMidiWriterRuntime = () => {
    var _a;
    return (_a = window.MidiWriter) !== null && _a !== void 0 ? _a : null;
};
const normalizeTicksPerQuarter = (ticksPerQuarter) => {
    if (!Number.isFinite(ticksPerQuarter))
        return 480;
    return Math.max(1, Math.round(ticksPerQuarter));
};
const setMidiWriterHeaderTicksPerQuarter = (midiWriter, ticksPerQuarter) => {
    const constants = midiWriter.Constants;
    if (!constants || !Array.isArray(constants.HEADER_CHUNK_DIVISION))
        return;
    const tpq = Math.max(1, Math.min(0x7fff, normalizeTicksPerQuarter(ticksPerQuarter)));
    constants.HEADER_CHUNK_DIVISION = [(tpq >> 8) & 0xff, tpq & 0xff];
};
const normalizeMidiProgramNumber = (value) => {
    if (!Number.isFinite(value))
        return null;
    const rounded = Math.round(value);
    if (rounded < 1 || rounded > 128)
        return null;
    return rounded;
};
const normalizeMidiImportQuantizeGridOption = (value) => {
    if (value === "auto")
        return "auto";
    if (value === "1/8" || value === "1/16" || value === "1/32" || value === "1/64")
        return value;
    return DEFAULT_MIDI_IMPORT_QUANTIZE_GRID;
};
const quantizeGridToDivisions = (grid) => {
    if (grid === "1/8")
        return 2;
    if (grid === "1/64")
        return 16;
    if (grid === "1/32")
        return 8;
    return 4;
};
const gcdInt = (a, b) => {
    let x = Math.abs(Math.round(a));
    let y = Math.abs(Math.round(b));
    if (x === 0)
        return Math.max(1, y);
    if (y === 0)
        return Math.max(1, x);
    while (y !== 0) {
        const t = x % y;
        x = y;
        y = t;
    }
    return Math.max(1, x);
};
const isNearMultiple = (value, base, tolerance) => {
    if (!Number.isFinite(value) || !Number.isFinite(base) || base <= 0)
        return false;
    const nearest = Math.round(value / base) * base;
    return Math.abs(value - nearest) <= tolerance;
};
const hasTripletLikeTiming = (notes, ticksPerQuarter) => {
    if (!notes.length || !Number.isFinite(ticksPerQuarter) || ticksPerQuarter <= 0)
        return false;
    const tripletTick = ticksPerQuarter / 3;
    const tolerance = Math.max(1, Math.round(ticksPerQuarter / 96));
    let evidence = 0;
    for (const note of notes) {
        const duration = Math.max(1, Math.round(note.endTick) - Math.round(note.startTick));
        if (isNearMultiple(note.startTick, tripletTick, tolerance))
            evidence += 1;
        if (isNearMultiple(duration, tripletTick, tolerance))
            evidence += 1;
        if (evidence >= 4)
            return true;
    }
    return false;
};
const resolveImportQuantizeTick = (notes, ticksPerQuarter, grid, tripletAwareQuantize) => {
    const subdivision = quantizeGridToDivisions(grid);
    const baseQTick = Math.max(1, Math.round(ticksPerQuarter / subdivision));
    const useTripletAwareQuantize = tripletAwareQuantize && grid === "1/16" && hasTripletLikeTiming(notes, ticksPerQuarter);
    const tripletQTick = Math.max(1, Math.round(ticksPerQuarter / 3));
    const qTick = useTripletAwareQuantize ? gcdInt(baseQTick, tripletQTick) : baseQTick;
    const divisions = Math.max(1, Math.round(ticksPerQuarter / qTick));
    return { qTick, divisions };
};
const scoreImportQuantization = (notes, qTick) => {
    let score = 0;
    for (const note of notes) {
        const start = Math.max(0, Math.round(note.startTick));
        const end = Math.max(start + 1, Math.round(note.endTick));
        const duration = Math.max(1, end - start);
        const quantizedStart = Math.round(start / qTick) * qTick;
        const quantizedEnd = Math.round(end / qTick) * qTick;
        const quantizedDuration = Math.max(qTick, Math.round(duration / qTick) * qTick);
        const startError = Math.abs(start - quantizedStart);
        const endError = Math.abs(end - quantizedEnd);
        const durationError = Math.abs(duration - quantizedDuration);
        // Prioritize onset stability over duration shaping.
        score += startError * 2 + endError + durationError;
    }
    return score;
};
const chooseBestImportQuantizeGrid = (notes, ticksPerQuarter, tripletAwareQuantize) => {
    var _a;
    const candidates = ["1/8", "1/16", "1/32", "1/64"];
    let best = null;
    for (const grid of candidates) {
        const resolved = resolveImportQuantizeTick(notes, ticksPerQuarter, grid, tripletAwareQuantize);
        const score = scoreImportQuantization(notes, resolved.qTick);
        if (!best) {
            best = { grid, score, divisions: resolved.divisions };
            continue;
        }
        if (score < best.score) {
            best = { grid, score, divisions: resolved.divisions };
            continue;
        }
        if (score === best.score && resolved.divisions < best.divisions) {
            best = { grid, score, divisions: resolved.divisions };
        }
    }
    return (_a = best === null || best === void 0 ? void 0 : best.grid) !== null && _a !== void 0 ? _a : DEFAULT_MIDI_IMPORT_QUANTIZE_GRID;
};
const readAscii = (bytes, start, length) => {
    if (start < 0 || length < 0 || start + length > bytes.length)
        return "";
    let out = "";
    for (let i = 0; i < length; i += 1) {
        out += String.fromCharCode(bytes[start + i]);
    }
    return out;
};
const readUint32Be = (bytes, start) => {
    if (start < 0 || start + 4 > bytes.length)
        return null;
    return ((bytes[start] << 24) |
        (bytes[start + 1] << 16) |
        (bytes[start + 2] << 8) |
        bytes[start + 3]) >>> 0;
};
const readUint16Be = (bytes, start) => {
    if (start < 0 || start + 2 > bytes.length)
        return null;
    return (bytes[start] << 8) | bytes[start + 1];
};
const readVariableLengthAt = (bytes, start) => {
    let value = 0;
    let cursor = start;
    for (let i = 0; i < 4; i += 1) {
        if (cursor >= bytes.length)
            return null;
        const current = bytes[cursor];
        value = (value << 7) | (current & 0x7f);
        cursor += 1;
        if ((current & 0x80) === 0)
            return { value, next: cursor };
    }
    return null;
};
const asciiBytesToString = (bytes) => {
    let out = "";
    for (let i = 0; i < bytes.length; i += 1) {
        out += String.fromCharCode(bytes[i] & 0x7f);
    }
    return out;
};
const decodeMetaTextBytes = (bytes) => {
    if (!bytes.length)
        return "";
    try {
        if (typeof TextDecoder !== "undefined") {
            return new TextDecoder("utf-8", { fatal: false }).decode(bytes);
        }
    }
    catch (_a) {
        // fallback below
    }
    return asciiBytesToString(bytes);
};
const safeDecodeURIComponent = (value) => {
    try {
        return decodeURIComponent(value);
    }
    catch (_a) {
        return value;
    }
};
const parseMksMidiTextMetadata = (lines) => {
    const metadata = {
        partNameByTrackIndex: new Map(),
    };
    for (const rawLine of lines) {
        const line = String(rawLine !== null && rawLine !== void 0 ? rawLine : "").trim();
        if (!line.startsWith("mks:"))
            continue;
        if (line.startsWith("mks:title:")) {
            if (!metadata.title)
                metadata.title = safeDecodeURIComponent(line.slice("mks:title:".length));
            continue;
        }
        if (line.startsWith("mks:movement-title:")) {
            if (!metadata.movementTitle) {
                metadata.movementTitle = safeDecodeURIComponent(line.slice("mks:movement-title:".length));
            }
            continue;
        }
        if (line.startsWith("mks:composer:")) {
            if (!metadata.composer)
                metadata.composer = safeDecodeURIComponent(line.slice("mks:composer:".length));
            continue;
        }
        if (line.startsWith("mks:part-name-track:")) {
            const payload = line.slice("mks:part-name-track:".length);
            const sep = payload.indexOf(":");
            if (sep <= 0)
                continue;
            const trackIndex = Number.parseInt(payload.slice(0, sep), 10);
            if (!Number.isFinite(trackIndex) || trackIndex < 0)
                continue;
            if (metadata.partNameByTrackIndex.has(trackIndex))
                continue;
            metadata.partNameByTrackIndex.set(trackIndex, safeDecodeURIComponent(payload.slice(sep + 1)));
        }
    }
    return metadata;
};
const parseMksSysExChunk = (payloadBytes) => {
    var _a, _b, _c, _d, _e;
    if (!payloadBytes.length)
        return null;
    const trimmed = payloadBytes[payloadBytes.length - 1] === 0xf7 ? payloadBytes.slice(0, payloadBytes.length - 1) : payloadBytes;
    const text = asciiBytesToString(trimmed);
    if (!text.startsWith("mks|"))
        return null;
    const parts = text.split("|");
    const map = new Map();
    for (const part of parts.slice(1)) {
        const eq = part.indexOf("=");
        if (eq <= 0)
            continue;
        map.set(part.slice(0, eq), part.slice(eq + 1));
    }
    if (((_a = map.get("v")) !== null && _a !== void 0 ? _a : "") !== "1")
        return null;
    const messageId = Number.parseInt((_b = map.get("m")) !== null && _b !== void 0 ? _b : "", 10);
    const chunkIndex = Number.parseInt((_c = map.get("i")) !== null && _c !== void 0 ? _c : "", 10);
    const totalChunks = Number.parseInt((_d = map.get("n")) !== null && _d !== void 0 ? _d : "", 10);
    if (!Number.isFinite(messageId) || !Number.isFinite(chunkIndex) || !Number.isFinite(totalChunks))
        return null;
    if (chunkIndex < 1 || totalChunks < 1 || chunkIndex > totalChunks)
        return null;
    const encoded = (_e = map.get("d")) !== null && _e !== void 0 ? _e : "";
    try {
        return {
            messageId,
            chunkIndex,
            totalChunks,
            data: decodeURIComponent(encoded),
        };
    }
    catch (_f) {
        return null;
    }
};
const assembleMksSysExPayloads = (chunks) => {
    var _a, _b, _c, _d;
    if (!chunks.length)
        return [];
    const byMessageId = new Map();
    for (const chunk of chunks) {
        const bucket = (_a = byMessageId.get(chunk.messageId)) !== null && _a !== void 0 ? _a : [];
        bucket.push(chunk);
        byMessageId.set(chunk.messageId, bucket);
    }
    const payloads = [];
    const sortedMessageIds = Array.from(byMessageId.keys()).sort((a, b) => a - b);
    for (const messageId of sortedMessageIds) {
        const group = ((_b = byMessageId.get(messageId)) !== null && _b !== void 0 ? _b : []).slice().sort((a, b) => a.chunkIndex - b.chunkIndex);
        const total = (_d = (_c = group[0]) === null || _c === void 0 ? void 0 : _c.totalChunks) !== null && _d !== void 0 ? _d : 0;
        if (total <= 0)
            continue;
        if (group.length < total)
            continue;
        const byIndex = new Map();
        for (const chunk of group) {
            if (chunk.totalChunks !== total)
                continue;
            byIndex.set(chunk.chunkIndex, chunk.data);
        }
        if (byIndex.size < total)
            continue;
        const ordered = [];
        let ok = true;
        for (let i = 1; i <= total; i += 1) {
            const text = byIndex.get(i);
            if (text === undefined) {
                ok = false;
                break;
            }
            ordered.push(text);
        }
        if (ok)
            payloads.push(ordered.join(""));
    }
    return payloads;
};
const parseSmfHeader = (midiBytes) => {
    const diagnostics = [];
    if (midiBytes.length < 14) {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "SMF header is too short.",
        });
        return { header: null, diagnostics };
    }
    if (readAscii(midiBytes, 0, 4) !== "MThd") {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "Missing MThd header chunk.",
        });
        return { header: null, diagnostics };
    }
    const headerLength = readUint32Be(midiBytes, 4);
    const format = readUint16Be(midiBytes, 8);
    const trackCount = readUint16Be(midiBytes, 10);
    const division = readUint16Be(midiBytes, 12);
    if (headerLength === null ||
        format === null ||
        trackCount === null ||
        division === null ||
        headerLength < 6) {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "Invalid SMF header fields.",
        });
        return { header: null, diagnostics };
    }
    const nextOffset = 8 + headerLength;
    if (nextOffset > midiBytes.length) {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "Header chunk length exceeds file size.",
        });
        return { header: null, diagnostics };
    }
    if (format !== 0 && format !== 1) {
        diagnostics.push({
            code: "MIDI_UNSUPPORTED_FORMAT",
            message: `Unsupported SMF format ${format}. Supported formats are 0 and 1.`,
        });
        return { header: null, diagnostics };
    }
    if ((division & 0x8000) !== 0) {
        diagnostics.push({
            code: "MIDI_UNSUPPORTED_DIVISION",
            message: "SMPTE time division is unsupported. Use PPQ-based MIDI files.",
        });
        return { header: null, diagnostics };
    }
    const ticksPerQuarter = division & 0x7fff;
    if (ticksPerQuarter <= 0) {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "PPQ must be a positive integer.",
        });
        return { header: null, diagnostics };
    }
    return {
        header: {
            format,
            trackCount,
            ticksPerQuarter,
            nextOffset,
        },
        diagnostics,
    };
};
const parseTrackSummary = (trackData, trackIndex) => {
    var _a, _b;
    const notes = [];
    const channels = new Set();
    let trackName = null;
    const programByTrackChannel = new Map();
    const controllerEvents = [];
    const timeSignatureEvents = [];
    const keySignatureEvents = [];
    const tempoEvents = [];
    const mksSysExChunks = [];
    const mksTextMetaLines = [];
    const parseWarnings = [];
    const activeNoteStartTicks = new Map();
    let cursor = 0;
    let absTick = 0;
    let runningStatus = null;
    while (cursor < trackData.length) {
        const delta = readVariableLengthAt(trackData, cursor);
        if (!delta) {
            parseWarnings.push({
                code: "MIDI_EVENT_DROPPED",
                message: "Invalid variable-length delta time in track; remaining events were dropped.",
            });
            break;
        }
        cursor = delta.next;
        absTick += Math.max(0, delta.value);
        if (cursor >= trackData.length)
            break;
        let statusByte = trackData[cursor];
        if (statusByte < 0x80) {
            if (runningStatus === null) {
                parseWarnings.push({
                    code: "MIDI_EVENT_DROPPED",
                    message: "Running status without previous status; event dropped.",
                });
                break;
            }
            statusByte = runningStatus;
        }
        else {
            cursor += 1;
            runningStatus = statusByte < 0xf0 ? statusByte : null;
        }
        if (statusByte === 0xff) {
            if (cursor >= trackData.length)
                break;
            const metaType = trackData[cursor];
            cursor += 1;
            const metaLen = readVariableLengthAt(trackData, cursor);
            if (!metaLen)
                break;
            const payloadStart = metaLen.next;
            const payloadEnd = payloadStart + metaLen.value;
            if (payloadEnd > trackData.length) {
                parseWarnings.push({
                    code: "MIDI_EVENT_DROPPED",
                    message: "Meta event length overflow; remaining events were dropped.",
                });
                break;
            }
            if (metaType === 0x58 && metaLen.value >= 2) {
                const beats = trackData[payloadStart];
                const beatTypePow = trackData[payloadStart + 1];
                const beatType = Math.pow(2, beatTypePow);
                if (beats > 0 && Number.isFinite(beatType) && beatType > 0) {
                    timeSignatureEvents.push({ tick: absTick, beats, beatType });
                }
            }
            else if (metaType === 0x59 && metaLen.value >= 2) {
                const sfRaw = trackData[payloadStart];
                const sf = sfRaw >= 0x80 ? sfRaw - 0x100 : sfRaw;
                const mi = trackData[payloadStart + 1];
                const fifths = Math.max(-7, Math.min(7, sf));
                const mode = mi === 1 ? "minor" : "major";
                keySignatureEvents.push({ tick: absTick, fifths, mode });
            }
            else if (metaType === 0x51 && metaLen.value >= 3) {
                const microsPerQuarter = (trackData[payloadStart] << 16) |
                    (trackData[payloadStart + 1] << 8) |
                    trackData[payloadStart + 2];
                if (microsPerQuarter > 0) {
                    const bpm = clampTempo(60000000 / microsPerQuarter);
                    tempoEvents.push({ tick: absTick, bpm });
                }
            }
            else if (metaType === 0x01 || metaType === 0x03) {
                const payloadBytes = trackData.slice(payloadStart, payloadEnd);
                const text = decodeMetaTextBytes(payloadBytes).trim();
                if (metaType === 0x03 && text && !trackName) {
                    trackName = text;
                }
                if (text.startsWith("mks:")) {
                    mksTextMetaLines.push(text);
                }
            }
            cursor = payloadEnd;
            continue;
        }
        if (statusByte === 0xf0 || statusByte === 0xf7) {
            const sysExLen = readVariableLengthAt(trackData, cursor);
            if (!sysExLen)
                break;
            const payloadStart = sysExLen.next;
            const payloadEnd = payloadStart + sysExLen.value;
            if (payloadEnd > trackData.length) {
                parseWarnings.push({
                    code: "MIDI_EVENT_DROPPED",
                    message: "SysEx event length overflow; remaining events were dropped.",
                });
                break;
            }
            if (statusByte === 0xf0) {
                const parsedChunk = parseMksSysExChunk(trackData.slice(payloadStart, payloadEnd));
                if (parsedChunk)
                    mksSysExChunks.push(parsedChunk);
            }
            cursor = payloadEnd;
            if (cursor > trackData.length) {
                parseWarnings.push({
                    code: "MIDI_EVENT_DROPPED",
                    message: "SysEx event length overflow; remaining events were dropped.",
                });
                break;
            }
            continue;
        }
        const messageType = statusByte & 0xf0;
        const channel = (statusByte & 0x0f) + 1;
        channels.add(channel);
        const dataLen = messageType === 0xc0 || messageType === 0xd0 ? 1 : 2;
        if (cursor + dataLen > trackData.length) {
            parseWarnings.push({
                code: "MIDI_EVENT_DROPPED",
                message: "Channel event data is truncated; remaining events were dropped.",
            });
            break;
        }
        const data1 = trackData[cursor];
        const data2 = dataLen === 2 ? trackData[cursor + 1] : 0;
        cursor += dataLen;
        if (messageType === 0xc0) {
            programByTrackChannel.set(`${trackIndex}:${channel}`, data1 + 1);
            continue;
        }
        if (messageType === 0xb0 && (data1 === 7 || data1 === 11)) {
            controllerEvents.push({
                tick: absTick,
                channel,
                controllerNumber: data1,
                controllerValue: Math.max(0, Math.min(127, Math.round(data2))),
            });
            continue;
        }
        if (messageType !== 0x80 && messageType !== 0x90)
            continue;
        const key = `${channel}:${data1}`;
        if (messageType === 0x90 && data2 > 0) {
            const bucket = (_a = activeNoteStartTicks.get(key)) !== null && _a !== void 0 ? _a : [];
            bucket.push({ startTick: absTick, velocity: clampVelocity(data2) });
            activeNoteStartTicks.set(key, bucket);
            continue;
        }
        const bucket = (_b = activeNoteStartTicks.get(key)) !== null && _b !== void 0 ? _b : [];
        // Pair note-off with the oldest unmatched note-on to stabilize same-pitch retriggers.
        const started = bucket.shift();
        if (bucket.length > 0) {
            activeNoteStartTicks.set(key, bucket);
        }
        else {
            activeNoteStartTicks.delete(key);
        }
        if (!started) {
            parseWarnings.push({
                code: "MIDI_NOTE_PAIR_BROKEN",
                message: `Note off without matching note on (ch ${channel}, note ${data1}).`,
            });
            continue;
        }
        const startTick = started.startTick;
        const endTick = Math.max(startTick + 1, absTick);
        notes.push({
            trackIndex,
            channel,
            midi: data1,
            startTick,
            endTick,
            velocity: started.velocity,
        });
    }
    for (const [key, starts] of activeNoteStartTicks.entries()) {
        const [channelText, noteText] = key.split(":");
        const channel = Number(channelText);
        const note = Number(noteText);
        for (const started of starts) {
            parseWarnings.push({
                code: "MIDI_NOTE_PAIR_BROKEN",
                message: `Note on without matching note off (ch ${channel}, note ${note}, start ${started.startTick}).`,
            });
        }
    }
    return {
        notes,
        channels,
        trackName,
        programByTrackChannel,
        controllerEvents,
        timeSignatureEvents,
        keySignatureEvents,
        tempoEvents,
        mksSysExPayloads: assembleMksSysExPayloads(mksSysExChunks),
        mksTextMetaLines,
        parseWarnings,
    };
};
const xmlEscape = (raw) => {
    return raw
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&apos;");
};
const velocityToDynamicMark = (velocity) => {
    const v = clampVelocity(velocity);
    if (v <= 15)
        return "ppp";
    if (v <= 31)
        return "pp";
    if (v <= 47)
        return "p";
    if (v <= 63)
        return "mp";
    if (v <= 79)
        return "mf";
    if (v <= 95)
        return "f";
    if (v <= 111)
        return "ff";
    return "fff";
};
const buildDynamicsDirectionXml = (dynamicMark, offsetDiv, staff) => {
    let xml = "<direction>";
    xml += `<direction-type><dynamics><${dynamicMark}/></dynamics></direction-type>`;
    if (offsetDiv > 0) {
        xml += `<offset>${offsetDiv}</offset>`;
    }
    xml += `<staff>${Math.max(1, Math.round(staff))}</staff>`;
    xml += "</direction>";
    return xml;
};
const midiToPitchComponents = (midiNumber) => {
    var _a;
    const n = Math.max(0, Math.min(127, Math.round(midiNumber)));
    const octave = Math.floor(n / 12) - 1;
    const semitone = n % 12;
    const table = [
        { step: "C", alter: 0 },
        { step: "C", alter: 1 },
        { step: "D", alter: 0 },
        { step: "D", alter: 1 },
        { step: "E", alter: 0 },
        { step: "F", alter: 0 },
        { step: "F", alter: 1 },
        { step: "G", alter: 0 },
        { step: "G", alter: 1 },
        { step: "A", alter: 0 },
        { step: "A", alter: 1 },
        { step: "B", alter: 0 },
    ];
    const mapped = (_a = table[semitone]) !== null && _a !== void 0 ? _a : { step: "C", alter: 0 };
    return { step: mapped.step, alter: mapped.alter, octave };
};
const midiToPitchComponentsByKey = (midiNumber, keyFifths) => {
    var _a;
    const n = Math.max(0, Math.min(127, Math.round(midiNumber)));
    const octave = Math.floor(n / 12) - 1;
    const semitone = n % 12;
    const useFlatSpelling = keyFifths < 0;
    const sharpTable = [
        { step: "C", alter: 0 },
        { step: "C", alter: 1 },
        { step: "D", alter: 0 },
        { step: "D", alter: 1 },
        { step: "E", alter: 0 },
        { step: "F", alter: 0 },
        { step: "F", alter: 1 },
        { step: "G", alter: 0 },
        { step: "G", alter: 1 },
        { step: "A", alter: 0 },
        { step: "A", alter: 1 },
        { step: "B", alter: 0 },
    ];
    const flatTable = [
        { step: "C", alter: 0 },
        { step: "D", alter: -1 },
        { step: "D", alter: 0 },
        { step: "E", alter: -1 },
        { step: "E", alter: 0 },
        { step: "F", alter: 0 },
        { step: "G", alter: -1 },
        { step: "G", alter: 0 },
        { step: "A", alter: -1 },
        { step: "A", alter: 0 },
        { step: "B", alter: -1 },
        { step: "B", alter: 0 },
    ];
    const mapped = (_a = (useFlatSpelling ? flatTable : sharpTable)[semitone]) !== null && _a !== void 0 ? _a : { step: "C", alter: 0 };
    return { step: mapped.step, alter: mapped.alter, octave };
};
const accidentalTextFromAlter = (alter) => {
    if (alter === -2)
        return "flat-flat";
    if (alter === -1)
        return "flat";
    if (alter === 0)
        return "natural";
    if (alter === 1)
        return "sharp";
    if (alter === 2)
        return "double-sharp";
    return null;
};
const midiToDrumDisplay = (midiNumber) => {
    const p = midiToPitchComponents(midiNumber);
    return { step: p.step, octave: p.octave };
};
const quantizeImportedNotes = (notes, ticksPerQuarter, grid, tripletAwareQuantize) => {
    const warnings = [];
    const resolved = resolveImportQuantizeTick(notes, ticksPerQuarter, grid, tripletAwareQuantize);
    const qTick = resolved.qTick;
    const divisions = resolved.divisions;
    const quantized = [];
    for (const note of notes) {
        const startTick = Math.max(0, Math.round(note.startTick / qTick) * qTick);
        let endTick = Math.max(startTick + qTick, Math.round(note.endTick / qTick) * qTick);
        if (endTick <= startTick) {
            endTick = startTick + qTick;
            warnings.push({
                code: "MIDI_QUANTIZE_CLAMPED",
                message: `Quantized note duration was clamped (ch ${note.channel}, note ${note.midi}).`,
            });
        }
        quantized.push({
            trackIndex: note.trackIndex,
            channel: note.channel,
            midi: note.midi,
            startTick,
            endTick,
            velocity: note.velocity,
        });
    }
    return { notes: quantized, warnings, qTick, divisions };
};
const applyImportedControllerVelocityScale = (notes, controllerEvents) => {
    var _a;
    if (!notes.length || !controllerEvents.length)
        return notes;
    const controlByTrackChannel = new Map();
    for (const event of controllerEvents) {
        const key = `${event.trackIndex}:${event.channel}`;
        const bucket = (_a = controlByTrackChannel.get(key)) !== null && _a !== void 0 ? _a : { cc7: [], cc11: [] };
        const target = event.controllerNumber === 7 ? bucket.cc7 : bucket.cc11;
        target.push({ tick: Math.max(0, Math.round(event.tick)), value: Math.max(0, Math.min(127, event.controllerValue)) });
        controlByTrackChannel.set(key, bucket);
    }
    for (const bucket of controlByTrackChannel.values()) {
        bucket.cc7.sort((a, b) => a.tick - b.tick);
        bucket.cc11.sort((a, b) => a.tick - b.tick);
    }
    const resolveCcValueAtTick = (events, tick) => {
        let current = 127;
        for (const event of events) {
            if (event.tick > tick)
                break;
            current = event.value;
        }
        return current;
    };
    return notes.map((note) => {
        const key = `${note.trackIndex}:${note.channel}`;
        const bucket = controlByTrackChannel.get(key);
        if (!bucket)
            return note;
        const cc7 = resolveCcValueAtTick(bucket.cc7, note.startTick);
        const cc11 = resolveCcValueAtTick(bucket.cc11, note.startTick);
        const scaled = Math.round(note.velocity * (cc7 / 127) * (cc11 / 127));
        return { ...note, velocity: clampVelocity(Math.max(1, scaled)) };
    });
};
const allocateAutoVoices = (notes, warnings) => {
    var _a, _b;
    if (!notes.length)
        return [];
    const clustersByStart = new Map();
    for (const note of notes) {
        const bucket = (_a = clustersByStart.get(note.startTick)) !== null && _a !== void 0 ? _a : [];
        bucket.push(note);
        clustersByStart.set(note.startTick, bucket);
    }
    const starts = Array.from(clustersByStart.keys()).sort((a, b) => a - b);
    const voices = [];
    const out = [];
    for (const start of starts) {
        const clusterNotes = ((_b = clustersByStart.get(start)) !== null && _b !== void 0 ? _b : []).slice().sort((a, b) => a.midi - b.midi);
        if (!clusterNotes.length)
            continue;
        const clusterEnd = Math.max(...clusterNotes.map((note) => note.endTick));
        const representativePitch = clusterNotes[Math.floor(clusterNotes.length / 2)].midi;
        let bestVoice = -1;
        let bestGap = Number.POSITIVE_INFINITY;
        let bestPitchJump = Number.POSITIVE_INFINITY;
        for (let i = 0; i < voices.length; i += 1) {
            if (voices[i].lastEnd > start)
                continue;
            const gap = start - voices[i].lastEnd;
            const pitchJump = Math.abs(representativePitch - voices[i].lastPitch);
            if (gap < bestGap || (gap === bestGap && pitchJump < bestPitchJump)) {
                bestVoice = i;
                bestGap = gap;
                bestPitchJump = pitchJump;
            }
        }
        if (bestVoice < 0) {
            bestVoice = voices.length;
            voices.push({ lastEnd: clusterEnd, lastPitch: representativePitch });
        }
        else {
            voices[bestVoice] = { lastEnd: clusterEnd, lastPitch: representativePitch };
        }
        out.push({
            voice: bestVoice + 1,
            startTick: start,
            endTick: clusterEnd,
            notes: clusterNotes,
        });
    }
    if (voices.length > 1) {
        warnings.push({
            code: "MIDI_POLYPHONY_VOICE_ASSIGNED",
            message: `Auto voice split assigned ${voices.length} voices.`,
        });
    }
    if (voices.length > 8) {
        warnings.push({
            code: "MIDI_POLYPHONY_VOICE_OVERFLOW",
            message: `Auto voice split generated ${voices.length} voices (high density).`,
        });
    }
    return out;
};
const splitClustersToMeasureSegments = (params) => {
    var _a;
    const out = [];
    const { clusters, ticksPerQuarter, divisions, measureTicks, isDrum, useGrandStaff } = params;
    const pickupTicks = Math.max(0, Math.round((_a = params.pickupTicks) !== null && _a !== void 0 ? _a : 0));
    let previousStaff = null;
    const toDiv = (ticks) => Math.max(0, Math.round((ticks * divisions) / ticksPerQuarter));
    const measureStartTick = (measureIndex) => {
        if (pickupTicks <= 0)
            return measureIndex * measureTicks;
        if (measureIndex <= 0)
            return 0;
        return pickupTicks + (measureIndex - 1) * measureTicks;
    };
    const measureIndexAtTick = (tick) => {
        if (pickupTicks <= 0)
            return Math.floor(tick / measureTicks);
        if (tick < pickupTicks)
            return 0;
        return 1 + Math.floor((tick - pickupTicks) / measureTicks);
    };
    const nextMeasureBoundaryTick = (tick) => {
        if (pickupTicks <= 0) {
            const idx = Math.floor(tick / measureTicks);
            return (idx + 1) * measureTicks;
        }
        if (tick < pickupTicks)
            return pickupTicks;
        const idx = Math.floor((tick - pickupTicks) / measureTicks);
        return pickupTicks + (idx + 1) * measureTicks;
    };
    for (const cluster of clusters) {
        const clusterKeys = cluster.notes.map((note) => note.midi);
        const minClusterKey = clusterKeys.length ? Math.min(...clusterKeys) : 60;
        const maxClusterKey = clusterKeys.length ? Math.max(...clusterKeys) : 60;
        const clusterStaff = isDrum
            ? 1
            : useGrandStaff
                ? (0, staffClefPolicy_1.pickStaffForClusterWithHysteresis)(minClusterKey, maxClusterKey, previousStaff)
                : 1;
        if (!isDrum)
            previousStaff = clusterStaff;
        for (const note of cluster.notes) {
            let segmentStart = note.startTick;
            while (segmentStart < note.endTick) {
                const measureIndex = measureIndexAtTick(segmentStart);
                const measureEndTick = nextMeasureBoundaryTick(segmentStart);
                const segmentEnd = Math.min(note.endTick, measureEndTick);
                const startInMeasureTick = segmentStart - measureStartTick(measureIndex);
                const startDiv = toDiv(startInMeasureTick);
                const durDiv = Math.max(1, toDiv(segmentEnd - segmentStart));
                out.push({
                    measureIndex,
                    voice: cluster.voice,
                    staff: clusterStaff,
                    startDiv,
                    durDiv,
                    midi: note.midi,
                    velocity: note.velocity,
                    trackIndex: note.trackIndex,
                    channel: note.channel,
                    startTick: segmentStart,
                    endTick: segmentEnd,
                });
                segmentStart = segmentEnd;
            }
        }
    }
    return out;
};
const durationNotationCandidates = (divisions) => {
    const base = [
        { type: "whole", q: 4, dots: 0 },
        { type: "whole", q: 6, dots: 1 },
        { type: "whole", q: 7, dots: 2 },
        { type: "half", q: 2, dots: 0 },
        { type: "half", q: 3, dots: 1 },
        { type: "half", q: 3.5, dots: 2 },
        { type: "quarter", q: 1, dots: 0 },
        { type: "quarter", q: 1.5, dots: 1 },
        { type: "quarter", q: 1.75, dots: 2 },
        { type: "eighth", q: 0.5, dots: 0 },
        { type: "eighth", q: 0.75, dots: 1 },
        { type: "eighth", q: 0.875, dots: 2 },
        { type: "16th", q: 0.25, dots: 0 },
        { type: "16th", q: 0.375, dots: 1 },
        { type: "16th", q: 0.4375, dots: 2 },
        { type: "32nd", q: 0.125, dots: 0 },
        { type: "32nd", q: 0.1875, dots: 1 },
        { type: "32nd", q: 0.21875, dots: 2 },
        { type: "64th", q: 0.0625, dots: 0 },
        { type: "64th", q: 0.09375, dots: 1 },
        { type: "64th", q: 0.109375, dots: 2 },
    ];
    return base.map((candidate) => ({
        ...candidate,
        durDiv: candidate.q * divisions,
    }));
};
const resolveDurationNotation = (durDiv, divisions) => {
    if (!Number.isFinite(durDiv) || !Number.isFinite(divisions) || durDiv <= 0 || divisions <= 0)
        return null;
    const tolerance = 1e-6;
    const candidates = durationNotationCandidates(divisions);
    const matched = candidates.find((candidate) => Math.abs(candidate.durDiv - durDiv) <= tolerance);
    if (!matched)
        return null;
    return matched;
};
const splitDurationNotations = (durDiv, divisions) => {
    var _a, _b, _c;
    const single = resolveDurationNotation(durDiv, divisions);
    if (single)
        return [single];
    if (!Number.isFinite(durDiv) || !Number.isFinite(divisions) || durDiv <= 0 || divisions <= 0)
        return [];
    const roundedDur = Math.round(durDiv);
    if (Math.abs(durDiv - roundedDur) > 1e-6)
        return [];
    const candidates = durationNotationCandidates(divisions)
        .filter((candidate) => Math.abs(candidate.durDiv - Math.round(candidate.durDiv)) <= 1e-6)
        .map((candidate) => ({ ...candidate, durDiv: Math.round(candidate.durDiv) }))
        .filter((candidate) => candidate.durDiv > 0)
        .sort((a, b) => b.durDiv - a.durDiv);
    const best = Array.from({ length: roundedDur + 1 }, () => null);
    best[0] = [];
    for (let target = 1; target <= roundedDur; target += 1) {
        for (const candidate of candidates) {
            if (candidate.durDiv > target)
                continue;
            const prev = best[target - candidate.durDiv];
            if (!prev)
                continue;
            const composed = [...prev, candidate];
            if (!best[target] || composed.length < ((_b = (_a = best[target]) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : Number.POSITIVE_INFINITY)) {
                best[target] = composed;
            }
        }
    }
    return (_c = best[roundedDur]) !== null && _c !== void 0 ? _c : [];
};
const buildTypeXmlFromNotation = (notation) => {
    let xml = `<type>${notation.type}</type>`;
    for (let i = 0; i < notation.dots; i += 1) {
        xml += "<dot/>";
    }
    return xml;
};
const beamLevelFromNotationType = (type) => {
    switch (type) {
        case "eighth":
            return 1;
        case "16th":
            return 2;
        case "32nd":
            return 3;
        case "64th":
            return 4;
        default:
            return 0;
    }
};
const buildTieXml = (tieStart, tieStop) => {
    if (!tieStart && !tieStop)
        return "";
    let xml = "";
    if (tieStop)
        xml += '<tie type="stop"/>';
    if (tieStart)
        xml += '<tie type="start"/>';
    xml += "<notations>";
    if (tieStop)
        xml += '<tied type="stop"/>';
    if (tieStart)
        xml += '<tied type="start"/>';
    xml += "</notations>";
    return xml;
};
const buildRestXml = (durDiv, voice, outputStaff, divisions) => {
    const chunks = splitDurationNotations(durDiv, divisions);
    if (!chunks.length) {
        return `<note><rest/><duration>${durDiv}</duration><voice>${voice}</voice><staff>${outputStaff}</staff></note>`;
    }
    let xml = "";
    for (const chunk of chunks) {
        xml += `<note><rest/><duration>${chunk.durDiv}</duration>${buildTypeXmlFromNotation(chunk)}<voice>${voice}</voice><staff>${outputStaff}</staff></note>`;
    }
    return xml;
};
const prettyPrintXml = (xml) => {
    const compact = xml.replace(/>\s+</g, "><").trim();
    const split = compact.replace(/(>)(<)(\/*)/g, "$1\n$2$3").split("\n");
    let indent = 0;
    const lines = [];
    for (const rawToken of split) {
        const token = rawToken.trim();
        if (!token)
            continue;
        if (/^<\//.test(token))
            indent = Math.max(0, indent - 1);
        const pad = "  ".repeat(indent);
        lines.push(`${pad}${token}`);
        const isOpening = /^<[^!?/][^>]*>$/.test(token);
        const isSelfClosing = /\/>$/.test(token);
        if (isOpening && !isSelfClosing)
            indent += 1;
    }
    return lines.join("\n");
};
const toHex = (value, width = 2) => {
    const safe = Math.max(0, Math.round(value));
    return `0x${safe.toString(16).toUpperCase().padStart(width, "0")}`;
};
const buildMeasureMidiMetaMiscXml = (measureSegments) => {
    if (!measureSegments.length)
        return "";
    const sorted = measureSegments
        .slice()
        .sort((a, b) => a.startDiv === b.startDiv
        ? a.midi === b.midi
            ? a.voice - b.voice
            : a.midi - b.midi
        : a.startDiv - b.startDiv);
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:dbg:midi:meta:count">${toHex(sorted.length, 4)}</miscellaneous-field>`;
    for (let i = 0; i < sorted.length; i += 1) {
        const seg = sorted[i];
        const payload = [
            `idx=${toHex(i, 4)}`,
            `tr=${toHex(seg.trackIndex, 2)}`,
            `ch=${toHex(seg.channel, 2)}`,
            `v=${toHex(seg.voice, 2)}`,
            `stf=${toHex(seg.staff, 2)}`,
            `key=${toHex(seg.midi, 2)}`,
            `vel=${toHex(seg.velocity, 2)}`,
            `sd=${toHex(seg.startDiv, 4)}`,
            `dd=${toHex(seg.durDiv, 4)}`,
            `tk0=${toHex(seg.startTick, 6)}`,
            `tk1=${toHex(seg.endTick, 6)}`,
        ].join(";");
        xml += `<miscellaneous-field name="mks:dbg:midi:meta:${String(i + 1).padStart(4, "0")}">${payload}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildMidiSourceMiscXml = (midiBytes) => {
    const bytes = midiBytes instanceof Uint8Array ? midiBytes : new Uint8Array();
    if (!bytes.length)
        return "";
    const hex = Array.from(bytes)
        .map((v) => v.toString(16).toUpperCase().padStart(2, "0"))
        .join("");
    const CHUNK_SIZE = 240;
    const MAX_CHUNKS = 512;
    const chunks = [];
    for (let i = 0; i < hex.length && chunks.length < MAX_CHUNKS; i += CHUNK_SIZE) {
        chunks.push(hex.slice(i, i + CHUNK_SIZE));
    }
    const truncated = chunks.join("").length < hex.length;
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:src:midi:raw-encoding">hex-v1</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:midi:raw-bytes">${bytes.length}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:midi:raw-hex-length">${hex.length}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:midi:raw-chunks">${chunks.length}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:midi:raw-truncated">${truncated ? "1" : "0"}</miscellaneous-field>`;
    for (let i = 0; i < chunks.length; i += 1) {
        xml += `<miscellaneous-field name="mks:src:midi:raw-${String(i + 1).padStart(4, "0")}">${chunks[i]}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildMidiSysExMiscXml = (payloads) => {
    const lines = [];
    for (const payload of payloads) {
        const split = String(payload !== null && payload !== void 0 ? payload : "").split(/\r?\n/);
        for (const line of split) {
            const trimmed = line.trim();
            if (!trimmed.length)
                continue;
            lines.push(trimmed);
        }
    }
    if (!lines.length)
        return "";
    const map = new Map();
    for (const line of lines) {
        const eq = line.indexOf("=");
        if (eq <= 0)
            continue;
        const key = line.slice(0, eq).trim().toLowerCase();
        const value = line.slice(eq + 1).trim();
        if (!key || !value)
            continue;
        map.set(key, value);
    }
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:meta:midi:sysex:count">${toHex(lines.length, 4)}</miscellaneous-field>`;
    for (let i = 0; i < lines.length; i += 1) {
        xml += `<miscellaneous-field name="mks:meta:midi:sysex:${String(i + 1).padStart(4, "0")}">${xmlEscape(lines[i])}</miscellaneous-field>`;
    }
    const preferred = [
        "schema",
        "namespace",
        "app",
        "source",
        "tpq",
        "track-count",
        "event-count",
        "tempo-event-count",
        "timesig-event-count",
        "keysig-event-count",
        "control-event-count",
        "channel-count",
        "fingerprint-fnv1a32",
    ];
    for (const key of preferred) {
        const value = map.get(key);
        if (!value)
            continue;
        xml += `<miscellaneous-field name="mks:meta:midi:sysex:${key}">${xmlEscape(value)}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildMidiDiagMiscXml = (warnings) => {
    if (!warnings.length)
        return "";
    const maxEntries = Math.min(256, warnings.length);
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:diag:count">${maxEntries}</miscellaneous-field>`;
    for (let i = 0; i < maxEntries; i += 1) {
        const warning = warnings[i];
        const payload = [
            "level=warn",
            `code=${xmlEscape(warning.code)}`,
            "fmt=midi",
            `message=${xmlEscape(warning.message)}`,
        ].join(";");
        xml += `<miscellaneous-field name="mks:diag:${String(i + 1).padStart(4, "0")}">${payload}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildMeasureVoiceXml = (segments, voice, sourceStaff, outputStaff, measureDiv, beatDiv, isDrum, divisions, keyFifths) => {
    var _a, _b, _c, _d, _e;
    const voiceSegments = segments
        .filter((segment) => segment.voice === voice && segment.staff === sourceStaff)
        .slice()
        .sort((a, b) => (a.startDiv === b.startDiv ? a.midi - b.midi : a.startDiv - b.startDiv));
    if (!voiceSegments.length) {
        return buildRestXml(measureDiv, voice, outputStaff, divisions);
    }
    const groupsByStart = new Map();
    for (const segment of voiceSegments) {
        const bucket = (_a = groupsByStart.get(segment.startDiv)) !== null && _a !== void 0 ? _a : [];
        bucket.push(segment);
        groupsByStart.set(segment.startDiv, bucket);
    }
    const starts = Array.from(groupsByStart.keys()).sort((a, b) => a - b);
    const keyAlterMap = keySignatureAlterByStep(keyFifths);
    const accidentalByStepOctave = new Map();
    const preparedNoteChunks = [];
    const noteTimelineByChunkIndex = new Map();
    const beamTimeline = [];
    let cursorForTimeline = 0;
    for (const start of starts) {
        const group = ((_b = groupsByStart.get(start)) !== null && _b !== void 0 ? _b : []).slice().sort((a, b) => a.midi - b.midi);
        if (start > cursorForTimeline) {
            const restDur = start - cursorForTimeline;
            const restChunks = splitDurationNotations(restDur, divisions);
            if (restChunks.length) {
                for (const restChunk of restChunks) {
                    beamTimeline.push({
                        kind: "rest",
                        durDiv: restChunk.durDiv,
                        levels: beamLevelFromNotationType(restChunk.type),
                    });
                }
            }
            else {
                beamTimeline.push({ kind: "rest", durDiv: restDur, levels: 0 });
            }
        }
        const groupDur = Math.max(...group.map((segment) => segment.durDiv));
        const notationChunks = splitDurationNotations(groupDur, divisions);
        const fallbackChunk = notationChunks.length
            ? null
            : {
                type: "quarter",
                dots: 0,
                q: groupDur / Math.max(1, divisions),
                durDiv: groupDur,
            };
        const chunks = notationChunks.length ? notationChunks : [fallbackChunk];
        let chunkStartDiv = start;
        for (let chunkIndex = 0; chunkIndex < chunks.length; chunkIndex += 1) {
            const chunk = chunks[chunkIndex];
            if (!chunk)
                continue;
            const tieStart = chunks.length > 1 && chunkIndex < chunks.length - 1;
            const tieStop = chunks.length > 1 && chunkIndex > 0;
            const preparedIndex = preparedNoteChunks.length;
            noteTimelineByChunkIndex.set(preparedIndex, beamTimeline.length);
            beamTimeline.push({
                kind: "note",
                durDiv: chunk.durDiv,
                levels: beamLevelFromNotationType(chunk.type),
                chunkIndex: preparedIndex,
            });
            preparedNoteChunks.push({
                startDiv: chunkStartDiv,
                durDiv: chunk.durDiv,
                typeXml: buildTypeXmlFromNotation(chunk),
                tieStart,
                tieStop,
                group,
            });
            chunkStartDiv += chunk.durDiv;
        }
        cursorForTimeline = Math.max(cursorForTimeline, start + groupDur);
    }
    if (cursorForTimeline < measureDiv) {
        const restDur = measureDiv - cursorForTimeline;
        const restChunks = splitDurationNotations(restDur, divisions);
        if (restChunks.length) {
            for (const restChunk of restChunks) {
                beamTimeline.push({
                    kind: "rest",
                    durDiv: restChunk.durDiv,
                    levels: beamLevelFromNotationType(restChunk.type),
                });
            }
        }
        else {
            beamTimeline.push({ kind: "rest", durDiv: restDur, levels: 0 });
        }
    }
    const beamAssignments = (0, beam_common_1.computeBeamAssignments)(beamTimeline, beatDiv, (event) => ({
        timed: true,
        chord: event.kind === "note",
        grace: false,
        durationDiv: Math.max(0, event.durDiv),
        levels: event.levels,
    }), {
        splitAtBeatBoundaryWhenImplicit: true,
    });
    const beamXmlByChunkIndex = new Map();
    for (const [chunkIndex, timelineIndex] of noteTimelineByChunkIndex.entries()) {
        const assignment = beamAssignments.get(timelineIndex);
        if (!assignment || assignment.levels <= 0)
            continue;
        let xml = "";
        for (let level = 1; level <= assignment.levels; level += 1) {
            xml += `<beam number="${level}">${assignment.state}</beam>`;
        }
        if (xml)
            beamXmlByChunkIndex.set(chunkIndex, xml);
    }
    let cursor = 0;
    let xml = "";
    for (let chunkIndex = 0; chunkIndex < preparedNoteChunks.length; chunkIndex += 1) {
        const prepared = preparedNoteChunks[chunkIndex];
        if (prepared.startDiv > cursor) {
            const restDur = prepared.startDiv - cursor;
            xml += buildRestXml(restDur, voice, outputStaff, divisions);
        }
        const beamXml = (_c = beamXmlByChunkIndex.get(chunkIndex)) !== null && _c !== void 0 ? _c : "";
        for (let i = 0; i < prepared.group.length; i += 1) {
            const segment = prepared.group[i];
            if (isDrum) {
                const display = midiToDrumDisplay(segment.midi);
                xml += "<note>";
                if (i > 0)
                    xml += "<chord/>";
                xml += `<unpitched><display-step>${display.step}</display-step><display-octave>${display.octave}</display-octave></unpitched>`;
                xml += `<duration>${prepared.durDiv}</duration>${prepared.typeXml}<voice>${voice}</voice>${i === 0 ? beamXml : ""}<staff>${outputStaff}</staff><notehead>x</notehead>`;
                xml += buildTieXml(prepared.tieStart, prepared.tieStop);
                xml += "</note>";
            }
            else {
                const pitch = midiToPitchComponentsByKey(segment.midi, keyFifths);
                const stepOctaveKey = `${pitch.step}${pitch.octave}`;
                const defaultAlter = accidentalByStepOctave.has(stepOctaveKey)
                    ? (_d = accidentalByStepOctave.get(stepOctaveKey)) !== null && _d !== void 0 ? _d : 0
                    : (_e = keyAlterMap[pitch.step]) !== null && _e !== void 0 ? _e : 0;
                const requiresAccidental = pitch.alter !== defaultAlter;
                const accidentalText = requiresAccidental ? accidentalTextFromAlter(pitch.alter) : null;
                xml += "<note>";
                if (i > 0)
                    xml += "<chord/>";
                xml += `<pitch><step>${pitch.step}</step>${pitch.alter !== 0 ? `<alter>${pitch.alter}</alter>` : ""}<octave>${pitch.octave}</octave></pitch>`;
                if (accidentalText) {
                    xml += `<accidental>${accidentalText}</accidental>`;
                }
                xml += `<duration>${prepared.durDiv}</duration>${prepared.typeXml}<voice>${voice}</voice>${i === 0 ? beamXml : ""}<staff>${outputStaff}</staff>`;
                xml += buildTieXml(prepared.tieStart, prepared.tieStop);
                xml += "</note>";
                accidentalByStepOctave.set(stepOctaveKey, pitch.alter);
            }
        }
        cursor = Math.max(cursor, prepared.startDiv + prepared.durDiv);
    }
    if (cursor < measureDiv) {
        const restDur = measureDiv - cursor;
        xml += buildRestXml(restDur, voice, outputStaff, divisions);
    }
    return xml;
};
const buildPartMusicXml = (params) => {
    var _a, _b, _c, _d;
    const { partId, divisions, beats, beatType, keyFifths, keyMode, isDrum, notes, tempoEventsByMeasure, includeTempoEvents, ticksPerQuarter, pickupTicks = 0, warnings, debugImportMetadata, mksSysExMetadataXml, sourceMetadataXml, } = params;
    const measureTicks = Math.max(1, Math.round((ticksPerQuarter * 4 * beats) / Math.max(1, beatType)));
    const measureDiv = Math.max(1, Math.round((divisions * 4 * beats) / Math.max(1, beatType)));
    const pickupMeasureTicks = Math.max(0, Math.min(measureTicks - 1, Math.round(pickupTicks)));
    const pickupMeasureDiv = pickupMeasureTicks > 0
        ? Math.max(1, Math.round((pickupMeasureTicks * divisions) / ticksPerQuarter))
        : 0;
    const measureDivForIndex = (measureIndex) => measureIndex === 0 && pickupMeasureDiv > 0 ? pickupMeasureDiv : measureDiv;
    const maxEndTick = notes.length ? Math.max(...notes.map((note) => note.endTick)) : measureTicks;
    const measureCount = pickupMeasureTicks > 0
        ? (maxEndTick <= pickupMeasureTicks
            ? 1
            : 1 + Math.max(1, Math.ceil((maxEndTick - pickupMeasureTicks) / measureTicks)))
        : Math.max(1, Math.ceil(maxEndTick / measureTicks));
    const clusters = allocateAutoVoices(notes, warnings);
    const warningMetadataXml = buildMidiDiagMiscXml(warnings);
    const melodicKeys = notes.map((note) => note.midi);
    const singleClefSign = (0, staffClefPolicy_1.chooseSingleClefByKeys)(melodicKeys);
    const initialGrandStaff = !isDrum && (0, staffClefPolicy_1.shouldUseGrandStaffByRange)(melodicKeys);
    const voiceSegmentsByMeasure = new Map();
    let splitSegments = splitClustersToMeasureSegments({
        clusters,
        ticksPerQuarter,
        divisions,
        measureTicks,
        pickupTicks: pickupMeasureTicks,
        isDrum,
        useGrandStaff: initialGrandStaff,
    });
    let useGrandStaff = initialGrandStaff;
    if (!isDrum && useGrandStaff) {
        const hasUpper = splitSegments.some((segment) => segment.staff === 1);
        const hasLower = splitSegments.some((segment) => segment.staff === 2);
        if (!hasUpper || !hasLower) {
            useGrandStaff = false;
            splitSegments = splitSegments.map((segment) => ({ ...segment, staff: 1 }));
        }
    }
    for (const segment of splitSegments) {
        const bucket = (_a = voiceSegmentsByMeasure.get(segment.measureIndex)) !== null && _a !== void 0 ? _a : [];
        bucket.push(segment);
        voiceSegmentsByMeasure.set(segment.measureIndex, bucket);
    }
    const laneDefs = [];
    if (isDrum) {
        const voices = Array.from(new Set(splitSegments.map((segment) => segment.voice))).sort((a, b) => a - b);
        const resolvedVoices = voices.length ? voices : [1];
        for (let i = 0; i < resolvedVoices.length; i += 1) {
            laneDefs.push({ sourceStaff: 1, voice: resolvedVoices[i], outputStaff: i + 1 });
        }
    }
    else {
        if (useGrandStaff) {
            const trebleVoices = Array.from(new Set(splitSegments.filter((segment) => segment.staff === 1).map((segment) => segment.voice))).sort((a, b) => a - b);
            const bassVoices = Array.from(new Set(splitSegments.filter((segment) => segment.staff === 2).map((segment) => segment.voice))).sort((a, b) => a - b);
            const resolvedTrebleVoices = trebleVoices.length ? trebleVoices : [1];
            const resolvedBassVoices = bassVoices.length ? bassVoices : [1];
            let outputStaff = 1;
            for (const voice of resolvedTrebleVoices) {
                laneDefs.push({ sourceStaff: 1, voice, outputStaff });
                outputStaff += 1;
            }
            for (const voice of resolvedBassVoices) {
                laneDefs.push({ sourceStaff: 2, voice, outputStaff });
                outputStaff += 1;
            }
        }
        else {
            const voices = Array.from(new Set(splitSegments.map((segment) => segment.voice))).sort((a, b) => a - b);
            const resolvedVoices = voices.length ? voices : [1];
            for (const voice of resolvedVoices) {
                laneDefs.push({ sourceStaff: 1, voice, outputStaff: 1 });
            }
        }
    }
    const laneCount = Math.max(1, laneDefs.length);
    let partXml = `<part id="${partId}">`;
    let previousDynamicMark = null;
    for (let measureIndex = 0; measureIndex < measureCount; measureIndex += 1) {
        const measureNumber = pickupMeasureDiv > 0 ? measureIndex : (measureIndex + 1);
        const measureSegments = (_b = voiceSegmentsByMeasure.get(measureIndex)) !== null && _b !== void 0 ? _b : [];
        const currentMeasureDiv = measureDivForIndex(measureIndex);
        const implicitAttr = measureIndex === 0 && pickupMeasureDiv > 0 ? ' implicit="yes"' : "";
        partXml += `<measure number="${measureNumber}"${implicitAttr}>`;
        if (measureIndex === 0) {
            partXml += "<attributes>";
            partXml += `<divisions>${divisions}</divisions>`;
            partXml += `<key><fifths>${keyFifths}</fifths><mode>${keyMode}</mode></key>`;
            partXml += `<time><beats>${beats}</beats><beat-type>${beatType}</beat-type></time>`;
            if (isDrum) {
                partXml += "<clef><sign>percussion</sign><line>2</line></clef>";
            }
            else {
                if (useGrandStaff) {
                    partXml += `<staves>${laneCount}</staves>`;
                    for (const lane of laneDefs) {
                        if (lane.sourceStaff === 1) {
                            partXml += `<clef number="${lane.outputStaff}"><sign>G</sign><line>2</line></clef>`;
                        }
                        else {
                            partXml += `<clef number="${lane.outputStaff}"><sign>F</sign><line>4</line></clef>`;
                        }
                    }
                }
                else {
                    const line = singleClefSign === "F" ? 4 : 2;
                    partXml += `<clef><sign>${singleClefSign}</sign><line>${line}</line></clef>`;
                }
            }
            partXml += "</attributes>";
        }
        if (includeTempoEvents) {
            const tempoEvents = (_c = tempoEventsByMeasure.get(measureIndex)) !== null && _c !== void 0 ? _c : [];
            for (const event of tempoEvents) {
                partXml += "<direction>";
                partXml += "<direction-type><metronome><beat-unit>quarter</beat-unit>";
                partXml += `<per-minute>${event.bpm}</per-minute>`;
                partXml += "</metronome></direction-type>";
                if (event.offsetDiv > 0) {
                    partXml += `<offset>${event.offsetDiv}</offset>`;
                }
                partXml += `<sound tempo="${event.bpm}"/>`;
                partXml += "</direction>";
            }
        }
        if (debugImportMetadata) {
            partXml += buildMeasureMidiMetaMiscXml(measureSegments);
        }
        if (measureIndex === 0 && mksSysExMetadataXml) {
            partXml += mksSysExMetadataXml;
        }
        if (measureIndex === 0 && sourceMetadataXml) {
            partXml += sourceMetadataXml;
        }
        if (measureIndex === 0 && warningMetadataXml) {
            partXml += warningMetadataXml;
        }
        if (measureSegments.length > 0) {
            const dynamicVelocityByOffset = new Map();
            for (const segment of measureSegments) {
                const previousVelocity = dynamicVelocityByOffset.get(segment.startDiv);
                if (previousVelocity === undefined || segment.velocity > previousVelocity) {
                    dynamicVelocityByOffset.set(segment.startDiv, segment.velocity);
                }
            }
            const offsets = Array.from(dynamicVelocityByOffset.keys()).sort((a, b) => a - b);
            for (const offset of offsets) {
                const velocity = (_d = dynamicVelocityByOffset.get(offset)) !== null && _d !== void 0 ? _d : 80;
                const dynamicMark = velocityToDynamicMark(velocity);
                if (dynamicMark === previousDynamicMark)
                    continue;
                partXml += buildDynamicsDirectionXml(dynamicMark, offset, 1);
                previousDynamicMark = dynamicMark;
            }
        }
        const activeLanes = laneDefs.filter((lane) => measureSegments.some((segment) => segment.voice === lane.voice && segment.staff === lane.sourceStaff));
        const lanesForMeasure = activeLanes.length > 0 ? activeLanes : (laneDefs.length > 0 ? [laneDefs[0]] : []);
        for (let laneIndex = 0; laneIndex < lanesForMeasure.length; laneIndex += 1) {
            const lane = lanesForMeasure[laneIndex];
            if (laneIndex > 0) {
                partXml += `<backup><duration>${currentMeasureDiv}</duration></backup>`;
            }
            partXml += buildMeasureVoiceXml(measureSegments, lane.voice, lane.sourceStaff, lane.outputStaff, currentMeasureDiv, Math.max(1, Math.round(currentMeasureDiv / Math.max(1, beats))), isDrum, divisions, keyFifths);
        }
        partXml += "</measure>";
    }
    partXml += "</part>";
    return partXml;
};
const buildImportSkeletonMusicXml = (params) => {
    var _a, _b, _c, _d;
    const { title, movementTitle = "", composer = "", quantizeGrid, divisionsOverride, ticksPerQuarter, beats, beatType, keyFifths, keyMode, tempoEvents, pickupTicks = 0, partGroups, notesByTrackChannel, programByTrackChannel, warnings, debugImportMetadata, mksSysExMetadataXml, sourceMetadataXml, trackNameByIndex = new Map(), mksTextMetadata, } = params;
    const divisions = Math.max(1, Math.round(divisionsOverride !== null && divisionsOverride !== void 0 ? divisionsOverride : quantizeGridToDivisions(quantizeGrid)));
    const measureTicks = Math.max(1, Math.round((ticksPerQuarter * 4 * beats) / Math.max(1, beatType)));
    const pickupMeasureTicks = Math.max(0, Math.min(measureTicks - 1, Math.round(pickupTicks)));
    const mapTickToMeasureOffsetDiv = (tickRaw) => {
        const tick = Math.max(0, Math.round(tickRaw));
        let measureIndex = 0;
        let tickInMeasure = tick;
        if (pickupMeasureTicks > 0 && tick >= pickupMeasureTicks) {
            measureIndex = 1 + Math.floor((tick - pickupMeasureTicks) / measureTicks);
            tickInMeasure = (tick - pickupMeasureTicks) % measureTicks;
        }
        else if (pickupMeasureTicks <= 0) {
            measureIndex = Math.floor(tick / measureTicks);
            tickInMeasure = tick - measureIndex * measureTicks;
        }
        const offsetDiv = Math.max(0, Math.round((tickInMeasure * divisions) / ticksPerQuarter));
        return { measureIndex, offsetDiv };
    };
    const partDefs = [];
    const channelCountByTrackIndex = new Map();
    for (const group of partGroups) {
        channelCountByTrackIndex.set(group.trackIndex, ((_a = channelCountByTrackIndex.get(group.trackIndex)) !== null && _a !== void 0 ? _a : 0) + 1);
    }
    let index = 1;
    for (const group of partGroups) {
        const key = `${group.trackIndex}:${group.channel}`;
        const isDrum = group.channel === 10;
        partDefs.push({
            partId: `P${index}`,
            name: (() => {
                var _a, _b, _c, _d, _e;
                const mksName = (_b = (_a = mksTextMetadata === null || mksTextMetadata === void 0 ? void 0 : mksTextMetadata.partNameByTrackIndex.get(group.trackIndex)) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
                const trackName = (_d = (_c = trackNameByIndex.get(group.trackIndex)) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "";
                const preferred = mksName || trackName;
                if (preferred) {
                    const channelCount = (_e = channelCountByTrackIndex.get(group.trackIndex)) !== null && _e !== void 0 ? _e : 1;
                    return channelCount > 1 ? `${preferred} Ch ${group.channel}` : preferred;
                }
                return isDrum
                    ? `Drums (Track ${group.trackIndex + 1})`
                    : `Track ${group.trackIndex + 1} Ch ${group.channel}`;
            })(),
            channel: group.channel,
            program: (_c = normalizeMidiProgramNumber((_b = programByTrackChannel.get(key)) !== null && _b !== void 0 ? _b : NaN)) !== null && _c !== void 0 ? _c : 1,
            key,
        });
        index += 1;
    }
    if (!partDefs.length) {
        partDefs.push({
            partId: "P1",
            name: "Part 1",
            channel: 1,
            program: 1,
            key: "0:1",
        });
    }
    const partList = partDefs
        .map((part) => `<score-part id="${part.partId}"><part-name>${xmlEscape(part.name)}</part-name><midi-instrument id="${part.partId}-I1"><midi-channel>${part.channel}</midi-channel><midi-program>${part.program}</midi-program></midi-instrument></score-part>`)
        .join("");
    const tempoEventsByMeasure = new Map();
    for (const tempoEvent of tempoEvents) {
        const mapped = mapTickToMeasureOffsetDiv(tempoEvent.tick);
        const bucket = (_d = tempoEventsByMeasure.get(mapped.measureIndex)) !== null && _d !== void 0 ? _d : [];
        bucket.push({ offsetDiv: mapped.offsetDiv, bpm: clampTempo(tempoEvent.bpm) });
        tempoEventsByMeasure.set(mapped.measureIndex, bucket);
    }
    for (const [measureIndex, events] of tempoEventsByMeasure.entries()) {
        events.sort((a, b) => (a.offsetDiv === b.offsetDiv ? a.bpm - b.bpm : a.offsetDiv - b.offsetDiv));
        const deduped = [];
        for (const event of events) {
            const prev = deduped[deduped.length - 1];
            if (prev && prev.offsetDiv === event.offsetDiv) {
                prev.bpm = event.bpm;
            }
            else {
                deduped.push({ ...event });
            }
        }
        tempoEventsByMeasure.set(measureIndex, deduped);
    }
    const parts = partDefs
        .map((part, partIndex) => {
        var _a;
        return buildPartMusicXml({
            partId: part.partId,
            divisions,
            beats,
            beatType,
            keyFifths,
            keyMode,
            isDrum: part.channel === 10,
            notes: (_a = notesByTrackChannel.get(part.key)) !== null && _a !== void 0 ? _a : [],
            tempoEventsByMeasure,
            includeTempoEvents: partIndex === 0,
            ticksPerQuarter,
            pickupTicks: pickupMeasureTicks,
            warnings,
            debugImportMetadata,
            mksSysExMetadataXml: partIndex === 0 ? mksSysExMetadataXml : "",
            sourceMetadataXml: partIndex === 0 ? sourceMetadataXml : "",
        });
    })
        .join("");
    const movementTitleXml = movementTitle.trim()
        ? `<movement-title>${xmlEscape(movementTitle)}</movement-title>`
        : "";
    const composerXml = composer.trim()
        ? `<identification><creator type="composer">${xmlEscape(composer)}</creator></identification>`
        : "";
    return `<?xml version="1.0" encoding="UTF-8"?><score-partwise version="4.0"><work><work-title>${xmlEscape(title)}</work-title></work>${movementTitleXml}${composerXml}<part-list>${partList}</part-list>${parts}</score-partwise>`;
};
const numberToVariableLength = (value) => {
    let buffer = Math.max(0, Math.round(value)) & 0x0fffffff;
    const bytes = [buffer & 0x7f];
    buffer >>= 7;
    while (buffer > 0) {
        bytes.unshift((buffer & 0x7f) | 0x80);
        buffer >>= 7;
    }
    return bytes;
};
const buildMksSysexEventData = (deltaTicks, payloadText) => {
    const bytes = [];
    for (let i = 0; i < payloadText.length; i += 1) {
        bytes.push(payloadText.charCodeAt(i) & 0x7f);
    }
    // Include terminating F7 in payload for robust parser compatibility.
    const payloadLength = bytes.length + 1;
    return [
        ...numberToVariableLength(deltaTicks),
        0xf0,
        ...numberToVariableLength(payloadLength),
        ...bytes,
        0xf7,
    ];
};
const buildTextMetaEventData = (deltaTicks, text, metaType = 0x01) => {
    const safeText = String(text !== null && text !== void 0 ? text : "");
    const bytes = [];
    for (let i = 0; i < safeText.length; i += 1) {
        bytes.push(safeText.charCodeAt(i) & 0xff);
    }
    return [
        ...numberToVariableLength(deltaTicks),
        0xff,
        metaType & 0xff,
        ...numberToVariableLength(bytes.length),
        ...bytes,
    ];
};
const fnv1a32Hex = (text) => {
    let hash = 0x811c9dc5;
    for (let i = 0; i < text.length; i += 1) {
        hash ^= text.charCodeAt(i) & 0xff;
        hash = Math.imul(hash, 0x01000193) >>> 0;
    }
    return hash.toString(16).toUpperCase().padStart(8, "0");
};
const chunkString = (text, size) => {
    const out = [];
    for (let i = 0; i < text.length; i += size) {
        out.push(text.slice(i, i + size));
    }
    return out.length ? out : [""];
};
const buildMksSysexChunkTexts = (params) => {
    var _a;
    const diagnostics = ((_a = params.diagnostics) !== null && _a !== void 0 ? _a : []).filter((entry) => entry.trim().length > 0);
    const fingerprint = fnv1a32Hex([
        params.ticksPerQuarter,
        params.eventCount,
        params.trackCount,
        params.tempoEventCount,
        params.timeSignatureEventCount,
        params.keySignatureEventCount,
        params.controlEventCount,
        params.channelCount,
    ].join("|"));
    const metadataText = [
        "schema=mks-sysex-v1",
        "namespace=mks",
        "app=mikuscore",
        "source=musicxml",
        `tpq=${Math.max(1, Math.round(params.ticksPerQuarter))}`,
        `track-count=${Math.max(0, Math.round(params.trackCount))}`,
        `event-count=${Math.max(0, Math.round(params.eventCount))}`,
        `tempo-event-count=${Math.max(0, Math.round(params.tempoEventCount))}`,
        `timesig-event-count=${Math.max(0, Math.round(params.timeSignatureEventCount))}`,
        `keysig-event-count=${Math.max(0, Math.round(params.keySignatureEventCount))}`,
        `control-event-count=${Math.max(0, Math.round(params.controlEventCount))}`,
        `channel-count=${Math.max(0, Math.round(params.channelCount))}`,
        `diag-count=${diagnostics.length}`,
        ...diagnostics.map((diag, index) => `diag-${String(index + 1).padStart(4, "0")}=${diag}`),
        `fingerprint-fnv1a32=${fingerprint}`,
    ].join("\n");
    const encoded = encodeURIComponent(metadataText);
    const payloadChunks = chunkString(encoded, 180);
    const total = payloadChunks.length;
    const messageId = 1;
    return payloadChunks.map((chunk, index) => `mks|v=1|m=${String(messageId).padStart(4, "0")}|i=${String(index + 1).padStart(4, "0")}|n=${String(total).padStart(4, "0")}|d=${chunk}`);
};
const buildTempoMetaEventData = (deltaTicks, bpm) => {
    const safeBpm = clampTempo(bpm);
    const microsPerQuarter = Math.max(1, Math.round(60000000 / safeBpm));
    return [
        ...numberToVariableLength(deltaTicks),
        0xff,
        0x51,
        0x03,
        (microsPerQuarter >> 16) & 0xff,
        (microsPerQuarter >> 8) & 0xff,
        microsPerQuarter & 0xff,
    ];
};
const buildTimeSignatureMetaEventData = (deltaTicks, beats, beatType) => {
    const safeBeats = Math.max(1, Math.min(255, Math.round(beats)));
    const safeBeatType = Math.max(1, Math.round(beatType));
    const dd = Math.max(0, Math.min(7, Math.round(Math.log2(safeBeatType))));
    return [
        ...numberToVariableLength(deltaTicks),
        0xff,
        0x58,
        0x04,
        safeBeats & 0xff,
        dd & 0xff,
        24,
        8,
    ];
};
const buildKeySignatureMetaEventData = (deltaTicks, fifths, mode) => {
    const safeFifths = Math.max(-7, Math.min(7, Math.round(fifths)));
    const sf = safeFifths < 0 ? safeFifths + 256 : safeFifths;
    const mi = mode === "minor" ? 1 : 0;
    return [
        ...numberToVariableLength(deltaTicks),
        0xff,
        0x59,
        0x02,
        sf & 0xff,
        mi,
    ];
};
const toU16BeBytes = (value) => {
    const normalized = Math.max(0, Math.min(0xffff, Math.round(value)));
    return [(normalized >> 8) & 0xff, normalized & 0xff];
};
const toU32BeBytes = (value) => {
    const normalized = Math.max(0, Math.min(0xffffffff, Math.round(value)));
    return [(normalized >>> 24) & 0xff, (normalized >>> 16) & 0xff, (normalized >>> 8) & 0xff, normalized & 0xff];
};
const toMidiWriterVelocityByte = (velocity) => {
    const normalized = Math.max(1, Math.min(100, Math.round(velocity)));
    return Math.max(0, Math.min(127, Math.round((normalized / 100) * 127)));
};
const encodeRawTrackChunk = (events) => {
    const sorted = events
        .slice()
        .sort((a, b) => {
        var _a, _b;
        return a.tick === b.tick
            ? a.order === b.order
                ? ((_a = a.sortKey) !== null && _a !== void 0 ? _a : 0) - ((_b = b.sortKey) !== null && _b !== void 0 ? _b : 0)
                : a.order - b.order
            : a.tick - b.tick;
    });
    const body = [];
    let prevTick = 0;
    for (const event of sorted) {
        const tick = Math.max(0, Math.round(event.tick));
        const delta = Math.max(0, tick - prevTick);
        body.push(...numberToVariableLength(delta), ...event.bytes);
        prevTick = tick;
    }
    body.push(0x00, 0xff, 0x2f, 0x00);
    return [
        0x4d,
        0x54,
        0x72,
        0x6b,
        ...toU32BeBytes(body.length),
        ...body,
    ];
};
const buildRawMidiBytesForPlayback = (sourceEvents, trackProgramOverrides, controlEvents, dedupedTempoEvents, dedupedTimeSignatureEvents, dedupedKeySignatureEvents, writerTicksPerQuarter, normalizedProgramPreset, options) => {
    var _a, _b, _c, _d, _e;
    const tracksById = new Map();
    for (const event of sourceEvents) {
        const key = event.trackId || "__default__";
        const bucket = (_a = tracksById.get(key)) !== null && _a !== void 0 ? _a : [];
        bucket.push(event);
        tracksById.set(key, bucket);
    }
    const trackChunks = [];
    const tempoEvents = [];
    const metaTimeline = [];
    metaTimeline.push(...dedupedTempoEvents.map((e) => ({ kind: "tempo", ...e })));
    metaTimeline.push(...dedupedTimeSignatureEvents.map((e) => ({ kind: "time", ...e })));
    metaTimeline.push(...dedupedKeySignatureEvents.map((e) => ({ kind: "key", ...e })));
    const kindPriority = { tempo: 0, time: 1, key: 2 };
    metaTimeline.sort((a, b) => a.startTicks === b.startTicks ? kindPriority[a.kind] - kindPriority[b.kind] : a.startTicks - b.startTicks);
    for (const metaEvent of metaTimeline) {
        const tick = Math.max(0, Math.round(metaEvent.startTicks));
        if (metaEvent.kind === "tempo") {
            const bpm = clampTempo(metaEvent.bpm);
            const microsPerQuarter = Math.max(1, Math.round(60000000 / bpm));
            tempoEvents.push({
                tick,
                order: 0,
                bytes: [0xff, 0x51, 0x03, (microsPerQuarter >> 16) & 0xff, (microsPerQuarter >> 8) & 0xff, microsPerQuarter & 0xff],
            });
        }
        else if (metaEvent.kind === "time") {
            const beats = Math.max(1, Math.min(255, Math.round(metaEvent.beats)));
            const beatType = Math.max(1, Math.round(metaEvent.beatType));
            const dd = Math.max(0, Math.min(7, Math.round(Math.log2(beatType))));
            tempoEvents.push({
                tick,
                order: 1,
                bytes: [0xff, 0x58, 0x04, beats & 0xff, dd & 0xff, 24, 8],
            });
        }
        else {
            const fifths = Math.max(-7, Math.min(7, Math.round(metaEvent.fifths)));
            const sf = fifths < 0 ? fifths + 256 : fifths;
            const mi = metaEvent.mode === "minor" ? 1 : 0;
            tempoEvents.push({
                tick,
                order: 2,
                bytes: [0xff, 0x59, 0x02, sf & 0xff, mi],
            });
        }
    }
    if (options.embedMksSysEx) {
        for (const chunkText of options.sysexChunkTexts) {
            const sysexBytes = buildMksSysexEventData(0, chunkText);
            const body = sysexBytes.slice(numberToVariableLength(0).length);
            tempoEvents.push({ tick: 0, order: 3, bytes: body });
        }
    }
    for (const line of options.mksTextMetaLines) {
        const textBytes = buildTextMetaEventData(0, line, 0x01);
        const body = textBytes.slice(numberToVariableLength(0).length);
        tempoEvents.push({ tick: 0, order: 4, bytes: body });
    }
    trackChunks.push(encodeRawTrackChunk(tempoEvents));
    const normalizedProgram = instrumentByPreset[normalizedProgramPreset];
    const retriggerPolicy = options.retriggerPolicy;
    const sortedTrackIds = Array.from(tracksById.keys()).sort((a, b) => a.localeCompare(b));
    for (const trackId of sortedTrackIds) {
        const trackEvents = ((_b = tracksById.get(trackId)) !== null && _b !== void 0 ? _b : [])
            .slice()
            .sort((a, b) => (a.startTicks === b.startTicks ? a.midiNumber - b.midiNumber : a.startTicks - b.startTicks));
        if (!trackEvents.length)
            continue;
        const noteEvents = [];
        const channels = Array.from(new Set(trackEvents.map((event) => Math.max(1, Math.min(16, Math.round(event.channel || 1)))))).sort((a, b) => a - b);
        const overrideProgram = normalizeMidiProgramNumber((_c = trackProgramOverrides.get(trackId)) !== null && _c !== void 0 ? _c : NaN);
        const selectedProgram = Math.max(0, Math.min(127, (overrideProgram !== null && overrideProgram !== void 0 ? overrideProgram : normalizedProgram) & 0xff));
        for (const channel of channels) {
            if (channel === 10)
                continue;
            noteEvents.push({
                tick: 0,
                order: 0,
                bytes: [0xc0 + channel - 1, selectedProgram],
            });
        }
        for (const event of trackEvents) {
            const channel = Math.max(1, Math.min(16, Math.round(event.channel || 1)));
            const midiNumber = Math.max(0, Math.min(127, Math.round(event.midiNumber)));
            const startTick = Math.max(0, Math.round(event.startTicks));
            const endTick = Math.max(startTick + 1, startTick + Math.max(1, Math.round(event.durTicks)));
            const velocity = toMidiWriterVelocityByte(clampVelocity(event.velocity));
            const offOrder = retriggerPolicy === "on_before_off" ? 2 : 1;
            const onOrder = retriggerPolicy === "on_before_off" ? 1 : 2;
            const pitchOrderKeyOff = midiNumber * 2;
            const pitchOrderKeyOn = midiNumber * 2 + 1;
            const isPitchOrder = retriggerPolicy === "pitch_order";
            noteEvents.push({
                tick: endTick,
                order: isPitchOrder ? 1 : offOrder,
                sortKey: isPitchOrder ? pitchOrderKeyOff : undefined,
                bytes: [0x80 + channel - 1, midiNumber, velocity],
            });
            noteEvents.push({
                tick: startTick,
                order: isPitchOrder ? 1 : onOrder,
                sortKey: isPitchOrder ? pitchOrderKeyOn : undefined,
                bytes: [0x90 + channel - 1, midiNumber, velocity],
            });
        }
        trackChunks.push(encodeRawTrackChunk(noteEvents));
    }
    const groupedControlEvents = new Map();
    for (const controlEvent of controlEvents) {
        const key = `${controlEvent.trackId}::${normalizeMidiChannel(controlEvent.channel)}`;
        const bucket = (_d = groupedControlEvents.get(key)) !== null && _d !== void 0 ? _d : [];
        bucket.push(controlEvent);
        groupedControlEvents.set(key, bucket);
    }
    const sortedControlKeys = Array.from(groupedControlEvents.keys()).sort((a, b) => a.localeCompare(b));
    for (const controlKey of sortedControlKeys) {
        const channelEvents = ((_e = groupedControlEvents.get(controlKey)) !== null && _e !== void 0 ? _e : [])
            .slice()
            .sort((a, b) => a.startTicks === b.startTicks
            ? a.controllerNumber === b.controllerNumber
                ? a.controllerValue - b.controllerValue
                : a.controllerNumber - b.controllerNumber
            : a.startTicks - b.startTicks);
        if (!channelEvents.length)
            continue;
        const ccEvents = [];
        for (const controlEvent of channelEvents) {
            const channel = normalizeMidiChannel(controlEvent.channel);
            const controllerNumber = Math.max(0, Math.min(127, Math.round(controlEvent.controllerNumber)));
            const controllerValue = Math.max(0, Math.min(127, Math.round(controlEvent.controllerValue)));
            ccEvents.push({
                tick: Math.max(0, Math.round(controlEvent.startTicks)),
                order: 1,
                bytes: [0xb0 + channel - 1, controllerNumber, controllerValue],
            });
        }
        trackChunks.push(encodeRawTrackChunk(ccEvents));
    }
    const header = [
        0x4d,
        0x54,
        0x68,
        0x64,
        0x00,
        0x00,
        0x00,
        0x06,
        0x00,
        0x01,
        ...toU16BeBytes(trackChunks.length),
        ...toU16BeBytes(writerTicksPerQuarter),
    ];
    const output = new Uint8Array(header.length + trackChunks.reduce((sum, chunk) => sum + chunk.length, 0));
    let offset = 0;
    output.set(header, offset);
    offset += header.length;
    for (const chunk of trackChunks) {
        output.set(chunk, offset);
        offset += chunk.length;
    }
    return output;
};
const normalizeMidiChannel = (value) => {
    if (!Number.isFinite(value))
        return 1;
    return Math.max(1, Math.min(16, Math.round(value)));
};
const normalizePlaybackEventsForParity = (events) => {
    const deduped = new Map();
    for (const event of events) {
        const channel = normalizeMidiChannel(event.channel);
        const startTicks = Math.max(0, Math.round(event.startTicks));
        const durTicks = Math.max(1, Math.round(event.durTicks));
        const midiNumber = Math.round(event.midiNumber);
        // Parity mode compares rendered MIDI semantics, so dedupe across track/staff boundaries.
        const key = `${channel}|${midiNumber}|${startTicks}|${durTicks}`;
        const prev = deduped.get(key);
        if (!prev) {
            deduped.set(key, {
                ...event,
                channel,
                startTicks,
                durTicks,
                midiNumber,
            });
            continue;
        }
        if (event.velocity > prev.velocity) {
            deduped.set(key, { ...prev, velocity: event.velocity });
        }
    }
    return Array.from(deduped.values());
};
const parseMidiNoteNumber = (value) => {
    const parsed = Number.parseInt(value.trim(), 10);
    if (!Number.isFinite(parsed) || parsed < 0 || parsed > 127)
        return null;
    return parsed;
};
const resolveDrumMidiFromInstrumentName = (name) => {
    const trimmed = name.trim();
    if (!trimmed)
        return null;
    for (const entry of DRUM_NAME_HINT_TO_GM_NOTE) {
        if (entry.pattern.test(trimmed))
            return entry.midi;
    }
    return null;
};
const buildDrumPartMapByPartId = (doc) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
    const byPartId = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_b = (_a = scorePart.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        const instrumentNameById = new Map();
        for (const scoreInstrument of Array.from(scorePart.querySelectorAll(":scope > score-instrument"))) {
            const instrumentId = (_d = (_c = scoreInstrument.getAttribute("id")) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "";
            if (!instrumentId)
                continue;
            const name = (_g = (_f = (_e = scoreInstrument.querySelector("instrument-name")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) !== null && _g !== void 0 ? _g : "";
            if (name)
                instrumentNameById.set(instrumentId, name);
        }
        const midiUnpitchedByInstrumentId = new Map();
        let defaultMidiUnpitched = null;
        for (const midiInstrument of Array.from(scorePart.querySelectorAll(":scope > midi-instrument"))) {
            const midiUnpitchedText = (_k = (_j = (_h = midiInstrument.querySelector("midi-unpitched")) === null || _h === void 0 ? void 0 : _h.textContent) === null || _j === void 0 ? void 0 : _j.trim()) !== null && _k !== void 0 ? _k : "";
            const midiUnpitched = parseMidiNoteNumber(midiUnpitchedText);
            if (midiUnpitched === null)
                continue;
            const midiInstrumentId = (_m = (_l = midiInstrument.getAttribute("id")) === null || _l === void 0 ? void 0 : _l.trim()) !== null && _m !== void 0 ? _m : "";
            if (midiInstrumentId) {
                midiUnpitchedByInstrumentId.set(midiInstrumentId, midiUnpitched);
            }
            if (defaultMidiUnpitched === null) {
                defaultMidiUnpitched = midiUnpitched;
            }
        }
        byPartId.set(partId, {
            midiUnpitchedByInstrumentId,
            instrumentNameById,
            defaultMidiUnpitched,
        });
    }
    return byPartId;
};
const createControllerChangeEventForChannel = (midiWriter, channel, controllerNumber, controllerValue, deltaTicks) => {
    const event = new midiWriter.ControllerChangeEvent({
        controllerNumber: Math.max(0, Math.min(127, Math.round(controllerNumber))),
        controllerValue: Math.max(0, Math.min(127, Math.round(controllerValue))),
        delta: Math.max(0, Math.round(deltaTicks)),
    });
    if (Array.isArray(event.data) && event.data.length >= 3) {
        const statusIndex = event.data.length - 3;
        event.data[statusIndex] = 0xb0 + normalizeMidiChannel(channel) - 1;
    }
    return event;
};
const collectMidiProgramOverridesFromMusicXmlDoc = (doc) => {
    var _a, _b, _c, _d;
    const byPartId = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_b = (_a = scorePart.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        const midiProgramNodes = Array.from(scorePart.querySelectorAll("midi-instrument > midi-program"));
        for (const midiProgramNode of midiProgramNodes) {
            const midiProgramText = (_d = (_c = midiProgramNode.textContent) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "";
            if (!midiProgramText)
                continue;
            const parsed = Number.parseInt(midiProgramText, 10);
            const normalized = normalizeMidiProgramNumber(parsed);
            if (normalized === null)
                continue;
            byPartId.set(partId, normalized);
            break;
        }
    }
    return byPartId;
};
exports.collectMidiProgramOverridesFromMusicXmlDoc = collectMidiProgramOverridesFromMusicXmlDoc;
const resolveMeasureAdvanceDiv = (measure, measureMaxDiv, currentDivisions, currentBeats, currentBeatType, nextMeasureIsImplicit = false) => {
    const safeDivisions = Math.max(1, Math.round(currentDivisions));
    const safeBeats = Math.max(1, Math.round(currentBeats));
    const safeBeatType = Math.max(1, Math.round(currentBeatType));
    const capacityDiv = Math.max(1, Math.round((safeDivisions * 4 * safeBeats) / safeBeatType));
    const implicitAttr = (measure.getAttribute("implicit") || "").trim().toLowerCase();
    const isImplicit = implicitAttr === "yes" || implicitAttr === "true" || implicitAttr === "1";
    if (isImplicit) {
        return measureMaxDiv > 0 ? measureMaxDiv : capacityDiv;
    }
    // Some scores split one logical bar into [regular underfull] + [implicit pickup].
    // In that case, padding the regular bar to full capacity causes an extra silent beat.
    if (nextMeasureIsImplicit && measureMaxDiv > 0 && measureMaxDiv < capacityDiv) {
        return measureMaxDiv;
    }
    return Math.max(capacityDiv, measureMaxDiv);
};
const isImplicitMeasure = (measure) => {
    if (!measure)
        return false;
    const implicitAttr = (measure.getAttribute("implicit") || "").trim().toLowerCase();
    return implicitAttr === "yes" || implicitAttr === "true" || implicitAttr === "1";
};
const collectMidiControlEventsFromMusicXmlDoc = (doc, ticksPerQuarter) => {
    var _a, _b, _c, _d, _e, _f, _g;
    const normalizedTicksPerQuarter = normalizeTicksPerQuarter(ticksPerQuarter);
    const partNodes = Array.from(doc.querySelectorAll("score-partwise > part"));
    if (partNodes.length === 0)
        return [];
    const channelMap = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_a = scorePart.getAttribute("id")) !== null && _a !== void 0 ? _a : "";
        if (!partId)
            continue;
        const midiChannelText = (_c = (_b = scorePart.querySelector("midi-instrument > midi-channel")) === null || _b === void 0 ? void 0 : _b.textContent) === null || _c === void 0 ? void 0 : _c.trim();
        const midiChannel = midiChannelText ? Number.parseInt(midiChannelText, 10) : NaN;
        if (Number.isFinite(midiChannel) && midiChannel >= 1 && midiChannel <= 16) {
            channelMap.set(partId, midiChannel);
        }
    }
    const partNameById = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_d = scorePart.getAttribute("id")) !== null && _d !== void 0 ? _d : "";
        if (!partId)
            continue;
        const rawName = (_g = (_f = (_e = scorePart.querySelector("part-name")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) !== null && _g !== void 0 ? _g : "";
        partNameById.set(partId, rawName || partId);
    }
    const controlEvents = [];
    partNodes.forEach((part, partIndex) => {
        var _a, _b, _c, _d, _e, _f;
        const partId = (_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "";
        const fallbackChannel = (partIndex % 16) + 1 === 10 ? 11 : (partIndex % 16) + 1;
        const channel = (_b = channelMap.get(partId)) !== null && _b !== void 0 ? _b : fallbackChannel;
        const trackId = partId || `part-${partIndex + 1}`;
        const trackName = (_c = partNameById.get(partId)) !== null && _c !== void 0 ? _c : trackId;
        let currentDivisions = 1;
        let currentBeats = 4;
        let currentBeatType = 4;
        let timelineDiv = 0;
        let lastPedalValue = null;
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
            const measure = measures[measureIndex];
            const nextMeasure = (_d = measures[measureIndex + 1]) !== null && _d !== void 0 ? _d : null;
            const divisions = getFirstNumber(measure, "attributes > divisions");
            if (divisions && divisions > 0)
                currentDivisions = divisions;
            const beats = getFirstNumber(measure, "attributes > time > beats");
            const beatType = getFirstNumber(measure, "attributes > time > beat-type");
            if (beats && beats > 0 && beatType && beatType > 0) {
                currentBeats = beats;
                currentBeatType = beatType;
            }
            let cursorDiv = 0;
            let measureMaxDiv = 0;
            for (const child of Array.from(measure.children)) {
                if (child.tagName === "backup" || child.tagName === "forward") {
                    const dur = getFirstNumber(child, "duration");
                    if (!dur || dur <= 0)
                        continue;
                    if (child.tagName === "backup") {
                        cursorDiv = Math.max(0, cursorDiv - dur);
                    }
                    else {
                        cursorDiv += dur;
                        measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
                    }
                    continue;
                }
                if (child.tagName !== "direction")
                    continue;
                const pedalNodes = Array.from(child.querySelectorAll("direction-type > pedal"));
                if (!pedalNodes.length)
                    continue;
                const startTicks = Math.max(0, Math.round(((timelineDiv + cursorDiv) / currentDivisions) * normalizedTicksPerQuarter));
                for (const pedalNode of pedalNodes) {
                    const pedalType = (_f = (_e = pedalNode.getAttribute("type")) === null || _e === void 0 ? void 0 : _e.trim().toLowerCase()) !== null && _f !== void 0 ? _f : "start";
                    if (pedalType === "stop") {
                        if (lastPedalValue !== 0) {
                            controlEvents.push({
                                trackId,
                                trackName,
                                startTicks,
                                channel,
                                controllerNumber: 64,
                                controllerValue: 0,
                            });
                            lastPedalValue = 0;
                        }
                        continue;
                    }
                    if (pedalType === "change") {
                        if (lastPedalValue !== 0) {
                            controlEvents.push({
                                trackId,
                                trackName,
                                startTicks,
                                channel,
                                controllerNumber: 64,
                                controllerValue: 0,
                            });
                        }
                        controlEvents.push({
                            trackId,
                            trackName,
                            startTicks,
                            channel,
                            controllerNumber: 64,
                            controllerValue: 127,
                        });
                        lastPedalValue = 127;
                        continue;
                    }
                    if (pedalType === "start" || pedalType === "continue" || pedalType === "resume") {
                        if (lastPedalValue !== 127) {
                            controlEvents.push({
                                trackId,
                                trackName,
                                startTicks,
                                channel,
                                controllerNumber: 64,
                                controllerValue: 127,
                            });
                            lastPedalValue = 127;
                        }
                    }
                }
            }
            timelineDiv += resolveMeasureAdvanceDiv(measure, measureMaxDiv, currentDivisions, currentBeats, currentBeatType, isImplicitMeasure(nextMeasure));
        }
    });
    return controlEvents;
};
exports.collectMidiControlEventsFromMusicXmlDoc = collectMidiControlEventsFromMusicXmlDoc;
const collectMidiTempoEventsFromMusicXmlDoc = (doc, ticksPerQuarter) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o;
    const normalizedTicksPerQuarter = normalizeTicksPerQuarter(ticksPerQuarter);
    const firstPart = doc.querySelector("score-partwise > part");
    if (!firstPart)
        return [{ startTicks: 0, bpm: 120 }];
    let currentDivisions = 1;
    let currentBeats = 4;
    let currentBeatType = 4;
    let timelineDiv = 0;
    let currentTempo = clampTempo((_a = getFirstNumber(doc, "sound[tempo]")) !== null && _a !== void 0 ? _a : 120);
    const events = [{ startTicks: 0, bpm: currentTempo }];
    const measures = Array.from(firstPart.querySelectorAll(":scope > measure"));
    for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
        const measure = measures[measureIndex];
        const nextMeasure = (_b = measures[measureIndex + 1]) !== null && _b !== void 0 ? _b : null;
        const divisions = getFirstNumber(measure, "attributes > divisions");
        if (divisions && divisions > 0)
            currentDivisions = divisions;
        const beats = getFirstNumber(measure, "attributes > time > beats");
        const beatType = getFirstNumber(measure, "attributes > time > beat-type");
        if (beats && beats > 0 && beatType && beatType > 0) {
            currentBeats = beats;
            currentBeatType = beatType;
        }
        let cursorDiv = 0;
        let measureMaxDiv = 0;
        const lastStartByVoice = new Map();
        for (const child of Array.from(measure.children)) {
            if (child.tagName === "backup" || child.tagName === "forward") {
                const dur = getFirstNumber(child, "duration");
                if (!dur || dur <= 0)
                    continue;
                if (child.tagName === "backup") {
                    cursorDiv = Math.max(0, cursorDiv - dur);
                }
                else {
                    cursorDiv += dur;
                    measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
                }
                continue;
            }
            if (child.tagName === "direction") {
                const soundTempo = Number((_d = (_c = child.querySelector(":scope > sound")) === null || _c === void 0 ? void 0 : _c.getAttribute("tempo")) !== null && _d !== void 0 ? _d : "");
                const metronomeTempo = Number((_g = (_f = (_e = child.querySelector("direction-type > metronome > per-minute")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) !== null && _g !== void 0 ? _g : "");
                const rawTempo = Number.isFinite(soundTempo) && soundTempo > 0 ? soundTempo : metronomeTempo;
                if (Number.isFinite(rawTempo) && rawTempo > 0) {
                    const offsetDiv = (_h = getFirstNumber(child, ":scope > offset")) !== null && _h !== void 0 ? _h : 0;
                    const eventDiv = Math.max(0, timelineDiv + cursorDiv + offsetDiv);
                    const eventTick = Math.max(0, Math.round((eventDiv / Math.max(1, currentDivisions)) * normalizedTicksPerQuarter));
                    const normalizedTempo = clampTempo(rawTempo);
                    if (normalizedTempo !== currentTempo) {
                        events.push({ startTicks: eventTick, bpm: normalizedTempo });
                        currentTempo = normalizedTempo;
                    }
                }
            }
            if (child.tagName !== "note")
                continue;
            const durationDiv = getFirstNumber(child, "duration");
            if (!durationDiv || durationDiv <= 0)
                continue;
            const voice = (_l = (_k = (_j = child.querySelector("voice")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) !== null && _l !== void 0 ? _l : "1";
            const isChord = Boolean(child.querySelector("chord"));
            const startDiv = isChord ? ((_m = lastStartByVoice.get(voice)) !== null && _m !== void 0 ? _m : cursorDiv) : cursorDiv;
            if (!isChord) {
                lastStartByVoice.set(voice, startDiv);
                cursorDiv += durationDiv;
            }
            measureMaxDiv = Math.max(measureMaxDiv, cursorDiv, startDiv + durationDiv);
        }
        timelineDiv += resolveMeasureAdvanceDiv(measure, measureMaxDiv, currentDivisions, currentBeats, currentBeatType, isImplicitMeasure(nextMeasure));
    }
    const byTick = new Map();
    for (const event of events) {
        byTick.set(Math.max(0, Math.round(event.startTicks)), clampTempo(event.bpm));
    }
    const sortedTicks = Array.from(byTick.keys()).sort((a, b) => a - b);
    if (!sortedTicks.length || sortedTicks[0] !== 0) {
        sortedTicks.unshift(0);
        byTick.set(0, clampTempo((_o = getFirstNumber(doc, "sound[tempo]")) !== null && _o !== void 0 ? _o : 120));
    }
    return sortedTicks.map((tick) => { var _a; return ({ startTicks: tick, bpm: (_a = byTick.get(tick)) !== null && _a !== void 0 ? _a : 120 }); });
};
exports.collectMidiTempoEventsFromMusicXmlDoc = collectMidiTempoEventsFromMusicXmlDoc;
const collectMidiTimeSignatureEventsFromMusicXmlDoc = (doc, ticksPerQuarter) => {
    var _a;
    const normalizedTicksPerQuarter = normalizeTicksPerQuarter(ticksPerQuarter);
    const firstPart = doc.querySelector("score-partwise > part");
    if (!firstPart)
        return [{ startTicks: 0, beats: 4, beatType: 4 }];
    let currentDivisions = 1;
    let tickCursor = 0;
    let currentBeats = 4;
    let currentBeatType = 4;
    const events = [{ startTicks: 0, beats: currentBeats, beatType: currentBeatType }];
    const measures = Array.from(firstPart.querySelectorAll(":scope > measure"));
    for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
        const measure = measures[measureIndex];
        const nextMeasure = (_a = measures[measureIndex + 1]) !== null && _a !== void 0 ? _a : null;
        const divisions = getFirstNumber(measure, "attributes > divisions");
        if (divisions && divisions > 0)
            currentDivisions = divisions;
        const beats = getFirstNumber(measure, "attributes > time > beats");
        const beatType = getFirstNumber(measure, "attributes > time > beat-type");
        if (beats !== null &&
            beatType !== null &&
            (Math.round(beats) !== currentBeats || Math.round(beatType) !== currentBeatType)) {
            currentBeats = Math.max(1, Math.round(beats));
            currentBeatType = Math.max(1, Math.round(beatType));
            events.push({ startTicks: tickCursor, beats: currentBeats, beatType: currentBeatType });
        }
        let cursorDiv = 0;
        let measureMaxDiv = 0;
        for (const child of Array.from(measure.children)) {
            if (child.tagName === "backup" || child.tagName === "forward") {
                const dur = getFirstNumber(child, "duration");
                if (!dur || dur <= 0)
                    continue;
                if (child.tagName === "backup") {
                    cursorDiv = Math.max(0, cursorDiv - dur);
                }
                else {
                    cursorDiv += dur;
                    measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
                }
                continue;
            }
            if (child.tagName !== "note")
                continue;
            const durationDiv = getFirstNumber(child, "duration");
            if (!durationDiv || durationDiv <= 0)
                continue;
            if (!child.querySelector("chord")) {
                cursorDiv += durationDiv;
            }
            measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
        }
        const advanceDiv = resolveMeasureAdvanceDiv(measure, measureMaxDiv, currentDivisions, currentBeats, currentBeatType, isImplicitMeasure(nextMeasure));
        tickCursor += Math.max(1, Math.round((advanceDiv / Math.max(1, currentDivisions)) * normalizedTicksPerQuarter));
    }
    const byTick = new Map();
    for (const event of events) {
        byTick.set(Math.max(0, Math.round(event.startTicks)), {
            beats: Math.max(1, Math.round(event.beats)),
            beatType: Math.max(1, Math.round(event.beatType)),
        });
    }
    const sortedTicks = Array.from(byTick.keys()).sort((a, b) => a - b);
    return sortedTicks.map((tick) => {
        var _a, _b, _c, _d;
        return ({
            startTicks: tick,
            beats: (_b = (_a = byTick.get(tick)) === null || _a === void 0 ? void 0 : _a.beats) !== null && _b !== void 0 ? _b : 4,
            beatType: (_d = (_c = byTick.get(tick)) === null || _c === void 0 ? void 0 : _c.beatType) !== null && _d !== void 0 ? _d : 4,
        });
    });
};
exports.collectMidiTimeSignatureEventsFromMusicXmlDoc = collectMidiTimeSignatureEventsFromMusicXmlDoc;
const collectMidiKeySignatureEventsFromMusicXmlDoc = (doc, ticksPerQuarter) => {
    var _a, _b, _c, _d, _e, _f;
    const normalizedTicksPerQuarter = normalizeTicksPerQuarter(ticksPerQuarter);
    const firstPart = doc.querySelector("score-partwise > part");
    if (!firstPart)
        return [{ startTicks: 0, fifths: 0, mode: "major" }];
    let currentDivisions = 1;
    let tickCursor = 0;
    let currentFifths = 0;
    let currentMode = "major";
    const events = [
        { startTicks: 0, fifths: currentFifths, mode: currentMode },
    ];
    let hasInitialKey = false;
    const measures = Array.from(firstPart.querySelectorAll(":scope > measure"));
    for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
        const measure = measures[measureIndex];
        const nextMeasure = (_a = measures[measureIndex + 1]) !== null && _a !== void 0 ? _a : null;
        const divisions = getFirstNumber(measure, "attributes > divisions");
        if (divisions && divisions > 0)
            currentDivisions = divisions;
        const fifths = getFirstNumber(measure, "attributes > key > fifths");
        const modeText = (_d = (_c = (_b = measure.querySelector("attributes > key > mode")) === null || _b === void 0 ? void 0 : _b.textContent) === null || _c === void 0 ? void 0 : _c.trim().toLowerCase()) !== null && _d !== void 0 ? _d : "";
        const mode = modeText === "minor" ? "minor" : "major";
        if (Number.isFinite(fifths)) {
            const roundedFifths = Math.max(-7, Math.min(7, Math.round(fifths)));
            if (!hasInitialKey || roundedFifths !== currentFifths || mode !== currentMode) {
                if (!hasInitialKey) {
                    events[0] = { startTicks: 0, fifths: roundedFifths, mode };
                    hasInitialKey = true;
                }
                else {
                    events.push({ startTicks: tickCursor, fifths: roundedFifths, mode });
                }
                currentFifths = roundedFifths;
                currentMode = mode;
            }
        }
        let cursorDiv = 0;
        let measureMaxDiv = 0;
        for (const child of Array.from(measure.children)) {
            if (child.tagName === "backup" || child.tagName === "forward") {
                const dur = getFirstNumber(child, "duration");
                if (!dur || dur <= 0)
                    continue;
                if (child.tagName === "backup") {
                    cursorDiv = Math.max(0, cursorDiv - dur);
                }
                else {
                    cursorDiv += dur;
                    measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
                }
                continue;
            }
            if (child.tagName !== "note")
                continue;
            const durationDiv = getFirstNumber(child, "duration");
            if (!durationDiv || durationDiv <= 0)
                continue;
            if (!child.querySelector("chord")) {
                cursorDiv += durationDiv;
            }
            measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
        }
        const beats = (_e = getFirstNumber(measure, "attributes > time > beats")) !== null && _e !== void 0 ? _e : 4;
        const beatType = (_f = getFirstNumber(measure, "attributes > time > beat-type")) !== null && _f !== void 0 ? _f : 4;
        const advanceDiv = resolveMeasureAdvanceDiv(measure, measureMaxDiv, currentDivisions, beats, beatType, isImplicitMeasure(nextMeasure));
        tickCursor += Math.max(1, Math.round((advanceDiv / Math.max(1, currentDivisions)) * normalizedTicksPerQuarter));
    }
    const byTick = new Map();
    for (const event of events) {
        byTick.set(Math.max(0, Math.round(event.startTicks)), {
            fifths: Math.max(-7, Math.min(7, Math.round(event.fifths))),
            mode: event.mode === "minor" ? "minor" : "major",
        });
    }
    const sortedTicks = Array.from(byTick.keys()).sort((a, b) => a - b);
    return sortedTicks.map((tick) => {
        var _a, _b, _c, _d;
        return ({
            startTicks: tick,
            fifths: (_b = (_a = byTick.get(tick)) === null || _a === void 0 ? void 0 : _a.fifths) !== null && _b !== void 0 ? _b : 0,
            mode: (_d = (_c = byTick.get(tick)) === null || _c === void 0 ? void 0 : _c.mode) !== null && _d !== void 0 ? _d : "major",
        });
    });
};
exports.collectMidiKeySignatureEventsFromMusicXmlDoc = collectMidiKeySignatureEventsFromMusicXmlDoc;
const buildMidiBytesForPlayback = (events, tempo, programPreset = "electric_piano_2", trackProgramOverrides = new Map(), controlEvents = [], tempoEvents = [], timeSignatureEvents = [], keySignatureEvents = [], options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
    const rawWriter = options.rawWriter === true;
    const midiWriter = rawWriter ? null : getMidiWriterRuntime();
    if (!rawWriter && !midiWriter) {
        throw new Error("midi-writer.js is not loaded.");
    }
    const writerTicksPerQuarter = normalizeTicksPerQuarter((_a = options.ticksPerQuarter) !== null && _a !== void 0 ? _a : 480);
    if (midiWriter) {
        setMidiWriterHeaderTicksPerQuarter(midiWriter, writerTicksPerQuarter);
    }
    const normalizeForParity = options.normalizeForParity === true;
    const sourceEvents = normalizeForParity ? normalizePlaybackEventsForParity(events) : events;
    const tracksById = new Map();
    for (const event of sourceEvents) {
        const key = event.trackId || "__default__";
        const bucket = (_b = tracksById.get(key)) !== null && _b !== void 0 ? _b : [];
        bucket.push(event);
        tracksById.set(key, bucket);
    }
    const midiTracks = [];
    const sortedTrackIds = Array.from(tracksById.keys()).sort((a, b) => a.localeCompare(b));
    const mksTextMetaLines = ["mks:meta-version:1"];
    const metaTitle = String((_d = (_c = options.metadata) === null || _c === void 0 ? void 0 : _c.title) !== null && _d !== void 0 ? _d : "").trim();
    const metaMovementTitle = String((_f = (_e = options.metadata) === null || _e === void 0 ? void 0 : _e.movementTitle) !== null && _f !== void 0 ? _f : "").trim();
    const metaComposer = String((_h = (_g = options.metadata) === null || _g === void 0 ? void 0 : _g.composer) !== null && _h !== void 0 ? _h : "").trim();
    if (metaTitle)
        mksTextMetaLines.push(`mks:title:${encodeURIComponent(metaTitle)}`);
    if (metaMovementTitle) {
        mksTextMetaLines.push(`mks:movement-title:${encodeURIComponent(metaMovementTitle)}`);
    }
    if (metaComposer)
        mksTextMetaLines.push(`mks:composer:${encodeURIComponent(metaComposer)}`);
    for (let index = 0; index < sortedTrackIds.length; index += 1) {
        const trackId = sortedTrackIds[index];
        const trackEvents = (_j = tracksById.get(trackId)) !== null && _j !== void 0 ? _j : [];
        const trackName = (_m = (_l = (_k = trackEvents[0]) === null || _k === void 0 ? void 0 : _k.trackName) === null || _l === void 0 ? void 0 : _l.trim()) !== null && _m !== void 0 ? _m : "";
        if (!trackName)
            continue;
        mksTextMetaLines.push(`mks:part-name-track:${index + 1}:${encodeURIComponent(trackName)}`);
    }
    const normalizedTempoEvents = (tempoEvents.length ? tempoEvents : [{ startTicks: 0, bpm: tempo }])
        .map((event) => ({
        startTicks: Math.max(0, Math.round(event.startTicks)),
        bpm: clampTempo(event.bpm),
    }))
        .sort((a, b) => a.startTicks - b.startTicks);
    const dedupedTempoEvents = [];
    for (const event of normalizedTempoEvents) {
        const prev = dedupedTempoEvents[dedupedTempoEvents.length - 1];
        if (prev && prev.startTicks === event.startTicks) {
            prev.bpm = event.bpm;
            continue;
        }
        dedupedTempoEvents.push({ ...event });
    }
    if (!dedupedTempoEvents.length || dedupedTempoEvents[0].startTicks !== 0) {
        dedupedTempoEvents.unshift({ startTicks: 0, bpm: clampTempo(tempo) });
    }
    const dedupedTimeSignatureEvents = [];
    for (const event of timeSignatureEvents
        .map((e) => ({
        startTicks: Math.max(0, Math.round(e.startTicks)),
        beats: Math.max(1, Math.round(e.beats)),
        beatType: Math.max(1, Math.round(e.beatType)),
    }))
        .sort((a, b) => a.startTicks - b.startTicks)) {
        const prev = dedupedTimeSignatureEvents[dedupedTimeSignatureEvents.length - 1];
        if (prev && prev.startTicks === event.startTicks) {
            prev.beats = event.beats;
            prev.beatType = event.beatType;
            continue;
        }
        dedupedTimeSignatureEvents.push({ ...event });
    }
    if (!dedupedTimeSignatureEvents.length || dedupedTimeSignatureEvents[0].startTicks !== 0) {
        dedupedTimeSignatureEvents.unshift({ startTicks: 0, beats: 4, beatType: 4 });
    }
    const dedupedKeySignatureEvents = [];
    for (const event of keySignatureEvents
        .map((e) => ({
        startTicks: Math.max(0, Math.round(e.startTicks)),
        fifths: Math.max(-7, Math.min(7, Math.round(e.fifths))),
        mode: (e.mode === "minor" ? "minor" : "major"),
    }))
        .sort((a, b) => a.startTicks - b.startTicks)) {
        const prev = dedupedKeySignatureEvents[dedupedKeySignatureEvents.length - 1];
        if (prev && prev.startTicks === event.startTicks) {
            prev.fifths = event.fifths;
            prev.mode = event.mode;
            continue;
        }
        dedupedKeySignatureEvents.push({ ...event });
    }
    if (!dedupedKeySignatureEvents.length || dedupedKeySignatureEvents[0].startTicks !== 0) {
        dedupedKeySignatureEvents.unshift({ startTicks: 0, fifths: 0, mode: "major" });
    }
    const exportDiagnostics = [];
    const sourceDiagnostics = ((_o = options.diagnostics) !== null && _o !== void 0 ? _o : [])
        .map((entry) => String(entry || "").trim())
        .filter((entry) => entry.length > 0);
    exportDiagnostics.push(...sourceDiagnostics);
    if (!tempoEvents.length) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_TEMPO_INSERTED;fmt=midi;startTick=0;bpm=120");
    }
    else if (!tempoEvents.some((event) => Math.max(0, Math.round(event.startTicks)) === 0)) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_TEMPO_AT_ZERO_INSERTED;fmt=midi;startTick=0;bpm=120");
    }
    if (!timeSignatureEvents.length) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_TIMESIG_INSERTED;fmt=midi;startTick=0;beats=4;beatType=4");
    }
    else if (!timeSignatureEvents.some((event) => Math.max(0, Math.round(event.startTicks)) === 0)) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_TIMESIG_AT_ZERO_INSERTED;fmt=midi;startTick=0;beats=4;beatType=4");
    }
    if (!keySignatureEvents.length) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_KEYSIG_INSERTED;fmt=midi;startTick=0;fifths=0;mode=major");
    }
    else if (!keySignatureEvents.some((event) => Math.max(0, Math.round(event.startTicks)) === 0)) {
        exportDiagnostics.push("level=info;code=MIDI_EXPORT_DEFAULT_KEYSIG_AT_ZERO_INSERTED;fmt=midi;startTick=0;fifths=0;mode=major");
    }
    const embedMksSysEx = options.embedMksSysEx !== false;
    const channelCount = new Set(sourceEvents.map((event) => normalizeMidiChannel(event.channel))).size;
    const sysexChunks = buildMksSysexChunkTexts({
        ticksPerQuarter: writerTicksPerQuarter,
        eventCount: sourceEvents.length,
        trackCount: tracksById.size,
        tempoEventCount: dedupedTempoEvents.length,
        timeSignatureEventCount: dedupedTimeSignatureEvents.length,
        keySignatureEventCount: dedupedKeySignatureEvents.length,
        controlEventCount: controlEvents.length,
        channelCount,
        diagnostics: exportDiagnostics,
    });
    const normalizedProgramPreset = instrumentByPreset[programPreset] !== undefined ? programPreset : "electric_piano_2";
    if (rawWriter) {
        return buildRawMidiBytesForPlayback(sourceEvents, trackProgramOverrides, controlEvents, dedupedTempoEvents, dedupedTimeSignatureEvents, dedupedKeySignatureEvents, writerTicksPerQuarter, normalizedProgramPreset, {
            embedMksSysEx,
            sysexChunkTexts: sysexChunks,
            retriggerPolicy: (_p = options.rawRetriggerPolicy) !== null && _p !== void 0 ? _p : "off_before_on",
            mksTextMetaLines,
        });
    }
    const midiWriterRuntime = midiWriter;
    const tempoTrack = new midiWriterRuntime.Track();
    tempoTrack.addTrackName("Tempo Map");
    tempoTrack.addInstrumentName("Tempo Map");
    const metaTimeline = [];
    metaTimeline.push(...dedupedTempoEvents.map((e) => ({ kind: "tempo", ...e })));
    metaTimeline.push(...dedupedTimeSignatureEvents.map((e) => ({ kind: "time", ...e })));
    metaTimeline.push(...dedupedKeySignatureEvents.map((e) => ({ kind: "key", ...e })));
    const kindPriority = { time: 0, key: 1, tempo: 2 };
    metaTimeline.sort((a, b) => a.startTicks === b.startTicks ? kindPriority[a.kind] - kindPriority[b.kind] : a.startTicks - b.startTicks);
    let prevTempoTick = 0;
    for (const metaEvent of metaTimeline) {
        const currentTick = Math.max(0, Math.round(metaEvent.startTicks));
        const deltaTicks = Math.max(0, currentTick - prevTempoTick);
        if (metaEvent.kind === "tempo") {
            tempoTrack.addEvent({ data: buildTempoMetaEventData(deltaTicks, metaEvent.bpm) });
        }
        else if (metaEvent.kind === "time") {
            tempoTrack.addEvent({
                data: buildTimeSignatureMetaEventData(deltaTicks, metaEvent.beats, metaEvent.beatType),
            });
        }
        else {
            tempoTrack.addEvent({
                data: buildKeySignatureMetaEventData(deltaTicks, metaEvent.fifths, metaEvent.mode),
            });
        }
        prevTempoTick = currentTick;
    }
    if (embedMksSysEx) {
        for (const chunk of sysexChunks) {
            tempoTrack.addEvent({ data: buildMksSysexEventData(0, chunk) });
        }
    }
    for (const line of mksTextMetaLines) {
        tempoTrack.addEvent({ data: buildTextMetaEventData(0, line, 0x01) });
    }
    midiTracks.push(tempoTrack);
    sortedTrackIds.forEach((trackId, index) => {
        var _a, _b, _c;
        const trackEvents = ((_a = tracksById.get(trackId)) !== null && _a !== void 0 ? _a : [])
            .slice()
            .sort((a, b) => (a.startTicks === b.startTicks ? a.midiNumber - b.midiNumber : a.startTicks - b.startTicks));
        if (!trackEvents.length)
            return;
        const track = new midiWriterRuntime.Track();
        const first = trackEvents[0];
        const trackName = ((_b = first.trackName) === null || _b === void 0 ? void 0 : _b.trim()) || trackId || `Track ${index + 1}`;
        track.addTrackName(trackName);
        track.addInstrumentName(trackName);
        const channels = Array.from(new Set(trackEvents.map((event) => Math.max(1, Math.min(16, Math.round(event.channel || 1)))))).sort((a, b) => a - b);
        const overrideProgram = normalizeMidiProgramNumber((_c = trackProgramOverrides.get(trackId)) !== null && _c !== void 0 ? _c : NaN);
        const selectedInstrumentProgram = overrideProgram !== null && overrideProgram !== void 0 ? overrideProgram : instrumentByPreset[normalizedProgramPreset];
        for (const channel of channels) {
            if (channel === 10)
                continue;
            track.addEvent(new midiWriterRuntime.ProgramChangeEvent({
                channel,
                instrument: selectedInstrumentProgram,
                delta: 0,
            }));
        }
        for (const event of trackEvents) {
            const fields = {
                pitch: [midiToPitchText(event.midiNumber)],
                duration: `T${event.durTicks}`,
                startTick: Math.max(0, Math.round(event.startTicks)),
                velocity: clampVelocity(event.velocity),
                channel: Math.max(1, Math.min(16, Math.round(event.channel || 1))),
            };
            track.addEvent(new midiWriterRuntime.NoteEvent(fields));
        }
        midiTracks.push(track);
    });
    const groupedControlEvents = new Map();
    for (const controlEvent of controlEvents) {
        const key = `${controlEvent.trackId}::${normalizeMidiChannel(controlEvent.channel)}`;
        const bucket = (_q = groupedControlEvents.get(key)) !== null && _q !== void 0 ? _q : [];
        bucket.push(controlEvent);
        groupedControlEvents.set(key, bucket);
    }
    const sortedControlKeys = Array.from(groupedControlEvents.keys()).sort((a, b) => a.localeCompare(b));
    for (const controlKey of sortedControlKeys) {
        const channelEvents = ((_r = groupedControlEvents.get(controlKey)) !== null && _r !== void 0 ? _r : [])
            .slice()
            .sort((a, b) => a.startTicks === b.startTicks
            ? a.controllerNumber === b.controllerNumber
                ? a.controllerValue - b.controllerValue
                : a.controllerNumber - b.controllerNumber
            : a.startTicks - b.startTicks);
        if (!channelEvents.length)
            continue;
        const first = channelEvents[0];
        const ccTrack = new midiWriterRuntime.Track();
        ccTrack.addTrackName(`${first.trackName} Pedal`);
        ccTrack.addInstrumentName(`${first.trackName} Pedal`);
        let prevTick = 0;
        for (const controlEvent of channelEvents) {
            const currentTick = Math.max(0, Math.round(controlEvent.startTicks));
            const deltaTicks = Math.max(0, currentTick - prevTick);
            ccTrack.addEvent(createControllerChangeEventForChannel(midiWriterRuntime, controlEvent.channel, controlEvent.controllerNumber, controlEvent.controllerValue, deltaTicks));
            prevTick = currentTick;
        }
        midiTracks.push(ccTrack);
    }
    if (!midiTracks.length) {
        throw new Error("No notes available for MIDI conversion.");
    }
    const writer = new midiWriterRuntime.Writer(midiTracks);
    const built = writer.buildFile();
    return built instanceof Uint8Array ? built : Uint8Array.from(built);
};
exports.buildMidiBytesForPlayback = buildMidiBytesForPlayback;
const convertMidiToMusicXml = (midiBytes, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const diagnostics = [];
    const warnings = [];
    const quantizeGridOption = normalizeMidiImportQuantizeGridOption(options.quantizeGrid);
    const debugImportMetadata = (_a = options.debugMetadata) !== null && _a !== void 0 ? _a : true;
    const sourceImportMetadata = (_b = options.sourceMetadata) !== null && _b !== void 0 ? _b : true;
    const tripletAwareQuantize = options.tripletAwareQuantize !== false;
    if (!(midiBytes instanceof Uint8Array) || midiBytes.length === 0) {
        diagnostics.push({
            code: "MIDI_INVALID_FILE",
            message: "MIDI input is empty.",
        });
        return { ok: false, xml: "", diagnostics, warnings };
    }
    const headerResult = parseSmfHeader(midiBytes);
    diagnostics.push(...headerResult.diagnostics);
    if (!headerResult.header) {
        return { ok: false, xml: "", diagnostics, warnings };
    }
    const header = headerResult.header;
    let offset = header.nextOffset;
    const trackChannelSet = new Set();
    const programByTrackChannel = new Map();
    const collectedNotes = [];
    const controllerEvents = [];
    const timeSignatureEvents = [];
    const keySignatureEvents = [];
    const tempoMetaEvents = [];
    const mksSysExPayloads = [];
    const mksTextMetaLines = [];
    const trackNameByIndex = new Map();
    for (let i = 0; i < header.trackCount; i += 1) {
        if (offset + 8 > midiBytes.length) {
            diagnostics.push({
                code: "MIDI_INVALID_FILE",
                message: `Track chunk ${i + 1} header is truncated.`,
            });
            return { ok: false, xml: "", diagnostics, warnings };
        }
        if (readAscii(midiBytes, offset, 4) !== "MTrk") {
            diagnostics.push({
                code: "MIDI_INVALID_FILE",
                message: `Track chunk ${i + 1} is missing MTrk signature.`,
            });
            return { ok: false, xml: "", diagnostics, warnings };
        }
        const trackLength = readUint32Be(midiBytes, offset + 4);
        if (trackLength === null || offset + 8 + trackLength > midiBytes.length) {
            diagnostics.push({
                code: "MIDI_INVALID_FILE",
                message: `Track chunk ${i + 1} has invalid length.`,
            });
            return { ok: false, xml: "", diagnostics, warnings };
        }
        const trackData = midiBytes.slice(offset + 8, offset + 8 + trackLength);
        const summary = parseTrackSummary(trackData, i);
        if (summary.trackName) {
            trackNameByIndex.set(i, summary.trackName);
        }
        collectedNotes.push(...summary.notes);
        controllerEvents.push(...summary.controllerEvents.map((event) => ({ ...event, trackIndex: i })));
        timeSignatureEvents.push(...summary.timeSignatureEvents);
        keySignatureEvents.push(...summary.keySignatureEvents);
        tempoMetaEvents.push(...summary.tempoEvents);
        mksSysExPayloads.push(...summary.mksSysExPayloads);
        mksTextMetaLines.push(...summary.mksTextMetaLines);
        for (const note of summary.notes)
            trackChannelSet.add(`${i}:${note.channel}`);
        for (const [trackChannel, program] of summary.programByTrackChannel.entries()) {
            if (!programByTrackChannel.has(trackChannel)) {
                programByTrackChannel.set(trackChannel, program);
            }
        }
        warnings.push(...summary.parseWarnings);
        offset += 8 + trackLength;
    }
    const parsedMksTextMetadata = parseMksMidiTextMetadata(mksTextMetaLines);
    const title = ((_c = parsedMksTextMetadata.title) === null || _c === void 0 ? void 0 : _c.trim()) ||
        String((_d = options.title) !== null && _d !== void 0 ? _d : "").trim() ||
        "Imported MIDI";
    const quantizeGrid = quantizeGridOption === "auto"
        ? chooseBestImportQuantizeGrid(collectedNotes, header.ticksPerQuarter, tripletAwareQuantize)
        : quantizeGridOption;
    const quantized = quantizeImportedNotes(collectedNotes, header.ticksPerQuarter, quantizeGrid, tripletAwareQuantize);
    warnings.push(...quantized.warnings);
    const velocityScaledNotes = applyImportedControllerVelocityScale(quantized.notes, controllerEvents);
    const notesByTrackChannel = new Map();
    for (const note of velocityScaledNotes) {
        const key = `${note.trackIndex}:${note.channel}`;
        const bucket = (_e = notesByTrackChannel.get(key)) !== null && _e !== void 0 ? _e : [];
        bucket.push(note);
        notesByTrackChannel.set(key, bucket);
    }
    const normalizedTimeSignature = normalizeLeadingPickupTimeSignatureEvents(timeSignatureEvents, header.ticksPerQuarter);
    if (normalizedTimeSignature.normalized) {
        warnings.push({
            code: "MIDI_TIME_SIGNATURE_PICKUP_NORMALIZED",
            message: "Normalized leading pickup time signature (e.g. 1/8 at tick 0 followed by full meter).",
        });
    }
    const firstTimeSignature = (_f = normalizedTimeSignature.events[0]) !== null && _f !== void 0 ? _f : { tick: 0, beats: 4, beatType: 4 };
    const inferredKeySignature = keySignatureEvents.length
        ? null
        : inferKeySignatureFromImportedNotes(velocityScaledNotes);
    const firstKeySignature = (_g = keySignatureEvents
        .slice()
        .sort((a, b) => a.tick - b.tick)[0]) !== null && _g !== void 0 ? _g : {
        tick: 0,
        fifths: (_h = inferredKeySignature === null || inferredKeySignature === void 0 ? void 0 : inferredKeySignature.fifths) !== null && _h !== void 0 ? _h : 0,
        mode: (_j = inferredKeySignature === null || inferredKeySignature === void 0 ? void 0 : inferredKeySignature.mode) !== null && _j !== void 0 ? _j : "major",
    };
    const beats = Math.max(1, Math.round(firstTimeSignature.beats));
    const beatType = Math.max(1, Math.round(firstTimeSignature.beatType));
    const keyFifths = Math.max(-7, Math.min(7, Math.round(firstKeySignature.fifths)));
    const keyMode = firstKeySignature.mode === "minor" ? "minor" : "major";
    if (!keySignatureEvents.length && inferredKeySignature) {
        warnings.push({
            code: "MIDI_KEY_SIGNATURE_INFERRED",
            message: `MIDI key signature meta event was missing; inferred key signature (${keyFifths}, ${keyMode}).`,
        });
    }
    const sortedTempoEvents = tempoMetaEvents.slice().sort((a, b) => a.tick - b.tick);
    const tempoEvents = [];
    for (const event of sortedTempoEvents) {
        const tick = Math.max(0, Math.round(event.tick));
        const bpm = clampTempo(event.bpm);
        const prev = tempoEvents[tempoEvents.length - 1];
        if (prev && prev.tick === tick) {
            prev.bpm = bpm;
        }
        else {
            tempoEvents.push({ tick, bpm });
        }
    }
    const partGroups = Array.from(trackChannelSet)
        .map((entry) => {
        const [trackText, channelText] = entry.split(":");
        return {
            trackIndex: Math.max(0, Number.parseInt(trackText, 10) || 0),
            channel: Math.max(1, Math.min(16, Number.parseInt(channelText, 10) || 1)),
        };
    })
        .sort((a, b) => a.trackIndex === b.trackIndex ? a.channel - b.channel : a.trackIndex - b.trackIndex);
    const hadDrumChannel = partGroups.some((group) => group.channel === 10);
    if (hadDrumChannel) {
        warnings.push({
            code: "MIDI_DRUM_CHANNEL_SEPARATED",
            message: "Channel 10 was mapped to a dedicated drum part.",
        });
    }
    const xml = buildImportSkeletonMusicXml({
        title,
        movementTitle: parsedMksTextMetadata.movementTitle,
        composer: parsedMksTextMetadata.composer,
        quantizeGrid,
        divisionsOverride: quantized.divisions,
        ticksPerQuarter: header.ticksPerQuarter,
        beats,
        beatType,
        keyFifths,
        keyMode,
        tempoEvents,
        pickupTicks: normalizedTimeSignature.pickupTicks,
        partGroups,
        notesByTrackChannel,
        programByTrackChannel,
        warnings,
        debugImportMetadata,
        mksSysExMetadataXml: debugImportMetadata ? buildMidiSysExMiscXml(mksSysExPayloads) : "",
        sourceMetadataXml: sourceImportMetadata ? buildMidiSourceMiscXml(midiBytes) : "",
        trackNameByIndex,
        mksTextMetadata: parsedMksTextMetadata,
    });
    return {
        ok: diagnostics.length === 0,
        xml: prettyPrintXml(xml),
        diagnostics,
        warnings,
    };
};
exports.convertMidiToMusicXml = convertMidiToMusicXml;
const buildPlaybackEventsFromMusicXmlDoc = (doc, ticksPerQuarter, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const normalizedTicksPerQuarter = normalizeTicksPerQuarter(ticksPerQuarter);
    const mode = (_a = options.mode) !== null && _a !== void 0 ? _a : "playback";
    const applyMidiNuance = mode === "midi";
    const includeGraceProcessing = applyMidiNuance || options.includeGraceInPlaybackLikeMode === true;
    const includeOrnamentExpansion = applyMidiNuance || options.includeOrnamentInPlaybackLikeMode === true;
    const includeTieProcessing = applyMidiNuance || options.includeTieInPlaybackLikeMode === true;
    const applyDefaultDetache = applyMidiNuance || options.applyDefaultDetacheInPlaybackLikeMode === true;
    const graceTimingMode = (_b = options.graceTimingMode) !== null && _b !== void 0 ? _b : DEFAULT_GRACE_TIMING_MODE;
    const metricAccentEnabled = options.metricAccentEnabled === true;
    const metricAccentProfile = normalizeMetricAccentProfile(options.metricAccentProfile);
    const partNodes = Array.from(doc.querySelectorAll("score-partwise > part"));
    if (partNodes.length === 0)
        return { tempo: 120, events: [] };
    const channelMap = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_c = scorePart.getAttribute("id")) !== null && _c !== void 0 ? _c : "";
        if (!partId)
            continue;
        const midiChannelText = (_e = (_d = scorePart.querySelector("midi-instrument > midi-channel")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim();
        const midiChannel = midiChannelText ? Number.parseInt(midiChannelText, 10) : NaN;
        if (Number.isFinite(midiChannel) && midiChannel >= 1 && midiChannel <= 16) {
            channelMap.set(partId, midiChannel);
        }
    }
    const partNameById = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const partId = (_f = scorePart.getAttribute("id")) !== null && _f !== void 0 ? _f : "";
        if (!partId)
            continue;
        const rawName = (_j = (_h = (_g = scorePart.querySelector("part-name")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "";
        partNameById.set(partId, rawName || partId);
    }
    const drumPartMapByPartId = buildDrumPartMapByPartId(doc);
    const defaultTempo = 120;
    const tempo = clampTempo((_k = getFirstNumber(doc, "sound[tempo]")) !== null && _k !== void 0 ? _k : defaultTempo);
    const events = [];
    partNodes.forEach((part, partIndex) => {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18;
        const partId = (_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "";
        const fallbackChannel = (partIndex % 16) + 1 === 10 ? 11 : (partIndex % 16) + 1;
        const channel = (_b = channelMap.get(partId)) !== null && _b !== void 0 ? _b : fallbackChannel;
        let currentDivisions = 1;
        let currentBeats = 4;
        let currentBeatType = 4;
        let currentFifths = 0;
        let currentTransposeSemitones = 0;
        let currentVelocity = 80;
        let timelineDiv = 0;
        const tieChainByKey = new Map();
        const activeWedgeByNumber = new Map();
        const pendingGraceByVoice = new Map();
        const activeSlurByVoice = new Map();
        const voiceTimeShiftTicks = new Map();
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
            const measure = measures[measureIndex];
            const nextMeasure = (_c = measures[measureIndex + 1]) !== null && _c !== void 0 ? _c : null;
            const divisions = getFirstNumber(measure, "attributes > divisions");
            if (divisions && divisions > 0) {
                currentDivisions = divisions;
            }
            const beats = getFirstNumber(measure, "attributes > time > beats");
            const beatType = getFirstNumber(measure, "attributes > time > beat-type");
            if (beats && beats > 0 && beatType && beatType > 0) {
                currentBeats = beats;
                currentBeatType = beatType;
            }
            const fifths = getFirstNumber(measure, "attributes > key > fifths");
            if (fifths !== null) {
                currentFifths = Math.max(-7, Math.min(7, Math.round(fifths)));
            }
            const hasTranspose = Boolean(measure.querySelector("attributes > transpose > chromatic")) ||
                Boolean(measure.querySelector("attributes > transpose > octave-change"));
            if (hasTranspose) {
                const chromatic = (_d = getFirstNumber(measure, "attributes > transpose > chromatic")) !== null && _d !== void 0 ? _d : 0;
                const octaveChange = (_e = getFirstNumber(measure, "attributes > transpose > octave-change")) !== null && _e !== void 0 ? _e : 0;
                currentTransposeSemitones = Math.round(chromatic + octaveChange * 12);
            }
            let cursorDiv = 0;
            let measureMaxDiv = 0;
            const lastStartByVoice = new Map();
            const measureAccidentalByStepOctave = new Map();
            const keyAlterMap = keySignatureAlterByStep(currentFifths);
            for (const child of Array.from(measure.children)) {
                if (child.tagName === "backup" || child.tagName === "forward") {
                    const dur = getFirstNumber(child, "duration");
                    if (!dur || dur <= 0)
                        continue;
                    if (child.tagName === "backup") {
                        cursorDiv = Math.max(0, cursorDiv - dur);
                    }
                    else {
                        cursorDiv += dur;
                        measureMaxDiv = Math.max(measureMaxDiv, cursorDiv);
                    }
                    continue;
                }
                if (applyMidiNuance && child.tagName === "direction") {
                    currentVelocity = readDirectionVelocity(child, currentVelocity);
                    const wedgeDirective = readDirectionWedgeDirective(child);
                    for (const wedgeNumber of wedgeDirective.stops) {
                        activeWedgeByNumber.delete(wedgeNumber);
                    }
                    for (const start of wedgeDirective.starts) {
                        activeWedgeByNumber.set(start.number, start.kind);
                    }
                    continue;
                }
                if (child.tagName !== "note")
                    continue;
                const voice = (_h = (_g = (_f = child.querySelector("voice")) === null || _f === void 0 ? void 0 : _f.textContent) === null || _g === void 0 ? void 0 : _g.trim()) !== null && _h !== void 0 ? _h : "1";
                const isChord = Boolean(child.querySelector("chord"));
                const isRest = Boolean(child.querySelector("rest"));
                const isGrace = Boolean(child.querySelector("grace"));
                const durationDiv = getFirstNumber(child, "duration");
                if (!isGrace && (!durationDiv || durationDiv <= 0))
                    continue;
                const startDiv = isChord ? ((_j = lastStartByVoice.get(voice)) !== null && _j !== void 0 ? _j : cursorDiv) : cursorDiv;
                if (!isChord) {
                    lastStartByVoice.set(voice, startDiv);
                }
                if (!isRest) {
                    const partDrumMap = drumPartMapByPartId.get(partId);
                    const noteInstrumentId = (_m = (_l = (_k = child.querySelector(":scope > instrument")) === null || _k === void 0 ? void 0 : _k.getAttribute("id")) === null || _l === void 0 ? void 0 : _l.trim()) !== null && _m !== void 0 ? _m : "";
                    const hasUnpitched = Boolean(child.querySelector("unpitched"));
                    const pitchStep = (_q = (_p = (_o = child.querySelector("pitch > step")) === null || _o === void 0 ? void 0 : _o.textContent) === null || _p === void 0 ? void 0 : _p.trim()) !== null && _q !== void 0 ? _q : "";
                    const pitchOctave = getFirstNumber(child, "pitch > octave");
                    const explicitAlter = getFirstNumber(child, "pitch > alter");
                    const accidentalAlter = accidentalTextToAlter((_t = (_s = (_r = child.querySelector("accidental")) === null || _r === void 0 ? void 0 : _r.textContent) === null || _s === void 0 ? void 0 : _s.trim()) !== null && _t !== void 0 ? _t : "");
                    const drumByInstrumentId = noteInstrumentId && partDrumMap
                        ? partDrumMap.midiUnpitchedByInstrumentId.get(noteInstrumentId)
                        : undefined;
                    const isDrumContext = channel === 10 || hasUnpitched || drumByInstrumentId !== undefined;
                    let melodicStep = pitchStep;
                    let melodicOctave = pitchOctave;
                    let soundingMidi = null;
                    if (isDrumContext) {
                        if (drumByInstrumentId !== undefined) {
                            soundingMidi = drumByInstrumentId;
                        }
                        if (soundingMidi === null && hasUnpitched) {
                            const displayStep = (_z = (_w = (_v = (_u = child.querySelector("unpitched > display-step")) === null || _u === void 0 ? void 0 : _u.textContent) === null || _v === void 0 ? void 0 : _v.trim()) !== null && _w !== void 0 ? _w : (_y = (_x = child.querySelector("unpitched > step")) === null || _x === void 0 ? void 0 : _x.textContent) === null || _y === void 0 ? void 0 : _y.trim()) !== null && _z !== void 0 ? _z : "";
                            const displayOctave = (_0 = getFirstNumber(child, "unpitched > display-octave")) !== null && _0 !== void 0 ? _0 : getFirstNumber(child, "unpitched > octave");
                            const displayAlter = (_2 = (_1 = getFirstNumber(child, "unpitched > display-alter")) !== null && _1 !== void 0 ? _1 : getFirstNumber(child, "unpitched > alter")) !== null && _2 !== void 0 ? _2 : 0;
                            if (displayOctave !== null) {
                                melodicStep = displayStep || melodicStep;
                                melodicOctave = displayOctave;
                                soundingMidi = pitchToMidi(displayStep, Math.round(displayAlter), displayOctave);
                            }
                        }
                        if (soundingMidi === null && noteInstrumentId && partDrumMap) {
                            const instrumentName = (_3 = partDrumMap.instrumentNameById.get(noteInstrumentId)) !== null && _3 !== void 0 ? _3 : "";
                            soundingMidi = resolveDrumMidiFromInstrumentName(instrumentName);
                        }
                        if (soundingMidi === null && partDrumMap && partDrumMap.defaultMidiUnpitched !== null) {
                            soundingMidi = partDrumMap.defaultMidiUnpitched;
                        }
                        if (soundingMidi === null && pitchOctave !== null) {
                            const stepOctaveKey = `${pitchStep}${pitchOctave}`;
                            let drumAlter = 0;
                            if (explicitAlter !== null) {
                                drumAlter = Math.round(explicitAlter);
                                measureAccidentalByStepOctave.set(stepOctaveKey, drumAlter);
                            }
                            else if (accidentalAlter !== null) {
                                drumAlter = accidentalAlter;
                                measureAccidentalByStepOctave.set(stepOctaveKey, drumAlter);
                            }
                            else if (measureAccidentalByStepOctave.has(stepOctaveKey)) {
                                drumAlter = (_4 = measureAccidentalByStepOctave.get(stepOctaveKey)) !== null && _4 !== void 0 ? _4 : 0;
                            }
                            soundingMidi = pitchToMidi(pitchStep, drumAlter, pitchOctave);
                        }
                    }
                    else if (pitchOctave !== null) {
                        const stepOctaveKey = `${pitchStep}${pitchOctave}`;
                        let effectiveAlter = 0;
                        if (explicitAlter !== null) {
                            effectiveAlter = Math.round(explicitAlter);
                            measureAccidentalByStepOctave.set(stepOctaveKey, effectiveAlter);
                        }
                        else if (accidentalAlter !== null) {
                            effectiveAlter = accidentalAlter;
                            measureAccidentalByStepOctave.set(stepOctaveKey, effectiveAlter);
                        }
                        else if (measureAccidentalByStepOctave.has(stepOctaveKey)) {
                            effectiveAlter = (_5 = measureAccidentalByStepOctave.get(stepOctaveKey)) !== null && _5 !== void 0 ? _5 : 0;
                        }
                        else {
                            effectiveAlter = (_6 = keyAlterMap[pitchStep]) !== null && _6 !== void 0 ? _6 : 0;
                        }
                        const midi = pitchToMidi(pitchStep, effectiveAlter, pitchOctave);
                        if (midi !== null) {
                            soundingMidi = midi + currentTransposeSemitones;
                        }
                    }
                    if (soundingMidi !== null) {
                        if (soundingMidi < 0 || soundingMidi > 127) {
                            continue;
                        }
                        const articulation = applyMidiNuance
                            ? getNoteArticulationAdjustments(child)
                            : { velocityDelta: 0, durationRatio: 1, hasTenuto: false };
                        const metricAccentDelta = applyMidiNuance && metricAccentEnabled
                            ? getMetricAccentVelocityDelta(startDiv, currentDivisions, currentBeats, currentBeatType, metricAccentProfile)
                            : 0;
                        const velocity = clampVelocity(currentVelocity + articulation.velocityDelta + metricAccentDelta);
                        const voiceShiftTicks = applyMidiNuance ? (_7 = voiceTimeShiftTicks.get(voice)) !== null && _7 !== void 0 ? _7 : 0 : 0;
                        const startTicks = Math.max(0, Math.round(((timelineDiv + startDiv) / currentDivisions) * normalizedTicksPerQuarter) + voiceShiftTicks);
                        const baseDurTicks = Math.max(1, Math.round(((durationDiv !== null && durationDiv !== void 0 ? durationDiv : 1) / currentDivisions) * normalizedTicksPerQuarter));
                        const slurNumbers = applyMidiNuance
                            ? getSlurNumbers(child)
                            : { starts: [], stops: [] };
                        const activeSlurSet = (_8 = activeSlurByVoice.get(voice)) !== null && _8 !== void 0 ? _8 : new Set();
                        const noteUnderSlur = applyMidiNuance &&
                            (activeSlurSet.size > 0 || slurNumbers.starts.length > 0 || slurNumbers.stops.length > 0);
                        const tieFlags = includeTieProcessing ? getTieFlags(child) : { start: false, stop: false };
                        const shouldApplyDefaultDetache = applyDefaultDetache &&
                            !isGrace &&
                            !isChord &&
                            articulation.durationRatio >= 1 &&
                            !articulation.hasTenuto &&
                            !tieFlags.start &&
                            !tieFlags.stop &&
                            !noteUnderSlur;
                        const effectiveDurationRatio = shouldApplyDefaultDetache
                            ? DEFAULT_DETACHE_DURATION_RATIO
                            : articulation.durationRatio;
                        if (includeGraceProcessing && isGrace) {
                            const graceNode = child.querySelector("grace");
                            const hasSlash = ((_10 = (_9 = graceNode === null || graceNode === void 0 ? void 0 : graceNode.getAttribute("slash")) === null || _9 === void 0 ? void 0 : _9.trim().toLowerCase()) !== null && _10 !== void 0 ? _10 : "") === "yes" ||
                                Boolean(graceNode === null || graceNode === void 0 ? void 0 : graceNode.querySelector("slash"));
                            const weight = hasSlash ? 1 : 2;
                            const pending = (_11 = pendingGraceByVoice.get(voice)) !== null && _11 !== void 0 ? _11 : [];
                            pending.push({
                                midiNumber: soundingMidi,
                                velocity,
                                weight,
                            });
                            pendingGraceByVoice.set(voice, pending);
                            continue;
                        }
                        const legatoOverlapTicks = applyMidiNuance && !isChord && (noteUnderSlur || articulation.hasTenuto)
                            ? Math.max(1, Math.round(normalizedTicksPerQuarter / 32))
                            : 0;
                        const temporalAdjustments = applyMidiNuance && !isGrace
                            ? getTemporalExpressionAdjustments(child, baseDurTicks, normalizedTicksPerQuarter)
                            : { durationExtraTicks: 0, postPauseTicks: 0 };
                        const durTicks = Math.max(1, Math.round(baseDurTicks * effectiveDurationRatio) +
                            legatoOverlapTicks +
                            temporalAdjustments.durationExtraTicks);
                        const canExpandOrnament = includeOrnamentExpansion && !isDrumContext && !tieFlags.start && !tieFlags.stop;
                        const ornamentMidiSequence = canExpandOrnament
                            ? buildOrnamentMidiSequence(child, soundingMidi, durTicks, normalizedTicksPerQuarter, {
                                step: melodicStep,
                                octave: melodicOctave !== null && melodicOctave !== void 0 ? melodicOctave : 4,
                                keyAlterMap,
                                measureAccidentalByStepOctave,
                            })
                            : [soundingMidi];
                        const generatedEvents = [];
                        const pendingGrace = includeGraceProcessing ? (_12 = pendingGraceByVoice.get(voice)) !== null && _12 !== void 0 ? _12 : [] : [];
                        let eventStartTick = startTicks;
                        let effectiveDurTicks = durTicks;
                        if (includeGraceProcessing && pendingGrace.length > 0) {
                            const maxLeadByPrincipal = Math.max(pendingGrace.length, Math.round(baseDurTicks * 0.45));
                            const maxLeadByTempo = Math.max(pendingGrace.length, Math.round(normalizedTicksPerQuarter / 2));
                            const totalGraceTicks = Math.max(pendingGrace.length, Math.min(maxLeadByPrincipal, maxLeadByTempo));
                            const graceDurations = graceTimingMode === "classical_equal"
                                ? splitTicks(Math.max(durTicks, pendingGrace.length + 1), pendingGrace.length + 1).slice(0, pendingGrace.length)
                                : splitTicksWeighted(totalGraceTicks, pendingGrace.map((g) => g.weight));
                            const graceStartTick = graceTimingMode === "before_beat" ? Math.max(0, startTicks - totalGraceTicks) : startTicks;
                            let graceTick = graceStartTick;
                            for (let i = 0; i < pendingGrace.length; i += 1) {
                                const grace = pendingGrace[i];
                                const graceDur = Math.max(1, (_13 = graceDurations[i]) !== null && _13 !== void 0 ? _13 : 1);
                                generatedEvents.push({
                                    midiNumber: grace.midiNumber,
                                    startTicks: graceTick,
                                    durTicks: graceDur,
                                    channel,
                                    velocity: grace.velocity,
                                    trackId: partId || `part-${partIndex + 1}`,
                                    trackName: (_14 = partNameById.get(partId)) !== null && _14 !== void 0 ? _14 : (partId || `part-${partIndex + 1}`),
                                });
                                graceTick += graceDur;
                            }
                            if (graceTimingMode === "before_beat") {
                                eventStartTick = Math.max(eventStartTick, graceTick);
                            }
                            else if (graceTimingMode === "on_beat") {
                                eventStartTick = graceTick;
                                effectiveDurTicks = Math.max(1, durTicks - (graceTick - startTicks));
                            }
                            else {
                                const equalDurations = splitTicks(Math.max(durTicks, pendingGrace.length + 1), pendingGrace.length + 1);
                                eventStartTick = graceTick;
                                effectiveDurTicks = Math.max(1, (_15 = equalDurations[pendingGrace.length]) !== null && _15 !== void 0 ? _15 : 1);
                            }
                            pendingGraceByVoice.delete(voice);
                        }
                        const ornamentDurations = splitTicks(effectiveDurTicks, ornamentMidiSequence.length);
                        for (let i = 0; i < ornamentMidiSequence.length; i += 1) {
                            const ornamentMidi = ornamentMidiSequence[i];
                            const ornamentDurTicks = Math.max(1, (_16 = ornamentDurations[i]) !== null && _16 !== void 0 ? _16 : 1);
                            generatedEvents.push({
                                midiNumber: ornamentMidi,
                                startTicks: eventStartTick,
                                durTicks: ornamentDurTicks,
                                channel,
                                velocity,
                                trackId: partId || `part-${partIndex + 1}`,
                                trackName: (_17 = partNameById.get(partId)) !== null && _17 !== void 0 ? _17 : (partId || `part-${partIndex + 1}`),
                            });
                            eventStartTick += ornamentDurTicks;
                        }
                        const primaryEvent = generatedEvents[0];
                        if (!primaryEvent)
                            continue;
                        for (const wedgeKind of activeWedgeByNumber.values()) {
                            currentVelocity = clampVelocity(currentVelocity + (wedgeKind === "crescendo" ? 4 : -4));
                        }
                        if (includeTieProcessing) {
                            const tieKey = `${voice}|${channel}|${soundingMidi}`;
                            if (tieFlags.stop) {
                                const chained = tieChainByKey.get(tieKey);
                                if (chained) {
                                    chained.durTicks += primaryEvent.durTicks;
                                    chained.velocity = Math.max(chained.velocity, velocity);
                                }
                                else {
                                    events.push(primaryEvent);
                                }
                                if (!tieFlags.start) {
                                    tieChainByKey.delete(tieKey);
                                }
                                else {
                                    tieChainByKey.set(tieKey, chained !== null && chained !== void 0 ? chained : primaryEvent);
                                }
                            }
                            else {
                                events.push(...generatedEvents);
                                if (tieFlags.start) {
                                    tieChainByKey.set(tieKey, primaryEvent);
                                }
                                else {
                                    tieChainByKey.delete(tieKey);
                                }
                            }
                        }
                        else {
                            events.push(...generatedEvents);
                        }
                        if (applyMidiNuance) {
                            const nextSlurSet = new Set(activeSlurSet);
                            for (const slurStart of slurNumbers.starts)
                                nextSlurSet.add(slurStart);
                            for (const slurStop of slurNumbers.stops)
                                nextSlurSet.delete(slurStop);
                            if (nextSlurSet.size > 0) {
                                activeSlurByVoice.set(voice, nextSlurSet);
                            }
                            else {
                                activeSlurByVoice.delete(voice);
                            }
                            if (!isChord && temporalAdjustments.postPauseTicks > 0) {
                                const shiftedTicks = ((_18 = voiceTimeShiftTicks.get(voice)) !== null && _18 !== void 0 ? _18 : 0) + temporalAdjustments.postPauseTicks;
                                voiceTimeShiftTicks.set(voice, shiftedTicks);
                            }
                        }
                    }
                }
                if (!isChord && !isGrace && durationDiv) {
                    cursorDiv += durationDiv;
                }
                if (!isGrace && durationDiv) {
                    measureMaxDiv = Math.max(measureMaxDiv, cursorDiv, startDiv + durationDiv);
                }
            }
            timelineDiv += resolveMeasureAdvanceDiv(measure, measureMaxDiv, currentDivisions, currentBeats, currentBeatType, isImplicitMeasure(nextMeasure));
        }
    });
    return { tempo, events };
};
exports.buildPlaybackEventsFromMusicXmlDoc = buildPlaybackEventsFromMusicXmlDoc;
const buildPlaybackEventsFromXml = (xml, ticksPerQuarter) => {
    const doc = new DOMParser().parseFromString(xml, "application/xml");
    if (doc.querySelector("parsererror"))
        return { tempo: 120, events: [] };
    return (0, exports.buildPlaybackEventsFromMusicXmlDoc)(doc, ticksPerQuarter);
};
exports.buildPlaybackEventsFromXml = buildPlaybackEventsFromXml;

  },
  "core/staffClefPolicy.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pickStaffForClusterWithHysteresis = exports.pickStaffByPitchWithHysteresis = exports.chooseSingleClefByKeys = exports.shouldUseGrandStaffByRange = exports.STAFF_SPLIT_B3 = exports.STAFF_SPLIT_C4 = exports.LOWER_STAFF_HOLD_MAX = exports.UPPER_STAFF_HOLD_MIN = void 0;
exports.UPPER_STAFF_HOLD_MIN = 55;
exports.LOWER_STAFF_HOLD_MAX = 64;
exports.STAFF_SPLIT_C4 = 60;
exports.STAFF_SPLIT_B3 = 59;
const shouldUseGrandStaffByRange = (keys) => {
    if (!keys.length)
        return false;
    const minKey = Math.min(...keys);
    const maxKey = Math.max(...keys);
    return minKey <= exports.UPPER_STAFF_HOLD_MIN && maxKey >= exports.LOWER_STAFF_HOLD_MAX;
};
exports.shouldUseGrandStaffByRange = shouldUseGrandStaffByRange;
const chooseSingleClefByKeys = (keys) => {
    var _a, _b;
    if (!keys.length)
        return "G";
    const sorted = keys.slice().sort((a, b) => a - b);
    const minKey = (_a = sorted[0]) !== null && _a !== void 0 ? _a : exports.STAFF_SPLIT_C4;
    if (minKey >= exports.UPPER_STAFF_HOLD_MIN)
        return "G";
    const median = (_b = sorted[Math.floor(sorted.length / 2)]) !== null && _b !== void 0 ? _b : exports.STAFF_SPLIT_C4;
    return median < exports.STAFF_SPLIT_C4 ? "F" : "G";
};
exports.chooseSingleClefByKeys = chooseSingleClefByKeys;
const pickStaffByPitchWithHysteresis = (midiKey, previousStaff) => {
    if (previousStaff === 1) {
        return midiKey >= exports.UPPER_STAFF_HOLD_MIN ? 1 : 2;
    }
    if (previousStaff === 2) {
        return midiKey <= exports.LOWER_STAFF_HOLD_MAX ? 2 : 1;
    }
    return midiKey >= exports.STAFF_SPLIT_C4 ? 1 : 2;
};
exports.pickStaffByPitchWithHysteresis = pickStaffByPitchWithHysteresis;
const pickStaffForClusterWithHysteresis = (minClusterKey, maxClusterKey, previousStaff) => {
    if (previousStaff === 1) {
        return maxClusterKey >= exports.UPPER_STAFF_HOLD_MIN ? 1 : 2;
    }
    if (previousStaff === 2) {
        return minClusterKey <= exports.LOWER_STAFF_HOLD_MAX ? 2 : 1;
    }
    return maxClusterKey >= exports.STAFF_SPLIT_C4 ? 1 : 2;
};
exports.pickStaffForClusterWithHysteresis = pickStaffForClusterWithHysteresis;

  },
  "src/ts/beam-common.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.computeBeamAssignments = void 0;
const isBeamableTimedEvent = (info) => {
    if (!info || !info.timed || info.grace)
        return false;
    return info.levels > 0;
};
const computeBeamAssignments = (events, beatDiv, resolveInfo, options = {}) => {
    const assignmentByIndex = new Map();
    const infos = events.map((event) => resolveInfo(event));
    const flushGroup = (indices) => {
        const chordIndices = indices.filter((idx) => {
            const info = infos[idx];
            return info && info.chord && !info.grace;
        });
        if (chordIndices.length < 2)
            return;
        for (let gi = 0; gi < chordIndices.length; gi += 1) {
            const idx = chordIndices[gi];
            const info = infos[idx];
            if (!info || info.levels <= 0)
                continue;
            const state = gi === 0 ? "begin" : (gi === chordIndices.length - 1 ? "end" : "continue");
            assignmentByIndex.set(idx, { state, levels: info.levels });
        }
    };
    const hasExplicitBeamMode = infos.some((info) => info.timed && (info.explicitMode === "begin" || info.explicitMode === "mid"));
    if (!hasExplicitBeamMode) {
        let currentGroup = [];
        let cursorDiv = 0;
        const resolvedBeatDiv = Math.max(1, Math.round(beatDiv));
        const splitAtBeatBoundaryWhenImplicit = options.splitAtBeatBoundaryWhenImplicit === true;
        for (let i = 0; i < infos.length; i += 1) {
            const info = infos[i];
            if (splitAtBeatBoundaryWhenImplicit && info.timed) {
                const startsAtBeatBoundary = cursorDiv > 0 && cursorDiv % resolvedBeatDiv === 0;
                if (startsAtBeatBoundary) {
                    flushGroup(currentGroup);
                    currentGroup = [];
                }
            }
            if (!info.chord || !isBeamableTimedEvent(info)) {
                flushGroup(currentGroup);
                currentGroup = [];
                if (info.timed)
                    cursorDiv += Math.max(0, info.durationDiv);
                continue;
            }
            currentGroup.push(i);
            if (info.timed)
                cursorDiv += Math.max(0, info.durationDiv);
        }
        flushGroup(currentGroup);
        return assignmentByIndex;
    }
    let activeGroup = [];
    let cursorDiv = 0;
    const resolvedBeatDiv = Math.max(1, Math.round(beatDiv));
    for (let i = 0; i < infos.length; i += 1) {
        const info = infos[i];
        if (!info.timed) {
            flushGroup(activeGroup);
            activeGroup = [];
            continue;
        }
        const startsAtBeatBoundary = cursorDiv > 0 && cursorDiv % resolvedBeatDiv === 0;
        if (startsAtBeatBoundary) {
            flushGroup(activeGroup);
            activeGroup = [];
        }
        if (!isBeamableTimedEvent(info)) {
            flushGroup(activeGroup);
            activeGroup = [];
            continue;
        }
        if (info.explicitMode === "begin") {
            flushGroup(activeGroup);
            activeGroup = [i];
            cursorDiv += Math.max(0, info.durationDiv);
            continue;
        }
        if (info.explicitMode === "mid") {
            if (!activeGroup.length) {
                const prev = i > 0 ? infos[i - 1] : undefined;
                activeGroup = isBeamableTimedEvent(prev) ? [i - 1, i] : [i];
            }
            else {
                activeGroup.push(i);
            }
            cursorDiv += Math.max(0, info.durationDiv);
            continue;
        }
        if (activeGroup.length)
            activeGroup.push(i);
        else
            activeGroup = [i];
        cursorDiv += Math.max(0, info.durationDiv);
    }
    flushGroup(activeGroup);
    return assignmentByIndex;
};
exports.computeBeamAssignments = computeBeamAssignments;

  },
  "src/ts/sampleXml2.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sampleXml2 = void 0;
// AUTO-GENERATED by scripts/build.mjs from src/samples/musicxml/*.musicxml.
exports.sampleXml2 = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<score-partwise version=\"4.0\">\n <work>\n  <work-title>Imported MIDI</work-title>\n </work>\n <part-list>\n  <score-part id=\"P1\">\n   <part-name>Track 1 Ch 1</part-name>\n   <midi-instrument id=\"P1-I1\">\n    <midi-channel>1</midi-channel>\n    <midi-program>9</midi-program>\n   </midi-instrument>\n  </score-part>\n </part-list>\n <part id=\"P1\">\n  <measure number=\"1\">\n   <attributes>\n    <divisions>4</divisions>\n    <key>\n     <fifths>-3</fifths>\n     <mode>major</mode>\n    </key>\n    <time>\n     <beats>2</beats>\n     <beat-type>4</beat-type>\n    </time>\n    <staves>7</staves>\n    <clef number=\"1\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"2\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"3\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"4\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"5\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"6\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"7\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n   </attributes>\n   <direction>\n    <direction-type>\n     <metronome>\n      <beat-unit>quarter</beat-unit>\n      <per-minute>201</per-minute>\n     </metronome>\n    </direction-type>\n    <sound tempo=\"201\"/>\n   </direction>\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"src:midi:raw-encoding\">hex-v1</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-bytes\">6670</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-hex-length\">13340</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-chunks\">56</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-truncated\">0</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0001\">4D546864000000060000000100184D54726B000019F800FF58040202180800FF5902FD0000FF5103048E0B00FF031342656574686F76656E2053796D35204D6F763100C00800B007643C9043640C804340009043640C804340009043640C80434000903C64003F640C44640C804440009044640C80444000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0002\">9044640C804440009043640C4B640C804B4000904B640C804B4000904B640C804B400090486430803F400043400C9043640C804340009043640C804340009043640C803C4000434000484000903E64003B640C44640C804440009044640C804440009044640C804440009043640C4D640C804D4000904D64</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0003\">0C804D4000904D640C803E40004D4000434000904364003E64004A6430804340003B40003E400C904F640C804F4000904F640C804F4000904D640C804D40004A4000904B64003C640C3F640C803F4000903F640C803F40009041640C804B40004140003C4000904A64004364003B640C804A4000904F640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0004\">804F4000904F640C804F4000904D640C803B40004D4000904B64003C640C80434000903F640C803F4000903F640C803F40009041640C804B40003C4000414000904364003B64004A640C803B40004A4000902F64004A64004F64003B640C804A40004F40002F40003B4000904A64003B64004F64002F640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0005\">804340004A40003B40002F40004F4000903E64002F64004364004D64003B640C804340004D40003E40002F40003B4000903C64004364003F64004B64004B64003C6400306418803F40004B40003C40004340003C40004B4000304018904264004864003864002C6400486400426400386400386400206418</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0006\">803840004840004240003840002C4000424000484000384000204018903E64004764003764001F64002B64004F6418801F40003E40002B40003740184740004F406C903864002C640020640044640C802040002C4000444000384000902C640038640044640020640C804440003840002040002C40009020</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0007\">64004464002C640038640C802C4000444000384000204000901D640029640035640041648110803540002940004140001D400C9044640C804440009044640C804440009044640C804440009041640C3E640C803E4000903E640C803E4000903E640C803E4000903B640C38640C803840009038640C803840</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0008\">009038640C803840009037640C2B64001F640C801F40002B4000902B64001F640C802B40001F4000902B64001F640C803B40002B40004140001F4000902464003F64003064003C640C803F40009044640C803740002440003040004440003C40009044640C804440009044640C804440009041640C3E640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0009\">803E4000903E640C803E4000903E640C803E4000903B640C38640C803840009038640C803840009038640C803840009037640C1F64002B640C802B40001F4000901F64002B640C801F40002B4000901F64002B640C803B40002B40001F4000414000903C64003F640024640030640C803F40003C40009043</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0010\">64003F640C802440004340003040003740003F4000903F640043640048640C804340003F4000484000903C64003F640048640C803C40003F4000484000904864004164003E640C30640024640C802440003040009030640024640C803040002440009024640030640C804840002440003040003E40009030</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0011\">640047640024640C804140004740009044640047640041640C804740004440002440003040004140009044640047640041640C80474000444000414000904A64003E640041640C804A40003E4000414000904A64003F640043640C30640024640C802440003040009030640024640C803040002440009030</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0012\">640024640C804A40002440003040009030640048640024640C804840004340003F4000904864003F640043640C803F4000484000244000304000434000904364004864003F640C804840004340003F4000904B64003C64003F640C804B40003C40003F4000904464002464004164003064004B640C804140</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0013\">004440004B4000904464004164004A640C803040004440004140002440004A4000904A640041640044640C804140004A4000444000904D64003B640041640C804D4000414000902464004364003064004D640046640C804640004340003B40004D4000904364004C640046640C8030400043400024400046</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0014\">40004C4000904664004C640043640C804C4000464000434000904F64004364003A640C804F40004340003A4000904F640030640048640024640044640C804840004F4000444000904D64003C640038640C803040003C40002440004D4000384000904D64003C640038640C804D40003C4000384000905064</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0015\">0035640038640C80354000384000504000902464003A640030640050640040640C805040003A4000404000904064004F64003A640C804F40004040002440003A4000304000904064004F64003A640C804040004F40003A4000903764003A640052640C803A4000524000374000902464003C640030640052</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0016\">640041640C805240003C4000414000905064004164003C640C804140005040002440003040003C4000904164005064003C640C805040003C4000414000903C640054640038640C805440003840003C40009054640030640041640044640024640C805440004440004140009053640041640044640C802440</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0017\">004140003040005340004440009044640053640041640C80534000444000414000903E640041640056640C804140003E4000564000905464002464003F640043640030640C803F4000434000544000304000903364004864003F640030640057640C805740004840003F4000334000304000903064003F64</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0018\">0048640033640057640C805740003F4000484000304000334000905764003364004864003F640030640C803040004840005740003340003F4000905464003F640048640030640033640C805440003F4000484000334000304000904F64004864003064003364003F640C804F40003340003F400048400030</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0019\">4000903364004864003F64003064004F640C804F40004840003F4000334000304000903064003364003F64004F640048640C804840003340003F40003040004F4000904864003064004B64003F640033640C804B40003040003F4000334000484000903364004864003064003F640C803040004840003340</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0020\">003F4000904864003064003F640033640043640C804840003040003F4000434000334000904864003364004364003064003F640C804840003040003F4000334000434000903F640030640048640033640C803040004840003F4000334000903F64003364004864003064003C640C803C4000484000304000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0021\">3340003F4000904864003364003064003C64003F640C803F40003340003040004840003C4000904864003C64003F640030640033640C803340002440004840003C40003040003F4000903264001F64003564003B64004764003E64002B640C803540003B40003240003E4000474000903564003564005964</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0022\">004D640032640032640C803240005940004D4000354000324000354000904A640056640032640035640C803240005640003540004A4000903564004A640032640056640C803540004A40003240005640009053640032640032640035640047640032640035640035640C8035400047400032400035400032</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0023\">4000354000324000534000904364003264003264003564003564003264004F640035640C803240003240003540004340004F4000354000354000324000904164004D640032640035640C803240003540004D4000414000903564004D640041640032640C804140004D4000324000354000904A64003E6400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0024\">35640032640C803E40003540003240004A4000903264004764003564003B640032640035640C803540003B40003240003540003240004740009035640032640043640037640C803740003240004340003540009032640035640041640C80354000324000414000903564003E640032640C801F40003E4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0025\">2B4000324000354000903264003264003564002B64003564001F64003B640C803540002B40003240003240001F40003540003B4000903064003364003C640024640C803C4000334000304000244000903C640033640024640030640C803040003C4000334000244000903C640030640033640024640C8024</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0026\">40003C4000304000334000904B640057640036640033640030640024640C802440003640003340004B4000574000304000903064004B640033640036640024640057640C805740003340003640003040004B4000244000904B640033640024640030640036640057640C803040004B400033400024400036</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0027\">40005740009048640024640030640033640036640054640C805440003040003340004840002440003640009045640051640024640033640036640030640C803040002440003340004540005140003640009030640051640024640036640033640045640C8045400024400036400030400051400033400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0028\">45640033640024640030640036640051640C80304000454000334000244000364000514000904264002464003064003364003664004E640C804E4000304000334000424000244000364000903F64004B640024640033640036640030640C803040002440003340003F40004B4000364000903064004B6400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0029\">2464003664003364003F640C803F40002440003640003040004B4000334000903F64004B640024640033640036640030640C803040002440003340003F40004B4000364000903C640033640030640048640036640024640C804840003C400033400030400036400024400090306400456400246400366400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0030\">33640039640C803940002440003640003040004540003340009039640045640024640033640036640030640C803040002440003340003940004540003640009030640045640024640036640033640039640C8039400024400036400030400045400033400090396400366400306400246400336400456418</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0031\">80244000394000364000304000334000454048904164004664003264003A6400356400266418803540002640003240003A4000414000464024903A640046640C803A4000464000904664003A640C803A4000464000904664003A640C803A4000464000903F6400336418803340183F400090416400356418</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0032\">80354018414000902E64003A6418802E40183A4000903F640043640046641880464000904B6418804340004B40003F4000904A6400416400446418804A4000904B6418804140004440004B4000903E64004464004D640C2E640C802E40004D4000904864002E640C802E4000902E640C804840004440002E</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0033\">40003E4000903364003F64004864004364188033400048400090466418803F4000434000464000904364003A64003F6418803A40003F4000903F6418803F4000434000903E6400446400416418803E4000903F6418804440004140003F4000903E640044640041640C2E640C802E4000414000903C64002E</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0034\">640C802E4000902E640C803C40004440002E40003E4000903C64004364003364003F6418803C4000334000903A6418804340003A40003F4000904664003F640043641880464000904B6418803F40004340004B4000904464004164004A6418804A4000904B6418804440004B4000414000904D6400446400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0035\">3E640C2E640C804D40002E4000902E640048640C802E4000902E640C804840003E40002E4000444000903364003F64004864004364188033400048400090466418803F4000464000434000904664004364003F64188046400090486418804340003F40004840009040640043640049641880494000904864</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0036\">18804040004840004340009046640040640043640C24640030640C804640003040002440009030640048640024640C803040002440009030640024640C80404000304000434000484000244000904164002964003C64004664003564188046400029400035400090446418804140004440003C4000904164</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0037\">0044640049641880494000904B6418804140004440004B4000904364004664004D6418804D4000904B6418804340004640004B40009046640043640049640C27640033640C80334000494000274000904B640027640033640C802740003340009027640033640C804340002740004640004B400033400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0038\">4464003864003F64002C6400496418802C400038400049400090486418804440003F4000484000904B64003F6418803F40004B4000904D6400416418804D4000414000904264004E640C2D640039640C803940004E40004240002D4000904164003964004D64002D640C803940002D4000902D640039640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0039\">803940004D40004140002D4000902D64003F64003964004B6418803940003F40004B40002D4000904D6400416418804D4000414000904E640042640C2E64003A640C803A40004240002E40004E4000903A64004164002E64004D640C803A40002E4000903A64002E640C803A40004140004D40002E400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0040\">3F64002E64004B64003A6418804B40002E40003A40003F4000904164004D6418804140004D4000904264004E640C2F64003B640C803B40004E40004240002F4000904164003B64004D64002F640C803B40002F4000902F64003B640C803B40004D40004140002F4000903F64002F64003B64004B6418803B</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0041\">40002F40004B40003F4000904164004D6418804140004D4000904E640042640C3064003C640C803C40004240004E4000304000904164003C64004D640030640C803C4000304000903064003C640C803C40004D4000414000304000903064003C64003F64004B6418803F40003C40004B4000304000904D64</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0042\">00416418804D4000414000904E640042640C3064003C640C803C40004240004E4000304000904D64003C640041640030640C803C4000304000903064003C640C803C40004140004D4000304000904264003C64003064004E6418803040003C40004E4000424000905164003C640045640030640C803C4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0043\">304000903C640030640C803C4000514000304000454000903E6400466400326400526430803E400032400C4640005240009054640C805440009052640032640026640C805240009050640C803240005040002640009050640027640033640C80504000904F640C802740004F4000334000904D640C804D40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0044\">00904B640C804B4000904B640035640029640C804B4000904A640C803540002940004A40009048640C80484000904A640C804A4000904D64002B640037640C804D4000904B640C802B40004B40003740009046640C804640009043640C80434000902C64003864004A640C804A40009048640C802C400038</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0045\">40004840009044640C804440009041640C80414000902E64003A640048640C804840009046640C802E40003A40004640009043640C80434000903F640C803F4000903A64002264002E640C51640045640C802240005140002E40004540003A40009046640052640C805240004640009051640045640C8051</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0046\">40004540009046640026640035640052640032640C804640005240003540009045640051640035640C803240005140002640004540003540009038640035640052640029640046640C805240003840004640009051640038640045640C803840005140003540004540002940009035640032640052640026</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0047\">640046640C805240003540004640009048640035640054640C803240003540002640004840005440009038640035640052640029640046640C805240003840004640009038640050640044640C805040003840003540002940004440009027640037640033640050640C80374000504000904F640037640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0048\">804F4000274000334000374000903764004D64002B64003A640C804D40003A4000903A64004B640C804B40002B40003A4000374000904B640029640038640035640C804B4000384000903864004A640C804A4000354000384000294000903C64003864004864002C640C803C4000484000904A64003C640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0049\">804A40003840003C40002C4000904D64002B640041640037640C804D4000414000903F64004B640C804B40003740003F40002B4000903A64004664002E640C804640003A40009043640037640C802E4000434000374000903E64002C64004A640038640C803E40004A4000903C640048640C803C40002C40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0050\">00384000484000903064003864003C640044640C803840004440009041640035640C803540003C4000304000414000902E64004864003C64003A640C803C40004840003A4000904664003A640C804640003A40002E4000904364002E640038640022640C80434000384000903F640033640C803F40002240</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0051\">002E4000334000903A64002E640C4664003E640035640C802E40004640003E40003A4000354000902E640038640022640041640052640C80414000384000524000903E640035640052640C803540003E40002E4000524000224000903F64002764004B6400336400376481108027400033400037400C3F40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0052\">004B4000904D64002E64003E64003A640C803A40004D40003E40002E4000902E64003E64003A64004D640C803A40003E40004D40002E4000902E64003E64003A64004D640C803A40003E40002E40004D4000903A64003F64002764004F640033648110802740003A400C4F40003F4000334000905264003A</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0053\">64004664002E64004164004A640C804A40005240003A40004640004140002E4000905264003A64004664004164004A64002E640C804140005240003A40004A40004640002E4000905264002E64004664003A64004164004A640C804A40004640003A40005240002E4000414000905264003364004664003A</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0054\">64004B6400436418804340004640003A40005240003340004B4024905264002E64004664003A64004164004A640C804A40004640003A40005240002E4000414000905264003A64004664004164004A64002E640C804140005240003A40004640004A40002E4000905264002E64004664003A64004164004A</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0055\">640C804A40004640003A40005240002E4000414000905264003A64004664004364004B6400336418804340005240003A40004640004B4000334024905664002E64004D64003A640046640C804D40003A40005640002E4000464000905664003A64004D64004664002E640C805640003A40004640004D4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0056\">2E4000905664003A64004D64004664002E640C805640003A40004640004D40002E4000905764003364004F64003F6400466418804F40003F4000574000334000464000FF2F00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"diag:count\">1</miscellaneous-field>\n     <miscellaneous-field name=\"diag:0001\">level=warn;code=MIDI_POLYPHONY_VOICE_ASSIGNED;fmt=midi;message=Auto voice split assigned 4 voices.</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"2\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0003</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00003C;tk1=0x000048</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000048;tk1=0x000054</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000054;tk1=0x000060</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <direction>\n    <direction-type>\n     <dynamics>\n      <mf/>\n     </dynamics>\n    </direction-type>\n    <offset>2</offset>\n    <staff>1</staff>\n   </direction>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"3\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000060;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000060;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00006C;tk1=0x000078</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000078;tk1=0x000084</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000084;tk1=0x000090</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"4\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000090;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000090;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000090;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00009C;tk1=0x0000A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0000A8;tk1=0x0000B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0000B4;tk1=0x0000C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"5\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"6\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000F0;tk1=0x000120</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000F0;tk1=0x000120</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0000FC;tk1=0x000108</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000108;tk1=0x000114</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000114;tk1=0x000120</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"7\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000120;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000120;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00012C;tk1=0x000138</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000138;tk1=0x000144</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000144;tk1=0x000150</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"8\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000150;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000150;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000150;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00015C;tk1=0x000168</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000168;tk1=0x000174</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000174;tk1=0x000180</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"9\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"10\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001B0;tk1=0x0001E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0001BC;tk1=0x0001C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0001C8;tk1=0x0001D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0001D4;tk1=0x0001E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"11\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001E0;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001E0;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0001EC;tk1=0x0001F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0001F8;tk1=0x000204</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000204;tk1=0x000210</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"12\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000210;tk1=0x000240</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000210;tk1=0x000240</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000210;tk1=0x00021C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00021C;tk1=0x000228</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000228;tk1=0x000234</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000234;tk1=0x000240</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"13\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000240;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000240;tk1=0x00024C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000240;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00024C;tk1=0x000258</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000258;tk1=0x000264</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000264;tk1=0x000270</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"14\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0010</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000270;tk1=0x00027C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x000270;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000270;tk1=0x00027C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"15\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0007</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"16\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x20;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"17\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000300;tk1=0x000330</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000300;tk1=0x000330</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"18\">\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"19\">\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"20\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x20;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x20;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x20;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"21\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1D;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003C0;tk1=0x0003F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003C0;tk1=0x0003F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003C0;tk1=0x0003F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003C0;tk1=0x0003F0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"22\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1D;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003F0;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003F0;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003F0;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0003F0;tk1=0x000420</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"23\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1D;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000420;tk1=0x000450</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000420;tk1=0x000450</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000420;tk1=0x000450</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000420;tk1=0x000450</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"24\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0003</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00045C;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000468;tk1=0x000474</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000474;tk1=0x000480</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"25\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000480;tk1=0x0004B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00048C;tk1=0x000498</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000498;tk1=0x0004A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0004A4;tk1=0x0004B0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"26\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0004B0;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0004B0;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0004BC;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0004C8;tk1=0x0004D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0004D4;tk1=0x0004E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"27\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0004E0;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0004E0;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0004E0;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0004EC;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0004EC;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0004F8;tk1=0x000504</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0004F8;tk1=0x000504</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"28\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000510;tk1=0x00051C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00051C;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000528;tk1=0x000534</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000534;tk1=0x000540</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"29\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000540;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00054C;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000558;tk1=0x000564</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"30\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000570;tk1=0x0005A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000570;tk1=0x0005A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00057C;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000588;tk1=0x000594</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000594;tk1=0x0005A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"31\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0005A0;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0005A0;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0005A0;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0005AC;tk1=0x0005B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0005AC;tk1=0x0005B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0005B8;tk1=0x0005C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0005B8;tk1=0x0005C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x1F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005C4;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005C4;tk1=0x0005D0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"32\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000D</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0005D0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0005D0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0005D0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0005D0;tk1=0x0005DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0005D0;tk1=0x0005DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0005DC;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0005DC;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0005E8;tk1=0x0005F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0005E8;tk1=0x0005F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0005E8;tk1=0x0005F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005F4;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005F4;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005F4;tk1=0x000600</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"33\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000600;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000600;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000600;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00060C;tk1=0x000618</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00060C;tk1=0x000618</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000618;tk1=0x000624</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000618;tk1=0x000624</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000624;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000624;tk1=0x000630</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"34\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000D</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000630;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000630;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000630;tk1=0x00063C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000630;tk1=0x00063C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00063C;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00063C;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00063C;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000648;tk1=0x000654</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000648;tk1=0x000654</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000648;tk1=0x000654</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000654;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000654;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000654;tk1=0x000660</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"35\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000660;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000660;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000660;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00066C;tk1=0x000678</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00066C;tk1=0x000678</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000678;tk1=0x000684</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000678;tk1=0x000684</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000684;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000684;tk1=0x000690</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"36\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000690;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000690;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000690;tk1=0x00069C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000690;tk1=0x00069C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000690;tk1=0x00069C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00069C;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00069C;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00069C;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006A8;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006A8;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006A8;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006B4;tk1=0x0006C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006B4;tk1=0x0006C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006B4;tk1=0x0006C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"37\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006C0;tk1=0x0006CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006C0;tk1=0x0006CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006C0;tk1=0x0006CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006CC;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006CC;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006CC;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006D8;tk1=0x0006E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006D8;tk1=0x0006E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0006D8;tk1=0x0006E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006E4;tk1=0x0006F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006E4;tk1=0x0006F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0006E4;tk1=0x0006F0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"38\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006F0;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006F0;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006F0;tk1=0x0006FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006F0;tk1=0x0006FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006F0;tk1=0x0006FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0006F0;tk1=0x0006FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006FC;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006FC;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0006FC;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000708;tk1=0x000714</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000708;tk1=0x000714</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000708;tk1=0x000714</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000714;tk1=0x000720</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000714;tk1=0x000720</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000714;tk1=0x000720</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"39\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000720;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000720;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000720;tk1=0x00072C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000720;tk1=0x00072C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000720;tk1=0x00072C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00072C;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00072C;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00072C;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000738;tk1=0x000744</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000738;tk1=0x000744</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000738;tk1=0x000744</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000744;tk1=0x000750</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000744;tk1=0x000750</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000744;tk1=0x000750</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"40\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000750;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000750;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000750;tk1=0x00075C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000750;tk1=0x00075C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000750;tk1=0x00075C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00075C;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00075C;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00075C;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000768;tk1=0x000774</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000768;tk1=0x000774</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000768;tk1=0x000774</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000774;tk1=0x000780</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000774;tk1=0x000780</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x52;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000774;tk1=0x000780</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"41\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000780;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000780;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000780;tk1=0x00078C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000780;tk1=0x00078C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000780;tk1=0x00078C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00078C;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00078C;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00078C;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000798;tk1=0x0007A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000798;tk1=0x0007A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000798;tk1=0x0007A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007A4;tk1=0x0007B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007A4;tk1=0x0007B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x54;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007A4;tk1=0x0007B0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"42\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0007B0;tk1=0x0007C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0007B0;tk1=0x0007C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007B0;tk1=0x0007BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007B0;tk1=0x0007BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007B0;tk1=0x0007BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007BC;tk1=0x0007C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007BC;tk1=0x0007C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007BC;tk1=0x0007C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007C8;tk1=0x0007D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007C8;tk1=0x0007D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007C8;tk1=0x0007D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007D4;tk1=0x0007E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007D4;tk1=0x0007E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x56;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0007D4;tk1=0x0007E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"43\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0007E0;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"44\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0015</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000810;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"45\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000840;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00084C;tk1=0x000858</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00084C;tk1=0x000858</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00084C;tk1=0x000858</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00084C;tk1=0x000858</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000858;tk1=0x000864</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000858;tk1=0x000864</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000858;tk1=0x000864</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000858;tk1=0x000864</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000858;tk1=0x000864</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000864;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000864;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000864;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000864;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000864;tk1=0x000870</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"46\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000870;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000870;tk1=0x00087C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000870;tk1=0x00087C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000870;tk1=0x00087C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000870;tk1=0x00087C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00087C;tk1=0x000888</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00087C;tk1=0x000888</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00087C;tk1=0x000888</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00087C;tk1=0x000888</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00087C;tk1=0x000888</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"47\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0015</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0008A0;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0008A0;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x59;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008B8;tk1=0x0008C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008B8;tk1=0x0008C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008B8;tk1=0x0008C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x56;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008B8;tk1=0x0008C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x56;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"48\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x001A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0008D0;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0008D0;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008D0;tk1=0x0008DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008DC;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008E8;tk1=0x0008F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008E8;tk1=0x0008F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008E8;tk1=0x0008F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008E8;tk1=0x0008F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008F4;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008F4;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008F4;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008F4;tk1=0x000900</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"49\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0013</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000900;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000900;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000924;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000924;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000924;tk1=0x000930</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"50\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000930;tk1=0x00093C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000930;tk1=0x00093C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000930;tk1=0x00093C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000930;tk1=0x00093C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000930;tk1=0x00093C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x1F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00093C;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000948;tk1=0x000954</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000948;tk1=0x000954</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000948;tk1=0x000954</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000948;tk1=0x000954</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000954;tk1=0x000960</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000954;tk1=0x000960</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000954;tk1=0x000960</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000954;tk1=0x000960</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"51\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x57;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"52\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000990;tk1=0x00099C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00099C;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"53\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"54\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009F0;tk1=0x0009FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009FC;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A08;tk1=0x000A14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A14;tk1=0x000A20</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"55\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"56\">\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"57\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"58\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000AC8;tk1=0x000AD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000AC8;tk1=0x000AD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"59\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0002</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000AE0;tk1=0x000AF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000AE0;tk1=0x000B10</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"60\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0002</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000B10;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000B10;tk1=0x000B40</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"61\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0002</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000B40;tk1=0x000B58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000B40;tk1=0x000B70</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"62\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000B70;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000B70;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000B70;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000B88;tk1=0x000BA0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"63\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BA0;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BA0;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000BA0;tk1=0x000BB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000BB8;tk1=0x000BD0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"64\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0007</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BD0;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BD0;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000BD0;tk1=0x000BE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000BDC;tk1=0x000BE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000BE8;tk1=0x000BF4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000BE8;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000BF4;tk1=0x000C00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"65\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C00;tk1=0x000C18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C00;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C00;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C00;tk1=0x000C18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000C18;tk1=0x000C30</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"66\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C30;tk1=0x000C48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C30;tk1=0x000C48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C30;tk1=0x000C60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000C48;tk1=0x000C60</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"67\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C60;tk1=0x000C78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C60;tk1=0x000C90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C60;tk1=0x000C90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000C78;tk1=0x000C90</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"68\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0007</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C90;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C90;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C90;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000C9C;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000CA8;tk1=0x000CB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000CA8;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000CB4;tk1=0x000CC0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"69\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000CC0;tk1=0x000CD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000CC0;tk1=0x000CD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000CC0;tk1=0x000CF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000CC0;tk1=0x000CF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000CD8;tk1=0x000CF0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"70\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000CF0;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000CF0;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000CF0;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000D08;tk1=0x000D20</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"71\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D20;tk1=0x000D50</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D20;tk1=0x000D50</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D20;tk1=0x000D38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000D38;tk1=0x000D50</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"72\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0007</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D50;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D50;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D50;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000D5C;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000D68;tk1=0x000D74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000D68;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000D74;tk1=0x000D80</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"73\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D80;tk1=0x000D98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D80;tk1=0x000DB0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000D80;tk1=0x000DB0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D80;tk1=0x000D98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000D98;tk1=0x000DB0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"74\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000DB0;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000DB0;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DB0;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000DC8;tk1=0x000DE0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"75\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000DE0;tk1=0x000E10</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000DE0;tk1=0x000E10</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000DF8;tk1=0x000E10</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"76\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E10;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E10;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E10;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000E1C;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000E1C;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000E28;tk1=0x000E34</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000E28;tk1=0x000E34</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000E28;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x24;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000E34;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000E34;tk1=0x000E40</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"77\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E40;tk1=0x000E70</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E40;tk1=0x000E70</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000E58;tk1=0x000E70</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"78\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E70;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000E70;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E70;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000E88;tk1=0x000EA0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"79\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000EA0;tk1=0x000ED0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000EA0;tk1=0x000ED0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000EA0;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000EB8;tk1=0x000ED0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"80\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000ED0;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000ED0;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000ED0;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x27;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000EDC;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000EDC;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x27;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000EE8;tk1=0x000EF4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000EE8;tk1=0x000EF4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000EE8;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x27;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000EF4;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000EF4;tk1=0x000F00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"81\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000F00;tk1=0x000F30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000F00;tk1=0x000F30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000F18;tk1=0x000F30</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"82\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F30;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F30;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000F48;tk1=0x000F60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000F48;tk1=0x000F60</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"83\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F60;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F60;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000F78;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000F78;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"84\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F90;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F90;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F90;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F90;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FA8;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FA8;tk1=0x000FC0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"85\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FC0;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FC0;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FD8;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FD8;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"86\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001008;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001008;tk1=0x001020</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"87\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001020;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001020;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001038;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001038;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"88\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001068;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001068;tk1=0x001080</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"89\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001080;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001080;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001098;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001098;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"90\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"91\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0010EC;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0010EC;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0010F8;tk1=0x001104</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0010F8;tk1=0x001104</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010F8;tk1=0x001110</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010F8;tk1=0x001110</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001104;tk1=0x001110</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001104;tk1=0x001110</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"92\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001128;tk1=0x001134</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001128;tk1=0x001134</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001134;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001134;tk1=0x001140</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>flat</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"93\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0004</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001140;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001140;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001140;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001140;tk1=0x001170</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"94\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0007</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001170;tk1=0x00117C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001170;tk1=0x00117C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00117C;tk1=0x001188</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001188;tk1=0x0011A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001188;tk1=0x0011A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001188;tk1=0x001194</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001194;tk1=0x0011A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"95\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x50;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0011A0;tk1=0x0011AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0011AC;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0011B8;tk1=0x0011C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0011C4;tk1=0x0011D0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"96\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011D0;tk1=0x0011E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011D0;tk1=0x0011E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0011D0;tk1=0x0011DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0011DC;tk1=0x0011E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0011E8;tk1=0x0011F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0011F4;tk1=0x001200</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"97\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001200;tk1=0x001218</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001200;tk1=0x001218</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001200;tk1=0x00120C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00120C;tk1=0x001218</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001218;tk1=0x001224</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001224;tk1=0x001230</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"98\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001230;tk1=0x001248</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001230;tk1=0x001248</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001230;tk1=0x00123C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00123C;tk1=0x001248</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001248;tk1=0x001254</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001254;tk1=0x001260</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"99\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001260;tk1=0x00126C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00126C;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001278;tk1=0x001284</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001284;tk1=0x001290</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"100\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x22;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00129C;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00129C;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012A8;tk1=0x0012B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012A8;tk1=0x0012B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012B4;tk1=0x0012C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012B4;tk1=0x0012C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"101\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0010</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012C0;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012C0;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012C0;tk1=0x0012CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012C0;tk1=0x0012CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012C0;tk1=0x0012CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012CC;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012CC;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012CC;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0012D8;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0012D8;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012D8;tk1=0x0012E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012D8;tk1=0x0012E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012D8;tk1=0x0012E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012E4;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012E4;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012E4;tk1=0x0012F0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"102\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0010</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012F0;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012F0;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012FC;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012FC;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x54;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012FC;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001308;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001308;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001308;tk1=0x001314</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001308;tk1=0x001314</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001308;tk1=0x001314</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001314;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x44;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001314;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x50;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001314;tk1=0x001320</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"103\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001320;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001320;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001320;tk1=0x00132C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x50;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001320;tk1=0x00132C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00132C;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00132C;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001338;tk1=0x001344</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001338;tk1=0x001344</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001344;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001344;tk1=0x001350</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"104\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001350;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001350;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001350;tk1=0x00135C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001350;tk1=0x00135C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x38;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00135C;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00135C;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2C;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001368;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001368;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001368;tk1=0x001374</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001368;tk1=0x001374</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"105\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000B</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001380;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001380;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001380;tk1=0x00138C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001380;tk1=0x00138C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00138C;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00138C;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001398;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001398;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001398;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"106\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0013B0;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0013B0;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0013B0;tk1=0x0013BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0013B0;tk1=0x0013BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0013BC;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0013BC;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0013C8;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0013C8;tk1=0x0013D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0013C8;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0013C8;tk1=0x0013D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013D4;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013D4;tk1=0x0013E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"107\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0013E0;tk1=0x0013F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0013E0;tk1=0x0013EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0013E0;tk1=0x0013EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0013E0;tk1=0x0013EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0013EC;tk1=0x0013F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0013EC;tk1=0x0013F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x22;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0013F8;tk1=0x001410</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0013F8;tk1=0x001410</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0013F8;tk1=0x001404</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0013F8;tk1=0x001404</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001404;tk1=0x001410</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001404;tk1=0x001410</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"108\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000D</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001410;tk1=0x001428</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001410;tk1=0x001428</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00141C;tk1=0x001428</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00141C;tk1=0x001428</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00141C;tk1=0x001428</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x22;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001428;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001428;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x38;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001428;tk1=0x001434</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001428;tk1=0x001434</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001428;tk1=0x001434</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001434;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001434;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x52;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001434;tk1=0x001440</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"109\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001440;tk1=0x001470</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001440;tk1=0x001470</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001440;tk1=0x001470</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001440;tk1=0x001470</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001440;tk1=0x001470</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"110\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001470;tk1=0x0014A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001470;tk1=0x0014A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001470;tk1=0x0014A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001470;tk1=0x0014A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001470;tk1=0x0014A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"111\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0014A0;tk1=0x0014D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0014A0;tk1=0x0014D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0014A0;tk1=0x0014D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0014A0;tk1=0x0014D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0014A0;tk1=0x0014D0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"112\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000E</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0014D0;tk1=0x0014DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0014D0;tk1=0x0014DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0014DC;tk1=0x0014E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0014DC;tk1=0x0014E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0014DC;tk1=0x0014E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0014DC;tk1=0x0014E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0014E8;tk1=0x0014F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0014E8;tk1=0x0014F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0014E8;tk1=0x0014F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0014E8;tk1=0x0014F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0014F4;tk1=0x001500</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0014F4;tk1=0x001500</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0014F4;tk1=0x001500</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0014F4;tk1=0x001500</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"113\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001500;tk1=0x001530</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001500;tk1=0x001530</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001500;tk1=0x001530</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001500;tk1=0x001530</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001500;tk1=0x001530</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"114\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001530;tk1=0x001560</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001530;tk1=0x001560</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001530;tk1=0x001560</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001530;tk1=0x001560</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001530;tk1=0x001560</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"115\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001560;tk1=0x001590</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001560;tk1=0x001590</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001560;tk1=0x001590</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001560;tk1=0x001590</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001560;tk1=0x001590</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"116\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0015</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001590;tk1=0x00159C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001590;tk1=0x00159C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001590;tk1=0x00159C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00159C;tk1=0x0015A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0015A8;tk1=0x0015B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0015B4;tk1=0x0015C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"117\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0015C0;tk1=0x0015D8</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"118\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0015FC;tk1=0x001608</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001608;tk1=0x001614</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001614;tk1=0x001620</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"119\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0006</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001620;tk1=0x001638</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"120\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00165C;tk1=0x001668</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00165C;tk1=0x001668</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00165C;tk1=0x001668</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00165C;tk1=0x001668</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00165C;tk1=0x001668</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001668;tk1=0x001674</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001668;tk1=0x001674</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001668;tk1=0x001674</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001668;tk1=0x001674</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001668;tk1=0x001674</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001674;tk1=0x001680</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001674;tk1=0x001680</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001674;tk1=0x001680</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001674;tk1=0x001680</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001674;tk1=0x001680</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n  </measure>\n  <measure number=\"121\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001680;tk1=0x001698</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001680;tk1=0x001698</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001680;tk1=0x001698</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001680;tk1=0x001698</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x57;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001680;tk1=0x001698</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <alter>-1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <alter>-1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>8</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>4</voice>\n    <staff>7</staff>\n   </note>\n   <barline location=\"right\">\n    <bar-style>light-heavy</bar-style>\n   </barline>\n  </measure>\n </part>\n</score-partwise>";

  },
  "src/ts/sampleXml.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sampleXml = void 0;
// AUTO-GENERATED by scripts/build.mjs from src/samples/musicxml/*.musicxml.
exports.sampleXml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<score-partwise version=\"4.0\">\n <work>\n  <work-title>Imported MIDI</work-title>\n </work>\n <part-list>\n  <score-part id=\"P1\">\n   <part-name>Track 1 Ch 1</part-name>\n   <midi-instrument id=\"P1-I1\">\n    <midi-channel>1</midi-channel>\n    <midi-program>6</midi-program>\n   </midi-instrument>\n  </score-part>\n </part-list>\n <part id=\"P1\">\n  <measure number=\"1\">\n   <attributes>\n    <divisions>4</divisions>\n    <key>\n     <fifths>0</fifths>\n     <mode>major</mode>\n    </key>\n    <time>\n     <beats>4</beats>\n     <beat-type>4</beat-type>\n    </time>\n    <staves>8</staves>\n    <clef number=\"1\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"2\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"3\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"4\">\n     <sign>G</sign>\n     <line>2</line>\n    </clef>\n    <clef number=\"5\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"6\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"7\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n    <clef number=\"8\">\n     <sign>F</sign>\n     <line>4</line>\n    </clef>\n   </attributes>\n   <direction>\n    <direction-type>\n     <metronome>\n      <beat-unit>quarter</beat-unit>\n      <per-minute>137</per-minute>\n     </metronome>\n    </direction-type>\n    <sound tempo=\"137\"/>\n   </direction>\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0002</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000048;tk1=0x000060</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000048;tk1=0x000060</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"src:midi:raw-encoding\">hex-v1</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-bytes\">7257</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-hex-length\">14514</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-chunks\">61</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-truncated\">0</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0001\">4D546864000000060000000100184D54726B00001C4300FF58040402180800FF5902000000FF510306AEC400FF0311427261686D73204E722E34206D6F762E3100C00500B00764489047640053641880474000534000904F640028640043640C2B640C802B40009037640C80374000903B640C802840004F</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0002\">40004340003B4000903464003B640C803B4000903B640040640C803B4000404000344000904364004C640040640C804340009047640043640C804740004C40004040004340009028640040640048640054640039640C30640C803040003940004040009039640C80394000903C640C805440004840003C40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0003\">00284000903C640034640039640C803C4000394000904064003C640C804040003C40003440009040640051640045640C804040004540009048640045640C80484000454000514000903F64002864003964004E640042640C2F640C802F40003F40003940009036640C803640009039640C804E4000424000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0004\">284000394000903664002F640039640C803640003940009039640040640C803940002F4000404000904264003F64004B640C804240009045640042640C804540003F40004240004B4000903764002864003B640047640053640C2F640C802F40003740003B40009037640C80374000903B640C8028400047</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0005\">40005340003B40009034640037640C80374000903764003B640C803740003B4000344000903B64005864004064003464004C640C804040003B40009043640040640C805840004340003440004C4000404000902864004C640048640040640024640C80284000902B640C802B40004840009034640C37640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0006\">804040003440002440004C4000374000903C640030640034640C803C40009040640037640C80404000304000344000374000903C64004364004F640C803C40009048640040640C804840004340004040004F4000902B64005364003E640023640047640C802B40009032640C803240003E40009037640C80</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0007\">374000903B640C802340004740005340003B4000903B640032640037640C803B4000374000903E64003B640C803E40003240003B4000904A64004364005664003E640C804340003E40009043640047640C804740005640004A4000434000902664004A64003E640041640C2D640C802D4000414000903564</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0008\">0C803540009039640C804A40003E4000394000264000903564003264003E640C803540003E40009041640039640C80414000394000324000904564004D64004164003E640C803E4000454000414000904A640041640C804A40004D4000414000902D640045640048640021640040640051640C802D400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0009\">34640C803440004840004040009039640C80394000903C640C805140002140003C4000454000903C640039640034640C803940003C4000903C640040640C803440003C40004040009040640048640045640054640C804840004040004540009045640048640C805440004540004840009042640027640039</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0010\">64004864003C640C30640C803040004240003940009036640C803640009039640C803940009036640039640030640C803940003C4000484000364000903964004764003C64003B640C803C40004740003040003940002740003B4000902764004864004264003C640C804240004840003C40009045640039</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0011\">640042640C80424000274000454000394000903C640028640039640054640048640C30640C803040003C40003940009034640C39640C803440003940009034640039640030640C80394000484000544000903C640045640039640051640C803440003C400039400030400051400028400045400090286400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0012\">4064003C64004C640C803C40004040004C4000903E64004564004A640040640C804540004A40002840003E4000404000903964002964004864003C640C30640C803940003040009035640C803540009039640C803940009033640039640C803C4000394000484000903B64003964003C640047640C804740</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0013\">003340003940002940003B40003C4000903C64004864003F640029640C804840003C40003F40009039640045640040640C80404000294000394000454000903964002A64003C640048640054640C30640C803C40003940003040009033640C39640C803340003940009039640030640C8054400039400048</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0014\">4000905164004564003C640039640C804540002A40005140003040003C4000394000903364003F64002A64003C64004B640C803C40003F40004B4000903E64004A64004564003E640C803E40003340004A40002A40004540003E4000903C64002B640040640048640C30640C803C40002B40004840004040</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0015\">00304000903C640043640040640C80434000404000904C640037640040640048640C804040003740004C40003C4000484000902C64003E640047640041640C35640C802C40003E4000414000474000354000903B640C803B4000904764003564004A64003B640C803540004740004A40003B400090456400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0016\">3C64004064002D640C34640C804540003C40002D4000404000344000903C640034640039640C80344000394000903E64003964004564003464004864003B640C803940004540004840003440003B40003C40003E4000902F64003B64003E640044640023640C802F40009032640C804440003B40003E4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0017\">3240002340009038640C32640044640047640C804740003840003240004440009034640030640045640040640024640C803440009032640C803240004540009043640034640C39640C80434000404000344000394000903464003A6400426418803040002440004240009024640040640030641880404000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0018\">2440003A4000344000304000903464002264004664003D64002A640C803440009031640C804640003140009043640034640C3A640C804340003D40003440002A40003A4000904264003D64003A640034641880424000224000902264002A6400406418803D40004040003A40002240003440002A4000902F</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0019\">64003B640023640037640C803740009037640034640C803B4000374000344000903764003B640C803B4000374000903B640040640047640C804040003B40002F4000474000234000904064002F640043640047640023640C80404000434000904064003B640C804040003B40009040640043640C80404000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0020\">4740004340009043640047640C804340002340002F4000903F64002F64003B6400426418803B40002F40003F40004740004240009045640C47640680474000454000904564068045400090436418804340009053640042640047640C805340004740009047640C80474000424000904764004F640C804F40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0021\">004740009045640040640C804040004540009028640034640043640C804340009042640C802840004240003440009043640C804340009042640C804240009024640030640040640C80404000904C64003F640C803F40003040004C40002440009048640040640C804840009054640C804040005440009021</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0022\">64002D6418802140002D4018904564002A640051640036640C804540005140009045640C802A4000364000904E640C804E40004540009042640043640C804240004340009042640027640033640C804240009040640C802740004040003340009042640C804240009040640C80404000903F64002F640023</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0023\">640C803F4000903D64004B640C803D40002F40002340004B4000903F640047640C803F40004740009053640C80534000901F64002B6418801F40002B40189058640034640028640C80584000904B640C803440004B4000284000903E64004064004C640C803E40004040004C4000904064003764003E640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0024\">803740003E4000404000903C640030640034640C803C4000903E640037640C803E4000304000344000374000903C6400406418803C40004040009043640024640030640C80434000904F640C802440004F4000304000903B64003E640047640C803E40003B4000474000903964003C640053640C803C4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0025\">394000534000903764001F64003B64002B640C803740003B4000903964003C640C803C40001F40003940002B4000903A64003E6418803A40003E4000905664002B640037640C805640009049640C802B4000494000374000904A64004264003E640C804A40004240003E4000903964003E640040640C803E</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0026\">4000404000394000903E640032640036640C803E40003640009040640039640C80404000324000394000903E6400426418803E40004240009042640032640026640C80424000904D640C803240004D4000264000904564003D640040640C803D4000454000404000903B64003E640051640C803E40003B40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0027\">00514000903964002164003D64002D640C803940003D4000903B64003E640C803E40002140003B40002D4000904064003C6418804040003C4000903964002D64005464003C6418803C40003940002D40005440009036640027640039640048640C2D640C803640002D40009036640C803940003640009039</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0028\">640C803940009036640039640033640C80394000484000364000904764003B64003C640039640C804740003940003B40002740003C4000904864003C640042640027640C804240004840003C40009045640039640042640C803940004540002740003340004240009054640039640026640048640036640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0029\">2D640C803640002D40009036640C803940003640009039640C803940009039640036640032640C80364000484000544000394000905164004564003C640039640C805140003940004540002640003C4000904E64003C640042640026640C804240003C40004E4000904264003C640045640048640C803C40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0030\">00264000454000484000324000424000903664002564003964004964003D640C2D640C802D40003640009036640C803640003940009039640C803940009039640036640031640C803640003D4000394000494000903964003C64004864003C640C803C40003940004840003C400025400090256400496400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0031\">4264003D640C804940004240003D40009039640045640042640C80254000454000314000394000424000903664002464003964004A640056640C2D640C802D40003640009036640C803640003940009039640C803940009039640030640036640C803640004A400039400056400090516400456400396400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0032\">3E640C803E4000244000394000454000514000902464004E64004264003E640C804E40004240003E4000904A64004264003E640045640C804540002440004240003040004A40003E4000903F64002364003964003664004B64002F640C803F400C3640003940004B4000903B640037640C803740003B4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0033\">904064003B64004F640C802F40004040002340004F40003B4000902F64004064003B640048640043640C804040004340009043640047640C804740004340004840009045640042640C80424000454000904E640048640045640C804E4000484000454000904264004764003F640C804240003F4000904564</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0034\">0042640C804740004540004240009043640040640C80434000404000904364004764004C640C803B40004340002F40004740004C4000903D64002364004064004564002F640C803D40004040009043640040640C80454000434000404000904264003F640C804240003F4000904264004564004B640C8023</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0035\">40004540002F40004B4000424000904064002B640043640047640C34640C80404000344000474000434000903764004F640053640C80374000903B640C803B4000903764003B640034640C803B40005340004F4000374000904E64004064003B640052640C804E40003440004040002B40003B4000524000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0036\">904F64002B640040640053640043640C804040005340004F4000434000904C64004F640043640047640C802B40004C40004F4000474000434000904064002D64003D640C34640C803440004040003D4000903964005864005B640C80394000903D640C803D4000903D640034640039640C803D4000584000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0037\">3940005B4000903D640055640058640040640C805540002D40003D4000344000584000404000905564004F64004064004364002D640C805540004F4000434000404000904C64004364004F640049640C804340004F40002D40004C4000494000903D64002E640040640C34640C803D400040400034400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0038\">4F64003764004C640C80374000903D640C803D4000903D64003A640034640C803D40004C40003A40004F4000904064004B64003D64004E640C804B40002E40004040003440003D40004E4000904064002E64004F64004364004C640C804F40004340004040004C4000904C640043640049640C804940002E</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0039\">40004C4000434000903A64002A64003D640C34640C803440003A40003D40009036640058640055640C80364000903D640C803D4000903664003464003A640C803640005840005540003A4000903A64005564005264003D640C803A40003440005540002A40005240003D4000904064002A64005264003D64</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0040\">004C64001E640C803D40004040005240004C4000904664004C640040640049640C804640001E40004C40002A4000404000494000904764003F64004264002F64002364004B6418804B40004240002F40004740003F4000234000904764002F64004364003B640C4F640C804F40009048640C804340004740</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0041\">009043640040640C804840004340002F40003B4000404000903B64004264002F640045640C4E640C804E40009047640C80424000454000903F640042640C803B40004240002F40003F4000474000904064002F64004364003B640C4C640C804C40009045640C80404000434000903D640040640C802F4000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0042\">4040003B40004540003D4000902164004264002D64003F640C4B640C802140004B40003F40002D4000902B64005364001F640C80424000904B640042640C801F40004B40002B40005340004240009058640043640047640C3064003C640C803040003C4000902A640036640C804740004340009045640048</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0043\">640C802A40003640004840005840004540009056640042640045640C2F64003B640C802F40003B40009028640034640C804540004240009043640047640C802840003440004740005640004340009054640043640040640C2D640039640C802D40003940009026640032640C804040004340009045640042</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0044\">640C80264000454000544000424000324000903E640053640042640C3764002B640C802B40003740003E40004240009025640040640031640C80534000404000904F64004064005264004C640043640C802540004040003140004F40004C4000524000434000904064002A64004F64004C64005264004364</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0045\">0036640C804F40004C4000404000434000524000904E64004A64005664003E640042640C805640003E40004E40004A4000424000904F640C3E64004A64004264004E640C802A40003E40003640004A40004F40004E4000424000904A64001E64003E64004264004E64002A640C804240004A40004E40003E</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0046\">4000904C64004064005564003D640049640C805540003D40004C4000404000494000904E640C4C64003D640040640049640C804E40004040001E40004C40002A40003D4000494000904064002A64004C64003664003D640049640C804940004C40004040003D4000904764005364004A64003B64003E640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0047\">803640004740002A40005340003E40004A40003B4000904A64001E64003E64004764004C64003B640036640C803E40004740004A40003B40004C4000904964003964005164003D640045640C805140003D40003640003940001E4000494000454000904964003664003D64002A64004564003964004A640C</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0048\">804540003940003D40004940004A4000904764004F64004364003764003B640C803640004F40002A40004740004340003B4000374000904364002A64003764001E64004764003B640049640C804740003B4000374000434000494000904564004E640042640036640039640C802A40004E40001E40004540</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0049\">00424000394000364000903664002A640042640045640039640047640C80474000424000454000364000394000904064004364003464003764004C640C804C40002A4000404000434000374000344000904364002A64003464001E640040640037640046640C80344000374000434000404000903E640036</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0050\">640032640042640C802A40003E40001E4000424000364000324000903664003E64002A640032640042640C804240003E4000464000324000904064003164004664003464003D640C804640003440003640003140002A40004040003D4000903D64002B64003164004764004064003464003B640C80404000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0051\">3440003D40003140003B4000903E64003264003B64002F640C802F40004740003240002B40003E40003B4000904364002364003764004A64004064002F640034640C80404000434000374000344000903664003E640032640042640C802340003240004A40003640002F40003E4000424000903664004664</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0052\">004264003E6400326400266418802640004240003E4000364000324000903D64003464003164002664004064001A640C804640009046640C804040003D40003440003140002640001A4000464000901F64003B64003E64003264002B6400476418803240001F40003B40002B40003E4000474000903B6400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0053\">5664003764004A6418805640004A400090556400496418805540003B4000494000374000905364003D64004764003964188053400047400090456400516418805140003D4000454000394000904F64003E6400436418803E40004F4000434000903E64004A64003D6418803D4000903B6418803B40009039</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0054\">6400366418803940004A40003640003E4000904964003D6400376400346418803440004940003740003D4000903664002664003A640046640C32640C803640003240009032640036640C804640003A4000904764003B640C803240004740002640003B4000364000902664004A64003E640C802640009032</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0055\">640036640C80364000324000903664003B640C803E40004A4000904264004E640C804240004E40003640009053640032640047640C803B4000903E64003B640C803E40003B4000904264003E640C805340004240004740003E4000904A640056640047640042640C804740005640004A4000324000424000</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0056\">905A64004E64003B64004A6400326418805A40004E40004A40003B4000324000905B64002464003464004F640C2B640037640C805B40004F40003440003740002B4000904E64003C64005A640034640C803C40009040640037640C804E40002440004040005A400034400037400090586400266400326400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0057\">4C640C36640C805840003640004C4000324000903C64005664003964004A640C803940003C4000904264003E640C804A40004240002640003E40005640009037640028640054640048640034640C80374000903764003C640C803C4000484000544000374000344000904064003C64004364004F640C8043</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0058\">40004040003C40009040640043640C80434000404000903764003C640C803740003C4000903C640040640C803C40004040009037640034640C80374000903764003C640C802840003C40004F40003440003740009033640027640045640051640037640C80374000903C640037640C804540002740003C40</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0059\">003340003740005140009037640026640032640054640048640C80374000903E640037640C803E40003740003240009037640032640C80484000544000374000903E640053640047640037640C803E4000324000534000264000474000374000903264004364002F64004F640023640C803240002F400090</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0060\">37640032640C80374000324000903264002F640C804F40003240004340002F4000903264003764003E64004A640C803240003E40002340004A4000374000903B64001D640037640029640047640C803740003B4000903B64003E640C803E40003B4000903B640037640C803B4000474000374000903B6400</miscellaneous-field>\n     <miscellaneous-field name=\"src:midi:raw-0061\">4364003E640C804340003B40002940001D40003E4000904264003A64002A64003D64001E6460804240003A40003D40002A40001E4000FF2F00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"diag:count\">1</miscellaneous-field>\n     <miscellaneous-field name=\"diag:0001\">level=warn;code=MIDI_POLYPHONY_VOICE_ASSIGNED;fmt=midi;message=Auto voice split assigned 4 voices.</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <direction>\n    <direction-type>\n     <dynamics>\n      <mf/>\n     </dynamics>\n    </direction-type>\n    <offset>12</offset>\n    <staff>1</staff>\n   </direction>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"2\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000060;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000060;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000060;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00006C;tk1=0x000078</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000078;tk1=0x000084</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000084;tk1=0x000090</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000090;tk1=0x0000A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000090;tk1=0x00009C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00009C;tk1=0x0000A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00009C;tk1=0x0000A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0000A8;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0000A8;tk1=0x0000B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0000A8;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0000B4;tk1=0x0000C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0000B4;tk1=0x0000C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"3\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0000C0;tk1=0x0000D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0000C0;tk1=0x0000D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0000C0;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0000CC;tk1=0x0000D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0000D8;tk1=0x0000E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0000E4;tk1=0x0000F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0000F0;tk1=0x000108</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0000F0;tk1=0x0000FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0000F0;tk1=0x0000FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0000FC;tk1=0x000108</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0000FC;tk1=0x000108</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000108;tk1=0x000114</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000108;tk1=0x000114</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000108;tk1=0x000120</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000114;tk1=0x000120</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000114;tk1=0x000120</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"4\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000120;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000120;tk1=0x000138</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000120;tk1=0x000138</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000120;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000120;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00012C;tk1=0x000138</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000138;tk1=0x000144</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000144;tk1=0x000150</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2F;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000150;tk1=0x000168</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000150;tk1=0x00015C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000150;tk1=0x00015C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00015C;tk1=0x000168</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00015C;tk1=0x000168</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000168;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000168;tk1=0x000174</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000168;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000174;tk1=0x000180</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000174;tk1=0x000180</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"5\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0013</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000180;tk1=0x000198</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000180;tk1=0x000198</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000180;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00018C;tk1=0x000198</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000198;tk1=0x0001A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0001A4;tk1=0x0001B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0001B0;tk1=0x0001C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0001B0;tk1=0x0001BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0001BC;tk1=0x0001C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0001BC;tk1=0x0001C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0001C8;tk1=0x0001E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0001C8;tk1=0x0001D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0001C8;tk1=0x0001D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0001C8;tk1=0x0001E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x58;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0001C8;tk1=0x0001E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0001D4;tk1=0x0001E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0001D4;tk1=0x0001E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"6\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001E0;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0001E0;tk1=0x0001EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001E0;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0001E0;tk1=0x0001F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4C;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0001E0;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0001EC;tk1=0x0001F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0001F8;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000204;tk1=0x000210</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000210;tk1=0x000228</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000210;tk1=0x000228</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000210;tk1=0x00021C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00021C;tk1=0x000228</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00021C;tk1=0x000228</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000228;tk1=0x000234</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000228;tk1=0x000240</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000228;tk1=0x000240</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000234;tk1=0x000240</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000234;tk1=0x000240</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"7\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0013</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x23;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000240;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000240;tk1=0x00024C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000240;tk1=0x000258</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000240;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x53;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000240;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00024C;tk1=0x000258</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000258;tk1=0x000264</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000264;tk1=0x000270</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000270;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000270;tk1=0x00027C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000270;tk1=0x00027C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00027C;tk1=0x000288</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000288;tk1=0x000294</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000288;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x56;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000288;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000294;tk1=0x0002A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"8\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0002A0;tk1=0x0002D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0002A0;tk1=0x0002D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0002A0;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0002A0;tk1=0x0002D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0002AC;tk1=0x0002B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0002B8;tk1=0x0002C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0002C4;tk1=0x0002D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0002D0;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0002D0;tk1=0x0002DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0002D0;tk1=0x0002DC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0002DC;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0002DC;tk1=0x0002E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0002E8;tk1=0x0002F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0002E8;tk1=0x0002F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0002E8;tk1=0x0002F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0002E8;tk1=0x000300</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x41;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0002F4;tk1=0x000300</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0002F4;tk1=0x000300</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"9\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x21;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000300;tk1=0x000330</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000300;tk1=0x00030C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000300;tk1=0x000330</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000300;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000300;tk1=0x000330</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00030C;tk1=0x000318</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000318;tk1=0x000324</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000324;tk1=0x000330</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000330;tk1=0x000348</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000330;tk1=0x00033C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000330;tk1=0x00033C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00033C;tk1=0x000348</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00033C;tk1=0x000348</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000348;tk1=0x000354</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000348;tk1=0x000354</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000348;tk1=0x000354</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000348;tk1=0x000360</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000354;tk1=0x000360</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000354;tk1=0x000360</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"10\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000360;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000360;tk1=0x000378</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000360;tk1=0x00039C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000360;tk1=0x000378</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000360;tk1=0x00039C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00036C;tk1=0x000378</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000378;tk1=0x000384</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000384;tk1=0x000390</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000390;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000390;tk1=0x00039C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000390;tk1=0x00039C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00039C;tk1=0x0003A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0003A8;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0003A8;tk1=0x0003B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0003B4;tk1=0x0003C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"11\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x0003C0;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0003C0;tk1=0x0003D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0003C0;tk1=0x0003D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x0003C0;tk1=0x0003FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x0003C0;tk1=0x0003FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0003CC;tk1=0x0003D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0003D8;tk1=0x0003F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0003E4;tk1=0x0003F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0003F0;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0003F0;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0003F0;tk1=0x0003FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0003FC;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0003FC;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0003FC;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0003FC;tk1=0x000408</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000408;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000408;tk1=0x000414</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000408;tk1=0x000414</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000408;tk1=0x000414</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000414;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000414;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000414;tk1=0x000420</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000414;tk1=0x000420</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"12\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000420;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000420;tk1=0x000438</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000420;tk1=0x00045C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000420;tk1=0x00045C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00042C;tk1=0x000438</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x35;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000438;tk1=0x000444</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000444;tk1=0x000450</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x33;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000450;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000450;tk1=0x00045C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00045C;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00045C;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00045C;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00045C;tk1=0x000468</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000468;tk1=0x000480</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000468;tk1=0x000474</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000468;tk1=0x000474</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000468;tk1=0x000474</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000474;tk1=0x000480</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000474;tk1=0x000480</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000474;tk1=0x000480</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"13\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000480;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000480;tk1=0x000498</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000480;tk1=0x000498</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000480;tk1=0x0004BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000480;tk1=0x0004BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00048C;tk1=0x000498</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000498;tk1=0x0004B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0004A4;tk1=0x0004B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x30;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0004B0;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0004B0;tk1=0x0004BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0004BC;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0004BC;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0004BC;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x51;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0004BC;tk1=0x0004C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0004C8;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0004C8;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0004C8;tk1=0x0004D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0004C8;tk1=0x0004D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0004C8;tk1=0x0004D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0004D4;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0004D4;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0004D4;tk1=0x0004E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0004D4;tk1=0x0004E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"14\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0004E0;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0004E0;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0004E0;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0004E0;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0004EC;tk1=0x0004F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0004F8;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0004F8;tk1=0x000504</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0004F8;tk1=0x000504</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000504;tk1=0x000510</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2C;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x41;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000510;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x35;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00051C;tk1=0x000528</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000528;tk1=0x000534</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x35;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000534;tk1=0x000540</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000534;tk1=0x000540</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000534;tk1=0x000540</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000534;tk1=0x000540</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"15\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000540;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000540;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000540;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000540;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00054C;tk1=0x000558</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000558;tk1=0x000564</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000558;tk1=0x000564</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000558;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000564;tk1=0x000570</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x23;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000570;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000570;tk1=0x00057C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000570;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000570;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x44;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000570;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00057C;tk1=0x000588</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x38;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000588;tk1=0x0005A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000594;tk1=0x0005A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x44;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000594;tk1=0x0005A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000594;tk1=0x0005A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"16\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x0005A0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x0005A0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0005A0;tk1=0x0005AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x0005A0;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0005A0;tk1=0x0005B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0005AC;tk1=0x0005B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0005B8;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0005B8;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0005C4;tk1=0x0005D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0005D0;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0005D0;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0005D0;tk1=0x0005E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0005E8;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0005E8;tk1=0x000600</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0005E8;tk1=0x000600</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"17\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0010</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x22;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000600;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000600;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000600;tk1=0x00060C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000600;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000600;tk1=0x000618</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x31;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00060C;tk1=0x000618</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000618;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000618;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000624;tk1=0x000630</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000630;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000630;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000630;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000630;tk1=0x000648</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x22;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000648;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000648;tk1=0x000660</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000648;tk1=0x000660</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"18\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000660;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000660;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000660;tk1=0x00066C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000660;tk1=0x000678</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00066C;tk1=0x000678</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00066C;tk1=0x000678</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000678;tk1=0x000684</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000678;tk1=0x000684</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000684;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000684;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000684;tk1=0x000690</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x23;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000690;tk1=0x0006C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000690;tk1=0x0006C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000690;tk1=0x00069C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000690;tk1=0x00069C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x000690;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00069C;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00069C;tk1=0x0006A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0006A8;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0006A8;tk1=0x0006B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0006B4;tk1=0x0006C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0006B4;tk1=0x0006C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"19\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000D</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0006C0;tk1=0x0006D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0003;tk0=0x0006D8;tk1=0x0006EA</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0006;dd=0x0001;tk0=0x0006E4;tk1=0x0006EA</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0007;dd=0x0001;tk0=0x0006EA;tk1=0x0006F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0006F0;tk1=0x000708</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000708;tk1=0x000720</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000708;tk1=0x000714</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000708;tk1=0x000714</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000714;tk1=0x000720</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>3</duration>\n    <type>eighth</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>1</duration>\n    <type>16th</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>1</duration>\n    <type>16th</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>7</duration>\n    <type>quarter</type>\n    <dot/>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"20\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000720;tk1=0x00072C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000720;tk1=0x00072C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00072C;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00072C;tk1=0x000738</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x28;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000738;tk1=0x000750</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000738;tk1=0x000750</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000738;tk1=0x000744</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000744;tk1=0x000750</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000750;tk1=0x00075C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00075C;tk1=0x000768</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000768;tk1=0x000780</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000768;tk1=0x000780</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000768;tk1=0x000774</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000774;tk1=0x000780</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000774;tk1=0x000780</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"21\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000780;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000780;tk1=0x00078C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x54;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00078C;tk1=0x000798</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x21;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000798;tk1=0x0007B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000798;tk1=0x0007B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0007C8;tk1=0x0007E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0007C8;tk1=0x0007E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0007C8;tk1=0x0007D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0007C8;tk1=0x0007D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0007D4;tk1=0x0007E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"22\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000F</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0007E0;tk1=0x0007EC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0007EC;tk1=0x0007F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x27;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0007F8;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0007F8;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0007F8;tk1=0x000804</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000804;tk1=0x000810</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000810;tk1=0x00081C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00081C;tk1=0x000828</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000828;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000828;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000828;tk1=0x000834</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000834;tk1=0x000840</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"23\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0009</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000840;tk1=0x00084C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00084C;tk1=0x000858</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x1F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000858;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000858;tk1=0x000870</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x28;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000888;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000888;tk1=0x0008A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x58;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000888;tk1=0x000894</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000894;tk1=0x0008A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"24\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0011</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0008A0;tk1=0x0008AC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0008AC;tk1=0x0008B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0008B8;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0008B8;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0008B8;tk1=0x0008C4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0008C4;tk1=0x0008D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0008D0;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0008D0;tk1=0x0008E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0008E8;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0008E8;tk1=0x000900</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0008E8;tk1=0x0008F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0008F4;tk1=0x000900</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"25\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000900;tk1=0x00090C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00090C;tk1=0x000918</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x1F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000918;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000918;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000918;tk1=0x000924</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000924;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000924;tk1=0x000930</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000930;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000930;tk1=0x000948</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000948;tk1=0x000960</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000948;tk1=0x000960</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000948;tk1=0x000954</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000954;tk1=0x000960</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"26\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0011</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000960;tk1=0x00096C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00096C;tk1=0x000978</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000978;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000978;tk1=0x000984</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000984;tk1=0x000990</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000990;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000990;tk1=0x0009A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0009A8;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0009A8;tk1=0x0009C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0009A8;tk1=0x0009B4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4D;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0009B4;tk1=0x0009C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"27\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0012</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0009C0;tk1=0x0009CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x51;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0009CC;tk1=0x0009D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x21;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0009D8;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0009D8;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0009D8;tk1=0x0009E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0009E4;tk1=0x0009F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0009F0;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0009F0;tk1=0x000A08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000A08;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000A08;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000A08;tk1=0x000A20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000A08;tk1=0x000A20</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"28\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0015</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000A20;tk1=0x000A68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A20;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x000A20;tk1=0x000A44</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000A20;tk1=0x000A5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000A2C;tk1=0x000A38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A38;tk1=0x000A44</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000A44;tk1=0x000A50</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x33;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000A50;tk1=0x000A80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000A50;tk1=0x000A5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000A50;tk1=0x000A5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000A5C;tk1=0x000A68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000A5C;tk1=0x000A68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000A5C;tk1=0x000A68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000A5C;tk1=0x000A68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x27;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000A68;tk1=0x000A80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000A68;tk1=0x000A74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000A68;tk1=0x000A74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000A68;tk1=0x000A74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000A74;tk1=0x000A80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000A74;tk1=0x000A80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000A74;tk1=0x000A80</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"29\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000A80;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000A80;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x000A80;tk1=0x000AA4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000A80;tk1=0x000ABC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x54;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000A80;tk1=0x000ABC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000A8C;tk1=0x000A98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000A98;tk1=0x000AA4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000AA4;tk1=0x000AB0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000AB0;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000AB0;tk1=0x000ABC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000AB0;tk1=0x000ABC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x51;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000ABC;tk1=0x000AC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x26;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000AC8;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000AC8;tk1=0x000AD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000AC8;tk1=0x000AD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000AC8;tk1=0x000AD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000AD4;tk1=0x000AE0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"30\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x25;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000AE0;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000AE0;tk1=0x000AF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x000AE0;tk1=0x000B04</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000AE0;tk1=0x000B1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000AE0;tk1=0x000B1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000AEC;tk1=0x000AF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000AF8;tk1=0x000B04</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000B04;tk1=0x000B10</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x31;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000B10;tk1=0x000B40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000B10;tk1=0x000B1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000B10;tk1=0x000B1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B1C;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B1C;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B1C;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B1C;tk1=0x000B28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x25;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000B28;tk1=0x000B40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B28;tk1=0x000B34</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B28;tk1=0x000B34</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B28;tk1=0x000B34</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B34;tk1=0x000B40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B34;tk1=0x000B40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B34;tk1=0x000B40</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"31\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x24;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000B40;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000B40;tk1=0x000B58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x000B40;tk1=0x000B64</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000B40;tk1=0x000B7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x56;vel=0x4F;sd=0x0000;dd=0x000A;tk0=0x000B40;tk1=0x000B7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000B4C;tk1=0x000B58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000B58;tk1=0x000B64</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000B64;tk1=0x000B70</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x30;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000B70;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000B70;tk1=0x000B7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000B70;tk1=0x000B7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B7C;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B7C;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B7C;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x51;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000B7C;tk1=0x000B88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000B88;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B88;tk1=0x000B94</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B88;tk1=0x000B94</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000B88;tk1=0x000B94</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B94;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B94;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B94;tk1=0x000BA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000B94;tk1=0x000BA0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n    <tie type=\"start\"/>\n    <notations>\n     <tied type=\"start\"/>\n    </notations>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n    <tie type=\"stop\"/>\n    <notations>\n     <tied type=\"stop\"/>\n    </notations>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"32\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BA0;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000BA0;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000BA0;tk1=0x000BB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000BA0;tk1=0x000BB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000BA0;tk1=0x000BAC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000BA0;tk1=0x000BB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000BB8;tk1=0x000BC4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000BB8;tk1=0x000BC4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000BC4;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000BC4;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000BC4;tk1=0x000BD0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000BD0;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000BD0;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000BD0;tk1=0x000BDC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000BD0;tk1=0x000BDC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000BD0;tk1=0x000BE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000BDC;tk1=0x000BE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000BDC;tk1=0x000BE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000BE8;tk1=0x000BF4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000BE8;tk1=0x000BF4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000BF4;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000BF4;tk1=0x000C00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000BF4;tk1=0x000C00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"33\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C00;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x000C00;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000C00;tk1=0x000C0C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000C00;tk1=0x000C0C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C00;tk1=0x000C18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000C0C;tk1=0x000C18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000C0C;tk1=0x000C18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000C18;tk1=0x000C24</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000C18;tk1=0x000C24</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000C24;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000C24;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000C24;tk1=0x000C30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x23;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000C30;tk1=0x000C60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x000C30;tk1=0x000C60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000C30;tk1=0x000C3C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000C30;tk1=0x000C3C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000C30;tk1=0x000C48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C3C;tk1=0x000C48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C3C;tk1=0x000C48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000C48;tk1=0x000C54</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000C48;tk1=0x000C54</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000C54;tk1=0x000C60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000C54;tk1=0x000C60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000C54;tk1=0x000C60</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"34\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0019</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000C60;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C60;tk1=0x000C78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C60;tk1=0x000C78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000C60;tk1=0x000C78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000C6C;tk1=0x000C78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000C78;tk1=0x000C84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000C78;tk1=0x000C9C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000C78;tk1=0x000C9C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000C84;tk1=0x000C90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000C90;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000C90;tk1=0x000C9C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000C90;tk1=0x000C9C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C9C;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C9C;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C9C;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x52;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000C9C;tk1=0x000CA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000CA8;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000CA8;tk1=0x000CB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000CA8;tk1=0x000CB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000CA8;tk1=0x000CB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000CA8;tk1=0x000CB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000CB4;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000CB4;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000CB4;tk1=0x000CC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000CB4;tk1=0x000CC0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"35\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000CC0;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000CC0;tk1=0x000CD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000CC0;tk1=0x000CD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000CCC;tk1=0x000CD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000CD8;tk1=0x000CE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x58;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000CD8;tk1=0x000CFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x5B;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000CD8;tk1=0x000CFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000CE4;tk1=0x000CF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000CF0;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000CF0;tk1=0x000CFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000CF0;tk1=0x000CFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000CFC;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000CFC;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x55;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000CFC;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x58;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000CFC;tk1=0x000D08</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000D08;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D08;tk1=0x000D14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D08;tk1=0x000D14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D08;tk1=0x000D14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x55;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D08;tk1=0x000D14</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D14;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D14;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D14;tk1=0x000D20</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D14;tk1=0x000D20</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"36\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0017</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000D20;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D20;tk1=0x000D38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D20;tk1=0x000D38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000D2C;tk1=0x000D38</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000D38;tk1=0x000D44</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000D38;tk1=0x000D5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000D38;tk1=0x000D5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000D44;tk1=0x000D50</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000D50;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000D50;tk1=0x000D5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000D50;tk1=0x000D5C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000D5C;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000D5C;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000D5C;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000D5C;tk1=0x000D68</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2E;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000D68;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D68;tk1=0x000D74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D68;tk1=0x000D74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D68;tk1=0x000D74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000D68;tk1=0x000D74</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D74;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D74;tk1=0x000D80</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000D74;tk1=0x000D80</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"37\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0019</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x000C;tk0=0x000D80;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D80;tk1=0x000D98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000D80;tk1=0x000D98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000D8C;tk1=0x000D98</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000D98;tk1=0x000DA4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x55;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000D98;tk1=0x000DBC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x58;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000D98;tk1=0x000DBC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000DA4;tk1=0x000DB0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000DB0;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000DB0;tk1=0x000DBC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000DB0;tk1=0x000DBC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3A;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000DBC;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000DBC;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x52;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000DBC;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x55;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000DBC;tk1=0x000DC8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000DC8;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000DC8;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000DC8;tk1=0x000DD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000DC8;tk1=0x000DD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000DC8;tk1=0x000DD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000DC8;tk1=0x000DD4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000DD4;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000DD4;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000DD4;tk1=0x000DE0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000DD4;tk1=0x000DE0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"38\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0013</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000DE0;tk1=0x000DF8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000DF8;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000DF8;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000DF8;tk1=0x000E1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000DF8;tk1=0x000E1C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000E04;tk1=0x000E10</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000E10;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000E1C;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000E1C;tk1=0x000E28</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E28;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E28;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E28;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E28;tk1=0x000E40</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000E34;tk1=0x000E40</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"39\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000E40;tk1=0x000E4C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000E40;tk1=0x000E4C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000E40;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000E4C;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000E4C;tk1=0x000E58</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000E58;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000E58;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000E58;tk1=0x000E7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000E58;tk1=0x000E7C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000E64;tk1=0x000E70</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000E70;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000E7C;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000E7C;tk1=0x000E88</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x21;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E88;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E88;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3F;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E88;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000E88;tk1=0x000EA0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000E94;tk1=0x000EA0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"40\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000EA0;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000EA0;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000EA0;tk1=0x000EAC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000EA0;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000EAC;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000EAC;tk1=0x000EB8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000EB8;tk1=0x000EDC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000EB8;tk1=0x000EDC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x58;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000EB8;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x30;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000EC4;tk1=0x000ED0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000EC4;tk1=0x000ED0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2A;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000ED0;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000ED0;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000EDC;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x48;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000EDC;tk1=0x000EE8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000EE8;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000EE8;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000EE8;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000EF4;tk1=0x000F00</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000EF4;tk1=0x000F00</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"41\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0015</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000F00;tk1=0x000F0C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000F00;tk1=0x000F0C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F00;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F0C;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F0C;tk1=0x000F18</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000F18;tk1=0x000F3C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x000F18;tk1=0x000F3C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000F18;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2D;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F24;tk1=0x000F30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F24;tk1=0x000F30</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x26;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000F30;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000F30;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F3C;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F3C;tk1=0x000F48</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000F48;tk1=0x000F60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000F48;tk1=0x000F60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000F48;tk1=0x000F60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000F54;tk1=0x000F60</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000F54;tk1=0x000F60</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"42\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0025</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x25;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F60;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x31;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000F60;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000F60;tk1=0x000F6C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x000F60;tk1=0x000F6C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000F6C;tk1=0x000F78</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000F78;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x000F78;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x52;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000F78;tk1=0x000F84</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x56;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000F84;tk1=0x000F90</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000F90;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F9C;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x42;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F9C;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F9C;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000F9C;tk1=0x000FA8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0027\">idx=0x001A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000FA8;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0028\">idx=0x001B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x000FA8;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0029\">idx=0x001C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000FA8;tk1=0x000FB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0030\">idx=0x001D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000FA8;tk1=0x000FB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0031\">idx=0x001E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000FA8;tk1=0x000FB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0032\">idx=0x001F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x000FA8;tk1=0x000FB4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0033\">idx=0x0020;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3D;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000FB4;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0034\">idx=0x0021;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000FB4;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0035\">idx=0x0022;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x49;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000FB4;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0036\">idx=0x0023;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000FB4;tk1=0x000FC0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0037\">idx=0x0024;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x55;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x000FB4;tk1=0x000FC0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"43\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x002A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FC0;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FC0;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x000FC0;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x40;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x000FCC;tk1=0x000FD8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FD8;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x000FD8;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x000FD8;tk1=0x000FE4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x53;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x000FE4;tk1=0x000FF0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x000FF0;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000FF0;tk1=0x000FFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000FF0;tk1=0x000FFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000FF0;tk1=0x000FFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000FF0;tk1=0x000FFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x000FF0;tk1=0x000FFC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000FFC;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0027\">idx=0x001A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3D;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000FFC;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0028\">idx=0x001B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000FFC;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0029\">idx=0x001C;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000FFC;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0030\">idx=0x001D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x51;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x000FFC;tk1=0x001008</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0031\">idx=0x001E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001008;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0032\">idx=0x001F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001008;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0033\">idx=0x0020;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001008;tk1=0x001014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0034\">idx=0x0021;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001008;tk1=0x001014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0035\">idx=0x0022;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001008;tk1=0x001014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0036\">idx=0x0023;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001008;tk1=0x001014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0037\">idx=0x0024;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001008;tk1=0x001014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0038\">idx=0x0025;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001014;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0039\">idx=0x0026;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001014;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0040\">idx=0x0027;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001014;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0041\">idx=0x0028;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001014;tk1=0x001020</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0042\">idx=0x0029;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001014;tk1=0x001020</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"44\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x002C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001020;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001020;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001020;tk1=0x00102C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001020;tk1=0x00102C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001020;tk1=0x00102C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001020;tk1=0x00102C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001020;tk1=0x00102C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00102C;tk1=0x001038</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2A;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001038;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001038;tk1=0x001044</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001044;tk1=0x001050</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001050;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001050;tk1=0x00105C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0027\">idx=0x001A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001050;tk1=0x00105C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0028\">idx=0x001B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001050;tk1=0x00105C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0029\">idx=0x001C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001050;tk1=0x00105C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0030\">idx=0x001D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x001050;tk1=0x001074</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0031\">idx=0x001E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00105C;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0032\">idx=0x001F;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00105C;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0033\">idx=0x0020;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00105C;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0034\">idx=0x0021;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00105C;tk1=0x001068</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0035\">idx=0x0022;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001068;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0036\">idx=0x0023;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001068;tk1=0x001074</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0037\">idx=0x0024;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001068;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0038\">idx=0x0025;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001068;tk1=0x001074</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0039\">idx=0x0026;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001068;tk1=0x001074</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0040\">idx=0x0027;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x31;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001074;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0041\">idx=0x0028;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001074;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0042\">idx=0x0029;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001074;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0043\">idx=0x002A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001074;tk1=0x001080</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0044\">idx=0x002B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001074;tk1=0x001080</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"45\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0023</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001080;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x31;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001080;tk1=0x00108C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001080;tk1=0x00108C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001080;tk1=0x00108C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001080;tk1=0x00108C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001080;tk1=0x00108C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001080;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x2F;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00108C;tk1=0x001098</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001098;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001098;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001098;tk1=0x0010A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001098;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0010A4;tk1=0x0010B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x26;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0027\">idx=0x001A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0010B0;tk1=0x0010C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0028\">idx=0x001B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x0010B0;tk1=0x0010D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0029\">idx=0x001C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1A;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0030\">idx=0x001D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0031\">idx=0x001E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x31;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0032\">idx=0x001F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0033\">idx=0x0020;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0034\">idx=0x0021;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0010C8;tk1=0x0010E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0035\">idx=0x0022;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x46;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0010D4;tk1=0x0010E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"46\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0010</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0010E0;tk1=0x0010F8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x0010F8;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x0010F8;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010F8;tk1=0x001110</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x56;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0010F8;tk1=0x001110</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x49;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x55;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001110;tk1=0x001128</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001128;tk1=0x001140</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"47\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x000B</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001140;tk1=0x001158</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001140;tk1=0x001158</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x45;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001140;tk1=0x001158</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x51;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001140;tk1=0x001158</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001158;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001158;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001158;tk1=0x001170</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001170;tk1=0x001188</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x001170;tk1=0x0011A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x001170;tk1=0x0011A0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001188;tk1=0x0011A0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"48\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0011</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0011A0;tk1=0x0011B8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0011B8;tk1=0x0011D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0011B8;tk1=0x0011D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0011B8;tk1=0x0011D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x49;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0011B8;tk1=0x0011D0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0011D0;tk1=0x001200</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x36;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x0011D0;tk1=0x0011E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x0011D0;tk1=0x0011F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x46;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x0011D0;tk1=0x0011F4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0011DC;tk1=0x0011E8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0011E8;tk1=0x001200</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0011E8;tk1=0x001200</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x3B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0011F4;tk1=0x001200</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0011F4;tk1=0x001200</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"49\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0014</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001200;tk1=0x00120C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3E;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x001200;tk1=0x001224</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x001200;tk1=0x001224</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00120C;tk1=0x001218</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00120C;tk1=0x001218</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x36;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001218;tk1=0x001230</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0004;dd=0x0006;tk0=0x001218;tk1=0x00123C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001224;tk1=0x001230</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001224;tk1=0x001230</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x001230;tk1=0x001260</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x001230;tk1=0x001254</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x53;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x001230;tk1=0x001254</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00123C;tk1=0x001248</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00123C;tk1=0x001248</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001248;tk1=0x001254</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001248;tk1=0x001254</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001254;tk1=0x001260</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001254;tk1=0x001260</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001254;tk1=0x001260</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x56;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001254;tk1=0x001260</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"50\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0016</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x3B;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4E;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x5A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001260;tk1=0x001278</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x24;vel=0x4F;sd=0x0004;dd=0x0008;tk0=0x001278;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001278;tk1=0x001290</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x4F;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001278;tk1=0x001290</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x5B;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001278;tk1=0x001290</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2B;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001284;tk1=0x001290</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001284;tk1=0x001290</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001290;tk1=0x00129C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4E;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x5A;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001290;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00129C;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00129C;tk1=0x0012A8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0012A8;tk1=0x0012C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0012A8;tk1=0x0012C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4C;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0012A8;tk1=0x0012C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x58;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x0012A8;tk1=0x0012C0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x36;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0012B4;tk1=0x0012C0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>5</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>6</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"51\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0018</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012C0;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x39;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012C0;tk1=0x0012CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x0012C0;tk1=0x0012CC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4A;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012C0;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x56;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x0012C0;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x3E;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012CC;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x42;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x0012CC;tk1=0x0012D8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x28;vel=0x4F;sd=0x0004;dd=0x000C;tk0=0x0012D8;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x34;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0012D8;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x0012D8;tk1=0x0012E4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x48;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0012D8;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x03;stf=0x01;key=0x54;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x0012D8;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012E4;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0012E4;tk1=0x0012F0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3C;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x40;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x43;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0012F0;tk1=0x0012FC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0012F0;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0012FC;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0012FC;tk1=0x001308</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001308;tk1=0x001314</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001308;tk1=0x001314</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3C;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001314;tk1=0x001320</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x40;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001314;tk1=0x001320</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"52\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x001A</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x03;stf=0x02;key=0x28;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001320;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x34;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001320;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001320;tk1=0x00132C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0004;tk0=0x001320;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00132C;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3C;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00132C;tk1=0x001338</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x27;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x33;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001338;tk1=0x001344</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x45;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x51;vel=0x4F;sd=0x0004;dd=0x0004;tk0=0x001338;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001344;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3C;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x001344;tk1=0x001350</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x26;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x001350;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0008;dd=0x0004;tk0=0x001350;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x001350;tk1=0x00135C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x48;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x001350;tk1=0x001374</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x54;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x001350;tk1=0x001374</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00135C;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x00135C;tk1=0x001368</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x32;vel=0x4F;sd=0x000C;dd=0x0004;tk0=0x001368;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x001368;tk1=0x001374</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x02;stf=0x02;key=0x37;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x47;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0026\">idx=0x0019;tr=0x00;ch=0x01;v=0x02;stf=0x01;key=0x53;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x001374;tk1=0x001380</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>A</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>C</step>\n     <octave>6</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>C</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>2</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <accidental>natural</accidental>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>14</duration>\n    <type>half</type>\n    <dot/>\n    <dot/>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>E</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>12</duration>\n    <type>half</type>\n    <dot/>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>4</duration>\n    <type>quarter</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"53\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0019</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x23;vel=0x4F;sd=0x0000;dd=0x0008;tk0=0x001380;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2F;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001380;tk1=0x00138C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x32;vel=0x4F;sd=0x0000;dd=0x0002;tk0=0x001380;tk1=0x00138C</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x43;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x001380;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x4F;vel=0x4F;sd=0x0000;dd=0x0006;tk0=0x001380;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0006\">idx=0x0005;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x32;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00138C;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0007\">idx=0x0006;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x0002;dd=0x0002;tk0=0x00138C;tk1=0x001398</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0008\">idx=0x0007;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x2F;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001398;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0009\">idx=0x0008;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x32;vel=0x4F;sd=0x0004;dd=0x0002;tk0=0x001398;tk1=0x0013A4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0010\">idx=0x0009;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x32;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0011\">idx=0x000A;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0012\">idx=0x000B;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3E;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0013\">idx=0x000C;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x4A;vel=0x4F;sd=0x0006;dd=0x0002;tk0=0x0013A4;tk1=0x0013B0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0014\">idx=0x000D;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1D;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0013B0;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0015\">idx=0x000E;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x29;vel=0x4F;sd=0x0008;dd=0x0008;tk0=0x0013B0;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0016\">idx=0x000F;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x37;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0013B0;tk1=0x0013BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0017\">idx=0x0010;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3B;vel=0x4F;sd=0x0008;dd=0x0002;tk0=0x0013B0;tk1=0x0013BC</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0018\">idx=0x0011;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x47;vel=0x4F;sd=0x0008;dd=0x0006;tk0=0x0013B0;tk1=0x0013D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0019\">idx=0x0012;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x3B;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0013BC;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0020\">idx=0x0013;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3E;vel=0x4F;sd=0x000A;dd=0x0002;tk0=0x0013BC;tk1=0x0013C8</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0021\">idx=0x0014;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x37;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0013C8;tk1=0x0013D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0022\">idx=0x0015;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x3B;vel=0x4F;sd=0x000C;dd=0x0002;tk0=0x0013C8;tk1=0x0013D4</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0023\">idx=0x0016;tr=0x00;ch=0x01;v=0x04;stf=0x02;key=0x3B;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0013D4;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0024\">idx=0x0017;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x3E;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0013D4;tk1=0x0013E0</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0025\">idx=0x0018;tr=0x00;ch=0x01;v=0x04;stf=0x01;key=0x43;vel=0x4F;sd=0x000E;dd=0x0002;tk0=0x0013D4;tk1=0x0013E0</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>6</duration>\n    <type>quarter</type>\n    <dot/>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>5</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>4</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>F</step>\n     <octave>1</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>8</duration>\n    <type>half</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>2</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>D</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <rest/>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>G</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <note>\n    <pitch>\n     <step>B</step>\n     <octave>3</octave>\n    </pitch>\n    <duration>2</duration>\n    <type>eighth</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n  </measure>\n  <measure number=\"54\">\n   <attributes>\n    <miscellaneous>\n     <miscellaneous-field name=\"mks:midi-meta-count\">0x0005</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0001\">idx=0x0000;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x1E;vel=0x4F;sd=0x0000;dd=0x0010;tk0=0x0013E0;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0002\">idx=0x0001;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x2A;vel=0x4F;sd=0x0000;dd=0x0010;tk0=0x0013E0;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0003\">idx=0x0002;tr=0x00;ch=0x01;v=0x01;stf=0x02;key=0x3A;vel=0x4F;sd=0x0000;dd=0x0010;tk0=0x0013E0;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0004\">idx=0x0003;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x3D;vel=0x4F;sd=0x0000;dd=0x0010;tk0=0x0013E0;tk1=0x001440</miscellaneous-field>\n     <miscellaneous-field name=\"mks:midi-meta-0005\">idx=0x0004;tr=0x00;ch=0x01;v=0x01;stf=0x01;key=0x42;vel=0x4F;sd=0x0000;dd=0x0010;tk0=0x0013E0;tk1=0x001440</miscellaneous-field>\n    </miscellaneous>\n   </attributes>\n   <note>\n    <pitch>\n     <step>C</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>4</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>1</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>2</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>3</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>4</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>1</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>F</step>\n     <alter>1</alter>\n     <octave>2</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <note>\n    <chord/>\n    <pitch>\n     <step>A</step>\n     <alter>1</alter>\n     <octave>3</octave>\n    </pitch>\n    <accidental>sharp</accidental>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>1</voice>\n    <staff>5</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>2</voice>\n    <staff>6</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>3</voice>\n    <staff>7</staff>\n   </note>\n   <backup>\n    <duration>16</duration>\n   </backup>\n   <note>\n    <rest/>\n    <duration>16</duration>\n    <type>whole</type>\n    <voice>4</voice>\n    <staff>8</staff>\n   </note>\n   <barline location=\"right\">\n    <bar-style>light-heavy</bar-style>\n   </barline>\n  </measure>\n </part>\n</score-partwise>";

  },
  "src/ts/preview-flow.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderMeasureEditorPreview = exports.renderScorePreview = void 0;
const verovio_out_1 = require("./verovio-out");
const renderScorePreview = async (params) => {
    if (!params.xml) {
        params.setMetaText("No XML to render.");
        params.setSvgHtml("");
        params.setSvgIdMap(new Map());
        return;
    }
    const renderBundle = params.buildRenderXmlForVerovio(params.xml);
    const renderDoc = renderBundle.renderDoc;
    if (!renderDoc) {
        params.setMetaText("Render failed: invalid MusicXML.");
        params.setSvgHtml("");
        params.setSvgIdMap(new Map());
        return;
    }
    params.setMetaText("Rendering with verovio...");
    try {
        const { svg, pageCount } = await (0, verovio_out_1.renderMusicXmlDomToSvg)(renderDoc, {
            pageWidth: 20000,
            pageHeight: 3000,
            scale: 40,
            breaks: "none",
            mnumInterval: 1,
            adjustPageHeight: 1,
            footer: "none",
            header: "none",
        });
        if (!params.isRenderSeqCurrent(params.renderSeq))
            return;
        const measures = renderDoc.querySelectorAll("part > measure").length;
        params.setSvgHtml(svg);
        const renderedNoteIds = params.deriveRenderedNoteIds(params.renderedRoot);
        let mapMode = "direct";
        let map = renderBundle.svgIdToNodeId;
        if (renderedNoteIds.length > 0 && !renderedNoteIds.some((id) => id.startsWith("mks-"))) {
            map = params.buildFallbackSvgIdMap(params.noteNodeIds, renderedNoteIds);
            mapMode = "fallback-seq";
        }
        params.setSvgIdMap(map);
        if (params.debugLog) {
            console.warn("[mikuscore][click-map] render map prepared:", {
                mapMode,
                mappedNotes: map.size,
                renderedNoteIds: renderedNoteIds.slice(0, 20),
            });
        }
        params.onRendered();
        params.setMetaText([
            "engine=verovio",
            "measures=" + measures,
            "mode=long-horizontal",
            "pages=" + pageCount,
            "click-map-notes=" + renderBundle.noteCount,
            "map-mode=" + mapMode,
        ].join(" "));
    }
    catch (error) {
        if (!params.isRenderSeqCurrent(params.renderSeq))
            return;
        const message = error instanceof Error ? error.message : String(error);
        params.setMetaText("Render failed: " + message);
        params.setSvgHtml("");
        params.setSvgIdMap(new Map());
    }
};
exports.renderScorePreview = renderScorePreview;
const renderMeasureEditorPreview = async (params) => {
    if (!params.hasDraft || !params.xml) {
        params.setHtml("");
        params.setSvgIdMap(new Map());
        return;
    }
    const sourceDoc = params.parseMusicXmlDocument(params.xml);
    if (!sourceDoc) {
        params.setHtml("Render failed: invalid MusicXML.");
        params.setSvgIdMap(new Map());
        return;
    }
    const renderBundle = params.buildRenderDocWithNodeIds(sourceDoc, params.draftNoteNodeIds.slice(), "mks-draft");
    const renderDoc = renderBundle.renderDoc;
    if (!renderDoc) {
        params.setHtml("Render failed: invalid MusicXML.");
        params.setSvgIdMap(new Map());
        return;
    }
    params.setHtml("Rendering...");
    try {
        const { svg } = await (0, verovio_out_1.renderMusicXmlDomToSvg)(renderDoc, {
            pageWidth: 6000,
            pageHeight: 2200,
            scale: 58,
            breaks: "none",
            adjustPageHeight: 1,
            footer: "none",
            header: "none",
        });
        params.setHtml(svg);
        const renderedNoteIds = params.deriveRenderedNoteIds(params.renderedRoot);
        let map = renderBundle.svgIdToNodeId;
        if (renderedNoteIds.length > 0 && !renderedNoteIds.some((id) => id.startsWith("mks-"))) {
            map = params.buildFallbackSvgIdMap(params.draftNoteNodeIds, renderedNoteIds);
        }
        params.setSvgIdMap(map);
        params.onRendered();
    }
    catch (error) {
        params.setHtml(`Render failed: ${error instanceof Error ? error.message : String(error)}`);
        params.setSvgIdMap(new Map());
    }
};
exports.renderMeasureEditorPreview = renderMeasureEditorPreview;

  },
  "src/ts/verovio-out.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderMusicXmlDomToSvg = void 0;
let verovioToolkit = null;
let verovioInitPromise = null;
const cloneXmlDocument = (doc) => {
    const cloned = document.implementation.createDocument("", "", null);
    const root = cloned.importNode(doc.documentElement, true);
    cloned.appendChild(root);
    return cloned;
};
const pruneEmptyNotations = (notations) => {
    if (!notations || notations.tagName !== "notations")
        return;
    if (notations.children.length > 0)
        return;
    notations.remove();
};
const sanitizeSlursForRender = (doc) => {
    var _a, _b, _c;
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    for (const part of parts) {
        const openSlurs = new Map();
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        for (const measure of measures) {
            const notes = Array.from(measure.querySelectorAll(":scope > note"));
            for (const note of notes) {
                const slurs = Array.from(note.querySelectorAll(":scope > notations > slur"));
                for (const slur of slurs) {
                    const number = ((_a = slur.getAttribute("number")) !== null && _a !== void 0 ? _a : "1").trim() || "1";
                    const type = ((_b = slur.getAttribute("type")) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
                    const stack = (_c = openSlurs.get(number)) !== null && _c !== void 0 ? _c : [];
                    if (type === "start") {
                        stack.push(slur);
                        openSlurs.set(number, stack);
                        continue;
                    }
                    if (type === "stop") {
                        if (stack.length > 0) {
                            stack.pop();
                        }
                        else {
                            const notations = slur.parentElement;
                            slur.remove();
                            pruneEmptyNotations(notations);
                        }
                        continue;
                    }
                    if (type === "continue") {
                        if (stack.length === 0) {
                            const notations = slur.parentElement;
                            slur.remove();
                            pruneEmptyNotations(notations);
                            continue;
                        }
                        stack.pop();
                        stack.push(slur);
                        openSlurs.set(number, stack);
                    }
                }
            }
        }
        for (const danglingStarts of openSlurs.values()) {
            for (const startSlur of danglingStarts) {
                const notations = startSlur.parentElement;
                startSlur.remove();
                pruneEmptyNotations(notations);
            }
        }
    }
};
const getVerovioRuntime = () => {
    var _a;
    return (_a = window.verovio) !== null && _a !== void 0 ? _a : null;
};
const ensureVerovioToolkit = async () => {
    if (verovioToolkit) {
        return verovioToolkit;
    }
    if (verovioInitPromise) {
        return verovioInitPromise;
    }
    verovioInitPromise = (async () => {
        const runtime = getVerovioRuntime();
        if (!runtime || typeof runtime.toolkit !== "function") {
            throw new Error("verovio.js is not loaded.");
        }
        const moduleObj = runtime.module;
        if (!moduleObj) {
            throw new Error("verovio module was not found.");
        }
        if (!moduleObj.calledRun || typeof moduleObj.cwrap !== "function") {
            await new Promise((resolve, reject) => {
                let settled = false;
                const timeoutId = window.setTimeout(() => {
                    if (settled)
                        return;
                    settled = true;
                    reject(new Error("Timed out while waiting for verovio initialization."));
                }, 8000);
                const complete = () => {
                    if (settled)
                        return;
                    settled = true;
                    window.clearTimeout(timeoutId);
                    resolve();
                };
                const previous = moduleObj.onRuntimeInitialized;
                moduleObj.onRuntimeInitialized = () => {
                    if (typeof previous === "function") {
                        previous();
                    }
                    complete();
                };
                if (moduleObj.calledRun && typeof moduleObj.cwrap === "function") {
                    complete();
                }
            });
        }
        verovioToolkit = new runtime.toolkit();
        return verovioToolkit;
    })()
        .catch((error) => {
        verovioInitPromise = null;
        throw error;
    });
    return verovioInitPromise;
};
const renderMusicXmlDomToSvg = async (doc, options) => {
    const toolkit = await ensureVerovioToolkit();
    if (!toolkit) {
        throw new Error("Failed to initialize verovio toolkit.");
    }
    // Keep source DOM intact and only sanitize slur mismatch on render copy.
    const renderDoc = cloneXmlDocument(doc);
    sanitizeSlursForRender(renderDoc);
    const xml = new XMLSerializer().serializeToString(renderDoc);
    toolkit.setOptions(options);
    const loaded = toolkit.loadData(xml);
    if (!loaded) {
        throw new Error("verovio loadData failed.");
    }
    const pageCount = toolkit.getPageCount();
    if (!Number.isFinite(pageCount) || pageCount < 1) {
        throw new Error("verovio returned an invalid pageCount.");
    }
    const svg = toolkit.renderToSVG(1, {});
    if (!svg) {
        throw new Error("Failed to generate SVG with verovio.");
    }
    return { svg, pageCount };
};
exports.renderMusicXmlDomToSvg = renderMusicXmlDomToSvg;

  },
  "src/ts/musicxml-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.replaceMeasureInMainDocument = exports.extractMeasureEditorDocument = exports.buildRenderDocWithNodeIds = exports.applyImplicitBeamsToMusicXmlText = exports.normalizeImportedMusicXmlText = exports.prettyPrintMusicXmlText = exports.serializeMusicXmlDocument = exports.parseMusicXmlDocument = void 0;
const beam_common_1 = require("./beam-common");
const parseMusicXmlDocument = (xml) => {
    const doc = new DOMParser().parseFromString(xml, "application/xml");
    return doc.querySelector("parsererror") ? null : doc;
};
exports.parseMusicXmlDocument = parseMusicXmlDocument;
const serializeMusicXmlDocument = (doc) => {
    return new XMLSerializer().serializeToString(doc);
};
exports.serializeMusicXmlDocument = serializeMusicXmlDocument;
const prettyPrintMusicXmlText = (xml) => {
    const compact = String(xml || "").replace(/>\s+</g, "><").trim();
    const split = compact.replace(/(>)(<)(\/*)/g, "$1\n$2$3").split("\n");
    let indent = 0;
    const lines = [];
    for (const rawToken of split) {
        const token = rawToken.trim();
        if (!token)
            continue;
        if (/^<\//.test(token))
            indent = Math.max(0, indent - 1);
        lines.push(`${" ".repeat(indent)}${token}`);
        const isOpening = /^<[^!?/][^>]*>$/.test(token);
        const isSelfClosing = /\/>$/.test(token);
        if (isOpening && !isSelfClosing)
            indent += 1;
    }
    return lines.join("\n");
};
exports.prettyPrintMusicXmlText = prettyPrintMusicXmlText;
const ensureTupletNotation = (note, type, number, withDisplayAttrs) => {
    let notations = note.querySelector(":scope > notations");
    if (!notations) {
        notations = note.ownerDocument.createElement("notations");
        note.appendChild(notations);
    }
    const existing = notations.querySelector(`:scope > tuplet[type="${type}"]`);
    if (existing) {
        if (!existing.getAttribute("number"))
            existing.setAttribute("number", String(number));
        if (type === "start" && withDisplayAttrs) {
            if (!existing.getAttribute("bracket"))
                existing.setAttribute("bracket", "yes");
            if (!existing.getAttribute("show-number"))
                existing.setAttribute("show-number", "actual");
        }
        return;
    }
    const tuplet = note.ownerDocument.createElement("tuplet");
    tuplet.setAttribute("type", type);
    tuplet.setAttribute("number", String(number));
    if (type === "start" && withDisplayAttrs) {
        tuplet.setAttribute("bracket", "yes");
        tuplet.setAttribute("show-number", "actual");
    }
    notations.appendChild(tuplet);
};
const hasChordTag = (note) => note.querySelector(":scope > chord") !== null;
const laneKeyForNote = (note) => {
    var _a, _b, _c, _d, _e, _f;
    const voice = (_c = (_b = (_a = note.querySelector(":scope > voice")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "1";
    const staff = (_f = (_e = (_d = note.querySelector(":scope > staff")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "1";
    return `${voice}::${staff}`;
};
const tupletSignatureForNote = (note) => {
    var _a, _b, _c, _d, _e, _f;
    const tm = note.querySelector(":scope > time-modification");
    if (!tm)
        return null;
    const actual = Number((_c = (_b = (_a = tm.querySelector(":scope > actual-notes")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "");
    const normal = Number((_f = (_e = (_d = tm.querySelector(":scope > normal-notes")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "");
    if (!Number.isFinite(actual) || !Number.isFinite(normal) || actual <= 0 || normal <= 0)
        return null;
    return `${Math.round(actual)}/${Math.round(normal)}`;
};
const enrichTupletNotationsInDocument = (doc) => {
    for (const measure of Array.from(doc.querySelectorAll("part > measure"))) {
        const children = Array.from(measure.children);
        const activeByLane = new Map();
        const nextTupletNoByLane = new Map();
        const flushLane = (lane) => {
            var _a;
            const group = activeByLane.get(lane);
            activeByLane.delete(lane);
            if (!group || group.notes.length < 2)
                return;
            const number = (_a = nextTupletNoByLane.get(lane)) !== null && _a !== void 0 ? _a : 1;
            nextTupletNoByLane.set(lane, number + 1);
            ensureTupletNotation(group.notes[0], "start", number, true);
            ensureTupletNotation(group.notes[group.notes.length - 1], "stop", number, false);
        };
        const flushAll = () => {
            for (const lane of Array.from(activeByLane.keys()))
                flushLane(lane);
        };
        for (const child of children) {
            if (child.tagName === "backup" || child.tagName === "forward") {
                flushAll();
                continue;
            }
            if (child.tagName !== "note")
                continue;
            const note = child;
            if (hasChordTag(note))
                continue;
            const lane = laneKeyForNote(note);
            const sig = tupletSignatureForNote(note);
            const current = activeByLane.get(lane);
            if (!sig) {
                flushLane(lane);
                continue;
            }
            if (!current || current.sig !== sig) {
                flushLane(lane);
                activeByLane.set(lane, { sig, notes: [note] });
            }
            else {
                current.notes.push(note);
            }
        }
        flushAll();
    }
};
const normalizePartListAndPartIds = (doc) => {
    var _a, _b, _c;
    const root = doc.querySelector("score-partwise");
    if (!root)
        return;
    const parts = Array.from(root.querySelectorAll(":scope > part"));
    if (parts.length === 0)
        return;
    const usedIds = new Set();
    let seq = 1;
    const nextPartId = () => {
        while (usedIds.has(`P${seq}`))
            seq += 1;
        const id = `P${seq}`;
        seq += 1;
        return id;
    };
    for (const part of parts) {
        const current = ((_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim();
        if (!current || usedIds.has(current)) {
            const assigned = nextPartId();
            part.setAttribute("id", assigned);
            usedIds.add(assigned);
            continue;
        }
        usedIds.add(current);
    }
    let partList = root.querySelector(":scope > part-list");
    if (!partList) {
        partList = doc.createElement("part-list");
        root.insertBefore(partList, parts[0]);
    }
    const scorePartById = new Map();
    for (const scorePart of Array.from(partList.querySelectorAll(":scope > score-part"))) {
        const id = ((_b = scorePart.getAttribute("id")) !== null && _b !== void 0 ? _b : "").trim();
        if (!id || scorePartById.has(id))
            continue;
        scorePartById.set(id, scorePart);
    }
    for (const part of parts) {
        const id = ((_c = part.getAttribute("id")) !== null && _c !== void 0 ? _c : "").trim();
        if (!id)
            continue;
        const existing = scorePartById.get(id);
        if (existing) {
            if (!existing.querySelector(":scope > part-name")) {
                const partName = doc.createElement("part-name");
                partName.textContent = "Music";
                existing.appendChild(partName);
            }
            continue;
        }
        const scorePart = doc.createElement("score-part");
        scorePart.setAttribute("id", id);
        const partName = doc.createElement("part-name");
        partName.textContent = "Music";
        scorePart.appendChild(partName);
        partList.appendChild(scorePart);
        scorePartById.set(id, scorePart);
    }
};
const ensureFinalBarlineInEachPart = (doc) => {
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    for (const part of parts) {
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        const lastMeasure = measures[measures.length - 1];
        if (!lastMeasure)
            continue;
        const rightBarline = lastMeasure.querySelector(':scope > barline[location="right"]');
        if (rightBarline)
            continue;
        const barline = doc.createElement("barline");
        barline.setAttribute("location", "right");
        const barStyle = doc.createElement("bar-style");
        barStyle.textContent = "light-heavy";
        barline.appendChild(barStyle);
        lastMeasure.appendChild(barline);
    }
};
const beamLevelsFromType = (typeText) => {
    switch (String(typeText || "").trim().toLowerCase()) {
        case "eighth":
            return 1;
        case "16th":
            return 2;
        case "32nd":
            return 3;
        case "64th":
            return 4;
        case "128th":
            return 5;
        case "256th":
            return 6;
        default:
            return 0;
    }
};
const laneKeyForTimelineNote = (note) => {
    var _a, _b, _c, _d;
    const voice = ((_b = (_a = note.querySelector(":scope > voice")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || "1";
    const staff = ((_d = (_c = note.querySelector(":scope > staff")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) || "1";
    return `${voice}::${staff}`;
};
const appendBeamElement = (note, number, state) => {
    const beam = note.ownerDocument.createElement("beam");
    beam.setAttribute("number", String(number));
    beam.textContent = state;
    const before = note.querySelector(":scope > notations, :scope > lyric, :scope > play, :scope > listen, :scope > sound");
    if (before)
        note.insertBefore(beam, before);
    else
        note.appendChild(beam);
};
const enrichImplicitBeamsInDocument = (doc) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
    for (const part of Array.from(doc.querySelectorAll("score-partwise > part"))) {
        let currentDivisions = 480;
        let currentBeats = 4;
        let currentBeatType = 4;
        for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
            const divisionsText = (_b = (_a = measure.querySelector(":scope > attributes > divisions")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim();
            const divisions = Number.parseInt(divisionsText || "", 10);
            if (Number.isFinite(divisions) && divisions > 0)
                currentDivisions = divisions;
            const beatsText = (_d = (_c = measure.querySelector(":scope > attributes > time > beats")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim();
            const beats = Number.parseInt(beatsText || "", 10);
            if (Number.isFinite(beats) && beats > 0)
                currentBeats = beats;
            const beatTypeText = (_f = (_e = measure.querySelector(":scope > attributes > time > beat-type")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim();
            const beatType = Number.parseInt(beatTypeText || "", 10);
            if (Number.isFinite(beatType) && beatType > 0)
                currentBeatType = beatType;
            const beatDiv = Math.max(1, Math.round((currentDivisions * 4) / Math.max(1, currentBeatType)));
            const laneHasExistingBeam = new Set();
            const lanes = new Set();
            for (const note of Array.from(measure.querySelectorAll(":scope > note"))) {
                if (note.querySelector(":scope > chord"))
                    continue;
                const lane = laneKeyForTimelineNote(note);
                lanes.add(lane);
                if (note.querySelector(":scope > beam"))
                    laneHasExistingBeam.add(lane);
            }
            if (!lanes.size)
                continue;
            const children = Array.from(measure.children);
            for (const lane of lanes) {
                if (laneHasExistingBeam.has(lane))
                    continue;
                const timeline = [];
                const noteIndexByTimelineIndex = new Map();
                for (const child of children) {
                    if (child.tagName === "backup") {
                        timeline.push({
                            note: null,
                            timed: false,
                            chord: false,
                            grace: false,
                            durationDiv: 0,
                            levels: 0,
                        });
                        continue;
                    }
                    if (child.tagName === "forward") {
                        const duration = Number.parseInt(((_h = (_g = child.querySelector(":scope > duration")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) || "0", 10);
                        timeline.push({
                            note: null,
                            timed: true,
                            chord: false,
                            grace: false,
                            durationDiv: Number.isFinite(duration) ? Math.max(0, duration) : 0,
                            levels: 0,
                        });
                        continue;
                    }
                    if (child.tagName !== "note")
                        continue;
                    const note = child;
                    if (note.querySelector(":scope > chord"))
                        continue;
                    if (laneKeyForTimelineNote(note) !== lane)
                        continue;
                    const duration = Number.parseInt(((_k = (_j = note.querySelector(":scope > duration")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) || "0", 10);
                    const typeText = ((_m = (_l = note.querySelector(":scope > type")) === null || _l === void 0 ? void 0 : _l.textContent) === null || _m === void 0 ? void 0 : _m.trim()) || "";
                    const entry = {
                        note,
                        timed: true,
                        chord: !note.querySelector(":scope > rest"),
                        grace: note.querySelector(":scope > grace") !== null,
                        durationDiv: Number.isFinite(duration) ? Math.max(0, duration) : 0,
                        levels: beamLevelsFromType(typeText),
                    };
                    const idx = timeline.length;
                    timeline.push(entry);
                    noteIndexByTimelineIndex.set(idx, note);
                }
                if (timeline.length < 2)
                    continue;
                const assignments = (0, beam_common_1.computeBeamAssignments)(timeline, beatDiv, (event) => ({
                    timed: event.timed,
                    chord: event.chord,
                    grace: event.grace,
                    durationDiv: event.durationDiv,
                    levels: event.levels,
                }), { splitAtBeatBoundaryWhenImplicit: true });
                for (const [idx, assignment] of assignments.entries()) {
                    const note = noteIndexByTimelineIndex.get(idx);
                    if (!note || assignment.levels <= 0)
                        continue;
                    if (note.querySelector(":scope > beam"))
                        continue;
                    for (let level = 1; level <= assignment.levels; level += 1) {
                        appendBeamElement(note, level, assignment.state);
                    }
                }
            }
        }
    }
};
const normalizeImportedMusicXmlText = (xml) => {
    const doc = (0, exports.parseMusicXmlDocument)(xml);
    if (!doc)
        return xml;
    normalizePartListAndPartIds(doc);
    enrichTupletNotationsInDocument(doc);
    ensureFinalBarlineInEachPart(doc);
    return (0, exports.prettyPrintMusicXmlText)((0, exports.serializeMusicXmlDocument)(doc));
};
exports.normalizeImportedMusicXmlText = normalizeImportedMusicXmlText;
const applyImplicitBeamsToMusicXmlText = (xml) => {
    const doc = (0, exports.parseMusicXmlDocument)(xml);
    if (!doc)
        return xml;
    enrichImplicitBeamsInDocument(doc);
    return (0, exports.serializeMusicXmlDocument)(doc);
};
exports.applyImplicitBeamsToMusicXmlText = applyImplicitBeamsToMusicXmlText;
const cloneXmlDocument = (doc) => {
    const cloned = document.implementation.createDocument("", "", null);
    const root = cloned.importNode(doc.documentElement, true);
    cloned.appendChild(root);
    return cloned;
};
const findPartById = (doc, partId) => {
    var _a;
    for (const part of Array.from(doc.querySelectorAll("score-partwise > part"))) {
        if (((_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "") === partId)
            return part;
    }
    return null;
};
const findScorePartById = (doc, partId) => {
    var _a;
    for (const scorePart of Array.from(doc.querySelectorAll("score-partwise > part-list > score-part"))) {
        if (((_a = scorePart.getAttribute("id")) !== null && _a !== void 0 ? _a : "") === partId)
            return scorePart;
    }
    return null;
};
const findMeasureByNumber = (part, measureNumber) => {
    var _a;
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        if (((_a = measure.getAttribute("number")) !== null && _a !== void 0 ? _a : "") === measureNumber)
            return measure;
    }
    return null;
};
const buildRenderDocWithNodeIds = (sourceDoc, nodeIds, idPrefix) => {
    const map = new Map();
    if (nodeIds.length === 0) {
        return { renderDoc: sourceDoc, svgIdToNodeId: map, noteCount: 0 };
    }
    const doc = cloneXmlDocument(sourceDoc);
    const notes = Array.from(doc.querySelectorAll("note"));
    const count = Math.min(notes.length, nodeIds.length);
    for (let i = 0; i < count; i += 1) {
        const nodeId = nodeIds[i];
        const svgId = `${idPrefix}-${nodeId}`;
        notes[i].setAttribute("xml:id", svgId);
        notes[i].setAttribute("id", svgId);
        map.set(svgId, nodeId);
    }
    return {
        renderDoc: doc,
        svgIdToNodeId: map,
        noteCount: count,
    };
};
exports.buildRenderDocWithNodeIds = buildRenderDocWithNodeIds;
const extractMeasureEditorDocument = (sourceDoc, partId, measureNumber) => {
    var _a;
    const srcRoot = sourceDoc.querySelector("score-partwise");
    const srcPart = findPartById(sourceDoc, partId);
    if (!srcRoot || !srcPart)
        return null;
    const srcMeasure = findMeasureByNumber(srcPart, measureNumber);
    if (!srcMeasure)
        return null;
    const collectEffectiveAttributes = (part, targetMeasure) => {
        var _a;
        let divisions = null;
        let key = null;
        let time = null;
        let staves = null;
        const clefByNo = new Map();
        for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
            const attrs = measure.querySelector(":scope > attributes");
            if (attrs) {
                const nextDivisions = attrs.querySelector(":scope > divisions");
                if (nextDivisions)
                    divisions = nextDivisions.cloneNode(true);
                const nextKey = attrs.querySelector(":scope > key");
                if (nextKey)
                    key = nextKey.cloneNode(true);
                const nextTime = attrs.querySelector(":scope > time");
                if (nextTime)
                    time = nextTime.cloneNode(true);
                const nextStaves = attrs.querySelector(":scope > staves");
                if (nextStaves)
                    staves = nextStaves.cloneNode(true);
                for (const clef of Array.from(attrs.querySelectorAll(":scope > clef"))) {
                    const no = (_a = clef.getAttribute("number")) !== null && _a !== void 0 ? _a : "1";
                    clefByNo.set(no, clef.cloneNode(true));
                }
            }
            if (measure === targetMeasure)
                break;
        }
        const doc = targetMeasure.ownerDocument;
        const effective = doc.createElement("attributes");
        if (divisions)
            effective.appendChild(divisions);
        if (key)
            effective.appendChild(key);
        if (time)
            effective.appendChild(time);
        if (staves)
            effective.appendChild(staves);
        for (const no of Array.from(clefByNo.keys()).sort()) {
            const clef = clefByNo.get(no);
            if (clef)
                effective.appendChild(clef);
        }
        return effective.childElementCount > 0 ? effective : null;
    };
    const patchedMeasure = srcMeasure.cloneNode(true);
    const effectiveAttrs = collectEffectiveAttributes(srcPart, srcMeasure);
    if (effectiveAttrs) {
        const existing = patchedMeasure.querySelector(":scope > attributes");
        if (!existing) {
            patchedMeasure.insertBefore(effectiveAttrs, patchedMeasure.firstChild);
        }
        else {
            const ensureSingle = (selector) => {
                if (existing.querySelector(`:scope > ${selector}`))
                    return;
                const src = effectiveAttrs.querySelector(`:scope > ${selector}`);
                if (src)
                    existing.appendChild(src.cloneNode(true));
            };
            ensureSingle("divisions");
            ensureSingle("key");
            ensureSingle("time");
            ensureSingle("staves");
            const existingClefNos = new Set(Array.from(existing.querySelectorAll(":scope > clef")).map((c) => { var _a; return (_a = c.getAttribute("number")) !== null && _a !== void 0 ? _a : "1"; }));
            for (const clef of Array.from(effectiveAttrs.querySelectorAll(":scope > clef"))) {
                const no = (_a = clef.getAttribute("number")) !== null && _a !== void 0 ? _a : "1";
                if (existingClefNos.has(no))
                    continue;
                existing.appendChild(clef.cloneNode(true));
            }
        }
    }
    const dst = document.implementation.createDocument("", "score-partwise", null);
    const dstRoot = dst.documentElement;
    if (!dstRoot)
        return null;
    const version = srcRoot.getAttribute("version");
    if (version)
        dstRoot.setAttribute("version", version);
    const srcPartList = sourceDoc.querySelector("score-partwise > part-list");
    const srcScorePart = findScorePartById(sourceDoc, partId);
    if (srcPartList && srcScorePart) {
        const dstPartList = dst.importNode(srcPartList, false);
        const dstScorePart = dst.importNode(srcScorePart, true);
        const dstPartName = dstScorePart.querySelector(":scope > part-name");
        if (dstPartName)
            dstPartName.textContent = "";
        const dstPartAbbreviation = dstScorePart.querySelector(":scope > part-abbreviation");
        if (dstPartAbbreviation)
            dstPartAbbreviation.textContent = "";
        dstPartList.appendChild(dstScorePart);
        dstRoot.appendChild(dstPartList);
    }
    const dstPart = dst.importNode(srcPart, false);
    dstPart.appendChild(dst.importNode(patchedMeasure, true));
    dstRoot.appendChild(dstPart);
    return dst;
};
exports.extractMeasureEditorDocument = extractMeasureEditorDocument;
const replaceMeasureInMainDocument = (mainDoc, partId, measureNumber, measureDoc) => {
    const replacementMeasure = measureDoc.querySelector("part > measure");
    if (!replacementMeasure)
        return null;
    const targetPart = findPartById(mainDoc, partId);
    if (!targetPart)
        return null;
    const targetMeasure = findMeasureByNumber(targetPart, measureNumber);
    if (!targetMeasure)
        return null;
    const replacementForMain = replacementMeasure.cloneNode(true);
    const replacementAttrs = replacementForMain.querySelector(":scope > attributes");
    const targetAttrs = targetMeasure.querySelector(":scope > attributes");
    // Editing preview injects effective attributes for rendering.
    // Do not introduce them into the main score when the original measure had none.
    if (replacementAttrs && !targetAttrs) {
        replacementAttrs.remove();
    }
    const next = cloneXmlDocument(mainDoc);
    const nextPart = findPartById(next, partId);
    if (!nextPart)
        return null;
    const nextTargetMeasure = findMeasureByNumber(nextPart, measureNumber);
    if (!nextTargetMeasure)
        return null;
    nextTargetMeasure.replaceWith(next.importNode(replacementForMain, true));
    return next;
};
exports.replaceMeasureInMainDocument = replaceMeasureInMainDocument;

  },
  "src/ts/playback-flow.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startMeasurePlayback = exports.startPlayback = exports.stopPlayback = exports.createBasicWaveSynthEngine = exports.PLAYBACK_TICKS_PER_QUARTER = void 0;
const midi_io_1 = require("./midi-io");
const musicxml_io_1 = require("./musicxml-io");
exports.PLAYBACK_TICKS_PER_QUARTER = 480;
const summarizeDiagnostics = (diagnostics) => {
    if (!diagnostics.length)
        return "unknown reason";
    const first = diagnostics[0];
    const firstText = `[${first.code}] ${first.message}`;
    if (diagnostics.length === 1)
        return firstText;
    return `${firstText} (+${diagnostics.length - 1} more)`;
};
const logPlaybackFailureDiagnostics = (label, diagnostics) => {
    if (!diagnostics.length) {
        console.warn(`[mikuscore][playback] ${label}: no diagnostics.`);
        return;
    }
    console.error(`[mikuscore][playback] ${label}:`);
    for (const d of diagnostics) {
        console.error(`- [${d.code}] ${d.message}`);
    }
};
const midiToHz = (midi) => 440 * Math.pow(2, (midi - 69) / 12);
const normalizeWaveform = (value) => {
    if (value === "square" || value === "triangle")
        return value;
    return "sine";
};
const createBasicWaveSynthEngine = (options) => {
    const ticksPerQuarter = Number.isFinite(options.ticksPerQuarter)
        ? Math.max(1, Math.round(options.ticksPerQuarter))
        : 480;
    let audioContext = null;
    let activeSynthNodes = [];
    let synthStopTimer = null;
    const ensureAudioContext = () => {
        if (audioContext)
            return audioContext;
        const ctor = window.AudioContext ||
            window
                .webkitAudioContext;
        if (!ctor) {
            throw new Error("Web Audio API is not available in this browser.");
        }
        audioContext = new ctor();
        return audioContext;
    };
    const ensureAudioContextRunning = async () => {
        const context = ensureAudioContext();
        if (context.state !== "running") {
            await context.resume();
        }
        if (context.state !== "running") {
            throw new Error("AudioContext is not running.");
        }
        return context;
    };
    const scheduleBasicWaveNote = (event, startAt, bodyDuration, waveform, sustainHoldSeconds = 0) => {
        if (!audioContext)
            return startAt;
        const attack = 0.005;
        const release = 0.03;
        const endAt = startAt + bodyDuration;
        const heldEndAt = endAt + Math.max(0, sustainHoldSeconds);
        const oscillator = audioContext.createOscillator();
        oscillator.type = waveform;
        oscillator.frequency.setValueAtTime(midiToHz(event.midiNumber), startAt);
        const gainNode = audioContext.createGain();
        const gainLevel = event.channel === 10 ? 0.06 : 0.1;
        gainNode.gain.setValueAtTime(0.0001, startAt);
        gainNode.gain.linearRampToValueAtTime(gainLevel, startAt + attack);
        gainNode.gain.setValueAtTime(gainLevel, heldEndAt);
        gainNode.gain.linearRampToValueAtTime(0.0001, heldEndAt + release);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start(startAt);
        oscillator.stop(heldEndAt + release + 0.01);
        oscillator.onended = () => {
            try {
                oscillator.disconnect();
                gainNode.disconnect();
            }
            catch (_a) {
                // ignore cleanup failure
            }
        };
        activeSynthNodes.push({ oscillator, gainNode });
        return heldEndAt + release + 0.02;
    };
    const stop = () => {
        if (synthStopTimer !== null) {
            window.clearTimeout(synthStopTimer);
            synthStopTimer = null;
        }
        for (const node of activeSynthNodes) {
            try {
                node.oscillator.stop();
            }
            catch (_a) {
                // ignore already-stopped nodes
            }
            try {
                node.oscillator.disconnect();
                node.gainNode.disconnect();
            }
            catch (_b) {
                // ignore disconnect error
            }
        }
        activeSynthNodes = [];
    };
    const unlockFromUserGesture = async () => {
        let context;
        try {
            context = await ensureAudioContextRunning();
        }
        catch (_a) {
            return false;
        }
        try {
            const src = context.createBufferSource();
            src.buffer = context.createBuffer(1, 1, 22050);
            const gainNode = context.createGain();
            gainNode.gain.setValueAtTime(0.000001, context.currentTime);
            src.connect(gainNode);
            gainNode.connect(context.destination);
            src.start(context.currentTime);
            src.stop(context.currentTime + 0.005);
            src.onended = () => {
                try {
                    src.disconnect();
                    gainNode.disconnect();
                }
                catch (_a) {
                    // ignore cleanup failure
                }
            };
            return true;
        }
        catch (_b) {
            return false;
        }
    };
    const playSchedule = async (schedule, waveform, onEnded) => {
        var _a, _b;
        if (!schedule || !Array.isArray(schedule.events) || schedule.events.length === 0) {
            throw new Error("Please convert first.");
        }
        const runningContext = await ensureAudioContextRunning();
        stop();
        const normalizedWaveform = normalizeWaveform(waveform);
        const normalizedTempoEvents = (((_a = schedule.tempoEvents) === null || _a === void 0 ? void 0 : _a.length)
            ? schedule.tempoEvents
            : [{ startTick: 0, bpm: Math.max(1, Number(schedule.tempo) || 120) }])
            .map((event) => ({
            startTick: Math.max(0, Math.round(event.startTick)),
            bpm: Math.max(1, Math.round(event.bpm || 120)),
        }))
            .sort((a, b) => a.startTick - b.startTick);
        const mergedTempoEvents = [];
        for (const event of normalizedTempoEvents) {
            const prev = mergedTempoEvents[mergedTempoEvents.length - 1];
            if (prev && prev.startTick === event.startTick) {
                prev.bpm = event.bpm;
            }
            else {
                mergedTempoEvents.push({ ...event });
            }
        }
        if (!mergedTempoEvents.length || mergedTempoEvents[0].startTick !== 0) {
            mergedTempoEvents.unshift({ startTick: 0, bpm: Math.max(1, Number(schedule.tempo) || 120) });
        }
        const tickToSeconds = (targetTick) => {
            var _a, _b;
            let seconds = 0;
            let cursorTick = 0;
            for (let i = 0; i < mergedTempoEvents.length; i += 1) {
                const current = mergedTempoEvents[i];
                const nextStart = (_b = (_a = mergedTempoEvents[i + 1]) === null || _a === void 0 ? void 0 : _a.startTick) !== null && _b !== void 0 ? _b : Number.POSITIVE_INFINITY;
                const segStart = Math.max(cursorTick, current.startTick);
                if (targetTick <= segStart)
                    break;
                const segEnd = Math.min(targetTick, nextStart);
                if (segEnd <= segStart)
                    continue;
                const secPerTick = 60 / (current.bpm * ticksPerQuarter);
                seconds += (segEnd - segStart) * secPerTick;
                cursorTick = segEnd;
                if (segEnd >= targetTick)
                    break;
            }
            return seconds;
        };
        const baseTime = runningContext.currentTime + 0.04;
        let latestEndTime = baseTime;
        const pedalRanges = ((_b = schedule.pedalRanges) !== null && _b !== void 0 ? _b : []).map((range) => ({
            channel: Math.max(1, Math.min(16, Math.round(range.channel || 1))),
            startTick: Math.max(0, Math.round(range.startTick)),
            endTick: Math.max(0, Math.round(range.endTick)),
        }));
        const isPedalHeldAt = (channel, tick) => {
            return pedalRanges.some((range) => range.channel === channel && tick >= range.startTick && tick < range.endTick);
        };
        for (const event of schedule.events) {
            const startAt = baseTime + tickToSeconds(event.start);
            const endAt = baseTime + tickToSeconds(event.start + event.ticks);
            const bodyDuration = Math.max(0.04, endAt - startAt);
            const sustainHoldSeconds = isPedalHeldAt(event.channel, event.start) ? 0.18 : 0;
            latestEndTime = Math.max(latestEndTime, scheduleBasicWaveNote(event, startAt, bodyDuration, normalizedWaveform, sustainHoldSeconds));
        }
        const waitMs = Math.max(0, Math.ceil((latestEndTime - runningContext.currentTime) * 1000));
        synthStopTimer = window.setTimeout(() => {
            activeSynthNodes = [];
            if (typeof onEnded === "function") {
                onEnded();
            }
        }, waitMs);
    };
    return { unlockFromUserGesture, playSchedule, stop };
};
exports.createBasicWaveSynthEngine = createBasicWaveSynthEngine;
const toSynthSchedule = (tempo, events, tempoEvents = [], controlEvents = []) => {
    const normalizedTempoEvents = tempoEvents
        .map((event) => ({
        startTick: Math.max(0, Math.round(event.startTicks)),
        bpm: Math.max(1, Math.round(event.bpm || 120)),
    }))
        .sort((a, b) => a.startTick - b.startTick);
    const cc64Events = controlEvents
        .filter((event) => event.controllerNumber === 64)
        .map((event) => ({
        channel: Math.max(1, Math.min(16, Math.round(event.channel || 1))),
        startTick: Math.max(0, Math.round(event.startTicks)),
        value: Math.max(0, Math.min(127, Math.round(event.controllerValue))),
    }))
        .sort((a, b) => (a.channel === b.channel ? a.startTick - b.startTick : a.channel - b.channel));
    const pedalRanges = [];
    const rangeStartByChannel = new Map();
    for (const event of cc64Events) {
        const pedalOn = event.value >= 64;
        if (pedalOn) {
            if (!rangeStartByChannel.has(event.channel)) {
                rangeStartByChannel.set(event.channel, event.startTick);
            }
            continue;
        }
        const start = rangeStartByChannel.get(event.channel);
        if (start !== undefined) {
            pedalRanges.push({ channel: event.channel, startTick: start, endTick: event.startTick });
            rangeStartByChannel.delete(event.channel);
        }
    }
    const latestNoteTick = events.reduce((max, event) => Math.max(max, Math.max(0, Math.round(event.startTicks + event.durTicks))), 0);
    for (const [channel, startTick] of rangeStartByChannel.entries()) {
        pedalRanges.push({
            channel,
            startTick,
            endTick: Math.max(startTick + 1, latestNoteTick + 1),
        });
    }
    return {
        tempo,
        tempoEvents: normalizedTempoEvents,
        pedalRanges,
        events: events
            .slice()
            .sort((a, b) => a.startTicks === b.startTicks ? a.midiNumber - b.midiNumber : a.startTicks - b.startTicks)
            .map((event) => ({
            midiNumber: event.midiNumber,
            start: event.startTicks,
            ticks: event.durTicks,
            channel: event.channel,
        })),
    };
};
const parsePositiveInt = (text) => {
    const value = Number.parseInt(String(text !== null && text !== void 0 ? text : "").trim(), 10);
    return Number.isFinite(value) && value > 0 ? value : null;
};
const resolveMeasureStartTickInPart = (doc, startFromMeasure, fallbackDivisions) => {
    var _a, _b, _c, _d, _e;
    const part = Array.from(doc.querySelectorAll("score-partwise > part")).find((p) => { var _a; return ((_a = p.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim() === String(startFromMeasure.partId || "").trim(); });
    if (!part)
        return null;
    let divisions = Math.max(1, Math.round(fallbackDivisions));
    let beats = 4;
    let beatType = 4;
    let tick = 0;
    const measures = Array.from(part.querySelectorAll(":scope > measure"));
    for (const measure of measures) {
        const attrs = measure.querySelector(":scope > attributes");
        const nextDivisions = parsePositiveInt((_a = attrs === null || attrs === void 0 ? void 0 : attrs.querySelector(":scope > divisions")) === null || _a === void 0 ? void 0 : _a.textContent);
        if (nextDivisions)
            divisions = nextDivisions;
        const nextBeats = parsePositiveInt((_b = attrs === null || attrs === void 0 ? void 0 : attrs.querySelector(":scope > time > beats")) === null || _b === void 0 ? void 0 : _b.textContent);
        if (nextBeats)
            beats = nextBeats;
        const nextBeatType = parsePositiveInt((_c = attrs === null || attrs === void 0 ? void 0 : attrs.querySelector(":scope > time > beat-type")) === null || _c === void 0 ? void 0 : _c.textContent);
        if (nextBeatType)
            beatType = nextBeatType;
        const measureNo = ((_d = measure.getAttribute("number")) !== null && _d !== void 0 ? _d : "").trim();
        if (measureNo === String((_e = startFromMeasure.measureNumber) !== null && _e !== void 0 ? _e : "").trim()) {
            return tick;
        }
        const measureTicks = Math.max(1, Math.round((divisions * beats * 4) / Math.max(1, beatType)));
        tick += measureTicks;
    }
    return null;
};
const trimPlaybackFromTick = (parsedPlayback, tempoEvents, controlEvents, startTick) => {
    if (!Number.isFinite(startTick) || startTick <= 0) {
        return { parsedPlayback, tempoEvents, controlEvents };
    }
    const safeStartTick = Math.max(0, Math.round(startTick));
    const trimmedEvents = parsedPlayback.events
        .filter((event) => event.startTicks >= safeStartTick)
        .map((event) => ({ ...event, startTicks: event.startTicks - safeStartTick }));
    const sortedTempo = (tempoEvents !== null && tempoEvents !== void 0 ? tempoEvents : [])
        .slice()
        .map((event) => ({
        startTicks: Math.max(0, Math.round(event.startTicks)),
        bpm: Math.max(1, Math.round(event.bpm || parsedPlayback.tempo || 120)),
    }))
        .sort((a, b) => a.startTicks - b.startTicks);
    const lastTempoBeforeOrAtStart = sortedTempo
        .slice()
        .reverse()
        .find((event) => event.startTicks <= safeStartTick);
    const trimmedTempoEvents = sortedTempo
        .filter((event) => event.startTicks > safeStartTick)
        .map((event) => ({ ...event, startTicks: event.startTicks - safeStartTick }));
    if (lastTempoBeforeOrAtStart) {
        trimmedTempoEvents.unshift({ startTicks: 0, bpm: lastTempoBeforeOrAtStart.bpm });
    }
    const trimmedControlEvents = (controlEvents !== null && controlEvents !== void 0 ? controlEvents : [])
        .filter((event) => event.startTicks >= safeStartTick)
        .map((event) => ({ ...event, startTicks: event.startTicks - safeStartTick }));
    return {
        parsedPlayback: { ...parsedPlayback, events: trimmedEvents },
        tempoEvents: trimmedTempoEvents,
        controlEvents: trimmedControlEvents,
    };
};
const stopPlayback = (options) => {
    options.engine.stop();
    options.setIsPlaying(false);
    options.setPlaybackText("Playback: stopped");
    options.renderControlState();
};
exports.stopPlayback = stopPlayback;
const startPlayback = async (options, params) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
    if (!params.isLoaded || options.getIsPlaying())
        return;
    const saveResult = params.core.save();
    options.onFullSaveResult(saveResult);
    if (!saveResult.ok) {
        options.logDiagnostics("playback", saveResult.diagnostics);
        logPlaybackFailureDiagnostics("save failed", saveResult.diagnostics);
        if (saveResult.diagnostics.some((d) => d.code === "MEASURE_OVERFULL")) {
            const debugXml = params.core.debugSerializeCurrentXml();
            if (debugXml) {
                options.dumpOverfullContext(debugXml, options.editableVoice);
            }
            else if (options.debugLog) {
                console.warn("[mikuscore][debug] no in-memory XML to dump.");
            }
        }
        options.renderAll();
        options.setPlaybackText(`Playback: save failed (${summarizeDiagnostics(saveResult.diagnostics)})`);
        return;
    }
    const playbackDoc = (0, musicxml_io_1.parseMusicXmlDocument)(saveResult.xml);
    if (!playbackDoc) {
        options.setPlaybackText("Playback: invalid MusicXML");
        options.renderControlState();
        return;
    }
    const useMidiLikePlayback = options.getUseMidiLikePlayback();
    const playbackMode = useMidiLikePlayback ? "midi" : "playback";
    const parsedPlayback = (0, midi_io_1.buildPlaybackEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter, {
        mode: playbackMode,
        graceTimingMode: options.getGraceTimingMode(),
        metricAccentEnabled: options.getMetricAccentEnabled(),
        metricAccentProfile: options.getMetricAccentProfile(),
    });
    let effectiveParsedPlayback = parsedPlayback;
    let effectiveTempoEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiTempoEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    let effectiveControlEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiControlEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    if (params.startFromMeasure) {
        const startTick = resolveMeasureStartTickInPart(playbackDoc, params.startFromMeasure, options.ticksPerQuarter);
        if (startTick !== null && startTick > 0) {
            const trimmed = trimPlaybackFromTick(effectiveParsedPlayback, effectiveTempoEvents, effectiveControlEvents, startTick);
            effectiveParsedPlayback = trimmed.parsedPlayback;
            effectiveTempoEvents = trimmed.tempoEvents;
            effectiveControlEvents = trimmed.controlEvents;
        }
    }
    const events = effectiveParsedPlayback.events;
    if (events.length === 0) {
        options.setPlaybackText("Playback: no playable notes");
        options.renderControlState();
        return;
    }
    const timeSignatureEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiTimeSignatureEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    const keySignatureEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiKeySignatureEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    const waveform = options.getPlaybackWaveform();
    let midiBytes;
    try {
        const scoreTitle = (_f = (_c = (_b = (_a = playbackDoc.querySelector("score-partwise > work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : (_e = (_d = playbackDoc.querySelector("score-partwise > movement-title")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
        const movementTitle = (_j = (_h = (_g = playbackDoc.querySelector("score-partwise > movement-title")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "";
        const scoreComposer = (_q = (_m = (_l = (_k = playbackDoc
            .querySelector('score-partwise > identification > creator[type="composer"]')) === null || _k === void 0 ? void 0 : _k.textContent) === null || _l === void 0 ? void 0 : _l.trim()) !== null && _m !== void 0 ? _m : (_p = (_o = playbackDoc.querySelector("score-partwise > identification > creator")) === null || _o === void 0 ? void 0 : _o.textContent) === null || _p === void 0 ? void 0 : _p.trim()) !== null && _q !== void 0 ? _q : "";
        midiBytes = (0, midi_io_1.buildMidiBytesForPlayback)(events, effectiveParsedPlayback.tempo, "electric_piano_2", (0, midi_io_1.collectMidiProgramOverridesFromMusicXmlDoc)(playbackDoc), effectiveControlEvents, effectiveTempoEvents, timeSignatureEvents, keySignatureEvents, {
            metadata: {
                title: scoreTitle,
                movementTitle,
                composer: scoreComposer,
            },
        });
    }
    catch (error) {
        options.setPlaybackText("Playback: MIDI generation failed (" + (error instanceof Error ? error.message : String(error)) + ")");
        options.renderControlState();
        return;
    }
    try {
        await options.engine.playSchedule(toSynthSchedule(effectiveParsedPlayback.tempo, events, effectiveTempoEvents, effectiveControlEvents), waveform, () => {
            options.setIsPlaying(false);
            options.setPlaybackText("Playback: stopped");
            options.renderControlState();
        });
    }
    catch (error) {
        options.setPlaybackText("Playback: synth playback failed (" + (error instanceof Error ? error.message : String(error)) + ")");
        options.renderControlState();
        return;
    }
    options.setIsPlaying(true);
    const fromMeasureLabel = params.startFromMeasure
        ? ` / from measure ${params.startFromMeasure.measureNumber}`
        : "";
    options.setPlaybackText(`Playing: ${events.length} notes / mode ${playbackMode}${fromMeasureLabel} / MIDI ${midiBytes.length} bytes / waveform ${waveform}`);
    options.renderControlState();
    options.renderAll();
};
exports.startPlayback = startPlayback;
const startMeasurePlayback = async (options, params) => {
    if (!params.draftCore || options.getIsPlaying())
        return;
    const saveResult = params.draftCore.save();
    if (!saveResult.ok) {
        options.onMeasureSaveDiagnostics(saveResult.diagnostics);
        options.logDiagnostics("playback", saveResult.diagnostics);
        logPlaybackFailureDiagnostics("measure save failed", saveResult.diagnostics);
        options.setPlaybackText(`Playback: measure save failed (${summarizeDiagnostics(saveResult.diagnostics)})`);
        options.renderAll();
        return;
    }
    const playbackDoc = (0, musicxml_io_1.parseMusicXmlDocument)(saveResult.xml);
    if (!playbackDoc) {
        options.setPlaybackText("Playback: invalid MusicXML");
        options.renderControlState();
        return;
    }
    const useMidiLikePlayback = options.getUseMidiLikePlayback();
    const playbackMode = useMidiLikePlayback ? "midi" : "playback";
    const parsedPlayback = (0, midi_io_1.buildPlaybackEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter, {
        mode: playbackMode,
        graceTimingMode: options.getGraceTimingMode(),
        metricAccentEnabled: options.getMetricAccentEnabled(),
        metricAccentProfile: options.getMetricAccentProfile(),
    });
    const events = parsedPlayback.events;
    if (events.length === 0) {
        options.setPlaybackText("Playback: no playable notes in this measure");
        options.renderControlState();
        return;
    }
    const tempoEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiTempoEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    const controlEvents = useMidiLikePlayback
        ? (0, midi_io_1.collectMidiControlEventsFromMusicXmlDoc)(playbackDoc, options.ticksPerQuarter)
        : [];
    const waveform = options.getPlaybackWaveform();
    try {
        await options.engine.playSchedule(toSynthSchedule(parsedPlayback.tempo, events, tempoEvents, controlEvents), waveform, () => {
            options.setIsPlaying(false);
            options.setPlaybackText("Playback: stopped");
            options.renderControlState();
        });
    }
    catch (error) {
        options.setPlaybackText("Playback: measure playback failed (" + (error instanceof Error ? error.message : String(error)) + ")");
        options.renderControlState();
        return;
    }
    options.setIsPlaying(true);
    options.setPlaybackText(`Playing: selected measure / ${events.length} notes / mode ${playbackMode} / waveform ${waveform}`);
    options.renderControlState();
};
exports.startMeasurePlayback = startMeasurePlayback;

  },
  "core/interfaces.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

  },
  "src/ts/mxl-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractZipEntryBytesByPath = exports.listZipRootEntryPathsByExtensions = exports.extractTextFromZipByExtensions = exports.extractMusicXmlTextFromMxl = void 0;
const ZIP_EOCD_SIG = 0x06054b50;
const ZIP_CDFH_SIG = 0x02014b50;
const ZIP_LFH_SIG = 0x04034b50;
const readU16 = (bytes, offset) => {
    return bytes[offset] | (bytes[offset + 1] << 8);
};
const readU32 = (bytes, offset) => {
    return (bytes[offset] |
        (bytes[offset + 1] << 8) |
        (bytes[offset + 2] << 16) |
        (bytes[offset + 3] << 24)) >>> 0;
};
const normalizeZipPath = (value) => {
    return value.replace(/\\/g, "/").replace(/^\.?\//, "");
};
const decodeZipFileName = (bytes, utf8Flag) => {
    if (utf8Flag)
        return new TextDecoder("utf-8").decode(bytes);
    let out = "";
    for (const b of bytes)
        out += String.fromCharCode(b);
    return out;
};
const findEndOfCentralDirectoryOffset = (bytes) => {
    // EOCD is within the last 65,557 bytes by ZIP spec.
    const minOffset = Math.max(0, bytes.length - 65557);
    for (let offset = bytes.length - 22; offset >= minOffset; offset -= 1) {
        if (readU32(bytes, offset) === ZIP_EOCD_SIG)
            return offset;
    }
    return -1;
};
const readZipEntries = (bytes) => {
    const eocdOffset = findEndOfCentralDirectoryOffset(bytes);
    if (eocdOffset < 0)
        throw new Error("Invalid ZIP: end of central directory was not found.");
    const centralDirectorySize = readU32(bytes, eocdOffset + 12);
    const centralDirectoryOffset = readU32(bytes, eocdOffset + 16);
    const centralDirectoryEnd = centralDirectoryOffset + centralDirectorySize;
    if (centralDirectoryEnd > bytes.length) {
        throw new Error("Invalid ZIP: central directory is out of range.");
    }
    const entries = [];
    let offset = centralDirectoryOffset;
    while (offset < centralDirectoryEnd) {
        if (readU32(bytes, offset) !== ZIP_CDFH_SIG) {
            throw new Error("Invalid ZIP: central directory entry is malformed.");
        }
        const flags = readU16(bytes, offset + 8);
        const compressionMethod = readU16(bytes, offset + 10);
        const compressedSize = readU32(bytes, offset + 20);
        const uncompressedSize = readU32(bytes, offset + 24);
        const fileNameLength = readU16(bytes, offset + 28);
        const extraLength = readU16(bytes, offset + 30);
        const commentLength = readU16(bytes, offset + 32);
        const localHeaderOffset = readU32(bytes, offset + 42);
        const fileNameStart = offset + 46;
        const fileNameEnd = fileNameStart + fileNameLength;
        if (fileNameEnd > bytes.length) {
            throw new Error("Invalid ZIP: entry filename is out of range.");
        }
        const fileName = decodeZipFileName(bytes.slice(fileNameStart, fileNameEnd), (flags & 0x0800) !== 0);
        const normalizedPath = normalizeZipPath(fileName);
        if (localHeaderOffset + 30 > bytes.length || readU32(bytes, localHeaderOffset) !== ZIP_LFH_SIG) {
            throw new Error(`Invalid ZIP: local header is missing for "${normalizedPath}".`);
        }
        const localNameLength = readU16(bytes, localHeaderOffset + 26);
        const localExtraLength = readU16(bytes, localHeaderOffset + 28);
        const dataOffset = localHeaderOffset + 30 + localNameLength + localExtraLength;
        if (dataOffset + compressedSize > bytes.length) {
            throw new Error(`Invalid ZIP: data is out of range for "${normalizedPath}".`);
        }
        if (normalizedPath && !normalizedPath.endsWith("/")) {
            entries.push({
                path: normalizedPath,
                compressionMethod,
                compressedSize,
                uncompressedSize,
                dataOffset,
            });
        }
        offset = fileNameEnd + extraLength + commentLength;
    }
    return entries;
};
const inflateDeflateRaw = async (compressed) => {
    const DS = globalThis.DecompressionStream;
    if (!DS) {
        throw new Error("DecompressionStream is not available in this browser.");
    }
    const copied = new Uint8Array(compressed.length);
    copied.set(compressed);
    const stream = new Blob([copied.buffer]).stream().pipeThrough(new DS("deflate-raw"));
    const arrayBuffer = await new Response(stream).arrayBuffer();
    return new Uint8Array(arrayBuffer);
};
const extractEntryBytes = async (archiveBytes, entry) => {
    const compressed = archiveBytes.slice(entry.dataOffset, entry.dataOffset + entry.compressedSize);
    if (entry.compressionMethod === 0) {
        return compressed;
    }
    if (entry.compressionMethod === 8) {
        const inflated = await inflateDeflateRaw(compressed);
        if (entry.uncompressedSize > 0 && inflated.length !== entry.uncompressedSize) {
            // Keep going: some archives are inconsistent here, but data is often still valid.
        }
        return inflated;
    }
    throw new Error(`Unsupported ZIP compression method: ${entry.compressionMethod}.`);
};
const findEntryByPath = (entries, path) => {
    var _a;
    const normalized = normalizeZipPath(path);
    return (_a = entries.find((entry) => entry.path === normalized)) !== null && _a !== void 0 ? _a : null;
};
const findLikelyMusicXmlEntry = (entries) => {
    for (const entry of entries) {
        const p = entry.path.toLowerCase();
        if (p.endsWith(".musicxml"))
            return entry;
    }
    for (const entry of entries) {
        const p = entry.path.toLowerCase();
        if (p.endsWith(".xml") && p !== "meta-inf/container.xml")
            return entry;
    }
    return null;
};
const findFirstEntryByExtensions = (entries, extensions) => {
    const normalized = extensions.map((ext) => ext.trim().toLowerCase()).filter((ext) => ext.length > 0);
    if (!normalized.length)
        return null;
    for (const entry of entries) {
        const p = entry.path.toLowerCase();
        if (normalized.some((ext) => p.endsWith(ext)))
            return entry;
    }
    return null;
};
const listRootEntriesByExtensions = (entries, extensions) => {
    const normalized = extensions.map((ext) => ext.trim().toLowerCase()).filter((ext) => ext.length > 0);
    if (!normalized.length)
        return [];
    return entries.filter((entry) => {
        if (entry.path.includes("/"))
            return false;
        const p = entry.path.toLowerCase();
        return normalized.some((ext) => p.endsWith(ext));
    });
};
const parseContainerRootFilePath = (containerXmlText) => {
    var _a, _b;
    const doc = new DOMParser().parseFromString(containerXmlText, "application/xml");
    if (doc.querySelector("parsererror"))
        return null;
    const rootFileNode = doc.querySelector("rootfile[full-path]");
    const fullPath = (_b = (_a = rootFileNode === null || rootFileNode === void 0 ? void 0 : rootFileNode.getAttribute("full-path")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
    return fullPath || null;
};
const extractMusicXmlTextFromMxl = async (archiveBuffer) => {
    const archiveBytes = new Uint8Array(archiveBuffer);
    const entries = readZipEntries(archiveBytes);
    if (entries.length === 0) {
        throw new Error("The MXL archive is empty.");
    }
    const containerEntry = findEntryByPath(entries, "META-INF/container.xml");
    if (containerEntry) {
        const containerBytes = await extractEntryBytes(archiveBytes, containerEntry);
        const containerText = new TextDecoder("utf-8").decode(containerBytes);
        const rootPath = parseContainerRootFilePath(containerText);
        if (rootPath) {
            const rootEntry = findEntryByPath(entries, rootPath);
            if (!rootEntry) {
                throw new Error(`MusicXML root file was not found in archive: ${rootPath}`);
            }
            const xmlBytes = await extractEntryBytes(archiveBytes, rootEntry);
            return new TextDecoder("utf-8").decode(xmlBytes);
        }
    }
    const fallbackEntry = findLikelyMusicXmlEntry(entries);
    if (!fallbackEntry) {
        throw new Error("No MusicXML file (.musicxml or .xml) was found in the MXL archive.");
    }
    const xmlBytes = await extractEntryBytes(archiveBytes, fallbackEntry);
    return new TextDecoder("utf-8").decode(xmlBytes);
};
exports.extractMusicXmlTextFromMxl = extractMusicXmlTextFromMxl;
const extractTextFromZipByExtensions = async (archiveBuffer, extensions) => {
    const archiveBytes = new Uint8Array(archiveBuffer);
    const entries = readZipEntries(archiveBytes);
    if (!entries.length) {
        throw new Error("The ZIP archive is empty.");
    }
    const entry = findFirstEntryByExtensions(entries, extensions);
    if (!entry) {
        throw new Error(`No matching entry was found for extensions: ${extensions.join(", ")}`);
    }
    const bytes = await extractEntryBytes(archiveBytes, entry);
    return new TextDecoder("utf-8").decode(bytes);
};
exports.extractTextFromZipByExtensions = extractTextFromZipByExtensions;
const listZipRootEntryPathsByExtensions = async (archiveBuffer, extensions) => {
    const archiveBytes = new Uint8Array(archiveBuffer);
    const entries = readZipEntries(archiveBytes);
    if (!entries.length) {
        throw new Error("The ZIP archive is empty.");
    }
    return listRootEntriesByExtensions(entries, extensions).map((entry) => entry.path);
};
exports.listZipRootEntryPathsByExtensions = listZipRootEntryPathsByExtensions;
const extractZipEntryBytesByPath = async (archiveBuffer, entryPath) => {
    const archiveBytes = new Uint8Array(archiveBuffer);
    const entries = readZipEntries(archiveBytes);
    if (!entries.length) {
        throw new Error("The ZIP archive is empty.");
    }
    const entry = findEntryByPath(entries, entryPath);
    if (!entry) {
        throw new Error(`ZIP entry not found: ${entryPath}`);
    }
    return extractEntryBytes(archiveBytes, entry);
};
exports.extractZipEntryBytesByPath = extractZipEntryBytesByPath;

  },
  "src/ts/load-flow.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolveLoadFlow = void 0;
const mxl_io_1 = require("./mxl-io");
const looksLikeScorePartwise = (xmlText) => {
    return /<\s*score-partwise(?:\s|>)/i.test(xmlText);
};
const readBinaryFile = async (file) => {
    const withArrayBuffer = file;
    if (typeof withArrayBuffer.arrayBuffer === "function") {
        const buffer = await withArrayBuffer.arrayBuffer();
        return new Uint8Array(buffer);
    }
    const blob = file;
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const result = reader.result;
            if (!(result instanceof ArrayBuffer)) {
                reject(new Error("Failed to read binary file."));
                return;
            }
            resolve(new Uint8Array(result));
        };
        reader.onerror = () => {
            var _a;
            reject((_a = reader.error) !== null && _a !== void 0 ? _a : new Error("Failed to read binary file."));
        };
        reader.readAsArrayBuffer(blob);
    });
};
const readTextFile = async (file) => {
    const withText = file;
    if (typeof withText.text === "function") {
        return withText.text();
    }
    const blob = file;
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const result = reader.result;
            if (typeof result !== "string") {
                reject(new Error("Failed to read text file."));
                return;
            }
            resolve(result);
        };
        reader.onerror = () => {
            var _a;
            reject((_a = reader.error) !== null && _a !== void 0 ? _a : new Error("Failed to read text file."));
        };
        reader.readAsText(blob);
    });
};
const resolveLoadFlow = async (params) => {
    if (params.isNewType) {
        const sourceText = params.createNewMusicXml();
        return {
            ok: true,
            xmlToLoad: sourceText,
            collapseInputSection: true,
            nextXmlInputText: sourceText,
        };
    }
    let sourceText = "";
    if (params.isFileMode) {
        const selected = params.selectedFile;
        if (!selected) {
            return {
                ok: false,
                diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                diagnosticMessage: "Please select a file.",
            };
        }
        const lowerName = selected.name.toLowerCase();
        const isAbcFile = lowerName.endsWith(".abc");
        const isMxl = lowerName.endsWith(".mxl");
        const isMusicXmlLike = lowerName.endsWith(".musicxml") || lowerName.endsWith(".xml");
        const isMidiFile = lowerName.endsWith(".mid") || lowerName.endsWith(".midi");
        const isVsqxFile = lowerName.endsWith(".vsqx");
        const isMeiFile = lowerName.endsWith(".mei");
        const isLilyPondFile = lowerName.endsWith(".ly");
        const isMuseScoreXmlFile = lowerName.endsWith(".mscx");
        const isMuseScoreZipFile = lowerName.endsWith(".mscz");
        if (isMxl) {
            try {
                sourceText = await (0, mxl_io_1.extractMusicXmlTextFromMxl)(await selected.arrayBuffer());
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse MXL: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
            const normalized = params.formatImportedMusicXml(sourceText);
            return {
                ok: true,
                xmlToLoad: normalized,
                collapseInputSection: true,
                nextXmlInputText: normalized,
            };
        }
        if (isMusicXmlLike) {
            sourceText = await readTextFile(selected);
            const normalized = params.formatImportedMusicXml(sourceText);
            return {
                ok: true,
                xmlToLoad: normalized,
                collapseInputSection: true,
                nextXmlInputText: normalized,
            };
        }
        if (isAbcFile) {
            sourceText = await readTextFile(selected);
            try {
                const convertedXml = params.formatImportedMusicXml(params.convertAbcToMusicXml(sourceText));
                return {
                    ok: true,
                    xmlToLoad: convertedXml,
                    collapseInputSection: true,
                    nextXmlInputText: convertedXml,
                    nextAbcInputText: sourceText,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse ABC: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isMidiFile) {
            try {
                const converted = params.convertMidiToMusicXml(await readBinaryFile(selected));
                if (!converted.ok) {
                    const first = converted.diagnostics[0];
                    return {
                        ok: false,
                        diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                        diagnosticMessage: `Failed to parse MIDI: ${first ? `${first.message} (${first.code})` : "Unknown parse error."}`,
                    };
                }
                const formattedXml = params.formatImportedMusicXml(converted.xml);
                return {
                    ok: true,
                    xmlToLoad: formattedXml,
                    collapseInputSection: true,
                    nextXmlInputText: formattedXml,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse MIDI: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isVsqxFile) {
            try {
                const converted = params.convertVsqxToMusicXml(await readTextFile(selected));
                if (!converted.ok) {
                    const first = converted.diagnostics[0];
                    return {
                        ok: false,
                        diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                        diagnosticMessage: `Failed to parse VSQX: ${first ? `${first.message} (${first.code})` : "Unknown parse error."}`,
                    };
                }
                const formattedXml = params.formatImportedMusicXml(converted.xml);
                return {
                    ok: true,
                    xmlToLoad: formattedXml,
                    collapseInputSection: true,
                    nextXmlInputText: formattedXml,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse VSQX: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isMeiFile) {
            sourceText = await readTextFile(selected);
            try {
                const convertedXml = params.formatImportedMusicXml(params.convertMeiToMusicXml(sourceText));
                return {
                    ok: true,
                    xmlToLoad: convertedXml,
                    collapseInputSection: true,
                    nextXmlInputText: convertedXml,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse MEI: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isLilyPondFile) {
            sourceText = await readTextFile(selected);
            try {
                const convertedXml = params.formatImportedMusicXml(params.convertLilyPondToMusicXml(sourceText));
                return {
                    ok: true,
                    xmlToLoad: convertedXml,
                    collapseInputSection: true,
                    nextXmlInputText: convertedXml,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse LilyPond: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isMuseScoreZipFile) {
            try {
                try {
                    // Prefer MuseScore XML entry first; generic MXL fallback can pick unrelated XML entries.
                    const mscxText = await (0, mxl_io_1.extractTextFromZipByExtensions)(await selected.arrayBuffer(), [".mscx"]);
                    const convertedXml = params.formatImportedMusicXml(params.convertMuseScoreToMusicXml(mscxText));
                    return {
                        ok: true,
                        xmlToLoad: convertedXml,
                        collapseInputSection: true,
                        nextXmlInputText: convertedXml,
                    };
                }
                catch (_a) {
                    // Fallback: if this ZIP actually carries MusicXML, accept it as-is.
                    sourceText = await (0, mxl_io_1.extractMusicXmlTextFromMxl)(await selected.arrayBuffer());
                    if (looksLikeScorePartwise(sourceText)) {
                        const normalized = params.formatImportedMusicXml(sourceText);
                        return {
                            ok: true,
                            xmlToLoad: normalized,
                            collapseInputSection: true,
                            nextXmlInputText: normalized,
                        };
                    }
                    // Last resort: try interpreting the extracted XML as MuseScore XML text.
                    const convertedXml = params.formatImportedMusicXml(params.convertMuseScoreToMusicXml(sourceText));
                    return {
                        ok: true,
                        xmlToLoad: convertedXml,
                        collapseInputSection: true,
                        nextXmlInputText: convertedXml,
                    };
                }
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse MuseScore: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        if (isMuseScoreXmlFile) {
            sourceText = await readTextFile(selected);
            try {
                const convertedXml = params.formatImportedMusicXml(params.convertMuseScoreToMusicXml(sourceText));
                return {
                    ok: true,
                    xmlToLoad: convertedXml,
                    collapseInputSection: true,
                    nextXmlInputText: convertedXml,
                };
            }
            catch (error) {
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse MuseScore: ${error instanceof Error ? error.message : String(error)}`,
                };
            }
        }
        return {
            ok: false,
            diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
            diagnosticMessage: "Unsupported file extension. Use .musicxml, .xml, .mxl, .abc, .mid, .midi, .vsqx, .mei, .ly, .mscx, or .mscz.",
        };
    }
    if (params.sourceType === "xml") {
        const normalized = params.formatImportedMusicXml(params.xmlSourceText);
        return {
            ok: true,
            xmlToLoad: normalized,
            collapseInputSection: true,
            nextXmlInputText: normalized,
        };
    }
    if (params.sourceType === "abc") {
        sourceText = params.abcSourceText;
        try {
            const convertedXml = params.formatImportedMusicXml(params.convertAbcToMusicXml(sourceText));
            return {
                ok: true,
                xmlToLoad: convertedXml,
                collapseInputSection: true,
                nextXmlInputText: convertedXml,
            };
        }
        catch (error) {
            return {
                ok: false,
                diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                diagnosticMessage: `Failed to parse ABC: ${error instanceof Error ? error.message : String(error)}`,
            };
        }
    }
    if (params.sourceType === "vsqx") {
        try {
            const converted = params.convertVsqxToMusicXml(params.vsqxSourceText);
            if (!converted.ok) {
                const first = converted.diagnostics[0];
                return {
                    ok: false,
                    diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                    diagnosticMessage: `Failed to parse VSQX: ${first ? `${first.message} (${first.code})` : "Unknown parse error."}`,
                };
            }
            const convertedXml = params.formatImportedMusicXml(converted.xml);
            return {
                ok: true,
                xmlToLoad: convertedXml,
                collapseInputSection: true,
                nextXmlInputText: convertedXml,
            };
        }
        catch (error) {
            return {
                ok: false,
                diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                diagnosticMessage: `Failed to parse VSQX: ${error instanceof Error ? error.message : String(error)}`,
            };
        }
    }
    if (params.sourceType === "mei") {
        try {
            const convertedXml = params.formatImportedMusicXml(params.convertMeiToMusicXml(params.meiSourceText));
            return {
                ok: true,
                xmlToLoad: convertedXml,
                collapseInputSection: true,
                nextXmlInputText: convertedXml,
            };
        }
        catch (error) {
            return {
                ok: false,
                diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                diagnosticMessage: `Failed to parse MEI: ${error instanceof Error ? error.message : String(error)}`,
            };
        }
    }
    if (params.sourceType === "lilypond") {
        try {
            const convertedXml = params.formatImportedMusicXml(params.convertLilyPondToMusicXml(params.lilyPondSourceText));
            return {
                ok: true,
                xmlToLoad: convertedXml,
                collapseInputSection: true,
                nextXmlInputText: convertedXml,
            };
        }
        catch (error) {
            return {
                ok: false,
                diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
                diagnosticMessage: `Failed to parse LilyPond: ${error instanceof Error ? error.message : String(error)}`,
            };
        }
    }
    try {
        const convertedXml = params.formatImportedMusicXml(params.convertMuseScoreToMusicXml(params.museScoreSourceText));
        return {
            ok: true,
            xmlToLoad: convertedXml,
            collapseInputSection: true,
            nextXmlInputText: convertedXml,
        };
    }
    catch (error) {
        return {
            ok: false,
            diagnosticCode: "MVP_INVALID_COMMAND_PAYLOAD",
            diagnosticMessage: `Failed to parse MuseScore: ${error instanceof Error ? error.message : String(error)}`,
        };
    }
};
exports.resolveLoadFlow = resolveLoadFlow;

  },
  "src/ts/midi-musescore-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolvePlaybackBuildModeForMidiExport = exports.resolveMidiExportRuntimeOptions = exports.normalizeMidiExportProfile = exports.MUSESCORE_PARITY_TICKS_PER_QUARTER = void 0;
exports.MUSESCORE_PARITY_TICKS_PER_QUARTER = 480;
const normalizeMidiExportProfile = (value) => {
    return value === "musescore_parity" ? "musescore_parity" : "safe";
};
exports.normalizeMidiExportProfile = normalizeMidiExportProfile;
const resolveMidiExportRuntimeOptions = (profileValue, baseTicksPerQuarter) => {
    const profile = (0, exports.normalizeMidiExportProfile)(profileValue);
    const normalizedBaseTicks = Number.isFinite(baseTicksPerQuarter) && Math.round(baseTicksPerQuarter) > 0
        ? Math.round(baseTicksPerQuarter)
        : 480;
    if (profile === "musescore_parity") {
        return {
            profile,
            ticksPerQuarter: exports.MUSESCORE_PARITY_TICKS_PER_QUARTER,
            normalizeForParity: true,
            eventBuildPolicy: "musescore_parity_tuned",
            includeGraceInPlaybackLikeMode: true,
            includeOrnamentInPlaybackLikeMode: true,
            includeTieInPlaybackLikeMode: true,
            rawWriter: true,
            rawRetriggerPolicy: "off_before_on",
        };
    }
    return {
        profile,
        ticksPerQuarter: normalizedBaseTicks,
        normalizeForParity: false,
        eventBuildPolicy: "safe_midi",
        includeGraceInPlaybackLikeMode: false,
        includeOrnamentInPlaybackLikeMode: false,
        includeTieInPlaybackLikeMode: false,
        rawWriter: false,
        rawRetriggerPolicy: "off_before_on",
    };
};
exports.resolveMidiExportRuntimeOptions = resolveMidiExportRuntimeOptions;
const resolvePlaybackBuildModeForMidiExport = (policy) => {
    if (policy === "musescore_parity_tuned") {
        // IMPORTANT:
        // This is not "quick playback mode" semantics.
        // We intentionally reuse the playback-style event shaping because it currently
        // matches MuseScore-exported MIDI closer in parity measurements.
        return "playback";
    }
    return "midi";
};
exports.resolvePlaybackBuildModeForMidiExport = resolvePlaybackBuildModeForMidiExport;

  },
  "src/ts/download-flow.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createZipBundleDownloadPayload = exports.createMuseScoreDownloadPayload = exports.createLilyPondDownloadPayload = exports.createMeiDownloadPayload = exports.createAbcDownloadPayload = exports.createMidiDownloadPayload = exports.createVsqxDownloadPayload = exports.createSvgDownloadPayload = exports.createMusicXmlDownloadPayload = exports.triggerFileDownload = void 0;
const midi_io_1 = require("./midi-io");
const midi_musescore_io_1 = require("./midi-musescore-io");
const musicxml_io_1 = require("./musicxml-io");
const pad2 = (value) => String(value).padStart(2, "0");
const buildFileTimestamp = () => {
    const now = new Date();
    return [
        now.getFullYear(),
        pad2(now.getMonth() + 1),
        pad2(now.getDate()),
        pad2(now.getHours()),
        pad2(now.getMinutes()),
    ].join("");
};
const prettyPrintXmlWithTwoSpaceIndent = (xml) => {
    const compact = String(xml || "").replace(/>\s+</g, "><").trim();
    const split = compact.replace(/(>)(<)(\/*)/g, "$1\n$2$3").split("\n");
    let indentLevel = 0;
    const lines = [];
    for (const rawToken of split) {
        const token = rawToken.trim();
        if (!token)
            continue;
        if (/^<\//.test(token))
            indentLevel = Math.max(0, indentLevel - 1);
        lines.push(`${"  ".repeat(indentLevel)}${token}`);
        const isOpening = /^<[^!?/][^>]*>$/.test(token);
        const isSelfClosing = /\/>$/.test(token);
        if (isOpening && !isSelfClosing)
            indentLevel += 1;
    }
    return lines.join("\n");
};
const triggerFileDownload = (payload) => {
    const url = URL.createObjectURL(payload.blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = payload.fileName;
    a.click();
    URL.revokeObjectURL(url);
};
exports.triggerFileDownload = triggerFileDownload;
const crc32Table = (() => {
    const table = new Uint32Array(256);
    for (let n = 0; n < 256; n += 1) {
        let c = n;
        for (let k = 0; k < 8; k += 1) {
            c = (c & 1) !== 0 ? (0xedb88320 ^ (c >>> 1)) : (c >>> 1);
        }
        table[n] = c >>> 0;
    }
    return table;
})();
const crc32 = (bytes) => {
    let crc = 0xffffffff;
    for (let i = 0; i < bytes.length; i += 1) {
        crc = crc32Table[(crc ^ bytes[i]) & 0xff] ^ (crc >>> 8);
    }
    return (crc ^ 0xffffffff) >>> 0;
};
const writeU16 = (target, offset, value) => {
    target[offset] = value & 0xff;
    target[offset + 1] = (value >>> 8) & 0xff;
};
const writeU32 = (target, offset, value) => {
    target[offset] = value & 0xff;
    target[offset + 1] = (value >>> 8) & 0xff;
    target[offset + 2] = (value >>> 16) & 0xff;
    target[offset + 3] = (value >>> 24) & 0xff;
};
const toDosDateTime = (date) => {
    const year = Math.max(1980, Math.min(2107, date.getFullYear()));
    const month = Math.max(1, Math.min(12, date.getMonth() + 1));
    const day = Math.max(1, Math.min(31, date.getDate()));
    const hours = Math.max(0, Math.min(23, date.getHours()));
    const minutes = Math.max(0, Math.min(59, date.getMinutes()));
    const seconds = Math.max(0, Math.min(59, date.getSeconds()));
    const dosTime = ((hours & 0x1f) << 11) | ((minutes & 0x3f) << 5) | ((Math.floor(seconds / 2)) & 0x1f);
    const dosDate = (((year - 1980) & 0x7f) << 9) | ((month & 0x0f) << 5) | (day & 0x1f);
    return { dosTime, dosDate };
};
const compressDeflateRaw = async (input) => {
    const CS = globalThis.CompressionStream;
    if (!CS)
        return null;
    try {
        const source = new Uint8Array(input.length);
        source.set(input);
        const stream = new Blob([bytesToArrayBuffer(source)]).stream().pipeThrough(new CS("deflate-raw"));
        const compressedBuffer = await new Response(stream).arrayBuffer();
        return new Uint8Array(compressedBuffer);
    }
    catch (_a) {
        return null;
    }
};
const makeZipBytes = async (entries, preferCompression) => {
    const encoder = new TextEncoder();
    const localChunks = [];
    const centralChunks = [];
    let localOffset = 0;
    const nowDos = toDosDateTime(new Date());
    const encodedEntries = [];
    for (const entry of entries) {
        const pathBytes = encoder.encode(entry.path.replace(/\\/g, "/").replace(/^\/+/, ""));
        const uncompressed = entry.bytes;
        let data = uncompressed;
        let method = 0;
        if (preferCompression) {
            const compressed = await compressDeflateRaw(uncompressed);
            if (compressed && compressed.length < uncompressed.length) {
                data = compressed;
                method = 8;
            }
        }
        encodedEntries.push({
            pathBytes,
            data,
            crc: crc32(uncompressed),
            method,
            compressedSize: data.length,
            uncompressedSize: uncompressed.length,
        });
    }
    for (const entry of encodedEntries) {
        const { pathBytes, data, crc, method, compressedSize, uncompressedSize } = entry;
        const localHeader = new Uint8Array(30 + pathBytes.length);
        writeU32(localHeader, 0, 0x04034b50);
        writeU16(localHeader, 4, 20);
        writeU16(localHeader, 6, 0x0800);
        writeU16(localHeader, 8, method);
        writeU16(localHeader, 10, nowDos.dosTime);
        writeU16(localHeader, 12, nowDos.dosDate);
        writeU32(localHeader, 14, crc);
        writeU32(localHeader, 18, compressedSize);
        writeU32(localHeader, 22, uncompressedSize);
        writeU16(localHeader, 26, pathBytes.length);
        writeU16(localHeader, 28, 0);
        localHeader.set(pathBytes, 30);
        localChunks.push(localHeader, data);
        const centralHeader = new Uint8Array(46 + pathBytes.length);
        writeU32(centralHeader, 0, 0x02014b50);
        writeU16(centralHeader, 4, 20);
        writeU16(centralHeader, 6, 20);
        writeU16(centralHeader, 8, 0x0800);
        writeU16(centralHeader, 10, method);
        writeU16(centralHeader, 12, nowDos.dosTime);
        writeU16(centralHeader, 14, nowDos.dosDate);
        writeU32(centralHeader, 16, crc);
        writeU32(centralHeader, 20, compressedSize);
        writeU32(centralHeader, 24, uncompressedSize);
        writeU16(centralHeader, 28, pathBytes.length);
        writeU16(centralHeader, 30, 0);
        writeU16(centralHeader, 32, 0);
        writeU16(centralHeader, 34, 0);
        writeU16(centralHeader, 36, 0);
        writeU32(centralHeader, 38, 0);
        writeU32(centralHeader, 42, localOffset);
        centralHeader.set(pathBytes, 46);
        centralChunks.push(centralHeader);
        localOffset += localHeader.length + compressedSize;
    }
    const localSize = localChunks.reduce((sum, b) => sum + b.length, 0);
    const centralSize = centralChunks.reduce((sum, b) => sum + b.length, 0);
    const eocd = new Uint8Array(22);
    writeU32(eocd, 0, 0x06054b50);
    writeU16(eocd, 4, 0);
    writeU16(eocd, 6, 0);
    writeU16(eocd, 8, entries.length);
    writeU16(eocd, 10, entries.length);
    writeU32(eocd, 12, centralSize);
    writeU32(eocd, 16, localSize);
    writeU16(eocd, 20, 0);
    const out = new Uint8Array(localSize + centralSize + eocd.length);
    let cursor = 0;
    for (const chunk of localChunks) {
        out.set(chunk, cursor);
        cursor += chunk.length;
    }
    for (const chunk of centralChunks) {
        out.set(chunk, cursor);
        cursor += chunk.length;
    }
    out.set(eocd, cursor);
    return out;
};
const makeMxlBytes = async (formattedXml) => {
    const encoder = new TextEncoder();
    const containerXml = `<?xml version="1.0" encoding="UTF-8"?>` +
        `<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">` +
        `<rootfiles><rootfile full-path="score.musicxml" media-type="application/vnd.recordare.musicxml+xml"/></rootfiles>` +
        `</container>`;
    return makeZipBytes([
        { path: "META-INF/container.xml", bytes: encoder.encode(containerXml) },
        { path: "score.musicxml", bytes: encoder.encode(formattedXml) },
    ], true);
};
const makeMsczBytes = async (mscxText) => {
    const encoder = new TextEncoder();
    return makeZipBytes([{ path: "score.mscx", bytes: encoder.encode(mscxText) }], true);
};
const bytesToArrayBuffer = (bytes) => {
    const out = new ArrayBuffer(bytes.byteLength);
    new Uint8Array(out).set(bytes);
    return out;
};
const createMusicXmlDownloadPayload = async (xmlText, options = {}) => {
    const ts = buildFileTimestamp();
    const formattedXml = (0, musicxml_io_1.prettyPrintMusicXmlText)(xmlText);
    if (options.compressed === true) {
        const mxlBytes = await makeMxlBytes(formattedXml);
        return {
            fileName: `mikuscore-${ts}.mxl`,
            blob: new Blob([bytesToArrayBuffer(mxlBytes)], { type: "application/vnd.recordare.musicxml" }),
        };
    }
    const extension = options.useXmlExtension === true ? "xml" : "musicxml";
    return {
        fileName: `mikuscore-${ts}.${extension}`,
        blob: new Blob([formattedXml], { type: "application/xml;charset=utf-8" }),
    };
};
exports.createMusicXmlDownloadPayload = createMusicXmlDownloadPayload;
const createSvgDownloadPayload = (svgText) => {
    const ts = buildFileTimestamp();
    return {
        fileName: `mikuscore-${ts}.svg`,
        blob: new Blob([svgText], { type: "image/svg+xml;charset=utf-8" }),
    };
};
exports.createSvgDownloadPayload = createSvgDownloadPayload;
const createVsqxDownloadPayload = (vsqxText) => {
    const ts = buildFileTimestamp();
    const formattedVsqx = prettyPrintXmlWithTwoSpaceIndent(vsqxText);
    return {
        fileName: `mikuscore-${ts}.vsqx`,
        blob: new Blob([formattedVsqx], { type: "application/xml;charset=utf-8" }),
    };
};
exports.createVsqxDownloadPayload = createVsqxDownloadPayload;
const createMidiDownloadPayload = (xmlText, ticksPerQuarter, programPreset = "electric_piano_2", forceProgramPreset = false, graceTimingMode = "before_beat", metricAccentEnabled = false, metricAccentProfile = "subtle", exportProfile = "safe") => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
    const playbackDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!playbackDoc)
        return null;
    const runtime = (0, midi_musescore_io_1.resolveMidiExportRuntimeOptions)(exportProfile, ticksPerQuarter);
    const exportTicksPerQuarter = runtime.ticksPerQuarter;
    const buildMode = (0, midi_musescore_io_1.resolvePlaybackBuildModeForMidiExport)(runtime.eventBuildPolicy);
    const parsedPlayback = (0, midi_io_1.buildPlaybackEventsFromMusicXmlDoc)(playbackDoc, exportTicksPerQuarter, {
        mode: buildMode,
        graceTimingMode,
        metricAccentEnabled,
        metricAccentProfile,
        includeGraceInPlaybackLikeMode: runtime.includeGraceInPlaybackLikeMode,
        includeOrnamentInPlaybackLikeMode: runtime.includeOrnamentInPlaybackLikeMode,
        includeTieInPlaybackLikeMode: runtime.includeTieInPlaybackLikeMode,
    });
    if (parsedPlayback.events.length === 0)
        return null;
    const midiProgramOverrides = forceProgramPreset
        ? new Map()
        : (0, midi_io_1.collectMidiProgramOverridesFromMusicXmlDoc)(playbackDoc);
    const midiControlEvents = (0, midi_io_1.collectMidiControlEventsFromMusicXmlDoc)(playbackDoc, exportTicksPerQuarter);
    const midiTempoEvents = (0, midi_io_1.collectMidiTempoEventsFromMusicXmlDoc)(playbackDoc, exportTicksPerQuarter);
    const midiTimeSignatureEvents = (0, midi_io_1.collectMidiTimeSignatureEventsFromMusicXmlDoc)(playbackDoc, exportTicksPerQuarter);
    const midiKeySignatureEvents = (0, midi_io_1.collectMidiKeySignatureEventsFromMusicXmlDoc)(playbackDoc, exportTicksPerQuarter);
    let midiBytes;
    try {
        const scoreTitle = (_f = (_c = (_b = (_a = playbackDoc.querySelector("score-partwise > work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : (_e = (_d = playbackDoc.querySelector("score-partwise > movement-title")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
        const movementTitle = (_j = (_h = (_g = playbackDoc.querySelector("score-partwise > movement-title")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "";
        const scoreComposer = (_q = (_m = (_l = (_k = playbackDoc
            .querySelector('score-partwise > identification > creator[type="composer"]')) === null || _k === void 0 ? void 0 : _k.textContent) === null || _l === void 0 ? void 0 : _l.trim()) !== null && _m !== void 0 ? _m : (_p = (_o = playbackDoc.querySelector("score-partwise > identification > creator")) === null || _o === void 0 ? void 0 : _o.textContent) === null || _p === void 0 ? void 0 : _p.trim()) !== null && _q !== void 0 ? _q : "";
        midiBytes = (0, midi_io_1.buildMidiBytesForPlayback)(parsedPlayback.events, parsedPlayback.tempo, programPreset, midiProgramOverrides, midiControlEvents, midiTempoEvents, midiTimeSignatureEvents, midiKeySignatureEvents, {
            embedMksSysEx: true,
            ticksPerQuarter: exportTicksPerQuarter,
            normalizeForParity: runtime.normalizeForParity,
            rawWriter: runtime.rawWriter,
            rawRetriggerPolicy: runtime.rawRetriggerPolicy,
            metadata: {
                title: scoreTitle,
                movementTitle,
                composer: scoreComposer,
            },
        });
    }
    catch (_r) {
        return null;
    }
    const midiArrayBuffer = new ArrayBuffer(midiBytes.byteLength);
    new Uint8Array(midiArrayBuffer).set(midiBytes);
    const ts = buildFileTimestamp();
    return {
        fileName: `mikuscore-${ts}.mid`,
        blob: new Blob([midiArrayBuffer], { type: "audio/midi" }),
    };
};
exports.createMidiDownloadPayload = createMidiDownloadPayload;
const createAbcDownloadPayload = (xmlText, convertMusicXmlToAbc) => {
    const musicXmlDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!musicXmlDoc)
        return null;
    let abcText = "";
    try {
        abcText = convertMusicXmlToAbc(musicXmlDoc);
    }
    catch (_a) {
        return null;
    }
    const ts = buildFileTimestamp();
    return {
        fileName: `mikuscore-${ts}.abc`,
        blob: new Blob([abcText], { type: "text/plain;charset=utf-8" }),
    };
};
exports.createAbcDownloadPayload = createAbcDownloadPayload;
const createMeiDownloadPayload = (xmlText, convertMusicXmlToMei) => {
    const musicXmlDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!musicXmlDoc)
        return null;
    let meiText = "";
    try {
        meiText = convertMusicXmlToMei(musicXmlDoc);
    }
    catch (_a) {
        return null;
    }
    const formattedMei = (0, musicxml_io_1.prettyPrintMusicXmlText)(meiText);
    const ts = buildFileTimestamp();
    return {
        fileName: `mikuscore-${ts}.mei`,
        blob: new Blob([formattedMei], { type: "application/mei+xml;charset=utf-8" }),
    };
};
exports.createMeiDownloadPayload = createMeiDownloadPayload;
const createLilyPondDownloadPayload = (xmlText, convertMusicXmlToLilyPond) => {
    const musicXmlDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!musicXmlDoc)
        return null;
    let lilyText = "";
    try {
        lilyText = convertMusicXmlToLilyPond(musicXmlDoc);
    }
    catch (_a) {
        return null;
    }
    const ts = buildFileTimestamp();
    return {
        fileName: `mikuscore-${ts}.ly`,
        blob: new Blob([lilyText], { type: "text/plain;charset=utf-8" }),
    };
};
exports.createLilyPondDownloadPayload = createLilyPondDownloadPayload;
const createMuseScoreDownloadPayload = async (xmlText, convertMusicXmlToMuseScore, options = {}) => {
    const musicXmlDoc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!musicXmlDoc)
        return null;
    let mscxText = "";
    try {
        mscxText = convertMusicXmlToMuseScore(musicXmlDoc);
    }
    catch (_a) {
        return null;
    }
    const formattedMscx = prettyPrintXmlWithTwoSpaceIndent(mscxText);
    const ts = buildFileTimestamp();
    if (options.compressed === true) {
        const msczBytes = await makeMsczBytes(formattedMscx);
        return {
            fileName: `mikuscore-${ts}.mscz`,
            blob: new Blob([bytesToArrayBuffer(msczBytes)], { type: "application/zip" }),
        };
    }
    return {
        fileName: `mikuscore-${ts}.mscx`,
        blob: new Blob([formattedMscx], { type: "application/xml;charset=utf-8" }),
    };
};
exports.createMuseScoreDownloadPayload = createMuseScoreDownloadPayload;
const createZipBundleDownloadPayload = async (entries, options = {}) => {
    const ts = buildFileTimestamp();
    const safeBase = String(options.baseName || "mikuscore-all").trim() || "mikuscore-all";
    const zipEntries = [];
    for (const entry of entries) {
        const fileName = String(entry.fileName || "").trim();
        if (!fileName)
            continue;
        const bytes = new Uint8Array(await entry.blob.arrayBuffer());
        zipEntries.push({ path: fileName, bytes });
    }
    const zipBytes = await makeZipBytes(zipEntries, options.compressed !== false);
    return {
        fileName: `${safeBase}-${ts}.zip`,
        blob: new Blob([bytesToArrayBuffer(zipBytes)], { type: "application/zip" }),
    };
};
exports.createZipBundleDownloadPayload = createZipBundleDownloadPayload;

  },
  "src/ts/vsqx-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertMusicXmlToVsqx = exports.convertVsqxToMusicXml = exports.isVsqxBridgeAvailable = exports.installVsqxMusicXmlNormalizationHook = void 0;
const bridge = () => {
    var _a;
    if (typeof window === "undefined")
        return null;
    return (_a = window.UtaFormatix3TsPlusMikuscore) !== null && _a !== void 0 ? _a : null;
};
const issueCode = (issue, fallback) => {
    const raw = String(issue.code || "").trim();
    return raw || fallback;
};
const issueMessage = (issue, fallback) => {
    const raw = String(issue.message || "").trim();
    return raw || fallback;
};
const installVsqxMusicXmlNormalizationHook = (normalizeImportedMusicXmlText) => {
    var _a;
    if (typeof window === "undefined")
        return;
    window.__utaformatix3TsPlusMikuscoreHooks = {
        ...((_a = window.__utaformatix3TsPlusMikuscoreHooks) !== null && _a !== void 0 ? _a : {}),
        normalizeImportedMusicXmlText,
    };
};
exports.installVsqxMusicXmlNormalizationHook = installVsqxMusicXmlNormalizationHook;
const isVsqxBridgeAvailable = () => {
    const runtime = bridge();
    return !!runtime;
};
exports.isVsqxBridgeAvailable = isVsqxBridgeAvailable;
const convertVsqxToMusicXml = (vsqxText, options) => {
    const runtime = bridge();
    if (!runtime) {
        return {
            ok: false,
            xml: "",
            diagnostics: [
                {
                    code: "VSQX_BRIDGE_UNAVAILABLE",
                    message: "VSQX converter bundle is not loaded.",
                },
            ],
            warnings: [],
        };
    }
    const report = runtime.convertVsqxToMusicXmlWithReport(vsqxText, options);
    const issues = Array.isArray(report === null || report === void 0 ? void 0 : report.issues) ? report.issues : [];
    const diagnostics = issues
        .filter((issue) => String(issue.level || "").toLowerCase() === "error")
        .map((issue, index) => ({
        code: issueCode(issue, `VSQX_CONVERT_ERROR_${index + 1}`),
        message: issueMessage(issue, "VSQX to MusicXML conversion failed."),
    }));
    const warnings = issues
        .filter((issue) => {
        const level = String(issue.level || "").toLowerCase();
        return level === "warning" || level === "info";
    })
        .map((issue, index) => ({
        code: issueCode(issue, `VSQX_CONVERT_WARNING_${index + 1}`),
        message: issueMessage(issue, "VSQX to MusicXML conversion emitted a warning."),
    }));
    const xml = String((report === null || report === void 0 ? void 0 : report.musicXml) || "");
    if (!xml.trim()) {
        const fallbackDiagnostics = diagnostics.length
            ? diagnostics
            : [
                {
                    code: "VSQX_CONVERT_EMPTY_RESULT",
                    message: "VSQX converter returned empty MusicXML.",
                },
            ];
        return {
            ok: false,
            xml: "",
            diagnostics: fallbackDiagnostics,
            warnings,
        };
    }
    return {
        ok: diagnostics.length === 0,
        xml,
        diagnostics,
        warnings,
    };
};
exports.convertVsqxToMusicXml = convertVsqxToMusicXml;
const convertMusicXmlToVsqx = (musicXmlText, options) => {
    const runtime = bridge();
    if (!runtime) {
        return {
            ok: false,
            vsqx: "",
            diagnostic: {
                code: "VSQX_BRIDGE_UNAVAILABLE",
                message: "VSQX converter bundle is not loaded.",
            },
        };
    }
    try {
        const vsqx = runtime.convertMusicXmlToVsqx(musicXmlText, options);
        if (!String(vsqx || "").trim()) {
            return {
                ok: false,
                vsqx: "",
                diagnostic: {
                    code: "VSQX_EXPORT_EMPTY_RESULT",
                    message: "MusicXML to VSQX conversion returned empty output.",
                },
            };
        }
        return { ok: true, vsqx };
    }
    catch (error) {
        return {
            ok: false,
            vsqx: "",
            diagnostic: {
                code: "VSQX_EXPORT_FAILED",
                message: error instanceof Error ? error.message : "MusicXML to VSQX conversion failed.",
            },
        };
    }
};
exports.convertMusicXmlToVsqx = convertMusicXmlToVsqx;

  },
  "src/ts/musescore-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.exportMusicXmlDomToMuseScore = exports.convertMuseScoreToMusicXml = void 0;
const accidentalSpelling_1 = require("../../core/accidentalSpelling");
const beam_common_1 = require("./beam-common");
const xmlEscape = (value) => String(value !== null && value !== void 0 ? value : "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&apos;");
const firstNumber = (scope, selector) => {
    var _a, _b;
    const text = ((_b = (_a = scope.querySelector(selector)) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    if (!text)
        return null;
    const n = Number(text);
    return Number.isFinite(n) ? n : null;
};
const firstAttrNumber = (scope, selector, attrName) => {
    var _a, _b;
    const raw = ((_b = (_a = scope.querySelector(selector)) === null || _a === void 0 ? void 0 : _a.getAttribute(attrName)) !== null && _b !== void 0 ? _b : "").trim();
    if (!raw)
        return null;
    const n = Number(raw);
    return Number.isFinite(n) ? n : null;
};
const durationTypeToDivisions = (durationType, divisions) => {
    const base = Math.max(1, Math.round(divisions));
    switch (String(durationType || "").trim().toLowerCase()) {
        case "whole":
            return base * 4;
        case "half":
            return base * 2;
        case "quarter":
            return base;
        case "eighth":
            return Math.round(base / 2);
        case "16th":
            return Math.round(base / 4);
        case "32nd":
            return Math.round(base / 8);
        case "64th":
            return Math.round(base / 16);
        default:
            return null;
    }
};
const durationWithDots = (baseDiv, dots) => {
    let out = Math.max(1, Math.round(baseDiv));
    let extra = out;
    for (let i = 0; i < Math.max(0, Math.round(dots)); i += 1) {
        extra = Math.max(1, Math.round(extra / 2));
        out += extra;
    }
    return out;
};
const divisionToTypeAndDots = (divisions, durationDiv) => {
    const base = Math.max(1, Math.round(divisions));
    const candidates = [
        { type: "whole", div: base * 4 },
        { type: "half", div: base * 2 },
        { type: "quarter", div: base },
        { type: "eighth", div: Math.max(1, Math.round(base / 2)) },
        { type: "16th", div: Math.max(1, Math.round(base / 4)) },
        { type: "32nd", div: Math.max(1, Math.round(base / 8)) },
        { type: "64th", div: Math.max(1, Math.round(base / 16)) },
    ];
    for (const c of candidates) {
        if (durationWithDots(c.div, 0) === durationDiv)
            return { type: c.type, dots: 0 };
        if (durationWithDots(c.div, 1) === durationDiv)
            return { type: c.type, dots: 1 };
        if (durationWithDots(c.div, 2) === durationDiv)
            return { type: c.type, dots: 2 };
    }
    let nearest = candidates[0];
    let best = Math.abs(nearest.div - durationDiv);
    for (const c of candidates) {
        const d = Math.abs(c.div - durationDiv);
        if (d < best) {
            best = d;
            nearest = c;
        }
    }
    return { type: nearest.type, dots: 0 };
};
const chunkString = (value, maxChunk) => {
    const out = [];
    const size = Math.max(1, Math.round(maxChunk));
    for (let i = 0; i < value.length; i += size)
        out.push(value.slice(i, i + size));
    return out;
};
const buildWarningMiscXml = (warnings) => {
    if (!warnings.length)
        return "";
    const maxEntries = Math.min(256, warnings.length);
    let xml = `<miscellaneous-field name="mks:diag:count">${maxEntries}</miscellaneous-field>`;
    for (let i = 0; i < maxEntries; i += 1) {
        const warning = warnings[i];
        const attrs = [
            "level=warn",
            `code=${warning.code}`,
            "fmt=mscx",
            `message=${warning.message}`,
        ];
        if (warning.measure !== undefined)
            attrs.push(`measure=${warning.measure}`);
        if (warning.staff !== undefined)
            attrs.push(`staff=${warning.staff}`);
        if (warning.voice !== undefined)
            attrs.push(`voice=${warning.voice}`);
        if (warning.atDiv !== undefined)
            attrs.push(`atDiv=${warning.atDiv}`);
        if (warning.action)
            attrs.push(`action=${warning.action}`);
        if (warning.reason)
            attrs.push(`reason=${warning.reason}`);
        if (warning.tag)
            attrs.push(`tag=${warning.tag}`);
        if (warning.occupiedDiv !== undefined)
            attrs.push(`occupiedDiv=${warning.occupiedDiv}`);
        if (warning.capacityDiv !== undefined)
            attrs.push(`capacityDiv=${warning.capacityDiv}`);
        const payload = attrs.join(";");
        xml += `<miscellaneous-field name="mks:diag:${String(i + 1).padStart(4, "0")}">${xmlEscape(payload)}</miscellaneous-field>`;
    }
    return xml;
};
const buildSourceMiscXml = (source) => {
    const encoded = encodeURIComponent(source);
    const chunks = chunkString(encoded, 800);
    let xml = "";
    xml += '<miscellaneous-field name="mks:src:musescore:raw-encoding">uri-v1</miscellaneous-field>';
    xml += `<miscellaneous-field name="mks:src:musescore:raw-length">${source.length}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:musescore:raw-encoded-length">${encoded.length}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:musescore:raw-chunks">${chunks.length}</miscellaneous-field>`;
    for (let i = 0; i < chunks.length; i += 1) {
        xml += `<miscellaneous-field name="mks:src:musescore:raw-${String(i + 1).padStart(4, "0")}">${xmlEscape(chunks[i])}</miscellaneous-field>`;
    }
    return xml;
};
const parseDurationDiv = (node, divisions, measureCapacityDiv = null) => {
    var _a, _b, _c;
    const explicitDuration = firstNumber(node, ":scope > duration");
    if (explicitDuration !== null && explicitDuration > 0) {
        return Math.max(1, Math.round(explicitDuration));
    }
    const durationType = ((_b = (_a = node.querySelector(":scope > durationType")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    if (durationType.toLowerCase() === "measure" && measureCapacityDiv !== null) {
        return Math.max(1, Math.round(measureCapacityDiv));
    }
    const base = durationTypeToDivisions(durationType, divisions);
    if (base === null)
        return null;
    const dots = (_c = firstNumber(node, ":scope > dots")) !== null && _c !== void 0 ? _c : 0;
    return durationWithDots(base, dots);
};
const parseTruthyFlag = (value) => {
    const v = String(value !== null && value !== void 0 ? value : "").trim().toLowerCase();
    return v === "1" || v === "true" || v === "yes";
};
const parseMuseDynamicMark = (value) => {
    const v = String(value || "").trim().toLowerCase();
    if (!v)
        return null;
    const allow = new Set(["pppp", "ppp", "pp", "p", "mp", "mf", "f", "ff", "fff", "ffff", "sf", "sfz", "rfz"]);
    return allow.has(v) ? v : null;
};
const parseMuseDynamicSoundValue = (dynamicEl) => {
    const velocity = firstNumber(dynamicEl, ":scope > velocity");
    if (velocity === null || velocity <= 0)
        return null;
    // MuseScore dynamic velocity uses a MIDI-like scale where 90 ~= 100%.
    return (velocity / 90) * 100;
};
const isMuseElementVisible = (el) => {
    const visible = firstNumber(el, ":scope > visible");
    if (visible === null)
        return true;
    return visible !== 0;
};
const museArticulationSubtypeToMusicXmlTag = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toLowerCase();
    if (!v)
        return null;
    // MuseScore left-hand pizzicato (+) variants.
    if ((v.includes("left") || v.includes("lh")) && v.includes("pizz")) {
        return { group: "technical", tag: "stopped" };
    }
    if (v.includes("stopped"))
        return { group: "technical", tag: "stopped" };
    if (v.includes("snap") && v.includes("pizz"))
        return { group: "technical", tag: "snap-pizzicato" };
    if (v.includes("upbow") || (v.includes("up") && v.includes("bow")))
        return { group: "technical", tag: "up-bow" };
    if (v.includes("downbow") || (v.includes("down") && v.includes("bow")))
        return { group: "technical", tag: "down-bow" };
    if (v.includes("open") && v.includes("string"))
        return { group: "technical", tag: "open-string" };
    if (v.includes("harmonic"))
        return { group: "technical", tag: "harmonic" };
    if (v.includes("staccatissimo"))
        return { group: "articulations", tag: "staccatissimo" };
    if (v.includes("staccato"))
        return { group: "articulations", tag: "staccato" };
    if (v.includes("tenuto"))
        return { group: "articulations", tag: "tenuto" };
    if (v.includes("accent"))
        return { group: "articulations", tag: "accent" };
    if (v.includes("marcato"))
        return { group: "articulations", tag: "strong-accent" };
    return null;
};
const museOrnamentSubtypeToMusicXmlTag = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toLowerCase();
    if (!v)
        return null;
    // MuseScore uses brassMuteClosed ornament for left-hand pizzicato in some scores.
    if (v === "brassmuteclosed" || (v.includes("brass") && v.includes("mute") && v.includes("closed"))) {
        return { group: "technical", tag: "stopped" };
    }
    return null;
};
const normalizeKeyMode = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toLowerCase();
    if (!v)
        return null;
    if (v === "major" || v === "maj")
        return "major";
    if (v === "minor" || v === "min")
        return "minor";
    if (v === "0")
        return "major";
    if (v === "1")
        return "minor";
    return null;
};
const inferKeyModeFromText = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "");
    if (!v)
        return null;
    if (/\bminor\b/i.test(v) || /çŸ­èª¿/.test(v))
        return "minor";
    if (/\bmajor\b/i.test(v) || /é•·èª¿/.test(v))
        return "major";
    return null;
};
const readGlobalMuseKeyMode = (score) => {
    var _a, _b, _c, _d, _e, _f;
    const explicit = normalizeKeyMode((_a = score.querySelector(":scope > Staff > Measure > KeySig > mode")) === null || _a === void 0 ? void 0 : _a.textContent)
        || normalizeKeyMode((_b = score.querySelector(":scope > Staff > Measure > voice > KeySig > mode")) === null || _b === void 0 ? void 0 : _b.textContent)
        || normalizeKeyMode((_c = score.querySelector(":scope > Staff > Measure > voice > keysig > mode")) === null || _c === void 0 ? void 0 : _c.textContent);
    if (explicit)
        return explicit;
    const inferred = inferKeyModeFromText((_d = score.querySelector(':scope > metaTag[name="workTitle"]')) === null || _d === void 0 ? void 0 : _d.textContent)
        || inferKeyModeFromText((_e = score.querySelector(':scope > metaTag[name="movementTitle"]')) === null || _e === void 0 ? void 0 : _e.textContent)
        || inferKeyModeFromText((_f = score.querySelector(":scope > Staff > VBox > Text > text")) === null || _f === void 0 ? void 0 : _f.textContent);
    return inferred || "major";
};
const buildDynamicDirectionXml = (mark, options) => {
    const value = options === null || options === void 0 ? void 0 : options.soundDynamics;
    const soundXml = Number.isFinite(value) ? `<sound dynamics="${Number(value).toFixed(2)}"/>` : "";
    return `<direction><direction-type><dynamics><${mark}/></dynamics></direction-type>${soundXml}</direction>`;
};
const museAccidentalSubtypeToMusicXml = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toLowerCase();
    if (!v)
        return null;
    if (v === "accidentalsharp")
        return "sharp";
    if (v === "accidentalflat")
        return "flat";
    if (v === "accidentalnatural")
        return "natural";
    if (v === "accidentaldoublesharp")
        return "double-sharp";
    if (v === "accidentaldoubleflat")
        return "flat-flat";
    return null;
};
const buildWordsDirectionXml = (text, options) => {
    var _a;
    const placementAttr = (options === null || options === void 0 ? void 0 : options.placement) ? ` placement="${options.placement}"` : "";
    const fontStyleAttr = (options === null || options === void 0 ? void 0 : options.fontStyle) ? ` font-style="${options.fontStyle}"` : "";
    const soundTempo = (_a = options === null || options === void 0 ? void 0 : options.soundTempo) !== null && _a !== void 0 ? _a : null;
    const soundXml = soundTempo !== null ? `<sound tempo="${soundTempo}"/>` : "";
    return `<direction${placementAttr}><direction-type><words${fontStyleAttr}>${xmlEscape(text)}</words></direction-type>${soundXml}</direction>`;
};
const buildSegnoDirectionXml = () => {
    return "<direction><direction-type><segno/></direction-type></direction>";
};
const buildCodaDirectionXml = () => {
    return "<direction><direction-type><coda/></direction-type></direction>";
};
const parseMarkerDirectionXml = (marker) => {
    var _a, _b, _c, _d;
    const subtype = ((_b = (_a = marker.querySelector(":scope > subtype")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
    const label = ((_d = (_c = marker.querySelector(":scope > label")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim();
    if (subtype.includes("segno"))
        return buildSegnoDirectionXml();
    if (subtype.includes("coda"))
        return buildCodaDirectionXml();
    if (subtype.includes("fine"))
        return buildWordsDirectionXml(label || "Fine");
    if (label)
        return buildWordsDirectionXml(label);
    return null;
};
const parseJumpDirectionXml = (jump) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const jumpTo = ((_b = (_a = jump.querySelector(":scope > jumpTo")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    const playUntil = ((_d = (_c = jump.querySelector(":scope > playUntil")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim();
    const continueAt = ((_f = (_e = jump.querySelector(":scope > continueAt")) === null || _e === void 0 ? void 0 : _e.textContent) !== null && _f !== void 0 ? _f : "").trim();
    const text = ((_h = (_g = jump.querySelector(":scope > text")) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : "").trim();
    const subtype = ((_k = (_j = jump.querySelector(":scope > subtype")) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : "").trim().toLowerCase();
    const words = text || subtype || [jumpTo, playUntil, continueAt].filter((v) => v.length > 0).join(" / ");
    if (!words)
        return null;
    const attrs = [];
    if (jumpTo.toLowerCase().includes("segno"))
        attrs.push('dalsegno="segno"');
    if (jumpTo.toLowerCase().includes("coda"))
        attrs.push('dacapo="yes"');
    if (playUntil.toLowerCase().includes("fine"))
        attrs.push('fine="fine"');
    if (playUntil.toLowerCase().includes("coda") || continueAt.toLowerCase().includes("coda"))
        attrs.push('tocoda="coda"');
    const soundXml = attrs.length ? `<sound ${attrs.join(" ")}/>` : "";
    return {
        xml: `<direction><direction-type><words>${xmlEscape(words)}</words></direction-type>${soundXml}</direction>`,
        mapped: attrs.length > 0,
    };
};
const parseExpressionDirectionXml = (expression) => {
    var _a, _b;
    const textNode = expression.querySelector(":scope > text");
    const text = ((_b = (_a = textNode === null || textNode === void 0 ? void 0 : textNode.textContent) !== null && _a !== void 0 ? _a : expression.textContent) !== null && _b !== void 0 ? _b : "").trim();
    if (!text)
        return null;
    const hasItalic = (textNode === null || textNode === void 0 ? void 0 : textNode.querySelector(":scope > i")) !== null;
    return buildWordsDirectionXml(text, { fontStyle: hasItalic ? "italic" : undefined });
};
const parseTempoDirectionXml = (tempoEl) => {
    var _a, _b;
    const qps = firstNumber(tempoEl, ":scope > tempo");
    const bpm = qps !== null && qps > 0 ? Math.max(20, Math.min(300, Math.round(qps * 60))) : null;
    const text = ((_b = (_a = tempoEl.querySelector(":scope > text")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    if (text) {
        return buildWordsDirectionXml(text, { placement: "above", soundTempo: bpm });
    }
    if (bpm !== null) {
        return `<direction><sound tempo="${bpm}"/></direction>`;
    }
    return null;
};
const parseMeasureValue = (measure, selectors, fallback) => {
    for (const selector of selectors) {
        const n = firstNumber(measure, selector);
        if (n !== null && Number.isFinite(n) && n > 0)
            return Math.max(1, Math.round(n));
    }
    return fallback;
};
const parseMeasureLenToDivisions = (measure, divisions) => {
    var _a;
    const raw = ((_a = measure.getAttribute("len")) !== null && _a !== void 0 ? _a : "").trim();
    if (!raw)
        return null;
    const m = raw.match(/^(\d+)\s*\/\s*(\d+)$/);
    if (!m)
        return null;
    const num = Number(m[1]);
    const den = Number(m[2]);
    if (!Number.isFinite(num) || !Number.isFinite(den) || num <= 0 || den <= 0)
        return null;
    const div = (Math.max(1, Math.round(divisions)) * 4 * num) / den;
    if (!Number.isFinite(div) || div <= 0)
        return null;
    return Math.max(1, Math.round(div));
};
const gcdPositive = (a, b) => {
    let x = Math.max(1, Math.abs(Math.round(a)));
    let y = Math.max(1, Math.abs(Math.round(b)));
    while (y !== 0) {
        const t = x % y;
        x = y;
        y = t;
    }
    return Math.max(1, x);
};
const formatMeasureLenFromDivisions = (measureLenDiv, divisions) => {
    const numRaw = Math.max(1, Math.round(measureLenDiv));
    const denRaw = Math.max(1, Math.round(divisions)) * 4;
    if (!Number.isFinite(numRaw) || !Number.isFinite(denRaw) || numRaw <= 0 || denRaw <= 0)
        return null;
    const g = gcdPositive(numRaw, denRaw);
    return `${Math.max(1, Math.round(numRaw / g))}/${Math.max(1, Math.round(denRaw / g))}`;
};
const readPartNameFromMusePart = (part, fallback) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const candidate = ((_b = (_a = part.querySelector(":scope > trackName")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim()
        || ((_d = (_c = part.querySelector(":scope > Instrument > longName")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim()
        || ((_f = (_e = part.querySelector(":scope > Instrument > trackName")) === null || _e === void 0 ? void 0 : _e.textContent) !== null && _f !== void 0 ? _f : "").trim()
        || ((_h = (_g = part.querySelector(":scope > Instrument > shortName")) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : "").trim()
        || ((_k = (_j = part.querySelector(":scope > Instrument > instrumentId")) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : "").trim();
    return candidate || fallback;
};
const readPartTransposeFromMusicXml = (part) => {
    var _a, _b, _c, _d, _e, _f;
    const transpose = part.querySelector(":scope > measure > attributes > transpose");
    if (!transpose)
        return null;
    const diatonic = Number((_c = (_b = (_a = transpose.querySelector(":scope > diatonic")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "");
    const chromatic = Number((_f = (_e = (_d = transpose.querySelector(":scope > chromatic")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "");
    const out = {};
    if (Number.isFinite(diatonic))
        out.diatonic = Math.round(diatonic);
    if (Number.isFinite(chromatic))
        out.chromatic = Math.round(chromatic);
    return Object.keys(out).length ? out : null;
};
const readPartTransposeFromMusePart = (part) => {
    var _a, _b, _c, _d;
    const diatonic = (_b = (_a = firstNumber(part, ":scope > Instrument > transposeDiatonic")) !== null && _a !== void 0 ? _a : firstNumber(part, ":scope > Instrument > mksTransposeDiatonic")) !== null && _b !== void 0 ? _b : firstNumber(part, ":scope > transpose > diatonic");
    const chromatic = (_d = (_c = firstNumber(part, ":scope > Instrument > transposeChromatic")) !== null && _c !== void 0 ? _c : firstNumber(part, ":scope > Instrument > mksTransposeChromatic")) !== null && _d !== void 0 ? _d : firstNumber(part, ":scope > transpose > chromatic");
    const out = {};
    if (Number.isFinite(diatonic))
        out.diatonic = Math.round(Number(diatonic));
    if (Number.isFinite(chromatic))
        out.chromatic = Math.round(Number(chromatic));
    return Object.keys(out).length ? out : null;
};
const buildTransposeXml = (transpose) => {
    if (!transpose)
        return "";
    const diatonic = Number.isFinite(transpose.diatonic) ? Math.round(Number(transpose.diatonic)) : null;
    const chromatic = Number.isFinite(transpose.chromatic) ? Math.round(Number(transpose.chromatic)) : null;
    if (diatonic === null && chromatic === null)
        return "";
    return `<transpose>${diatonic !== null ? `<diatonic>${diatonic}</diatonic>` : ""}${chromatic !== null ? `<chromatic>${chromatic}</chromatic>` : ""}</transpose>`;
};
const readClefForMuseStaff = (staff) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
    const clefTypeText = ((_b = (_a = staff.querySelector(":scope > Measure > voice > Clef > concertClefType")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim()
        || ((_d = (_c = staff.querySelector(":scope > Measure > voice > Clef > subtype")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim()
        || ((_f = (_e = staff.querySelector(":scope > Measure > Clef > concertClefType")) === null || _e === void 0 ? void 0 : _e.textContent) !== null && _f !== void 0 ? _f : "").trim()
        || ((_h = (_g = staff.querySelector(":scope > Measure > Clef > subtype")) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : "").trim()
        || ((_k = (_j = staff.querySelector(":scope > Clef > concertClefType")) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : "").trim()
        || ((_m = (_l = staff.querySelector(":scope > Clef > subtype")) === null || _l === void 0 ? void 0 : _l.textContent) !== null && _m !== void 0 ? _m : "").trim();
    const lower = clefTypeText.toLowerCase();
    if (lower.includes("f"))
        return { sign: "F", line: 4 };
    return { sign: "G", line: 2 };
};
const readStaffClefOverridesFromMusePart = (part) => {
    var _a, _b, _c, _d, _e;
    const overrides = new Map();
    for (const staffDef of Array.from(part.querySelectorAll(":scope > Staff[id]"))) {
        const staffId = ((_a = staffDef.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim();
        if (!staffId)
            continue;
        const defaultClef = ((_c = (_b = staffDef.querySelector(":scope > defaultClef")) === null || _b === void 0 ? void 0 : _b.textContent) !== null && _c !== void 0 ? _c : "").trim().toUpperCase();
        if (defaultClef.includes("F")) {
            overrides.set(staffId, { sign: "F", line: 4 });
            continue;
        }
        if (defaultClef.includes("G")) {
            overrides.set(staffId, { sign: "G", line: 2 });
            continue;
        }
    }
    for (const clefDef of Array.from(part.querySelectorAll(":scope > Instrument > clef[staff]"))) {
        const staffId = ((_d = clefDef.getAttribute("staff")) !== null && _d !== void 0 ? _d : "").trim();
        if (!staffId)
            continue;
        const clef = ((_e = clefDef.textContent) !== null && _e !== void 0 ? _e : "").trim().toUpperCase();
        if (clef.includes("F")) {
            overrides.set(staffId, { sign: "F", line: 4 });
            continue;
        }
        if (clef.includes("G")) {
            overrides.set(staffId, { sign: "G", line: 2 });
            continue;
        }
    }
    return overrides;
};
const withDirectionStaff = (directionXml, staffNo) => {
    if (/<staff>\d+<\/staff>/.test(directionXml))
        return directionXml;
    if (!directionXml.includes("</direction>"))
        return directionXml;
    return directionXml.replace(/<\/direction>\s*$/, `<staff>${staffNo}</staff></direction>`);
};
const withDirectionPlacement = (directionXml, staffNo, voiceNo) => {
    let out = withDirectionStaff(directionXml, staffNo);
    // octave-shift is staff-scoped; adding <voice> can suppress rendering in some engravers.
    if (out.includes("<octave-shift"))
        return out;
    if (!/<voice>\d+<\/voice>/.test(out) && out.includes("</direction>")) {
        out = out.replace(/<\/direction>\s*$/, `<voice>${voiceNo}</voice></direction>`);
    }
    return out;
};
const buildTupletMusicXml = (event) => {
    var _a, _b;
    const timeModification = event.tupletTimeModification;
    const starts = (_a = event.tupletStarts) !== null && _a !== void 0 ? _a : [];
    const stops = (_b = event.tupletStops) !== null && _b !== void 0 ? _b : [];
    const timeModificationXml = timeModification
        ? `<time-modification><actual-notes>${timeModification.actualNotes}</actual-notes><normal-notes>${timeModification.normalNotes}</normal-notes></time-modification>`
        : "";
    const tupletNotations = [];
    for (const start of starts) {
        const attrs = [
            `type="start"`,
            `number="${Math.max(1, Math.round(start.number))}"`,
        ];
        if (start.bracket)
            attrs.push(`bracket="${start.bracket}"`);
        if (start.showNumber)
            attrs.push(`show-number="${start.showNumber}"`);
        tupletNotations.push(`<tuplet ${attrs.join(" ")}/>`);
    }
    for (const stop of stops) {
        tupletNotations.push(`<tuplet type="stop" number="${Math.max(1, Math.round(stop))}"/>`);
    }
    return { timeModificationXml, notationItems: tupletNotations };
};
const tupletRoundingToleranceByVoiceEvents = (voiceEvents) => {
    var _a;
    let tupletCount = 0;
    for (const ev of voiceEvents) {
        if ((ev.kind !== "rest" && ev.kind !== "chord") || ((_a = ev.durationDiv) !== null && _a !== void 0 ? _a : 0) <= 0)
            continue;
        if (ev.kind === "chord" && ev.grace)
            continue;
        if (!ev.tupletTimeModification)
            continue;
        tupletCount += 1;
    }
    if (tupletCount <= 0)
        return 0;
    return Math.floor(tupletCount / 2);
};
const beamLevelFromType = (typeText) => {
    switch (String(typeText || "").trim().toLowerCase()) {
        case "eighth":
            return 1;
        case "16th":
            return 2;
        case "32nd":
            return 3;
        case "64th":
            return 4;
        default:
            return 0;
    }
};
const parseChordSlurTransitions = (chordEl, state) => {
    var _a, _b, _c;
    const starts = [];
    const stops = [];
    const resolveSlurNumber = (rawId) => {
        const key = rawId.trim();
        if (!key) {
            const num = state.nextSlurNumber;
            state.nextSlurNumber += 1;
            return num;
        }
        const direct = Number.parseInt(key, 10);
        if (Number.isFinite(direct) && direct > 0)
            return direct;
        const mapped = state.slurKeyToNumber.get(key);
        if (mapped)
            return mapped;
        const num = state.nextSlurNumber;
        state.nextSlurNumber += 1;
        state.slurKeyToNumber.set(key, num);
        return num;
    };
    for (const slurEl of Array.from(chordEl.querySelectorAll(":scope > Slur[type], :scope > slur[type]"))) {
        const type = ((_a = slurEl.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
        const num = resolveSlurNumber((_b = slurEl.getAttribute("id")) !== null && _b !== void 0 ? _b : "");
        if (type === "start") {
            starts.push(num);
            if (!state.activeSlurNumbers.includes(num))
                state.activeSlurNumbers.push(num);
            continue;
        }
        if (type === "stop") {
            stops.push(num);
            state.activeSlurNumbers = state.activeSlurNumbers.filter((active) => active !== num);
        }
    }
    const spanners = Array.from(chordEl.querySelectorAll(":scope > Spanner"));
    for (const spanner of spanners) {
        const type = ((_c = spanner.getAttribute("type")) !== null && _c !== void 0 ? _c : "").trim().toLowerCase();
        if (type !== "slur")
            continue;
        const hasStop = spanner.querySelector(":scope > prev") !== null;
        const hasStart = spanner.querySelector(":scope > Slur, :scope > next") !== null;
        if (hasStop) {
            const num = state.activeSlurNumbers.length ? state.activeSlurNumbers.pop() : 1;
            stops.push(num);
        }
        if (hasStart) {
            const num = state.nextSlurNumber;
            state.nextSlurNumber += 1;
            state.activeSlurNumbers.push(num);
            starts.push(num);
        }
    }
    return { starts, stops };
};
const parseMuseTieFlags = (noteEl) => {
    const tieEl = noteEl.querySelector(":scope > Tie, :scope > tie, :scope > Spanner[type=\"Tie\"], :scope > Spanner[type=\"tie\"]");
    const hasEndSpanner = noteEl.querySelector(":scope > endSpanner") !== null;
    const tieHasPrev = (tieEl === null || tieEl === void 0 ? void 0 : tieEl.querySelector(":scope > prev")) !== null;
    const tieHasNext = (tieEl === null || tieEl === void 0 ? void 0 : tieEl.querySelector(":scope > next")) !== null;
    const tieStart = tieEl !== null && (tieHasNext || !tieHasPrev);
    const tieStop = hasEndSpanner || (tieEl !== null && tieHasPrev);
    return { tieStart, tieStop };
};
const parseMuseStringText = (noteNode, tag) => {
    var _a, _b, _c;
    const container = noteNode.querySelector(`:scope > ${tag}`);
    if (!container)
        return null;
    const text = ((_c = (_b = (_a = container.querySelector(":scope > text")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : container.textContent) !== null && _c !== void 0 ? _c : "").trim();
    return text || null;
};
const parseTrillSpannerTransition = (spannerEl) => {
    var _a;
    const type = ((_a = spannerEl.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
    if (type !== "trill")
        return { start: false, stop: false };
    const start = spannerEl.querySelector(":scope > Trill, :scope > trill, :scope > next") !== null;
    const stop = spannerEl.querySelector(":scope > prev") !== null;
    return { start, stop };
};
const parseOttavaSubtype = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toLowerCase();
    const size = v.includes("15") ? 15 : 8;
    const shiftType = v.includes("8vb") || v.includes("15mb") || v.includes("bassa")
        ? "down"
        : "up";
    return { size, shiftType };
};
const buildOctaveShiftDirectionXml = (type, state) => {
    const placement = state.shiftType === "down" ? "below" : "above";
    return `<direction placement="${placement}"><direction-type><octave-shift type="${type}" size="${state.size}" number="${state.number}"/></direction-type></direction>`;
};
const semitoneShiftForOttavaDisplay = (state) => {
    const amount = state.size === 15 ? 24 : 12;
    return state.shiftType === "up" ? amount : -amount;
};
const buildBeamXmlByVoiceEvents = (voiceEvents, divisions, beatDiv) => {
    const beamXmlByIndex = new Map();
    const assignments = (0, beam_common_1.computeBeamAssignments)(voiceEvents, beatDiv, (ev) => {
        var _a;
        const isTimed = ev.kind === "chord" || ev.kind === "rest";
        const info = isTimed ? divisionToTypeAndDots(divisions, (_a = ev.displayDurationDiv) !== null && _a !== void 0 ? _a : ev.durationDiv) : null;
        const levels = info ? beamLevelFromType(info.type) : 0;
        return {
            timed: isTimed,
            chord: ev.kind === "chord",
            grace: ev.kind === "chord" && Boolean(ev.grace),
            durationDiv: isTimed ? Math.max(0, ev.durationDiv) : 0,
            levels,
            explicitMode: isTimed ? ev.beamMode : undefined,
        };
    });
    for (const [idx, assignment] of assignments.entries()) {
        let xml = "";
        for (let level = 1; level <= assignment.levels; level += 1) {
            xml += `<beam number="${level}">${assignment.state}</beam>`;
        }
        if (xml)
            beamXmlByIndex.set(idx, xml);
    }
    return beamXmlByIndex;
};
const convertMuseScoreToMusicXml = (mscxSource, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19, _20, _21, _22, _23, _24, _25, _26, _27, _28, _29, _30, _31, _32, _33, _34, _35, _36, _37, _38, _39, _40, _41, _42;
    const doc = new DOMParser().parseFromString(mscxSource, "application/xml");
    if (doc.querySelector("parsererror")) {
        throw new Error("MuseScore XML parse error.");
    }
    const score = doc.querySelector("museScore > Score, Score");
    if (!score) {
        throw new Error("MuseScore Score root was not found.");
    }
    const divisions = Math.max(1, Math.round((_a = firstNumber(score, ":scope > Division")) !== null && _a !== void 0 ? _a : 480));
    const sourceVersion = ((_c = (_b = doc.querySelector("museScore")) === null || _b === void 0 ? void 0 : _b.getAttribute("version")) !== null && _c !== void 0 ? _c : "").trim();
    const workTitle = ((_e = (_d = score.querySelector(':scope > metaTag[name="workTitle"]')) === null || _d === void 0 ? void 0 : _d.textContent) !== null && _e !== void 0 ? _e : "").trim() || "Imported MuseScore";
    const globalBeats = Math.max(1, Math.round((_f = firstNumber(score, ":scope > Staff > Measure > TimeSig > sigN")) !== null && _f !== void 0 ? _f : 4));
    const globalBeatType = Math.max(1, Math.round((_g = firstNumber(score, ":scope > Staff > Measure > TimeSig > sigD")) !== null && _g !== void 0 ? _g : 4));
    const globalFifths = Math.max(-7, Math.min(7, Math.round((_h = firstNumber(score, ":scope > Staff > Measure > KeySig > accidental")) !== null && _h !== void 0 ? _h : 0)));
    const globalMode = readGlobalMuseKeyMode(score);
    const staffNodes = Array.from(score.querySelectorAll(":scope > Staff")).filter((staff) => {
        var _a, _b;
        if (((_b = (_a = staff.parentElement) === null || _a === void 0 ? void 0 : _a.tagName) !== null && _b !== void 0 ? _b : "").toLowerCase() !== "score")
            return false;
        return staff.querySelector(":scope > Measure") !== null;
    });
    const staffById = new Map();
    staffNodes.forEach((staff, index) => {
        var _a;
        const id = ((_a = staff.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim() || String(index + 1);
        staffById.set(id, staff);
    });
    const warnings = [];
    const pushWarning = (warning) => {
        warnings.push(warning);
    };
    const unknownTagSet = new Set();
    if (!staffNodes.length) {
        pushWarning({
            code: "MUSESCORE_IMPORT_WARNING",
            message: "No readable staff content found; created an empty placeholder score.",
            action: "placeholder-created",
        });
    }
    const parsedByPart = [];
    const sourceMetadata = options.sourceMetadata !== false;
    const debugMetadata = options.debugMetadata !== false;
    const normalizeCutTimeToTwoTwo = options.normalizeCutTimeToTwoTwo === true;
    const usedStaffIds = new Set();
    const partNodes = Array.from(score.querySelectorAll(":scope > Part")).filter((part) => { var _a, _b; return ((_b = (_a = part.parentElement) === null || _a === void 0 ? void 0 : _a.tagName) !== null && _b !== void 0 ? _b : "").toLowerCase() === "score"; });
    const groupedStaffIds = [];
    for (let partIndex = 0; partIndex < partNodes.length; partIndex += 1) {
        const part = partNodes[partIndex];
        const partName = readPartNameFromMusePart(part, `P${partIndex + 1}`);
        const staffIds = Array.from(part.querySelectorAll(":scope > Staff"))
            .map((staffEl) => { var _a; return ((_a = staffEl.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim(); })
            .filter((id) => id.length > 0 && staffById.has(id));
        if (!staffIds.length)
            continue;
        groupedStaffIds.push({ partName, staffIds, partEl: part });
        for (const id of staffIds)
            usedStaffIds.add(id);
    }
    for (const [id] of staffById) {
        if (usedStaffIds.has(id))
            continue;
        groupedStaffIds.push({ partName: `P${groupedStaffIds.length + 1}`, staffIds: [id], partEl: null });
    }
    if (!groupedStaffIds.length) {
        groupedStaffIds.push({ partName: "P1", staffIds: [], partEl: null });
    }
    for (let partIndex = 0; partIndex < groupedStaffIds.length; partIndex += 1) {
        const group = groupedStaffIds[partIndex];
        const partId = `P${partIndex + 1}`;
        const parsedStaffs = [];
        const partClefOverrides = group.partEl
            ? readStaffClefOverridesFromMusePart(group.partEl)
            : new Map();
        for (let localStaffIndex = 0; localStaffIndex < Math.max(1, group.staffIds.length); localStaffIndex += 1) {
            const sourceStaffId = (_j = group.staffIds[localStaffIndex]) !== null && _j !== void 0 ? _j : `${localStaffIndex + 1}`;
            const staff = (_k = staffById.get(sourceStaffId)) !== null && _k !== void 0 ? _k : doc.createElement("Staff");
            const clef = (_l = partClefOverrides.get(sourceStaffId)) !== null && _l !== void 0 ? _l : readClefForMuseStaff(staff);
            const measures = Array.from(staff.querySelectorAll(":scope > Measure"));
            if (!measures.length) {
                parsedStaffs.push({
                    sourceStaffId,
                    clefSign: clef.sign,
                    clefLine: clef.line,
                    measures: [{
                            index: 1,
                            beats: globalBeats,
                            beatType: globalBeatType,
                            timeSymbol: null,
                            explicitTimeSig: true,
                            capacityDiv: Math.max(1, Math.round((divisions * 4 * globalBeats) / Math.max(1, globalBeatType))),
                            implicit: false,
                            fifths: globalFifths,
                            mode: globalMode,
                            tempoBpm: null,
                            tempoText: null,
                            repeatForward: false,
                            repeatBackward: false,
                            leftDoubleBarline: false,
                            events: [{
                                    kind: "rest",
                                    durationDiv: Math.max(1, Math.round((divisions * 4 * globalBeats) / Math.max(1, globalBeatType))),
                                    displayDurationDiv: Math.max(1, Math.round((divisions * 4 * globalBeats) / Math.max(1, globalBeatType))),
                                    voice: 1,
                                }],
                        }],
                });
                continue;
            }
            let currentBeats = globalBeats;
            let currentBeatType = globalBeatType;
            let currentTimeSymbol = null;
            let currentFifths = globalFifths;
            let currentMode = globalMode;
            const parsedMeasures = [];
            let absoluteDivCursor = 0;
            const slurStateByVoice = new Map();
            const ottavaStateByVoice = new Map();
            for (let mi = 0; mi < measures.length; mi += 1) {
                const measure = measures[mi];
                const measureStartDiv = absoluteDivCursor;
                const beats = parseMeasureValue(measure, [":scope > TimeSig > sigN", ":scope > voice > TimeSig > sigN", ":scope > voice > timesig > sigN"], currentBeats);
                const beatType = parseMeasureValue(measure, [":scope > TimeSig > sigD", ":scope > voice > TimeSig > sigD", ":scope > voice > timesig > sigD"], currentBeatType);
                const timeSigSubtype = firstNumber(measure, ":scope > TimeSig > subtype, :scope > voice > TimeSig > subtype, :scope > voice > timesig > subtype");
                const explicitTimeSig = measure.querySelector(":scope > TimeSig, :scope > voice > TimeSig, :scope > voice > timesig") !== null;
                const rawTimeSymbol = timeSigSubtype !== null && Math.round(timeSigSubtype) === 2 ? "cut" : null;
                const timeSymbol = rawTimeSymbol !== null && rawTimeSymbol !== void 0 ? rawTimeSymbol : currentTimeSymbol;
                const shouldNormalizeCut = normalizeCutTimeToTwoTwo && timeSymbol === "cut" && beats === 4 && beatType === 4;
                const effectiveBeats = shouldNormalizeCut ? 2 : beats;
                const effectiveBeatType = shouldNormalizeCut ? 2 : beatType;
                const nominalCapacityDiv = Math.max(1, Math.round((divisions * 4 * effectiveBeats) / Math.max(1, effectiveBeatType)));
                const measureLenDiv = parseMeasureLenToDivisions(measure, divisions);
                const capacityDiv = measureLenDiv !== null && measureLenDiv !== void 0 ? measureLenDiv : nominalCapacityDiv;
                const implicit = measureLenDiv !== null && measureLenDiv < nominalCapacityDiv;
                const fifthsRaw = (_o = (_m = firstNumber(measure, ":scope > KeySig > accidental")) !== null && _m !== void 0 ? _m : firstNumber(measure, ":scope > voice > KeySig > accidental")) !== null && _o !== void 0 ? _o : firstNumber(measure, ":scope > voice > keysig > accidental");
                const fifths = fifthsRaw === null ? currentFifths : Math.max(-7, Math.min(7, Math.round(fifthsRaw)));
                const modeRaw = normalizeKeyMode((_s = (_q = (_p = measure.querySelector(":scope > KeySig > mode")) === null || _p === void 0 ? void 0 : _p.textContent) !== null && _q !== void 0 ? _q : (_r = measure.querySelector(":scope > voice > KeySig > mode")) === null || _r === void 0 ? void 0 : _r.textContent) !== null && _s !== void 0 ? _s : (_t = measure.querySelector(":scope > voice > keysig > mode")) === null || _t === void 0 ? void 0 : _t.textContent);
                const mode = modeRaw !== null && modeRaw !== void 0 ? modeRaw : currentMode;
                const tempoBpm = null;
                const tempoText = null;
                const repeatForward = parseTruthyFlag(measure.getAttribute("startRepeat"))
                    || measure.querySelector(":scope > startRepeat, :scope > voice > startRepeat") !== null;
                const repeatBackward = parseTruthyFlag(measure.getAttribute("endRepeat"))
                    || measure.querySelector(":scope > endRepeat, :scope > voice > endRepeat") !== null;
                const leftDoubleBarline = (() => {
                    var _a, _b;
                    const subtype = ((_b = (_a = measure.querySelector(":scope > BarLine > subtype, :scope > voice > BarLine > subtype")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
                    return subtype === "double";
                })();
                const events = [];
                const voiceNodes = Array.from(measure.querySelectorAll(":scope > voice"));
                const eventHolders = voiceNodes.length ? voiceNodes : [measure];
                for (let holderIndex = 0; holderIndex < eventHolders.length; holderIndex += 1) {
                    const holder = eventHolders[holderIndex];
                    const defaultVoiceNo = holderIndex + 1;
                    let voicePosDiv = 0;
                    let slurState = slurStateByVoice.get(defaultVoiceNo);
                    if (!slurState) {
                        slurState = {
                            activeSlurNumbers: [],
                            nextSlurNumber: 1,
                            slurKeyToNumber: new Map(),
                        };
                        slurStateByVoice.set(defaultVoiceNo, slurState);
                    }
                    let ottavaState = ottavaStateByVoice.get(defaultVoiceNo);
                    if (!ottavaState) {
                        ottavaState = {
                            activeOttavaStates: [],
                            nextOttavaNumber: 1,
                        };
                        ottavaStateByVoice.set(defaultVoiceNo, ottavaState);
                    }
                    const tupletScaleStack = [];
                    const activeOttavaStates = ottavaState.activeOttavaStates;
                    const activeTrillNumbers = [];
                    let nextTrillNumber = 1;
                    const pendingTrillStarts = [];
                    const pendingTrillStops = [];
                    const tupletStateStack = [];
                    const tupletDefinitionById = new Map();
                    const tupletNumberById = new Map();
                    let activeTupletRefId = null;
                    let nextTupletNumber = 1;
                    const currentTupletScale = () => tupletScaleStack.reduce((acc, value) => acc * value, 1);
                    const consumeTupletStarts = () => {
                        const starts = tupletStateStack
                            .filter((state) => state.startPending)
                            .map((state) => ({
                            actualNotes: state.actualNotes,
                            normalNotes: state.normalNotes,
                            number: state.number,
                            showNumber: state.showNumber,
                            bracket: state.bracket,
                        }));
                        for (const state of tupletStateStack)
                            state.startPending = false;
                        return starts;
                    };
                    const appendTupletStopToLastTimedEvent = (tupletNumber) => {
                        var _a;
                        for (let i = events.length - 1; i >= 0; i -= 1) {
                            const ev = events[i];
                            if (ev.kind !== "rest" && ev.kind !== "chord")
                                continue;
                            const stops = (_a = ev.tupletStops) !== null && _a !== void 0 ? _a : [];
                            stops.push(tupletNumber);
                            ev.tupletStops = stops;
                            return;
                        }
                    };
                    const resolveTupletNumberById = (id) => {
                        const existing = tupletNumberById.get(id);
                        if (existing !== undefined)
                            return existing;
                        const assigned = nextTupletNumber;
                        nextTupletNumber += 1;
                        tupletNumberById.set(id, assigned);
                        return assigned;
                    };
                    const consumePendingTrillStarts = () => {
                        const out = pendingTrillStarts.splice(0, pendingTrillStarts.length);
                        return out;
                    };
                    const consumePendingTrillStops = () => {
                        const out = pendingTrillStops.splice(0, pendingTrillStops.length);
                        return out;
                    };
                    const children = Array.from(holder.children);
                    for (const event of children) {
                        const tag = event.tagName.toLowerCase();
                        const trackNo = Math.round((_u = firstNumber(event, ":scope > track")) !== null && _u !== void 0 ? _u : NaN);
                        const voiceNo = Number.isFinite(trackNo)
                            ? Math.max(1, Math.min(4, (Math.max(0, trackNo) % 4) + 1))
                            : defaultVoiceNo;
                        const moveRaw = Math.round((_v = firstNumber(event, ":scope > move")) !== null && _v !== void 0 ? _v : NaN);
                        const movedStaffNo = Number.isFinite(moveRaw)
                            ? Math.max(1, localStaffIndex + 1 + Math.round(moveRaw))
                            : (localStaffIndex + 1);
                        if (tag === "tick") {
                            const tickAbs = Math.max(0, Math.round(Number(((_w = event.textContent) !== null && _w !== void 0 ? _w : "").trim() || 0)));
                            voicePosDiv = Math.max(0, tickAbs - measureStartDiv);
                            continue;
                        }
                        if (tag === "tuplet") {
                            const normalNotes = Math.round((_x = firstNumber(event, ":scope > normalNotes")) !== null && _x !== void 0 ? _x : 0);
                            const actualNotes = Math.round((_y = firstNumber(event, ":scope > actualNotes")) !== null && _y !== void 0 ? _y : 0);
                            const numberType = Math.round((_z = firstNumber(event, ":scope > numberType")) !== null && _z !== void 0 ? _z : NaN);
                            const bracketType = Math.round((_0 = firstNumber(event, ":scope > bracketType")) !== null && _0 !== void 0 ? _0 : NaN);
                            const showNumber = Number.isFinite(numberType)
                                ? (numberType === 2 ? "none" : "actual")
                                : undefined;
                            const bracket = Number.isFinite(bracketType)
                                ? (bracketType === 2 ? "no" : "yes")
                                : "yes";
                            const id = ((_1 = event.getAttribute("id")) !== null && _1 !== void 0 ? _1 : "").trim();
                            if (id && normalNotes > 0 && actualNotes > 0) {
                                tupletDefinitionById.set(id, {
                                    actualNotes,
                                    normalNotes,
                                    showNumber,
                                    bracket,
                                });
                                continue;
                            }
                            if (normalNotes > 0 && actualNotes > 0) {
                                tupletScaleStack.push(normalNotes / actualNotes);
                                tupletStateStack.push({
                                    actualNotes,
                                    normalNotes,
                                    number: nextTupletNumber,
                                    showNumber,
                                    bracket,
                                    startPending: true,
                                });
                                nextTupletNumber += 1;
                            }
                            else {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: unsupported tuplet skipped.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "skipped",
                                    reason: "unsupported",
                                    tag: "Tuplet",
                                });
                            }
                            continue;
                        }
                        if (tag === "endtuplet") {
                            if (tupletScaleStack.length > 0)
                                tupletScaleStack.pop();
                            const ended = tupletStateStack.pop();
                            if (ended)
                                appendTupletStopToLastTimedEvent(ended.number);
                            continue;
                        }
                        if (tag === "rest") {
                            const parsed = parseDurationDiv(event, divisions, capacityDiv);
                            const displayDurationDiv = parsed === null ? null : Math.max(1, Math.round(parsed));
                            const tupletRefId = ((_3 = (_2 = event.querySelector(":scope > Tuplet")) === null || _2 === void 0 ? void 0 : _2.textContent) !== null && _3 !== void 0 ? _3 : "").trim() || null;
                            const tupletRef = tupletRefId ? tupletDefinitionById.get(tupletRefId) : undefined;
                            const tupletScale = tupletRef
                                ? (tupletRef.normalNotes / tupletRef.actualNotes)
                                : currentTupletScale();
                            const durationDiv = parsed === null ? null : Math.max(1, Math.round(parsed * tupletScale));
                            if (!durationDiv) {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: dropped rest with unknown duration.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "dropped",
                                    reason: "unknown-duration",
                                    tag: "Rest",
                                });
                                continue;
                            }
                            const resolvedDisplayDurationDiv = displayDurationDiv !== null && displayDurationDiv !== void 0 ? displayDurationDiv : durationDiv;
                            if (activeTupletRefId && activeTupletRefId !== tupletRefId) {
                                const endedNo = tupletNumberById.get(activeTupletRefId);
                                if (endedNo !== undefined)
                                    appendTupletStopToLastTimedEvent(endedNo);
                                activeTupletRefId = null;
                            }
                            const starts = consumeTupletStarts();
                            const currentTuplet = tupletRef !== null && tupletRef !== void 0 ? tupletRef : tupletStateStack[tupletStateStack.length - 1];
                            const startsWithRef = [...starts];
                            if (tupletRefId && tupletRef && activeTupletRefId !== tupletRefId) {
                                startsWithRef.push({
                                    actualNotes: tupletRef.actualNotes,
                                    normalNotes: tupletRef.normalNotes,
                                    number: resolveTupletNumberById(tupletRefId),
                                    showNumber: tupletRef.showNumber,
                                    bracket: tupletRef.bracket,
                                });
                                activeTupletRefId = tupletRefId;
                            }
                            const beamModeRaw = ((_5 = (_4 = event.querySelector(":scope > BeamMode")) === null || _4 === void 0 ? void 0 : _4.textContent) !== null && _5 !== void 0 ? _5 : "").trim().toLowerCase();
                            const beamMode = beamModeRaw === "begin" || beamModeRaw === "mid" ? beamModeRaw : undefined;
                            events.push({
                                kind: "rest",
                                durationDiv,
                                displayDurationDiv: resolvedDisplayDurationDiv,
                                voice: voiceNo,
                                staffNo: movedStaffNo,
                                atDiv: voicePosDiv,
                                beamMode,
                                tupletTimeModification: currentTuplet
                                    ? { actualNotes: currentTuplet.actualNotes, normalNotes: currentTuplet.normalNotes }
                                    : undefined,
                                tupletStarts: startsWithRef.length ? startsWithRef : undefined,
                                trillStarts: consumePendingTrillStarts(),
                                trillStops: consumePendingTrillStops(),
                            });
                            voicePosDiv += durationDiv;
                            continue;
                        }
                        if (tag === "chord") {
                            const isAcciaccatura = event.querySelector(":scope > acciaccatura") !== null;
                            const isAppoggiatura = event.querySelector(":scope > appoggiatura") !== null;
                            const isGrace = isAcciaccatura || isAppoggiatura || event.querySelector(":scope > grace") !== null;
                            const parsed = parseDurationDiv(event, divisions, capacityDiv);
                            const displayDurationDiv = parsed === null ? null : Math.max(1, Math.round(parsed));
                            const tupletRefId = ((_7 = (_6 = event.querySelector(":scope > Tuplet")) === null || _6 === void 0 ? void 0 : _6.textContent) !== null && _7 !== void 0 ? _7 : "").trim() || null;
                            const tupletRef = tupletRefId ? tupletDefinitionById.get(tupletRefId) : undefined;
                            const tupletScale = tupletRef
                                ? (tupletRef.normalNotes / tupletRef.actualNotes)
                                : currentTupletScale();
                            const durationDiv = isGrace
                                ? 0
                                : (parsed === null ? null : Math.max(1, Math.round(parsed * tupletScale)));
                            if (!isGrace && !durationDiv) {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: dropped chord with unknown duration.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "dropped",
                                    reason: "unknown-duration",
                                    tag: "Chord",
                                });
                                continue;
                            }
                            if (!isGrace && activeTupletRefId && activeTupletRefId !== tupletRefId) {
                                const endedNo = tupletNumberById.get(activeTupletRefId);
                                if (endedNo !== undefined)
                                    appendTupletStopToLastTimedEvent(endedNo);
                                activeTupletRefId = null;
                            }
                            const resolvedDurationDiv = durationDiv !== null && durationDiv !== void 0 ? durationDiv : 0;
                            const resolvedDisplayDurationDiv = displayDurationDiv !== null && displayDurationDiv !== void 0 ? displayDurationDiv : (durationDiv && durationDiv > 0 ? durationDiv : Math.max(1, Math.round(divisions / 4)));
                            // Handle chord-local spanners produced by MusicXML->MuseScore export path.
                            // They should affect the same timing point as this chord.
                            for (const spannerEl of Array.from(event.querySelectorAll(":scope > Spanner[type], :scope > spanner[type]"))) {
                                const spannerType = ((_8 = spannerEl.getAttribute("type")) !== null && _8 !== void 0 ? _8 : "").trim().toLowerCase();
                                if (spannerType === "ottava") {
                                    const hasStop = spannerEl.querySelector(":scope > prev") !== null;
                                    const hasStart = spannerEl.querySelector(":scope > Ottava, :scope > ottava, :scope > next") !== null;
                                    if (hasStop) {
                                        const state = activeOttavaStates.length
                                            ? activeOttavaStates.pop()
                                            : { number: 1, size: 8, shiftType: "up" };
                                        events.push({
                                            kind: "directionXml",
                                            xml: buildOctaveShiftDirectionXml("stop", state),
                                            voice: voiceNo,
                                            staffNo: movedStaffNo,
                                            atDiv: voicePosDiv,
                                        });
                                    }
                                    if (hasStart) {
                                        const parsed = parseOttavaSubtype((_9 = spannerEl.querySelector(":scope > Ottava > subtype, :scope > ottava > subtype")) === null || _9 === void 0 ? void 0 : _9.textContent);
                                        const state = {
                                            number: ottavaState.nextOttavaNumber,
                                            size: parsed.size,
                                            shiftType: parsed.shiftType,
                                        };
                                        ottavaState.nextOttavaNumber += 1;
                                        activeOttavaStates.push(state);
                                        events.push({
                                            kind: "directionXml",
                                            xml: buildOctaveShiftDirectionXml("start", state),
                                            voice: voiceNo,
                                            staffNo: movedStaffNo,
                                            atDiv: voicePosDiv,
                                        });
                                    }
                                    continue;
                                }
                                const trill = parseTrillSpannerTransition(spannerEl);
                                if (trill.stop) {
                                    const number = activeTrillNumbers.length ? activeTrillNumbers.pop() : 1;
                                    pendingTrillStops.push(number);
                                }
                                if (trill.start) {
                                    const number = nextTrillNumber;
                                    nextTrillNumber += 1;
                                    activeTrillNumbers.push(number);
                                    pendingTrillStarts.push(number);
                                }
                            }
                            const noteNodes = Array.from(event.querySelectorAll(":scope > Note"));
                            const ottavaDisplayShift = activeOttavaStates.reduce((sum, state) => sum + semitoneShiftForOttavaDisplay(state), 0);
                            const slurTransitions = parseChordSlurTransitions(event, slurState);
                            const articulationMappings = Array.from(event.querySelectorAll(":scope > Articulation > subtype"))
                                .map((node) => museArticulationSubtypeToMusicXmlTag(node.textContent))
                                .filter((mapped) => mapped !== null);
                            const ornamentMappings = Array.from(event.querySelectorAll(":scope > Ornament > subtype, :scope > ornament > subtype"))
                                .map((node) => museOrnamentSubtypeToMusicXmlTag(node.textContent))
                                .filter((mapped) => mapped !== null);
                            const allMappings = [...articulationMappings, ...ornamentMappings];
                            const articulationTags = allMappings
                                .filter((mapped) => mapped.group === "articulations")
                                .map((mapped) => mapped.tag);
                            const technicalTags = allMappings
                                .filter((mapped) => mapped.group === "technical")
                                .map((mapped) => mapped.tag);
                            const notes = noteNodes
                                .map((noteNode) => {
                                var _a, _b, _c, _d;
                                const midi = Number.parseInt(((_b = (_a = noteNode.querySelector(":scope > pitch")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim(), 10);
                                if (!Number.isFinite(midi))
                                    return null;
                                const accidentalText = museAccidentalSubtypeToMusicXml((_c = noteNode.querySelector(":scope > Accidental > subtype")) === null || _c === void 0 ? void 0 : _c.textContent);
                                const fingeringText = (_d = parseMuseStringText(noteNode, "Fingering")) !== null && _d !== void 0 ? _d : undefined;
                                const stringRaw = parseMuseStringText(noteNode, "String");
                                const stringValue = stringRaw !== null ? Number.parseInt(stringRaw, 10) : NaN;
                                const tieFlags = parseMuseTieFlags(noteNode);
                                return {
                                    midi: Math.max(0, Math.min(127, Math.round(midi + ottavaDisplayShift))),
                                    accidentalText,
                                    tieStart: tieFlags.tieStart,
                                    tieStop: tieFlags.tieStop,
                                    fingeringText,
                                    stringNumber: Number.isFinite(stringValue) && stringValue > 0 ? Math.round(stringValue) : undefined,
                                };
                            })
                                .filter((note) => note !== null);
                            if (!notes.length) {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: dropped chord without pitch.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "dropped",
                                    reason: "missing-pitch",
                                    tag: "Chord",
                                });
                                continue;
                            }
                            const starts = isGrace ? [] : consumeTupletStarts();
                            const currentTuplet = tupletRef !== null && tupletRef !== void 0 ? tupletRef : tupletStateStack[tupletStateStack.length - 1];
                            const startsWithRef = [...starts];
                            if (!isGrace && tupletRefId && tupletRef && activeTupletRefId !== tupletRefId) {
                                startsWithRef.push({
                                    actualNotes: tupletRef.actualNotes,
                                    normalNotes: tupletRef.normalNotes,
                                    number: resolveTupletNumberById(tupletRefId),
                                    showNumber: tupletRef.showNumber,
                                    bracket: tupletRef.bracket,
                                });
                                activeTupletRefId = tupletRefId;
                            }
                            const beamModeRaw = ((_11 = (_10 = event.querySelector(":scope > BeamMode")) === null || _10 === void 0 ? void 0 : _10.textContent) !== null && _11 !== void 0 ? _11 : "").trim().toLowerCase();
                            const beamMode = beamModeRaw === "begin" || beamModeRaw === "mid" ? beamModeRaw : undefined;
                            events.push({
                                kind: "chord",
                                durationDiv: resolvedDurationDiv,
                                displayDurationDiv: resolvedDisplayDurationDiv,
                                notes,
                                voice: voiceNo,
                                staffNo: movedStaffNo,
                                atDiv: voicePosDiv,
                                beamMode,
                                tupletTimeModification: !isGrace && currentTuplet
                                    ? { actualNotes: currentTuplet.actualNotes, normalNotes: currentTuplet.normalNotes }
                                    : undefined,
                                tupletStarts: !isGrace && startsWithRef.length ? startsWithRef : undefined,
                                slurStarts: slurTransitions.starts.length ? slurTransitions.starts : undefined,
                                slurStops: slurTransitions.stops.length ? slurTransitions.stops : undefined,
                                trillStarts: consumePendingTrillStarts(),
                                trillStops: consumePendingTrillStops(),
                                articulationTags: articulationTags.length ? Array.from(new Set(articulationTags)) : undefined,
                                technicalTags: technicalTags.length ? Array.from(new Set(technicalTags)) : undefined,
                                grace: isGrace,
                                graceSlash: isAcciaccatura,
                            });
                            if (!isGrace)
                                voicePosDiv += resolvedDurationDiv;
                            continue;
                        }
                        if (tag === "spanner") {
                            const spannerType = ((_12 = event.getAttribute("type")) !== null && _12 !== void 0 ? _12 : "").trim().toLowerCase();
                            if (spannerType === "ottava") {
                                const hasStop = event.querySelector(":scope > prev") !== null;
                                const hasStart = event.querySelector(":scope > Ottava, :scope > ottava, :scope > next") !== null;
                                if (hasStop) {
                                    const state = activeOttavaStates.length
                                        ? activeOttavaStates.pop()
                                        : { number: 1, size: 8, shiftType: "up" };
                                    events.push({
                                        kind: "directionXml",
                                        xml: buildOctaveShiftDirectionXml("stop", state),
                                        voice: voiceNo,
                                        staffNo: movedStaffNo,
                                        atDiv: voicePosDiv,
                                    });
                                }
                                if (hasStart) {
                                    const parsed = parseOttavaSubtype((_13 = event.querySelector(":scope > Ottava > subtype, :scope > ottava > subtype")) === null || _13 === void 0 ? void 0 : _13.textContent);
                                    const state = {
                                        number: ottavaState.nextOttavaNumber,
                                        size: parsed.size,
                                        shiftType: parsed.shiftType,
                                    };
                                    ottavaState.nextOttavaNumber += 1;
                                    activeOttavaStates.push(state);
                                    events.push({
                                        kind: "directionXml",
                                        xml: buildOctaveShiftDirectionXml("start", state),
                                        voice: voiceNo,
                                        staffNo: movedStaffNo,
                                        atDiv: voicePosDiv,
                                    });
                                }
                                continue;
                            }
                            const trill = parseTrillSpannerTransition(event);
                            if (trill.stop) {
                                const number = activeTrillNumbers.length ? activeTrillNumbers.pop() : 1;
                                pendingTrillStops.push(number);
                            }
                            if (trill.start) {
                                const number = nextTrillNumber;
                                nextTrillNumber += 1;
                                activeTrillNumbers.push(number);
                                pendingTrillStarts.push(number);
                            }
                            continue;
                        }
                        if (tag === "dynamic") {
                            if (!isMuseElementVisible(event))
                                continue;
                            const mark = parseMuseDynamicMark(((_16 = (_15 = (_14 = event.querySelector(":scope > subtype")) === null || _14 === void 0 ? void 0 : _14.textContent) !== null && _15 !== void 0 ? _15 : event.textContent) !== null && _16 !== void 0 ? _16 : "").trim());
                            if (mark) {
                                events.push({
                                    kind: "dynamic",
                                    mark,
                                    voice: voiceNo,
                                    staffNo: movedStaffNo,
                                    atDiv: voicePosDiv,
                                    soundDynamics: (_17 = parseMuseDynamicSoundValue(event)) !== null && _17 !== void 0 ? _17 : undefined,
                                });
                            }
                            else {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: unsupported dynamic skipped.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "skipped",
                                    reason: "unsupported",
                                    tag: "Dynamic",
                                });
                            }
                            continue;
                        }
                        if (tag === "tempo") {
                            const directionXml = parseTempoDirectionXml(event);
                            if (directionXml) {
                                events.push({ kind: "directionXml", xml: directionXml, voice: voiceNo, staffNo: movedStaffNo, atDiv: voicePosDiv });
                            }
                            continue;
                        }
                        if (tag === "expression") {
                            const directionXml = parseExpressionDirectionXml(event);
                            if (directionXml) {
                                events.push({ kind: "directionXml", xml: directionXml, voice: voiceNo, staffNo: movedStaffNo, atDiv: voicePosDiv });
                            }
                            else {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: unsupported expression skipped.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "skipped",
                                    reason: "unsupported",
                                    tag: "Expression",
                                });
                            }
                            continue;
                        }
                        if (tag === "marker") {
                            const directionXml = parseMarkerDirectionXml(event);
                            if (directionXml) {
                                events.push({ kind: "directionXml", xml: directionXml, voice: voiceNo, staffNo: movedStaffNo, atDiv: voicePosDiv });
                            }
                            else {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: unsupported marker skipped.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "skipped",
                                    reason: "unsupported",
                                    tag: "Marker",
                                });
                            }
                            continue;
                        }
                        if (tag === "jump") {
                            const parsed = parseJumpDirectionXml(event);
                            if (!parsed) {
                                pushWarning({
                                    code: "MUSESCORE_IMPORT_WARNING",
                                    message: `measure ${mi + 1}: unsupported jump skipped.`,
                                    measure: mi + 1,
                                    staff: localStaffIndex + 1,
                                    voice: voiceNo,
                                    atDiv: voicePosDiv,
                                    action: "skipped",
                                    reason: "unsupported",
                                    tag: "Jump",
                                });
                            }
                            else {
                                events.push({ kind: "directionXml", xml: parsed.xml, voice: voiceNo, staffNo: movedStaffNo, atDiv: voicePosDiv });
                                if (!parsed.mapped) {
                                    pushWarning({
                                        code: "MUSESCORE_IMPORT_WARNING",
                                        message: `measure ${mi + 1}: jump mapped as text only; playback semantics may be incomplete.`,
                                        measure: mi + 1,
                                        staff: localStaffIndex + 1,
                                        voice: voiceNo,
                                        atDiv: voicePosDiv,
                                        action: "mapped-with-loss",
                                        reason: "playback-semantics-incomplete",
                                        tag: "Jump",
                                    });
                                }
                            }
                            continue;
                        }
                        if (tag === "timesig"
                            || tag === "keysig"
                            || tag === "layoutbreak"
                            || tag === "clef"
                            || tag === "beam") {
                            continue;
                        }
                        unknownTagSet.add(tag);
                    }
                    if (activeTupletRefId) {
                        const endedNo = tupletNumberById.get(activeTupletRefId);
                        if (endedNo !== undefined)
                            appendTupletStopToLastTimedEvent(endedNo);
                        activeTupletRefId = null;
                    }
                }
                const capacity = capacityDiv;
                const occupiedByVoice = new Map();
                for (const event of events) {
                    if (!("durationDiv" in event))
                        continue;
                    const current = (_18 = occupiedByVoice.get(event.voice)) !== null && _18 !== void 0 ? _18 : 0;
                    occupiedByVoice.set(event.voice, current + Math.max(0, Math.round(event.durationDiv)));
                }
                for (const [voice, occupied] of occupiedByVoice) {
                    if (occupied <= capacity)
                        continue;
                    pushWarning({
                        code: "MUSESCORE_IMPORT_WARNING",
                        message: `measure ${mi + 1} voice ${voice}: overfull content (${occupied} > ${capacity}); tail events are clamped.`,
                        measure: mi + 1,
                        staff: localStaffIndex + 1,
                        voice,
                        action: "clamped",
                        reason: "overfull",
                        occupiedDiv: occupied,
                        capacityDiv: capacity,
                    });
                }
                parsedMeasures.push({
                    index: mi + 1,
                    beats: effectiveBeats,
                    beatType: effectiveBeatType,
                    timeSymbol,
                    explicitTimeSig,
                    capacityDiv,
                    implicit,
                    fifths,
                    mode,
                    tempoBpm,
                    tempoText,
                    repeatForward,
                    repeatBackward,
                    leftDoubleBarline,
                    events,
                });
                currentBeats = effectiveBeats;
                currentBeatType = effectiveBeatType;
                currentTimeSymbol = timeSymbol;
                currentFifths = fifths;
                currentMode = mode;
                absoluteDivCursor += capacityDiv;
            }
            parsedStaffs.push({
                sourceStaffId,
                clefSign: clef.sign,
                clefLine: clef.line,
                measures: parsedMeasures,
            });
        }
        const partTranspose = group.partEl ? readPartTransposeFromMusePart(group.partEl) : null;
        parsedByPart.push({ partId, partName: group.partName, transpose: partTranspose, staffs: parsedStaffs });
    }
    if (unknownTagSet.size > 0) {
        pushWarning({
            code: "MUSESCORE_IMPORT_WARNING",
            message: `unsupported MuseScore elements skipped: ${Array.from(unknownTagSet).sort().join(", ")}`,
            action: "skipped",
            reason: "unsupported-elements",
        });
    }
    let sourceMiscXml = "";
    if (sourceMetadata) {
        sourceMiscXml = buildSourceMiscXml(mscxSource);
        if (sourceVersion) {
            sourceMiscXml += `<miscellaneous-field name="mks:src:musescore:version">${xmlEscape(sourceVersion)}</miscellaneous-field>`;
        }
    }
    const miscXml = `${debugMetadata ? buildWarningMiscXml(warnings) : ""}${sourceMiscXml}`;
    const partList = parsedByPart.map((part) => `<score-part id="${part.partId}"><part-name>${xmlEscape(part.partName)}</part-name></score-part>`);
    const partXml = [];
    for (let partIndex = 0; partIndex < parsedByPart.length; partIndex += 1) {
        const part = parsedByPart[partIndex];
        const measuresXml = [];
        const voiceIdByStaffLocal = new Map();
        let nextVoiceId = 1;
        const resolvePartVoiceId = (staffNo, localVoiceNo) => {
            const key = `${staffNo}:${Math.max(1, Math.round(localVoiceNo))}`;
            const existing = voiceIdByStaffLocal.get(key);
            if (existing !== undefined)
                return existing;
            const assigned = nextVoiceId;
            nextVoiceId += 1;
            voiceIdByStaffLocal.set(key, assigned);
            return assigned;
        };
        for (let si = 0; si < part.staffs.length; si += 1) {
            const staffNo = si + 1;
            const voices = new Set();
            for (const measure of (_20 = (_19 = part.staffs[si]) === null || _19 === void 0 ? void 0 : _19.measures) !== null && _20 !== void 0 ? _20 : []) {
                for (const event of measure.events) {
                    voices.add(Math.max(1, Math.round(event.voice)));
                }
            }
            if (!voices.size)
                voices.add(1);
            Array.from(voices)
                .sort((a, b) => a - b)
                .forEach((voiceNo) => {
                resolvePartVoiceId(staffNo, voiceNo);
            });
        }
        let prevBeats = globalBeats;
        let prevBeatType = globalBeatType;
        let prevTimeSymbol = null;
        let prevFifths = globalFifths;
        let prevMode = globalMode;
        const measureCount = Math.max(1, ...part.staffs.map((staff) => staff.measures.length));
        const startsWithPickup = ((_23 = (_22 = (_21 = part.staffs[0]) === null || _21 === void 0 ? void 0 : _21.measures[0]) === null || _22 === void 0 ? void 0 : _22.implicit) !== null && _23 !== void 0 ? _23 : false) === true;
        for (let mi = 0; mi < measureCount; mi += 1) {
            const primaryMeasure = (_25 = (_24 = part.staffs[0]) === null || _24 === void 0 ? void 0 : _24.measures[mi]) !== null && _25 !== void 0 ? _25 : {
                index: mi + 1,
                beats: prevBeats,
                beatType: prevBeatType,
                timeSymbol: prevTimeSymbol,
                explicitTimeSig: false,
                capacityDiv: Math.max(1, Math.round((divisions * 4 * prevBeats) / Math.max(1, prevBeatType))),
                implicit: false,
                fifths: prevFifths,
                mode: prevMode,
                tempoBpm: null,
                tempoText: null,
                repeatForward: false,
                repeatBackward: false,
                leftDoubleBarline: false,
                events: [],
            };
            const capacity = Math.max(1, Math.round(primaryMeasure.capacityDiv));
            let body = "";
            const needsAttributes = mi === 0
                || primaryMeasure.beats !== prevBeats
                || primaryMeasure.beatType !== prevBeatType
                || primaryMeasure.timeSymbol !== prevTimeSymbol
                || primaryMeasure.explicitTimeSig
                || primaryMeasure.fifths !== prevFifths
                || primaryMeasure.mode !== prevMode;
            if (needsAttributes) {
                const timeSymbolAttr = primaryMeasure.timeSymbol ? ` symbol="${primaryMeasure.timeSymbol}"` : "";
                body += `<attributes><divisions>${divisions}</divisions><key><fifths>${primaryMeasure.fifths}</fifths><mode>${primaryMeasure.mode}</mode></key><time${timeSymbolAttr}><beats>${primaryMeasure.beats}</beats><beat-type>${primaryMeasure.beatType}</beat-type></time>${buildTransposeXml(part.transpose)}`;
                if (part.staffs.length > 1) {
                    body += `<staves>${part.staffs.length}</staves>`;
                    for (let si = 0; si < part.staffs.length; si += 1) {
                        const staff = part.staffs[si];
                        body += `<clef number="${si + 1}"><sign>${staff.clefSign}</sign><line>${staff.clefLine}</line></clef>`;
                    }
                }
                else {
                    const staff = part.staffs[0];
                    body += `<clef><sign>${(_26 = staff === null || staff === void 0 ? void 0 : staff.clefSign) !== null && _26 !== void 0 ? _26 : "G"}</sign><line>${(_27 = staff === null || staff === void 0 ? void 0 : staff.clefLine) !== null && _27 !== void 0 ? _27 : 2}</line></clef>`;
                }
                if (mi === 0 && partIndex === 0 && miscXml) {
                    body += `<miscellaneous>${miscXml}</miscellaneous>`;
                }
                body += "</attributes>";
            }
            if (primaryMeasure.leftDoubleBarline) {
                body += `<barline location="left"><bar-style>light-light</bar-style></barline>`;
            }
            if (primaryMeasure.repeatForward) {
                body += `<barline location="left"><repeat direction="forward"/></barline>`;
            }
            if (primaryMeasure.tempoText) {
                body += buildWordsDirectionXml(primaryMeasure.tempoText, {
                    placement: "above",
                    soundTempo: primaryMeasure.tempoBpm,
                });
            }
            else if (primaryMeasure.tempoBpm !== null) {
                body += `<direction><direction-type><metronome><beat-unit>quarter</beat-unit><per-minute>${primaryMeasure.tempoBpm}</per-minute></metronome></direction-type><sound tempo="${primaryMeasure.tempoBpm}"/></direction>`;
            }
            for (let si = 0; si < part.staffs.length; si += 1) {
                const staffNo = si + 1;
                const measure = (_29 = (_28 = part.staffs[si]) === null || _28 === void 0 ? void 0 : _28.measures[mi]) !== null && _29 !== void 0 ? _29 : {
                    index: mi + 1,
                    beats: primaryMeasure.beats,
                    beatType: primaryMeasure.beatType,
                    timeSymbol: primaryMeasure.timeSymbol,
                    explicitTimeSig: false,
                    capacityDiv: primaryMeasure.capacityDiv,
                    implicit: primaryMeasure.implicit,
                    fifths: primaryMeasure.fifths,
                    mode: primaryMeasure.mode,
                    tempoBpm: null,
                    tempoText: null,
                    repeatForward: false,
                    repeatBackward: false,
                    leftDoubleBarline: false,
                    events: [],
                };
                if (si > 0) {
                    body += `<backup><duration>${capacity}</duration></backup>`;
                }
                const voices = Array.from(new Set(measure.events.map((event) => Math.max(1, Math.round(event.voice))))).sort((a, b) => a - b);
                if (!voices.length)
                    voices.push(1);
                for (let vi = 0; vi < voices.length; vi += 1) {
                    const voiceNo = voices[vi];
                    const partVoiceNo = resolvePartVoiceId(staffNo, voiceNo);
                    const accidentalStateByPitch = new Map();
                    if (vi > 0) {
                        body += `<backup><duration>${capacity}</duration></backup>`;
                    }
                    let occupied = 0;
                    const voiceEvents = measure.events
                        .filter((event) => Math.max(1, Math.round(event.voice)) === voiceNo)
                        .slice()
                        .sort((a, b) => {
                        var _a, _b;
                        const aa = Math.max(0, Math.round(("atDiv" in a ? ((_a = a.atDiv) !== null && _a !== void 0 ? _a : 0) : 0)));
                        const bb = Math.max(0, Math.round(("atDiv" in b ? ((_b = b.atDiv) !== null && _b !== void 0 ? _b : 0) : 0)));
                        return aa - bb;
                    });
                    const tupletTolerance = tupletRoundingToleranceByVoiceEvents(voiceEvents);
                    const beatDiv = Math.max(1, Math.round(measure.capacityDiv / Math.max(1, measure.beats)));
                    const beamXmlByEventIndex = buildBeamXmlByVoiceEvents(voiceEvents, divisions, beatDiv);
                    for (const event of voiceEvents) {
                        const eventAtDiv = Math.max(0, Math.round(("atDiv" in event ? ((_30 = event.atDiv) !== null && _30 !== void 0 ? _30 : occupied) : occupied)));
                        const eventStaffNo = ("staffNo" in event && Number.isFinite(event.staffNo))
                            ? Math.max(1, Math.round(event.staffNo))
                            : staffNo;
                        if (event.kind === "dynamic") {
                            const lead = Math.max(0, eventAtDiv - occupied);
                            if (lead > 0) {
                                body += `<forward><duration>${lead}</duration><voice>${partVoiceNo}</voice><staff>${eventStaffNo}</staff></forward>`;
                                occupied += lead;
                            }
                            body += withDirectionPlacement(buildDynamicDirectionXml(event.mark, { soundDynamics: event.soundDynamics }), eventStaffNo, partVoiceNo);
                            continue;
                        }
                        if (event.kind === "directionXml") {
                            const lead = Math.max(0, eventAtDiv - occupied);
                            if (lead > 0) {
                                body += `<forward><duration>${lead}</duration><voice>${partVoiceNo}</voice><staff>${eventStaffNo}</staff></forward>`;
                                occupied += lead;
                            }
                            body += withDirectionPlacement(event.xml, eventStaffNo, partVoiceNo);
                            continue;
                        }
                        if (eventAtDiv > occupied) {
                            const lead = eventAtDiv - occupied;
                            body += `<forward><duration>${lead}</duration><voice>${partVoiceNo}</voice><staff>${eventStaffNo}</staff></forward>`;
                            occupied += lead;
                        }
                        const timedDuration = Math.max(0, event.durationDiv);
                        if (timedDuration > 0 && occupied + timedDuration > capacity + tupletTolerance)
                            break;
                        occupied += timedDuration;
                        const info = divisionToTypeAndDots(divisions, (_31 = event.displayDurationDiv) !== null && _31 !== void 0 ? _31 : event.durationDiv);
                        const eventIndex = voiceEvents.indexOf(event);
                        const beamXml = eventIndex >= 0 ? ((_32 = beamXmlByEventIndex.get(eventIndex)) !== null && _32 !== void 0 ? _32 : "") : "";
                        if (event.kind === "rest") {
                            const tupletXml = buildTupletMusicXml(event);
                            const notationsXml = tupletXml.notationItems.length
                                ? `<notations>${tupletXml.notationItems.join("")}</notations>`
                                : "";
                            body += `<note><rest/><duration>${event.durationDiv}</duration><voice>${partVoiceNo}</voice><type>${info.type}</type>${"<dot/>".repeat(info.dots)}${tupletXml.timeModificationXml}${beamXml}<staff>${eventStaffNo}</staff>${notationsXml}</note>`;
                            continue;
                        }
                        const tupletXml = buildTupletMusicXml(event);
                        const slurItems = [];
                        for (const no of (_33 = event.slurStarts) !== null && _33 !== void 0 ? _33 : []) {
                            slurItems.push(`<slur type="start" number="${Math.max(1, Math.round(no))}"/>`);
                        }
                        for (const no of (_34 = event.slurStops) !== null && _34 !== void 0 ? _34 : []) {
                            slurItems.push(`<slur type="stop" number="${Math.max(1, Math.round(no))}"/>`);
                        }
                        const trillItems = [];
                        for (const no of (_35 = event.trillStarts) !== null && _35 !== void 0 ? _35 : []) {
                            trillItems.push(`<ornaments><trill-mark/><wavy-line type="start" number="${Math.max(1, Math.round(no))}"/></ornaments>`);
                        }
                        for (const no of (_36 = event.trillStops) !== null && _36 !== void 0 ? _36 : []) {
                            trillItems.push(`<ornaments><wavy-line type="stop" number="${Math.max(1, Math.round(no))}"/></ornaments>`);
                        }
                        for (let ni = 0; ni < event.notes.length; ni += 1) {
                            const note = event.notes[ni];
                            const pitch = (0, accidentalSpelling_1.midiToPitch)(note.midi, {
                                keyFifths: measure.fifths,
                                preferAccidental: note.accidentalText,
                            });
                            const pitchKey = `${eventStaffNo}:${pitch.octave}:${pitch.step}`;
                            const accidentalText = (0, accidentalSpelling_1.resolveAccidentalTextForPitch)(pitch, {
                                keyFifths: measure.fifths,
                                previousAlterByPitchKey: accidentalStateByPitch,
                                pitchKey,
                                preferredAccidentalText: note.accidentalText,
                            });
                            const accidentalXml = accidentalText ? `<accidental>${accidentalText}</accidental>` : "";
                            const timeModificationXml = ni === 0 && !event.grace ? tupletXml.timeModificationXml : "";
                            const tieXml = `${note.tieStart ? '<tie type="start"/>' : ""}${note.tieStop ? '<tie type="stop"/>' : ""}`;
                            const tiedItems = `${note.tieStart ? '<tied type="start"/>' : ""}${note.tieStop ? '<tied type="stop"/>' : ""}`;
                            const articulationXml = ni === 0 && ((_38 = (_37 = event.articulationTags) === null || _37 === void 0 ? void 0 : _37.length) !== null && _38 !== void 0 ? _38 : 0) > 0
                                ? `<articulations>${((_39 = event.articulationTags) !== null && _39 !== void 0 ? _39 : []).map((tag) => `<${tag}/>`).join("")}</articulations>`
                                : "";
                            const noteTechnicalItems = [];
                            if (ni === 0 && ((_41 = (_40 = event.technicalTags) === null || _40 === void 0 ? void 0 : _40.length) !== null && _41 !== void 0 ? _41 : 0) > 0) {
                                noteTechnicalItems.push(...((_42 = event.technicalTags) !== null && _42 !== void 0 ? _42 : []).map((tag) => `<${tag}/>`));
                            }
                            if (note.fingeringText && note.fingeringText.trim()) {
                                noteTechnicalItems.push(`<fingering>${xmlEscape(note.fingeringText.trim())}</fingering>`);
                            }
                            if (note.stringNumber && note.stringNumber > 0) {
                                noteTechnicalItems.push(`<string>${Math.round(note.stringNumber)}</string>`);
                            }
                            const technicalXml = noteTechnicalItems.length
                                ? `<technical>${noteTechnicalItems.join("")}</technical>`
                                : "";
                            const notationItems = [
                                ...(ni === 0 ? tupletXml.notationItems : []),
                                ...(ni === 0 ? slurItems : []),
                                ...(ni === 0 ? trillItems : []),
                                articulationXml,
                                technicalXml,
                                tiedItems,
                            ].filter((item) => item.length > 0);
                            const notationsXml = notationItems.length ? `<notations>${notationItems.join("")}</notations>` : "";
                            const beamXmlForNote = ni === 0 ? beamXml : "";
                            const graceXml = ni === 0 && event.grace
                                ? (event.graceSlash ? '<grace slash="yes"/>' : "<grace/>")
                                : "";
                            const durationXml = event.grace ? "" : `<duration>${event.durationDiv}</duration>`;
                            body += `<note>${ni > 0 ? "<chord/>" : ""}${graceXml}<pitch><step>${pitch.step}</step>${pitch.alter !== 0 ? `<alter>${pitch.alter}</alter>` : ""}<octave>${pitch.octave}</octave></pitch>${tieXml}${durationXml}<voice>${partVoiceNo}</voice><type>${info.type}</type>${"<dot/>".repeat(info.dots)}${timeModificationXml}${accidentalXml}${beamXmlForNote}<staff>${eventStaffNo}</staff>${notationsXml}</note>`;
                        }
                    }
                    if (occupied < capacity && capacity - occupied > tupletTolerance) {
                        const restDiv = capacity - occupied;
                        const info = divisionToTypeAndDots(divisions, restDiv);
                        body += `<note><rest/><duration>${restDiv}</duration><voice>${partVoiceNo}</voice><type>${info.type}</type>${"<dot/>".repeat(info.dots)}<staff>${staffNo}</staff></note>`;
                    }
                }
            }
            const isLastMeasure = mi === measureCount - 1;
            if (primaryMeasure.repeatBackward || isLastMeasure) {
                body += `<barline location="right">`;
                if (isLastMeasure) {
                    body += "<bar-style>light-heavy</bar-style>";
                }
                if (primaryMeasure.repeatBackward) {
                    body += `<repeat direction="backward"/>`;
                }
                body += "</barline>";
            }
            const implicitAttr = primaryMeasure.implicit ? ' implicit="yes"' : "";
            const measureNumber = startsWithPickup ? mi : mi + 1;
            measuresXml.push(`<measure number="${measureNumber}"${implicitAttr}>${body}</measure>`);
            prevBeats = primaryMeasure.beats;
            prevBeatType = primaryMeasure.beatType;
            prevTimeSymbol = primaryMeasure.timeSymbol;
            prevFifths = primaryMeasure.fifths;
            prevMode = primaryMeasure.mode;
        }
        partXml.push(`<part id="${part.partId}">${measuresXml.join("")}</part>`);
    }
    return `<?xml version="1.0" encoding="UTF-8"?><score-partwise version="4.0"><work><work-title>${xmlEscape(workTitle)}</work-title></work><part-list>${partList.join("")}</part-list>${partXml.join("")}</score-partwise>`;
};
exports.convertMuseScoreToMusicXml = convertMuseScoreToMusicXml;
const firstNumberInDoc = (scope, selectors, fallback) => {
    for (const selector of selectors) {
        const n = firstNumber(scope, selector);
        if (n !== null && Number.isFinite(n) && n > 0)
            return Math.max(1, Math.round(n));
    }
    return fallback;
};
const divisionsToMuseDurationType = (divisions, durationDiv) => {
    const info = divisionToTypeAndDots(divisions, Math.max(1, Math.round(durationDiv)));
    switch (info.type) {
        case "whole":
        case "half":
        case "quarter":
        case "eighth":
        case "16th":
        case "32nd":
        case "64th":
            return { durationType: info.type, dots: info.dots };
        default:
            return { durationType: "quarter", dots: 0 };
    }
};
const makeMuseChordXml = (durationDiv, displayDurationDiv, divisions, notes, slurStarts, slurStops, articulationSubtypes, trillStarts, trillStops, tupletRefId, ottavaStartSubtypes, ottavaStopCount, grace, graceSlash) => {
    const duration = divisionsToMuseDurationType(divisions, displayDurationDiv > 0 ? displayDurationDiv : (durationDiv > 0 ? durationDiv : Math.max(1, Math.round(divisions / 4))));
    let xml = "<Chord>";
    if (grace) {
        xml += graceSlash ? "<acciaccatura/>" : "<grace/>";
    }
    xml += `<durationType>${duration.durationType}</durationType>`;
    if (tupletRefId && tupletRefId.trim()) {
        xml += `<Tuplet>${xmlEscape(tupletRefId.trim())}</Tuplet>`;
    }
    if (duration.dots > 0)
        xml += `<dots>${duration.dots}</dots>`;
    for (const subtype of ottavaStartSubtypes !== null && ottavaStartSubtypes !== void 0 ? ottavaStartSubtypes : []) {
        xml += `<Spanner type="Ottava"><Ottava><subtype>${xmlEscape(subtype)}</subtype></Ottava><next><location><fractions>1/1</fractions></location></next></Spanner>`;
    }
    for (let i = 0; i < Math.max(0, Math.round(ottavaStopCount !== null && ottavaStopCount !== void 0 ? ottavaStopCount : 0)); i += 1) {
        xml += `<Spanner type="Ottava"><prev><location><fractions>-1/1</fractions></location></prev></Spanner>`;
    }
    for (const _no of trillStarts !== null && trillStarts !== void 0 ? trillStarts : []) {
        xml += `<Spanner type="Trill"><Trill><subtype>trill</subtype></Trill><next><location><fractions>1/1</fractions></location></next></Spanner>`;
    }
    for (const _no of trillStops !== null && trillStops !== void 0 ? trillStops : []) {
        xml += `<Spanner type="Trill"><prev><location><fractions>-1/1</fractions></location></prev></Spanner>`;
    }
    for (const no of slurStarts !== null && slurStarts !== void 0 ? slurStarts : []) {
        xml += `<Slur type="start" id="${Math.max(1, Math.round(no))}"/>`;
    }
    for (const no of slurStops !== null && slurStops !== void 0 ? slurStops : []) {
        xml += `<Slur type="stop" id="${Math.max(1, Math.round(no))}"/>`;
    }
    for (const subtype of articulationSubtypes !== null && articulationSubtypes !== void 0 ? articulationSubtypes : []) {
        xml += `<Articulation><subtype>${xmlEscape(subtype)}</subtype></Articulation>`;
    }
    for (const note of notes) {
        xml += "<Note>";
        xml += `<pitch>${Math.max(0, Math.min(127, Math.round(note.midi)))}</pitch>`;
        if (note.accidentalSubtype) {
            xml += `<Accidental><subtype>${xmlEscape(note.accidentalSubtype)}</subtype></Accidental>`;
        }
        if (note.fingeringText && note.fingeringText.trim()) {
            xml += `<Fingering>${xmlEscape(note.fingeringText.trim())}</Fingering>`;
        }
        if (note.stringNumber && note.stringNumber > 0) {
            xml += `<String>${Math.round(note.stringNumber)}</String>`;
        }
        if (note.tieStart)
            xml += "<Tie/>";
        if (note.tieStop)
            xml += "<endSpanner/>";
        xml += "</Note>";
    }
    xml += "</Chord>";
    return xml;
};
const makeMuseRestXml = (durationDiv, displayDurationDiv, divisions, tupletRefId) => {
    const duration = divisionsToMuseDurationType(divisions, displayDurationDiv > 0 ? displayDurationDiv : durationDiv);
    let xml = "<Rest>";
    xml += `<durationType>${duration.durationType}</durationType>`;
    if (tupletRefId && tupletRefId.trim()) {
        xml += `<Tuplet>${xmlEscape(tupletRefId.trim())}</Tuplet>`;
    }
    if (duration.dots > 0)
        xml += `<dots>${duration.dots}</dots>`;
    xml += "</Rest>";
    return xml;
};
const getNoteStaffNo = (note) => {
    const staff = firstNumber(note, ":scope > staff");
    if (staff === null)
        return 1;
    return Math.max(1, Math.round(staff));
};
const getMeasureStaffCountFromMusicXml = (measure) => {
    var _a;
    let maxStaff = Math.max(1, Math.round((_a = firstNumber(measure, ":scope > attributes > staves")) !== null && _a !== void 0 ? _a : 1));
    for (const note of Array.from(measure.querySelectorAll(":scope > note"))) {
        maxStaff = Math.max(maxStaff, getNoteStaffNo(note));
    }
    return maxStaff;
};
const getPartStaffCountFromMusicXml = (part) => {
    let maxStaff = 1;
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        maxStaff = Math.max(maxStaff, getMeasureStaffCountFromMusicXml(measure));
    }
    return maxStaff;
};
const dynamicTagToMuseSubtype = (tag) => {
    const v = tag.trim().toLowerCase();
    const allow = new Set(["pppp", "ppp", "pp", "p", "mp", "mf", "f", "ff", "fff", "ffff", "sf", "sfz", "rfz"]);
    return allow.has(v) ? v : null;
};
const musicXmlSoundDynamicsToMuseVelocity = (raw) => {
    const n = Number(raw !== null && raw !== void 0 ? raw : "");
    if (!Number.isFinite(n) || n <= 0)
        return undefined;
    // Inverse of parseMuseDynamicSoundValue: dynamics(%) ~= velocity / 90 * 100.
    const velocity = Math.round((n * 90) / 100);
    return Math.max(1, Math.min(127, velocity));
};
const collectDirectionSeedsFromMusicXmlMeasure = (measure, staffNo) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
    const out = [];
    for (const direction of Array.from(measure.querySelectorAll(":scope > direction"))) {
        const directionStaff = Math.max(1, Math.round((_a = firstNumber(direction, ":scope > staff")) !== null && _a !== void 0 ? _a : 1));
        if (directionStaff !== staffNo)
            continue;
        const tempo = (_c = (_b = direction.querySelector(":scope > sound")) === null || _b === void 0 ? void 0 : _b.getAttribute("tempo")) !== null && _c !== void 0 ? _c : null;
        const tempoNumber = Number(tempo !== null && tempo !== void 0 ? tempo : "");
        const hasTempo = Number.isFinite(tempoNumber) && tempoNumber > 0;
        const qps = hasTempo ? tempoNumber / 60 : 0;
        const soundDynamics = (_e = (_d = direction.querySelector(":scope > sound")) === null || _d === void 0 ? void 0 : _d.getAttribute("dynamics")) !== null && _e !== void 0 ? _e : null;
        const soundDalsegno = ((_g = (_f = direction.querySelector(":scope > sound")) === null || _f === void 0 ? void 0 : _f.getAttribute("dalsegno")) !== null && _g !== void 0 ? _g : "").trim();
        const soundDaCapo = ((_j = (_h = direction.querySelector(":scope > sound")) === null || _h === void 0 ? void 0 : _h.getAttribute("dacapo")) !== null && _j !== void 0 ? _j : "").trim().toLowerCase();
        const soundFine = ((_l = (_k = direction.querySelector(":scope > sound")) === null || _k === void 0 ? void 0 : _k.getAttribute("fine")) !== null && _l !== void 0 ? _l : "").trim();
        const soundToCoda = ((_o = (_m = direction.querySelector(":scope > sound")) === null || _m === void 0 ? void 0 : _m.getAttribute("tocoda")) !== null && _o !== void 0 ? _o : "").trim();
        const velocity = musicXmlSoundDynamicsToMuseVelocity(soundDynamics);
        for (const dynNode of Array.from(direction.querySelectorAll(":scope > direction-type > dynamics > *"))) {
            const subtype = dynamicTagToMuseSubtype(dynNode.tagName.toLowerCase());
            if (!subtype)
                continue;
            out.push({ kind: "dynamic", subtype, velocity });
        }
        if (direction.querySelector(":scope > direction-type > segno") !== null) {
            out.push({ kind: "marker", subtype: "segno", label: "segno" });
        }
        if (direction.querySelector(":scope > direction-type > coda") !== null) {
            out.push({ kind: "marker", subtype: "coda", label: "coda" });
        }
        for (const words of Array.from(direction.querySelectorAll(":scope > direction-type > words"))) {
            const text = ((_p = words.textContent) !== null && _p !== void 0 ? _p : "").trim();
            if (!text)
                continue;
            const italic = ((_q = words.getAttribute("font-style")) !== null && _q !== void 0 ? _q : "").trim().toLowerCase() === "italic";
            if (hasTempo)
                out.push({ kind: "tempo", qps, text });
            else if (text.toLowerCase() === "fine")
                out.push({ kind: "marker", subtype: "fine", label: "Fine" });
            else
                out.push({ kind: "expression", text, italic: italic || undefined });
        }
        if (hasTempo && direction.querySelector(":scope > direction-type > words") === null) {
            out.push({ kind: "tempo", qps });
        }
        if (soundDalsegno || soundDaCapo === "yes" || soundFine || soundToCoda) {
            const jump = {
                kind: "jump",
                text: soundDaCapo === "yes" ? "D.C." : (soundDalsegno ? "D.S." : "Jump"),
                jumpTo: soundDaCapo === "yes" ? "start" : (soundDalsegno || undefined),
                playUntil: soundFine || (soundToCoda ? "coda" : undefined),
                continueAt: soundToCoda || undefined,
            };
            out.push(jump);
        }
    }
    return out;
};
const parseMusicXmlOctaveShiftSubtype = (octaveShift) => {
    var _a, _b;
    const type = ((_a = octaveShift.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
    if (!type || type === "stop" || type === "continue")
        return null;
    const size = Number.parseInt(((_b = octaveShift.getAttribute("size")) !== null && _b !== void 0 ? _b : "").trim(), 10);
    const resolvedSize = Number.isFinite(size) && size > 8 ? 15 : 8;
    if (type === "down")
        return resolvedSize === 15 ? "15mb" : "8vb";
    return resolvedSize === 15 ? "15ma" : "8va";
};
const parseMusicXmlPitchToMidi = (note) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    // Prefer pitched notes, but also accept unpitched display position so percussion notes are not dropped.
    const step = ((_d = (_b = (_a = note.querySelector(":scope > pitch > step")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : (_c = note.querySelector(":scope > unpitched > display-step")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim().toUpperCase();
    const octaveRaw = ((_h = (_f = (_e = note.querySelector(":scope > pitch > octave")) === null || _e === void 0 ? void 0 : _e.textContent) !== null && _f !== void 0 ? _f : (_g = note.querySelector(":scope > unpitched > display-octave")) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : "").trim();
    if (!step || !octaveRaw)
        return null;
    const octave = Number(octaveRaw);
    if (!Number.isFinite(octave))
        return null;
    const alter = Number((_l = (_k = (_j = note.querySelector(":scope > pitch > alter")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) !== null && _l !== void 0 ? _l : "0");
    const semitoneBase = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };
    const base = semitoneBase[step];
    if (base === undefined)
        return null;
    const midi = Math.round((octave + 1) * 12 + base + (Number.isFinite(alter) ? alter : 0));
    if (!Number.isFinite(midi))
        return null;
    return Math.max(0, Math.min(127, midi));
};
const parseMusicXmlTieFlags = (note) => {
    const hasStart = note.querySelector(':scope > tie[type="start"]') !== null
        || note.querySelector(':scope > notations > tied[type="start"]') !== null;
    const hasStop = note.querySelector(':scope > tie[type="stop"]') !== null
        || note.querySelector(':scope > notations > tied[type="stop"]') !== null;
    return { tieStart: hasStart, tieStop: hasStop };
};
const parseMusicXmlAccidentalSubtype = (note) => {
    var _a, _b;
    const accidental = ((_b = (_a = note.querySelector(":scope > accidental")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
    if (!accidental)
        return null;
    if (accidental === "natural")
        return "accidentalNatural";
    if (accidental === "sharp")
        return "accidentalSharp";
    if (accidental === "flat")
        return "accidentalFlat";
    if (accidental === "double-sharp")
        return "accidentalDoubleSharp";
    if (accidental === "flat-flat")
        return "accidentalDoubleFlat";
    return null;
};
const parseMusicXmlSlurNumbers = (note) => {
    var _a, _b;
    const starts = [];
    const stops = [];
    for (const slur of Array.from(note.querySelectorAll(":scope > notations > slur[type]"))) {
        const type = ((_a = slur.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
        const rawNumber = ((_b = slur.getAttribute("number")) !== null && _b !== void 0 ? _b : "").trim();
        const number = Number(rawNumber);
        const normalized = Number.isFinite(number) && number > 0 ? Math.round(number) : 1;
        if (type === "start")
            starts.push(normalized);
        if (type === "stop")
            stops.push(normalized);
    }
    return { starts, stops };
};
const parseMusicXmlTrillNumbers = (note) => {
    var _a, _b;
    const starts = [];
    const stops = [];
    for (const node of Array.from(note.querySelectorAll(':scope > notations > ornaments > wavy-line[type]'))) {
        const type = ((_a = node.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
        const rawNumber = ((_b = node.getAttribute("number")) !== null && _b !== void 0 ? _b : "").trim();
        const parsed = Number(rawNumber);
        const number = Number.isFinite(parsed) && parsed > 0 ? Math.round(parsed) : 1;
        if (type === "start")
            starts.push(number);
        if (type === "stop")
            stops.push(number);
    }
    if (starts.length === 0
        && note.querySelector(":scope > notations > ornaments > trill-mark") !== null) {
        starts.push(1);
    }
    return { starts, stops };
};
const parseMusicXmlTupletTimeModification = (note) => {
    var _a, _b, _c, _d;
    const actual = Number.parseInt(((_b = (_a = note.querySelector(":scope > time-modification > actual-notes")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim(), 10);
    const normal = Number.parseInt(((_d = (_c = note.querySelector(":scope > time-modification > normal-notes")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim(), 10);
    if (!Number.isFinite(actual) || !Number.isFinite(normal) || actual <= 0 || normal <= 0)
        return null;
    return {
        actualNotes: Math.max(1, Math.round(actual)),
        normalNotes: Math.max(1, Math.round(normal)),
    };
};
const parseMusicXmlTupletNumbers = (note) => {
    var _a, _b;
    const starts = [];
    const stops = [];
    for (const tuplet of Array.from(note.querySelectorAll(":scope > notations > tuplet[type]"))) {
        const type = ((_a = tuplet.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
        const rawNumber = ((_b = tuplet.getAttribute("number")) !== null && _b !== void 0 ? _b : "").trim();
        const parsed = Number.parseInt(rawNumber, 10);
        const number = Number.isFinite(parsed) && parsed > 0 ? Math.round(parsed) : 1;
        if (type === "start")
            starts.push(number);
        if (type === "stop")
            stops.push(number);
    }
    return { starts, stops };
};
const mergeUniqueNumbers = (base, incoming) => {
    if (!incoming.length)
        return base;
    const merged = new Set(base !== null && base !== void 0 ? base : []);
    for (const no of incoming)
        merged.add(Math.max(1, Math.round(no)));
    return Array.from(merged.values()).sort((a, b) => a - b);
};
const parseMusicXmlArticulationSubtypes = (note) => {
    const out = new Set();
    for (const node of Array.from(note.querySelectorAll(":scope > notations > articulations > *"))) {
        const tag = node.tagName.toLowerCase();
        if (tag === "staccato")
            out.add("articStaccatoAbove");
        if (tag === "accent")
            out.add("articAccentAbove");
        if (tag === "tenuto")
            out.add("articTenutoAbove");
    }
    for (const node of Array.from(note.querySelectorAll(":scope > notations > technical > *"))) {
        const tag = node.tagName.toLowerCase();
        if (tag === "stopped")
            out.add("articLhPizzicatoAbove");
        if (tag === "snap-pizzicato")
            out.add("snapPizzicato");
        if (tag === "up-bow")
            out.add("articUpBowAbove");
        if (tag === "down-bow")
            out.add("articDownBowAbove");
        if (tag === "open-string")
            out.add("articOpenStringAbove");
        if (tag === "harmonic")
            out.add("articHarmonicAbove");
    }
    return Array.from(out.values());
};
const parseMusicXmlTechnicalFingering = (note) => {
    var _a, _b;
    const text = ((_b = (_a = note.querySelector(":scope > notations > technical > fingering")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    return text || null;
};
const parseMusicXmlTechnicalString = (note) => {
    var _a, _b;
    const raw = ((_b = (_a = note.querySelector(":scope > notations > technical > string")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim();
    if (!raw)
        return null;
    const n = Number.parseInt(raw, 10);
    if (!Number.isFinite(n) || n <= 0)
        return null;
    return Math.round(n);
};
const mergeUniqueStrings = (base, incoming) => {
    if (!incoming.length)
        return base;
    const merged = new Set(base !== null && base !== void 0 ? base : []);
    for (const s of incoming)
        merged.add(s);
    return Array.from(merged.values());
};
const mergeUniqueSubtypes = (base, incoming) => {
    if (!incoming.length)
        return base;
    const merged = new Set(base !== null && base !== void 0 ? base : []);
    for (const s of incoming)
        merged.add(s);
    return Array.from(merged.values());
};
const normalizeMusicXmlClefSign = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim().toUpperCase();
    if (!v)
        return null;
    if (v.includes("F"))
        return "F";
    if (v.includes("G"))
        return "G";
    return null;
};
const readMusicXmlMeasureClefSign = (measure, staffNo) => {
    const numbered = measure.querySelector(`:scope > attributes > clef[number="${staffNo}"] > sign`);
    const numberedSign = normalizeMusicXmlClefSign(numbered === null || numbered === void 0 ? void 0 : numbered.textContent);
    if (numberedSign)
        return numberedSign;
    if (staffNo === 1) {
        const unnumbered = measure.querySelector(":scope > attributes > clef:not([number]) > sign");
        const unnumberedSign = normalizeMusicXmlClefSign(unnumbered === null || unnumbered === void 0 ? void 0 : unnumbered.textContent);
        if (unnumberedSign)
            return unnumberedSign;
    }
    return null;
};
const collectMusicXmlPitchesByStaff = (part) => {
    var _a;
    const byStaff = new Map();
    for (const note of Array.from(part.querySelectorAll(":scope > measure > note"))) {
        if (note.querySelector(":scope > rest"))
            continue;
        const midi = parseMusicXmlPitchToMidi(note);
        if (midi === null)
            continue;
        const staffNo = getNoteStaffNo(note);
        const list = (_a = byStaff.get(staffNo)) !== null && _a !== void 0 ? _a : [];
        list.push(midi);
        byStaff.set(staffNo, list);
    }
    return byStaff;
};
const inferClefSignFromPitches = (midiList) => {
    if (!midiList.length)
        return "G";
    const sorted = midiList.slice().sort((a, b) => a - b);
    const mid = Math.floor(sorted.length / 2);
    const median = sorted.length % 2 === 1 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
    return median < 60 ? "F" : "G";
};
const readFirstExplicitClefInPart = (part, staffNo) => {
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const clef = readMusicXmlMeasureClefSign(measure, staffNo);
        if (clef)
            return clef;
    }
    return null;
};
const buildMuseVoiceEventsByStaff = (measure, targetDivisions, sourceDivisions) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
    const byStaff = new Map();
    let cursorDiv = 0;
    const normalizeDuration = (rawDuration) => {
        const src = Math.max(1, Math.round(sourceDivisions));
        const dst = Math.max(1, Math.round(targetDivisions));
        return Math.max(0, Math.round((Math.max(0, rawDuration) * dst) / src));
    };
    const pendingDirectionMarks = [];
    const queueDirectionMarks = (staffNo, voiceNo, atDiv, marks) => {
        var _a, _b, _c;
        const prev = (_b = (_a = pendingDirectionMarks.find((entry) => entry.staffNo === staffNo && entry.voiceNo === voiceNo && entry.atDiv === atDiv)) === null || _a === void 0 ? void 0 : _a.marks) !== null && _b !== void 0 ? _b : { ottavaStartSubtypes: [], ottavaStopCount: 0 };
        if ((_c = marks.ottavaStartSubtypes) === null || _c === void 0 ? void 0 : _c.length) {
            prev.ottavaStartSubtypes.push(...marks.ottavaStartSubtypes);
        }
        if (marks.ottavaStopCount) {
            prev.ottavaStopCount += marks.ottavaStopCount;
        }
        const found = pendingDirectionMarks.find((entry) => entry.staffNo === staffNo && entry.voiceNo === voiceNo && entry.atDiv === atDiv);
        if (found) {
            found.marks = prev;
            return;
        }
        pendingDirectionMarks.push({ staffNo, voiceNo, atDiv, marks: prev });
    };
    const consumeDirectionMarks = (staffNo, voiceNo, atDiv) => {
        const collected = { ottavaStartSubtypes: [], ottavaStopCount: 0 };
        for (let i = pendingDirectionMarks.length - 1; i >= 0; i -= 1) {
            const entry = pendingDirectionMarks[i];
            if (entry.staffNo !== staffNo || entry.voiceNo !== voiceNo)
                continue;
            if (entry.atDiv > atDiv)
                continue;
            if (entry.marks.ottavaStartSubtypes.length) {
                collected.ottavaStartSubtypes.push(...entry.marks.ottavaStartSubtypes);
            }
            if (entry.marks.ottavaStopCount > 0) {
                collected.ottavaStopCount += entry.marks.ottavaStopCount;
            }
            pendingDirectionMarks.splice(i, 1);
        }
        if (!collected.ottavaStartSubtypes.length && collected.ottavaStopCount <= 0)
            return null;
        return collected;
    };
    const children = Array.from(measure.children);
    for (const child of children) {
        const tag = child.tagName.toLowerCase();
        if (tag === "backup") {
            const durationRaw = Math.max(0, Math.round((_a = firstNumber(child, ":scope > duration")) !== null && _a !== void 0 ? _a : 0));
            const duration = normalizeDuration(durationRaw);
            cursorDiv = Math.max(0, cursorDiv - duration);
            continue;
        }
        if (tag === "forward") {
            const durationRaw = Math.max(0, Math.round((_b = firstNumber(child, ":scope > duration")) !== null && _b !== void 0 ? _b : 0));
            const duration = normalizeDuration(durationRaw);
            cursorDiv += duration;
            continue;
        }
        if (tag === "direction") {
            const staffNo = Math.max(1, Math.round((_c = firstNumber(child, ":scope > staff")) !== null && _c !== void 0 ? _c : 1));
            const voiceNo = Math.max(1, Math.round((_d = firstNumber(child, ":scope > voice")) !== null && _d !== void 0 ? _d : 1));
            const startSubtypes = [];
            let stopCount = 0;
            for (const octaveShift of Array.from(child.querySelectorAll(":scope > direction-type > octave-shift[type]"))) {
                const type = ((_e = octaveShift.getAttribute("type")) !== null && _e !== void 0 ? _e : "").trim().toLowerCase();
                if (type === "stop") {
                    stopCount += 1;
                    continue;
                }
                const subtype = parseMusicXmlOctaveShiftSubtype(octaveShift);
                if (subtype)
                    startSubtypes.push(subtype);
            }
            if (startSubtypes.length || stopCount > 0) {
                queueDirectionMarks(staffNo, voiceNo, cursorDiv, {
                    ottavaStartSubtypes: startSubtypes,
                    ottavaStopCount: stopCount,
                });
            }
            continue;
        }
        if (tag !== "note")
            continue;
        const staffNo = getNoteStaffNo(child);
        const voiceNo = Math.max(1, Math.round((_f = firstNumber(child, ":scope > voice")) !== null && _f !== void 0 ? _f : 1));
        const isGrace = child.querySelector(":scope > grace") !== null;
        const isGraceSlash = ((_h = (_g = child.querySelector(":scope > grace")) === null || _g === void 0 ? void 0 : _g.getAttribute("slash")) !== null && _h !== void 0 ? _h : "").trim().toLowerCase() === "yes";
        const durationRaw = isGrace
            ? 0
            : Math.max(1, Math.round((_j = firstNumber(child, ":scope > duration")) !== null && _j !== void 0 ? _j : sourceDivisions));
        const durationDiv = isGrace
            ? 0
            : Math.max(1, normalizeDuration(durationRaw));
        const isChordFollow = child.querySelector(":scope > chord") !== null;
        const isRest = child.querySelector(":scope > rest") !== null;
        const tupletTimeModification = parseMusicXmlTupletTimeModification(child);
        const tupletNumbers = parseMusicXmlTupletNumbers(child);
        const byVoice = (_k = byStaff.get(staffNo)) !== null && _k !== void 0 ? _k : new Map();
        byStaff.set(staffNo, byVoice);
        const events = (_l = byVoice.get(voiceNo)) !== null && _l !== void 0 ? _l : [];
        byVoice.set(voiceNo, events);
        if (isChordFollow && !isRest && events.length > 0) {
            const prev = events[events.length - 1];
            // In MusicXML, <chord/> notes share onset with the previous note.
            // cursorDiv is already advanced past the previous non-chord note, so compare against prev end time.
            if (prev.pitches !== null && prev.atDiv + prev.durationDiv === cursorDiv) {
                const midi = parseMusicXmlPitchToMidi(child);
                if (midi !== null) {
                    const tie = parseMusicXmlTieFlags(child);
                    const accidentalSubtype = parseMusicXmlAccidentalSubtype(child);
                    const slur = parseMusicXmlSlurNumbers(child);
                    const trill = parseMusicXmlTrillNumbers(child);
                    const articulations = parseMusicXmlArticulationSubtypes(child);
                    prev.pitches.push({
                        midi,
                        tieStart: tie.tieStart,
                        tieStop: tie.tieStop,
                        accidentalSubtype,
                        fingeringText: (_m = parseMusicXmlTechnicalFingering(child)) !== null && _m !== void 0 ? _m : undefined,
                        stringNumber: (_o = parseMusicXmlTechnicalString(child)) !== null && _o !== void 0 ? _o : undefined,
                    });
                    prev.slurStarts = mergeUniqueNumbers(prev.slurStarts, slur.starts);
                    prev.slurStops = mergeUniqueNumbers(prev.slurStops, slur.stops);
                    prev.trillStarts = mergeUniqueNumbers(prev.trillStarts, trill.starts);
                    prev.trillStops = mergeUniqueNumbers(prev.trillStops, trill.stops);
                    prev.tupletStarts = mergeUniqueNumbers(prev.tupletStarts, tupletNumbers.starts);
                    prev.tupletStops = mergeUniqueNumbers(prev.tupletStops, tupletNumbers.stops);
                    if (!prev.tupletTimeModification && tupletTimeModification) {
                        prev.tupletTimeModification = tupletTimeModification;
                    }
                    prev.articulationSubtypes = mergeUniqueStrings(prev.articulationSubtypes, articulations);
                    if (isGrace) {
                        prev.grace = true;
                        prev.graceSlash = prev.graceSlash || isGraceSlash;
                    }
                }
            }
        }
        else if (isRest) {
            const marks = consumeDirectionMarks(staffNo, voiceNo, cursorDiv);
            events.push({
                atDiv: cursorDiv,
                durationDiv,
                pitches: null,
                tupletTimeModification: tupletTimeModification !== null && tupletTimeModification !== void 0 ? tupletTimeModification : undefined,
                tupletStarts: tupletNumbers.starts.length ? tupletNumbers.starts : undefined,
                tupletStops: tupletNumbers.stops.length ? tupletNumbers.stops : undefined,
                ottavaStartSubtypes: ((_p = marks === null || marks === void 0 ? void 0 : marks.ottavaStartSubtypes) === null || _p === void 0 ? void 0 : _p.length) ? marks.ottavaStartSubtypes : undefined,
                ottavaStopCount: (marks === null || marks === void 0 ? void 0 : marks.ottavaStopCount) ? marks.ottavaStopCount : undefined,
            });
        }
        else {
            const midi = parseMusicXmlPitchToMidi(child);
            if (midi !== null) {
                const tie = parseMusicXmlTieFlags(child);
                const accidentalSubtype = parseMusicXmlAccidentalSubtype(child);
                const slur = parseMusicXmlSlurNumbers(child);
                const trill = parseMusicXmlTrillNumbers(child);
                const articulations = parseMusicXmlArticulationSubtypes(child);
                const marks = consumeDirectionMarks(staffNo, voiceNo, cursorDiv);
                events.push({
                    atDiv: cursorDiv,
                    durationDiv,
                    grace: isGrace ? true : undefined,
                    graceSlash: isGrace ? isGraceSlash : undefined,
                    tupletTimeModification: tupletTimeModification !== null && tupletTimeModification !== void 0 ? tupletTimeModification : undefined,
                    tupletStarts: tupletNumbers.starts.length ? tupletNumbers.starts : undefined,
                    tupletStops: tupletNumbers.stops.length ? tupletNumbers.stops : undefined,
                    pitches: [{
                            midi,
                            tieStart: tie.tieStart,
                            tieStop: tie.tieStop,
                            accidentalSubtype,
                            fingeringText: (_q = parseMusicXmlTechnicalFingering(child)) !== null && _q !== void 0 ? _q : undefined,
                            stringNumber: (_r = parseMusicXmlTechnicalString(child)) !== null && _r !== void 0 ? _r : undefined,
                        }],
                    slurStarts: slur.starts.length ? slur.starts : undefined,
                    slurStops: slur.stops.length ? slur.stops : undefined,
                    trillStarts: trill.starts.length ? trill.starts : undefined,
                    trillStops: trill.stops.length ? trill.stops : undefined,
                    ottavaStartSubtypes: ((_s = marks === null || marks === void 0 ? void 0 : marks.ottavaStartSubtypes) === null || _s === void 0 ? void 0 : _s.length) ? marks.ottavaStartSubtypes : undefined,
                    ottavaStopCount: (marks === null || marks === void 0 ? void 0 : marks.ottavaStopCount) ? marks.ottavaStopCount : undefined,
                    articulationSubtypes: articulations.length ? articulations : undefined,
                });
            }
        }
        if (!isChordFollow && !isGrace) {
            cursorDiv += durationDiv;
        }
    }
    // Attach trailing direction marks (e.g. octave-shift stop at measure end) to the last timed event.
    for (const pending of pendingDirectionMarks) {
        const byVoice = byStaff.get(pending.staffNo);
        if (!byVoice)
            continue;
        const events = byVoice.get(pending.voiceNo);
        if (!events || !events.length)
            continue;
        const last = events[events.length - 1];
        last.ottavaStartSubtypes = (_t = mergeUniqueSubtypes(last.ottavaStartSubtypes, pending.marks.ottavaStartSubtypes)) !== null && _t !== void 0 ? _t : last.ottavaStartSubtypes;
        if (((_u = pending.marks.ottavaStopCount) !== null && _u !== void 0 ? _u : 0) > 0) {
            last.ottavaStopCount = ((_v = last.ottavaStopCount) !== null && _v !== void 0 ? _v : 0) + pending.marks.ottavaStopCount;
        }
    }
    return byStaff;
};
const readPartNameMapFromMusicXml = (score) => {
    var _a, _b, _c;
    const map = new Map();
    for (const sp of Array.from(score.querySelectorAll(":scope > part-list > score-part"))) {
        const id = ((_a = sp.getAttribute("id")) !== null && _a !== void 0 ? _a : "").trim();
        if (!id)
            continue;
        const name = ((_c = (_b = sp.querySelector(":scope > part-name")) === null || _b === void 0 ? void 0 : _b.textContent) !== null && _c !== void 0 ? _c : "").trim() || id;
        map.set(id, name);
    }
    return map;
};
const gcdForDivisions = (a, b) => {
    let x = Math.max(1, Math.abs(Math.round(a)));
    let y = Math.max(1, Math.abs(Math.round(b)));
    while (y !== 0) {
        const t = x % y;
        x = y;
        y = t;
    }
    return Math.max(1, x);
};
const lcmForDivisions = (a, b) => {
    const x = Math.max(1, Math.abs(Math.round(a)));
    const y = Math.max(1, Math.abs(Math.round(b)));
    return Math.max(1, Math.round((x / gcdForDivisions(x, y)) * y));
};
const computeGlobalMusicXmlDivisions = (score) => {
    const values = Array.from(score.querySelectorAll(":scope > part > measure > attributes > divisions"))
        .map((el) => { var _a; return Number(((_a = el.textContent) !== null && _a !== void 0 ? _a : "").trim()); })
        .filter((n) => Number.isFinite(n) && n > 0)
        .map((n) => Math.max(1, Math.round(n)));
    if (!values.length)
        return 480;
    let lcm = values[0];
    for (let i = 1; i < values.length; i += 1) {
        lcm = lcmForDivisions(lcm, values[i]);
        // Guard against pathological growth.
        if (lcm > 3840)
            return 3840;
    }
    return lcm;
};
const exportMusicXmlDomToMuseScore = (doc, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    const score = doc.querySelector("score-partwise");
    if (!score)
        throw new Error("MusicXML score-partwise root was not found.");
    const normalizeCutTimeToTwoTwo = options.normalizeCutTimeToTwoTwo === true;
    const title = ((_b = (_a = score.querySelector("work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : "").trim()
        || ((_d = (_c = score.querySelector("movement-title")) === null || _c === void 0 ? void 0 : _c.textContent) !== null && _d !== void 0 ? _d : "").trim()
        || "mikuscore export";
    const divisions = computeGlobalMusicXmlDivisions(score);
    const partNodes = Array.from(score.querySelectorAll(":scope > part"));
    const partNameById = readPartNameMapFromMusicXml(score);
    let scoreXml = `<?xml version="1.0" encoding="UTF-8"?><museScore version="4.0"><Score>`;
    scoreXml += `<metaTag name="workTitle">${xmlEscape(title)}</metaTag>`;
    scoreXml += `<Division>${divisions}</Division>`;
    if (!partNodes.length) {
        const capacity = Math.max(1, Math.round((divisions * 4 * 4) / 4));
        scoreXml += `<Part><trackName>P1</trackName><Staff id="1"/></Part>`;
        scoreXml += `<Staff id="1"><Measure><voice>${makeMuseRestXml(capacity, capacity, divisions)}</voice></Measure></Staff>`;
        scoreXml += "</Score></museScore>";
        return scoreXml;
    }
    let nextStaffId = 1;
    const partDefs = [];
    const staffsXml = [];
    for (let pi = 0; pi < partNodes.length; pi += 1) {
        const part = partNodes[pi];
        const partId = ((_e = part.getAttribute("id")) !== null && _e !== void 0 ? _e : "").trim();
        const partName = (_f = partNameById.get(partId)) !== null && _f !== void 0 ? _f : (partId || `P${pi + 1}`);
        const laneCount = getPartStaffCountFromMusicXml(part);
        const partTranspose = readPartTransposeFromMusicXml(part);
        const pitchByStaff = collectMusicXmlPitchesByStaff(part);
        const initialClefByStaff = new Map();
        for (let staffNo = 1; staffNo <= laneCount; staffNo += 1) {
            const explicit = readFirstExplicitClefInPart(part, staffNo);
            const fallback = inferClefSignFromPitches((_g = pitchByStaff.get(staffNo)) !== null && _g !== void 0 ? _g : []);
            initialClefByStaff.set(staffNo, explicit !== null && explicit !== void 0 ? explicit : fallback);
        }
        const staffIds = Array.from({ length: laneCount }, () => nextStaffId++);
        const instrumentTransposeXml = partTranspose
            ? `<Instrument>${Number.isFinite(partTranspose.diatonic) ? `<transposeDiatonic>${Math.round(Number(partTranspose.diatonic))}</transposeDiatonic><mksTransposeDiatonic>${Math.round(Number(partTranspose.diatonic))}</mksTransposeDiatonic>` : ""}${Number.isFinite(partTranspose.chromatic) ? `<transposeChromatic>${Math.round(Number(partTranspose.chromatic))}</transposeChromatic><mksTransposeChromatic>${Math.round(Number(partTranspose.chromatic))}</mksTransposeChromatic>` : ""}</Instrument>`
            : "";
        partDefs.push(`<Part><trackName>${xmlEscape(partName)}</trackName>${instrumentTransposeXml}${staffIds
            .map((id) => `<Staff id="${id}"/>`)
            .join("")}</Part>`);
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        let currentSourceDivisions = (_h = firstNumber(part, ":scope > measure > attributes > divisions")) !== null && _h !== void 0 ? _h : divisions;
        let currentBeats = Math.max(1, Math.round((_j = firstNumber(part, ":scope > measure > attributes > time > beats")) !== null && _j !== void 0 ? _j : 4));
        let currentBeatType = Math.max(1, Math.round((_k = firstNumber(part, ":scope > measure > attributes > time > beat-type")) !== null && _k !== void 0 ? _k : 4));
        let currentTimeSymbol = null;
        let currentFifths = Math.max(-7, Math.min(7, Math.round((_l = firstNumber(part, ":scope > measure > attributes > key > fifths")) !== null && _l !== void 0 ? _l : 0)));
        const staffXmlByLane = Array.from({ length: laneCount }, (_unused, laneIndex) => {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u;
            const staffNo = laneIndex + 1;
            let currentClef = (_a = initialClefByStaff.get(staffNo)) !== null && _a !== void 0 ? _a : "G";
            let staffXml = `<Staff id="${staffIds[laneIndex]}">`;
            for (let mi = 0; mi < measures.length; mi += 1) {
                const measure = measures[mi];
                const measureSourceDivisions = Math.max(1, Math.round((_b = firstNumber(measure, ":scope > attributes > divisions")) !== null && _b !== void 0 ? _b : currentSourceDivisions));
                const byStaffVoice = buildMuseVoiceEventsByStaff(measure, divisions, measureSourceDivisions);
                const byVoice = (_c = byStaffVoice.get(staffNo)) !== null && _c !== void 0 ? _c : new Map();
                const measureBeats = Math.max(1, Math.round((_d = firstNumber(measure, ":scope > attributes > time > beats")) !== null && _d !== void 0 ? _d : currentBeats));
                const measureBeatType = Math.max(1, Math.round((_e = firstNumber(measure, ":scope > attributes > time > beat-type")) !== null && _e !== void 0 ? _e : currentBeatType));
                const measureTimeSymbolRaw = ((_g = (_f = measure.querySelector(":scope > attributes > time")) === null || _f === void 0 ? void 0 : _f.getAttribute("symbol")) !== null && _g !== void 0 ? _g : "")
                    .trim()
                    .toLowerCase();
                const hasExplicitTimeInMusicXml = measure.querySelector(":scope > attributes > time") !== null;
                const measureTimeSymbolFromXml = measureTimeSymbolRaw === "cut" ? "cut" : null;
                const measureTimeSymbol = measureTimeSymbolFromXml !== null && measureTimeSymbolFromXml !== void 0 ? measureTimeSymbolFromXml : currentTimeSymbol;
                const shouldNormalizeCut = normalizeCutTimeToTwoTwo
                    && measureTimeSymbol === "cut"
                    && measureBeats === 4
                    && measureBeatType === 4;
                const effectiveMeasureBeats = shouldNormalizeCut ? 2 : measureBeats;
                const effectiveMeasureBeatType = shouldNormalizeCut ? 2 : measureBeatType;
                const measureFifths = Math.max(-7, Math.min(7, Math.round((_h = firstNumber(measure, ":scope > attributes > key > fifths")) !== null && _h !== void 0 ? _h : currentFifths)));
                const capacityDiv = Math.max(1, Math.round((divisions * 4 * effectiveMeasureBeats) / Math.max(1, effectiveMeasureBeatType)));
                const directionSeeds = collectDirectionSeedsFromMusicXmlMeasure(measure, staffNo);
                const voiceNos = Array.from(byVoice.keys()).sort((a, b) => a - b);
                if (!voiceNos.length)
                    voiceNos.push(1);
                const hasLeftDoubleBarlineInMusicXml = ((_k = (_j = measure.querySelector(':scope > barline[location="left"] > bar-style')) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : "").trim().toLowerCase() === "light-light";
                const hasPrevRightDoubleBarlineInMusicXml = mi > 0
                    && (((_o = (_m = (_l = measures[mi - 1]) === null || _l === void 0 ? void 0 : _l.querySelector(':scope > barline[location="right"] > bar-style')) === null || _m === void 0 ? void 0 : _m.textContent) !== null && _o !== void 0 ? _o : "")
                        .trim()
                        .toLowerCase() === "light-light");
                const needsDoubleBarlineAtMeasureStart = hasLeftDoubleBarlineInMusicXml || hasPrevRightDoubleBarlineInMusicXml;
                const hasImplicitMeasureInMusicXml = ((_p = measure.getAttribute("implicit")) !== null && _p !== void 0 ? _p : "").trim().toLowerCase() === "yes";
                const usedDiv = Array.from(byVoice.values()).reduce((maxEnd, events) => {
                    const laneEnd = events.reduce((laneMax, ev) => {
                        const end = ev.grace ? ev.atDiv : ev.atDiv + Math.max(0, Math.round(ev.durationDiv));
                        return Math.max(laneMax, end);
                    }, 0);
                    return Math.max(maxEnd, laneEnd);
                }, 0);
                const implicitLenDiv = hasImplicitMeasureInMusicXml ? Math.max(1, Math.min(capacityDiv, usedDiv)) : null;
                // For pickup/implicit measures, do not pad voice content to nominal bar capacity.
                const renderCapacityDiv = implicitLenDiv !== null && implicitLenDiv !== void 0 ? implicitLenDiv : capacityDiv;
                const lenAttr = implicitLenDiv !== null && implicitLenDiv < capacityDiv
                    ? formatMeasureLenFromDivisions(implicitLenDiv, divisions)
                    : null;
                let measureXml = lenAttr ? `<Measure len="${lenAttr}">` : "<Measure>";
                for (let vi = 0; vi < voiceNos.length; vi += 1) {
                    const voiceNo = voiceNos[vi];
                    let voiceXml = "<voice>";
                    if (vi === 0) {
                        const measureClef = readMusicXmlMeasureClefSign(measure, staffNo);
                        const targetClef = measureClef !== null && measureClef !== void 0 ? measureClef : currentClef;
                        const shouldWriteClef = mi === 0 || targetClef !== currentClef || measureClef !== null;
                        const shouldWriteTime = mi === 0
                            || effectiveMeasureBeats !== currentBeats
                            || effectiveMeasureBeatType !== currentBeatType
                            || measureTimeSymbol !== currentTimeSymbol
                            || hasExplicitTimeInMusicXml;
                        const shouldWriteKey = mi === 0 || measureFifths !== currentFifths;
                        if (shouldWriteClef) {
                            voiceXml += `<Clef><concertClefType>${targetClef}</concertClefType></Clef>`;
                        }
                        if (shouldWriteTime) {
                            const cutSubtypeXml = measureTimeSymbol === "cut" ? "<subtype>2</subtype>" : "";
                            voiceXml += `<TimeSig>${cutSubtypeXml}<sigN>${effectiveMeasureBeats}</sigN><sigD>${effectiveMeasureBeatType}</sigD></TimeSig>`;
                        }
                        if (shouldWriteKey) {
                            voiceXml += `<KeySig><accidental>${measureFifths}</accidental></KeySig>`;
                        }
                        if (needsDoubleBarlineAtMeasureStart) {
                            voiceXml += `<BarLine><subtype>double</subtype></BarLine>`;
                        }
                        for (const seed of directionSeeds) {
                            if (seed.kind === "tempo") {
                                voiceXml += `<Tempo><tempo>${seed.qps.toFixed(6)}</tempo>${seed.text ? `<text>${xmlEscape(seed.text)}</text>` : ""}</Tempo>`;
                                continue;
                            }
                            if (seed.kind === "dynamic") {
                                voiceXml += `<Dynamic><subtype>${xmlEscape(seed.subtype)}</subtype>${seed.velocity ? `<velocity>${seed.velocity}</velocity>` : ""}</Dynamic>`;
                                continue;
                            }
                            if (seed.kind === "expression") {
                                const text = seed.italic ? `<i></i>${xmlEscape(seed.text)}` : xmlEscape(seed.text);
                                voiceXml += `<Expression><text>${text}</text></Expression>`;
                                continue;
                            }
                            if (seed.kind === "marker") {
                                voiceXml += `<Marker><subtype>${xmlEscape(seed.subtype)}</subtype><label>${xmlEscape(seed.label)}</label></Marker>`;
                                continue;
                            }
                            if (seed.kind === "jump") {
                                voiceXml += `<Jump><text>${xmlEscape(seed.text)}</text>${seed.jumpTo ? `<jumpTo>${xmlEscape(seed.jumpTo)}</jumpTo>` : ""}${seed.playUntil ? `<playUntil>${xmlEscape(seed.playUntil)}</playUntil>` : ""}${seed.continueAt ? `<continueAt>${xmlEscape(seed.continueAt)}</continueAt>` : ""}</Jump>`;
                            }
                        }
                        if (measure.querySelector(':scope > barline[location="left"] > repeat[direction="forward"]')) {
                            voiceXml += "<startRepeat/>";
                        }
                        currentClef = targetClef;
                    }
                    const events = ((_q = byVoice.get(voiceNo)) !== null && _q !== void 0 ? _q : []).slice().sort((a, b) => a.atDiv - b.atDiv);
                    let cursorDiv = 0;
                    let nextTupletRefNo = 1;
                    const activeTupletRefByNumber = new Map();
                    for (const event of events) {
                        if (event.atDiv > cursorDiv) {
                            const gap = Math.min(event.atDiv, renderCapacityDiv) - cursorDiv;
                            if (gap > 0) {
                                voiceXml += makeMuseRestXml(gap, gap, divisions);
                                cursorDiv += gap;
                            }
                        }
                        const startNumbers = (_r = event.tupletStarts) !== null && _r !== void 0 ? _r : [];
                        const stopNumbers = (_s = event.tupletStops) !== null && _s !== void 0 ? _s : [];
                        const hasTupletTiming = Boolean(event.tupletTimeModification);
                        for (const number of startNumbers) {
                            const normalized = Math.max(1, Math.round(number));
                            const refId = `T${nextTupletRefNo}`;
                            nextTupletRefNo += 1;
                            const tm = (_t = event.tupletTimeModification) !== null && _t !== void 0 ? _t : { actualNotes: 3, normalNotes: 2 };
                            voiceXml += `<Tuplet id="${refId}"><normalNotes>${tm.normalNotes}</normalNotes><actualNotes>${tm.actualNotes}</actualNotes></Tuplet>`;
                            activeTupletRefByNumber.set(normalized, refId);
                        }
                        if (!hasTupletTiming && startNumbers.length === 0 && stopNumbers.length === 0) {
                            activeTupletRefByNumber.clear();
                        }
                        if (hasTupletTiming && activeTupletRefByNumber.size === 0) {
                            const implicitNumber = 1000000 + nextTupletRefNo;
                            const refId = `T${nextTupletRefNo}`;
                            nextTupletRefNo += 1;
                            const tm = (_u = event.tupletTimeModification) !== null && _u !== void 0 ? _u : { actualNotes: 3, normalNotes: 2 };
                            voiceXml += `<Tuplet id="${refId}"><normalNotes>${tm.normalNotes}</normalNotes><actualNotes>${tm.actualNotes}</actualNotes></Tuplet>`;
                            activeTupletRefByNumber.set(implicitNumber, refId);
                        }
                        const activeTupletRefIds = Array.from(activeTupletRefByNumber.entries())
                            .sort((a, b) => a[0] - b[0])
                            .map((entry) => entry[1]);
                        const tupletRefId = hasTupletTiming && activeTupletRefIds.length
                            ? activeTupletRefIds[activeTupletRefIds.length - 1]
                            : undefined;
                        const tupletDisplayDurationDiv = event.tupletTimeModification
                            ? Math.max(1, Math.round(Math.max(1, event.durationDiv) * event.tupletTimeModification.actualNotes
                                / event.tupletTimeModification.normalNotes))
                            : event.durationDiv;
                        if (event.pitches === null) {
                            voiceXml += makeMuseRestXml(event.durationDiv, tupletDisplayDurationDiv, divisions, tupletRefId);
                        }
                        else {
                            voiceXml += makeMuseChordXml(event.durationDiv, tupletDisplayDurationDiv, divisions, event.pitches, event.slurStarts, event.slurStops, event.articulationSubtypes, event.trillStarts, event.trillStops, tupletRefId, event.ottavaStartSubtypes, event.ottavaStopCount, event.grace, event.graceSlash);
                        }
                        for (const number of stopNumbers) {
                            activeTupletRefByNumber.delete(Math.max(1, Math.round(number)));
                        }
                        cursorDiv += event.durationDiv;
                    }
                    if (cursorDiv < renderCapacityDiv) {
                        voiceXml += makeMuseRestXml(renderCapacityDiv - cursorDiv, renderCapacityDiv - cursorDiv, divisions);
                    }
                    if (vi === 0 && measure.querySelector(':scope > barline[location="right"] > repeat[direction="backward"]')) {
                        voiceXml += "<endRepeat/>";
                    }
                    voiceXml += "</voice>";
                    measureXml += voiceXml;
                }
                measureXml += "</Measure>";
                staffXml += measureXml;
                currentBeats = effectiveMeasureBeats;
                currentBeatType = effectiveMeasureBeatType;
                currentTimeSymbol = measureTimeSymbol;
                currentFifths = measureFifths;
                currentSourceDivisions = measureSourceDivisions;
            }
            staffXml += "</Staff>";
            return staffXml;
        });
        staffsXml.push(...staffXmlByLane);
    }
    scoreXml += partDefs.join("");
    scoreXml += staffsXml.join("");
    scoreXml += "</Score></museScore>";
    return scoreXml;
};
exports.exportMusicXmlDomToMuseScore = exportMusicXmlDomToMuseScore;

  },
  "core/accidentalSpelling.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolveAccidentalTextForPitch = exports.accidentalTextFromAlter = exports.keySignatureAlterForStep = exports.midiToPitch = void 0;
const midiToPitch = (midiNumber, options) => {
    var _a, _b, _c;
    const n = Math.max(0, Math.min(127, Math.round(midiNumber)));
    const octave = Math.floor(n / 12) - 1;
    const semitone = n % 12;
    const sharpTable = [
        { step: "C", alter: 0 },
        { step: "C", alter: 1 },
        { step: "D", alter: 0 },
        { step: "D", alter: 1 },
        { step: "E", alter: 0 },
        { step: "F", alter: 0 },
        { step: "F", alter: 1 },
        { step: "G", alter: 0 },
        { step: "G", alter: 1 },
        { step: "A", alter: 0 },
        { step: "A", alter: 1 },
        { step: "B", alter: 0 },
    ];
    const flatTable = [
        { step: "C", alter: 0 },
        { step: "D", alter: -1 },
        { step: "D", alter: 0 },
        { step: "E", alter: -1 },
        { step: "E", alter: 0 },
        { step: "F", alter: 0 },
        { step: "G", alter: -1 },
        { step: "G", alter: 0 },
        { step: "A", alter: -1 },
        { step: "A", alter: 0 },
        { step: "B", alter: -1 },
        { step: "B", alter: 0 },
    ];
    const pref = String((_a = options === null || options === void 0 ? void 0 : options.preferAccidental) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
    const preferFlatByAccidental = pref === "flat" || pref === "flat-flat";
    const preferSharpByAccidental = pref === "sharp" || pref === "double-sharp";
    const keyFifths = Number((_b = options === null || options === void 0 ? void 0 : options.keyFifths) !== null && _b !== void 0 ? _b : 0);
    const preferFlatByKey = Number.isFinite(keyFifths) && keyFifths < 0;
    const preferFlat = preferFlatByAccidental || (!preferSharpByAccidental && preferFlatByKey);
    const table = preferFlat ? flatTable : sharpTable;
    const mapped = (_c = table[semitone]) !== null && _c !== void 0 ? _c : { step: "C", alter: 0 };
    return { step: mapped.step, alter: mapped.alter, octave };
};
exports.midiToPitch = midiToPitch;
const keySignatureAlterForStep = (fifths, step) => {
    const sharps = ["F", "C", "G", "D", "A", "E", "B"];
    const flats = ["B", "E", "A", "D", "G", "C", "F"];
    const s = String(step || "").trim().toUpperCase();
    if (!s)
        return 0;
    const n = Math.max(-7, Math.min(7, Math.round(Number(fifths) || 0)));
    if (n > 0 && sharps.slice(0, n).includes(s))
        return 1;
    if (n < 0 && flats.slice(0, Math.abs(n)).includes(s))
        return -1;
    return 0;
};
exports.keySignatureAlterForStep = keySignatureAlterForStep;
const accidentalTextFromAlter = (alter) => {
    switch (Math.round(alter)) {
        case -2:
            return "flat-flat";
        case -1:
            return "flat";
        case 0:
            return "natural";
        case 1:
            return "sharp";
        case 2:
            return "double-sharp";
        default:
            return null;
    }
};
exports.accidentalTextFromAlter = accidentalTextFromAlter;
const resolveAccidentalTextForPitch = (pitch, options) => {
    var _a, _b;
    const alter = Math.round(pitch.alter);
    const keyAlter = (0, exports.keySignatureAlterForStep)(options.keyFifths, pitch.step);
    const activeAlter = options.previousAlterByPitchKey.has(options.pitchKey)
        ? options.previousAlterByPitchKey.get(options.pitchKey)
        : keyAlter;
    let accidentalText = ((_a = options.preferredAccidentalText) !== null && _a !== void 0 ? _a : "").trim();
    if (!accidentalText && alter !== activeAlter) {
        accidentalText = (_b = (0, exports.accidentalTextFromAlter)(alter)) !== null && _b !== void 0 ? _b : "";
    }
    options.previousAlterByPitchKey.set(options.pitchKey, alter);
    return accidentalText;
};
exports.resolveAccidentalTextForPitch = resolveAccidentalTextForPitch;

  },
  "src/ts/lilypond-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.exportMusicXmlDomToLilyPond = exports.convertLilyPondToMusicXml = void 0;
const musicxml_io_1 = require("./musicxml-io");
const staffClefPolicy_1 = require("../../core/staffClefPolicy");
const expandLilyRepeatVoltaMarkers = (body) => {
    let expanded = String(body || "");
    const maxPasses = 8;
    for (let pass = 0; pass < maxPasses; pass += 1) {
        const m = expanded.match(/\\repeat\s+volta\s+(\d+)\s*\{/i);
        if (!m || m.index === undefined)
            break;
        const times = Number.parseInt(m[1], 10);
        const bracePos = expanded.indexOf("{", m.index + m[0].length - 1);
        if (bracePos < 0)
            break;
        const block = findBalancedBlock(expanded, bracePos);
        if (!block)
            break;
        const repeatTimes = Number.isFinite(times) && times > 1 ? Math.round(times) : 2;
        const markerStart = " @@MKS_RPT_FWD@@ ";
        const markerStop = ` @@MKS_RPT_BWD_${repeatTimes}@@ `;
        expanded =
            expanded.slice(0, m.index)
                + markerStart
                + block.content
                + markerStop
                + expanded.slice(block.endPos);
    }
    return expanded;
};
const expandLilyAlternativeMarkers = (body) => {
    let expanded = String(body || "");
    const maxPasses = 8;
    for (let pass = 0; pass < maxPasses; pass += 1) {
        const m = expanded.match(/\\alternative\s*\{/i);
        if (!m || m.index === undefined)
            break;
        const outerBracePos = expanded.indexOf("{", m.index + m[0].length - 1);
        if (outerBracePos < 0)
            break;
        const outer = findBalancedBlock(expanded, outerBracePos);
        if (!outer)
            break;
        const children = [];
        let cursor = 0;
        while (cursor < outer.content.length) {
            const next = outer.content.indexOf("{", cursor);
            if (next < 0)
                break;
            const child = findBalancedBlock(outer.content, next);
            if (!child)
                break;
            children.push(child.content);
            cursor = child.endPos;
        }
        const replacement = children
            .map((content, i) => {
            const endingNo = i + 1;
            return ` @@MKS_ENDING_START_${endingNo}@@ ${content} @@MKS_ENDING_STOP_${endingNo}@@ `;
        })
            .join(" ");
        expanded = expanded.slice(0, m.index) + replacement + expanded.slice(outer.endPos);
    }
    return expanded;
};
const expandLilyTupletMarkers = (body) => {
    let expanded = String(body || "");
    const maxPasses = 16;
    for (let pass = 0; pass < maxPasses; pass += 1) {
        const m = expanded.match(/\\tuplet\s+(\d+)\s*\/\s*(\d+)\s*\{/i);
        if (!m || m.index === undefined)
            break;
        const actual = Number.parseInt(m[1], 10);
        const normal = Number.parseInt(m[2], 10);
        const bracePos = expanded.indexOf("{", m.index + m[0].length - 1);
        if (bracePos < 0)
            break;
        const block = findBalancedBlock(expanded, bracePos);
        if (!block)
            break;
        const safeActual = Number.isFinite(actual) && actual > 0 ? Math.round(actual) : 3;
        const safeNormal = Number.isFinite(normal) && normal > 0 ? Math.round(normal) : 2;
        const replacement = ` @@MKS_TUPLET_START_${safeActual}_${safeNormal}@@ `
            + block.content
            + " @@MKS_TUPLET_STOP@@ ";
        expanded = expanded.slice(0, m.index) + replacement + expanded.slice(block.endPos);
    }
    return expanded;
};
const xmlEscape = (value) => String(value !== null && value !== void 0 ? value : "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
const gcd = (a, b) => {
    let x = Math.abs(Number(a) || 0);
    let y = Math.abs(Number(b) || 0);
    while (y !== 0) {
        const t = x % y;
        x = y;
        y = t;
    }
    return x || 1;
};
const reduceFraction = (num, den) => {
    if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0)
        return { num: 1, den: 1 };
    const sign = den < 0 ? -1 : 1;
    const n = Math.round(num * sign);
    const d = Math.round(den * sign);
    const g = gcd(n, d);
    return { num: n / g, den: d / g };
};
const lilyDurationToAbcLen = (duration, dotCount) => {
    const safeDuration = Number.isFinite(duration) && duration > 0 ? Math.round(duration) : 4;
    let ratio = reduceFraction(8, safeDuration);
    const safeDots = Math.max(0, Math.min(3, Math.round(dotCount)));
    if (safeDots > 0) {
        const dotMul = reduceFraction((2 ** (safeDots + 1)) - 1, 2 ** safeDots);
        ratio = reduceFraction(ratio.num * dotMul.num, ratio.den * dotMul.den);
    }
    if (ratio.num === ratio.den)
        return "";
    if (ratio.den === 1)
        return String(ratio.num);
    if (ratio.num === 1 && ratio.den === 2)
        return "/";
    if (ratio.num === 1)
        return `/${ratio.den}`;
    return `${ratio.num}/${ratio.den}`;
};
const abcLenToLilyDuration = (token) => {
    const raw = String(token || "").trim();
    if (!raw)
        return { duration: 8, dots: 0 };
    let ratio = { num: 1, den: 1 };
    if (/^\d+$/.test(raw)) {
        ratio = reduceFraction(Number.parseInt(raw, 10), 1);
    }
    else if (raw === "/") {
        ratio = { num: 1, den: 2 };
    }
    else if (/^\/\d+$/.test(raw)) {
        ratio = reduceFraction(1, Number.parseInt(raw.slice(1), 10));
    }
    else {
        const m = raw.match(/^(\d+)\/(\d+)$/);
        if (m)
            ratio = reduceFraction(Number.parseInt(m[1], 10), Number.parseInt(m[2], 10));
    }
    const exact = reduceFraction(8 * ratio.den, ratio.num);
    const dotted1 = reduceFraction(16 * ratio.den, 3 * ratio.num);
    const dotted2 = reduceFraction(32 * ratio.den, 7 * ratio.num);
    const candidates = [
        { duration: exact.num / exact.den, dots: 0, frac: exact },
        { duration: dotted1.num / dotted1.den, dots: 1, frac: dotted1 },
        { duration: dotted2.num / dotted2.den, dots: 2, frac: dotted2 },
    ].filter((item) => item.frac.den !== 0 && Number.isFinite(item.duration));
    for (const candidate of candidates) {
        if (candidate.frac.den === 1 && [1, 2, 4, 8, 16, 32, 64, 128].includes(candidate.frac.num)) {
            return {
                duration: candidate.frac.num,
                dots: candidate.dots,
            };
        }
    }
    return { duration: 8, dots: 0 };
};
const abcPitchFromStepOctave = (step, octave) => {
    const upperStep = String(step || "").toUpperCase();
    if (!/^[A-G]$/.test(upperStep))
        return "C";
    if (octave >= 5)
        return upperStep.toLowerCase() + "'".repeat(octave - 5);
    return upperStep + ",".repeat(Math.max(0, 4 - octave));
};
const lilyPitchFromStepAlterOctave = (step, alter, octave) => {
    const base = String(step || "").trim().toLowerCase();
    if (!/^[a-g]$/.test(base))
        return "c'";
    let acc = "";
    const safeAlter = Number.isFinite(alter) ? Math.round(alter) : 0;
    if (safeAlter > 0)
        acc = "is".repeat(Math.min(2, safeAlter));
    if (safeAlter < 0)
        acc = "es".repeat(Math.min(2, Math.abs(safeAlter)));
    const octaveShift = Math.round(octave) - 3;
    const octaveMarks = octaveShift >= 0 ? "'".repeat(octaveShift) : ",".repeat(Math.abs(octaveShift));
    return `${base}${acc}${octaveMarks}`;
};
const pitchToMidiKey = (step, alter, octave) => {
    const upper = String(step || "").trim().toUpperCase();
    if (!/^[A-G]$/.test(upper))
        return null;
    const semitone = lilyPitchClassToSemitone(upper, alter);
    if (!Number.isFinite(semitone) || !Number.isFinite(octave))
        return null;
    // MusicXML octave 4 corresponds to MIDI C4=60, so add +1 octave offset.
    return (Math.round(octave) + 1) * 12 + semitone;
};
const chooseLilyClefFromMeasures = (measures) => {
    const keys = [];
    for (const events of measures) {
        for (const event of events) {
            if (event.kind === "note") {
                const midi = pitchToMidiKey(event.pitch.step, event.pitch.alter, event.pitch.octave);
                if (midi !== null)
                    keys.push(midi);
                continue;
            }
            if (event.kind === "chord") {
                for (const pitch of event.pitches) {
                    const midi = pitchToMidiKey(pitch.step, pitch.alter, pitch.octave);
                    if (midi !== null)
                        keys.push(midi);
                }
            }
        }
    }
    return (0, staffClefPolicy_1.chooseSingleClefByKeys)(keys) === "F" ? "bass" : "treble";
};
const collectKeysFromMeasures = (measures) => {
    const keys = [];
    for (const events of measures) {
        for (const event of events) {
            if (event.kind === "note") {
                const midi = pitchToMidiKey(event.pitch.step, event.pitch.alter, event.pitch.octave);
                if (midi !== null)
                    keys.push(midi);
                continue;
            }
            if (event.kind === "chord") {
                for (const pitch of event.pitches) {
                    const midi = pitchToMidiKey(pitch.step, pitch.alter, pitch.octave);
                    if (midi !== null)
                        keys.push(midi);
                }
            }
        }
    }
    return keys;
};
const autoSplitMeasuresToGrandStaff = (measures) => {
    const keys = collectKeysFromMeasures(measures);
    if (!(0, staffClefPolicy_1.shouldUseGrandStaffByRange)(keys)) {
        return { upper: measures, lower: [], splitApplied: false };
    }
    const upper = [];
    const lower = [];
    let previousStaff = null;
    let upperHasPitch = false;
    let lowerHasPitch = false;
    for (const events of measures) {
        const upEvents = [];
        const lowEvents = [];
        for (const event of events) {
            if (event.kind === "note") {
                const midi = pitchToMidiKey(event.pitch.step, event.pitch.alter, event.pitch.octave);
                if (midi === null) {
                    upEvents.push(event);
                    continue;
                }
                const staff = (0, staffClefPolicy_1.pickStaffForClusterWithHysteresis)(midi, midi, previousStaff);
                previousStaff = staff;
                if (staff === 1) {
                    upEvents.push(event);
                    upperHasPitch = true;
                }
                else {
                    lowEvents.push(event);
                    lowerHasPitch = true;
                }
                continue;
            }
            if (event.kind === "chord") {
                const chordKeys = event.pitches
                    .map((pitch) => pitchToMidiKey(pitch.step, pitch.alter, pitch.octave))
                    .filter((value) => value !== null);
                if (!chordKeys.length) {
                    upEvents.push(event);
                    continue;
                }
                const minKey = Math.min(...chordKeys);
                const maxKey = Math.max(...chordKeys);
                const staff = (0, staffClefPolicy_1.pickStaffForClusterWithHysteresis)(minKey, maxKey, previousStaff);
                previousStaff = staff;
                if (staff === 1) {
                    upEvents.push(event);
                    upperHasPitch = true;
                }
                else {
                    lowEvents.push(event);
                    lowerHasPitch = true;
                }
                continue;
            }
            // Keep directions/backup/rests on upper staff in split mode.
            upEvents.push(event);
        }
        upper.push(upEvents);
        lower.push(lowEvents);
    }
    // Guard: if either side has no real notes, cancel split.
    if (!upperHasPitch || !lowerHasPitch) {
        return { upper: measures, lower: [], splitApplied: false };
    }
    return { upper, lower, splitApplied: true };
};
const lilyKeyToAbc = (tonicRaw, modeRaw) => {
    const tonic = String(tonicRaw || "").trim().toLowerCase();
    const mode = String(modeRaw || "").trim().toLowerCase();
    const table = {
        c: "C",
        cis: "C#",
        des: "Db",
        d: "D",
        dis: "D#",
        ees: "Eb",
        es: "Eb",
        e: "E",
        f: "F",
        fis: "F#",
        ges: "Gb",
        g: "G",
        gis: "G#",
        aes: "Ab",
        as: "Ab",
        a: "A",
        ais: "A#",
        bes: "Bb",
        b: "B",
    };
    const note = table[tonic] || "C";
    return mode === "minor" ? `${note}m` : note;
};
const parseHeaderField = (source, field) => {
    const headerMatch = source.match(/\\header\s*\{([\s\S]*?)\}/);
    if (!headerMatch)
        return "";
    const rx = new RegExp(`${field}\\s*=\\s*\"([^\"]*)\"`);
    const m = headerMatch[1].match(rx);
    return m ? m[1].trim() : "";
};
const parseTimeSignature = (source) => {
    const m = source.match(/\\time\s+(\d+)\s*\/\s*(\d+)/);
    const beats = m ? Number.parseInt(m[1], 10) : 4;
    const beatType = m ? Number.parseInt(m[2], 10) : 4;
    return {
        beats: Number.isFinite(beats) && beats > 0 ? beats : 4,
        beatType: Number.isFinite(beatType) && beatType > 0 ? beatType : 4,
    };
};
const parseKeySignature = (source) => {
    const m = source.match(/\\key\s+([a-g](?:is|es)?)\s+\\(major|minor)/i);
    if (!m)
        return "C";
    return lilyKeyToAbc(m[1], m[2]);
};
const stripLilyComments = (text) => {
    return text
        .split("\n")
        .map((line) => line.replace(/%.*$/, ""))
        .join("\n");
};
const keyModeAndFifthsFromAbcKey = (abcKey) => {
    const map = {
        C: 0,
        G: 1,
        D: 2,
        A: 3,
        E: 4,
        B: 5,
        "F#": 6,
        "C#": 7,
        F: -1,
        Bb: -2,
        Eb: -3,
        Ab: -4,
        Db: -5,
        Gb: -6,
        Cb: -7,
        Am: 0,
        Em: 1,
        Bm: 2,
        "F#m": 3,
        "C#m": 4,
        "G#m": 5,
        "D#m": 6,
        "A#m": 7,
        Dm: -1,
        Gm: -2,
        Cm: -3,
        Fm: -4,
        Bbm: -5,
        Ebm: -6,
        Abm: -7,
    };
    const normalized = String(abcKey || "C").trim();
    const fifths = Object.prototype.hasOwnProperty.call(map, normalized) ? map[normalized] : 0;
    return {
        mode: /m$/.test(normalized) ? "minor" : "major",
        fifths,
    };
};
const lilyDurationToDivisions = (duration, dots, divisions) => {
    const safeDuration = Number.isFinite(duration) && duration > 0 ? Math.round(duration) : 4;
    const base = Math.max(1, Math.round((divisions * 4) / safeDuration));
    const safeDots = Math.max(0, Math.min(3, Math.round(dots)));
    if (safeDots === 0)
        return base;
    // dotted multiplier: 1 + 1/2 + 1/4 + ...
    const num = (2 ** (safeDots + 1)) - 1;
    const den = 2 ** safeDots;
    return Math.max(1, Math.round((base * num) / den));
};
const parseLilyDurationExpr = (expr) => {
    const raw = String(expr || "").trim();
    if (!raw)
        return { base: 4, mulNum: 1, mulDen: 1 };
    const m = raw.match(/^(\d+)(?:\*(\d+)(?:\/(\d+))?)?$/);
    if (!m)
        return { base: 4, mulNum: 1, mulDen: 1 };
    const base = Number.parseInt(m[1], 10);
    const mulNum = m[2] ? Number.parseInt(m[2], 10) : 1;
    const mulDen = m[3] ? Number.parseInt(m[3], 10) : 1;
    return {
        base: Number.isFinite(base) && base > 0 ? base : 4,
        mulNum: Number.isFinite(mulNum) && mulNum > 0 ? mulNum : 1,
        mulDen: Number.isFinite(mulDen) && mulDen > 0 ? mulDen : 1,
    };
};
const lilyDurationExprToDivisions = (durationExpr, dots, divisions) => {
    const parsed = parseLilyDurationExpr(durationExpr);
    const safeDivisions = Math.max(1, Math.round(divisions));
    const baseDiv = Math.max(1, Math.round((safeDivisions * 4) / parsed.base));
    const safeDots = Math.max(0, Math.min(3, Math.round(dots)));
    const dotNum = (2 ** (safeDots + 1)) - 1;
    const dotDen = 2 ** safeDots;
    const raw = (baseDiv * parsed.mulNum * dotNum) /
        Math.max(1, parsed.mulDen * dotDen);
    return Math.max(1, Math.round(raw));
};
const noteDurationToLilyToken = (typeText, dots, durationDiv, divisions) => {
    const safeDots = Math.max(0, Math.min(3, Math.round(dots)));
    const typeDurText = noteTypeToLilyDuration(typeText);
    const typeDur = Number.parseInt(typeDurText, 10);
    const safeDivisions = Math.max(1, Math.round(divisions));
    const safeDurationDiv = Number.isFinite(durationDiv) && durationDiv > 0
        ? Math.round(durationDiv)
        : noteTypeToDivisionsFallback(typeText, safeDivisions);
    if (Number.isFinite(typeDur) && typeDur > 0) {
        const expected = lilyDurationToDivisions(typeDur, safeDots, safeDivisions);
        if (expected === safeDurationDiv) {
            return `${typeDurText}${".".repeat(safeDots)}`;
        }
    }
    const quarterRatio = reduceFraction(safeDurationDiv, safeDivisions);
    if (quarterRatio.num === quarterRatio.den)
        return "4";
    if (quarterRatio.den === 1)
        return `4*${quarterRatio.num}`;
    return `4*${quarterRatio.num}/${quarterRatio.den}`;
};
const lilyDurationToMusicXmlType = (duration) => {
    const d = Number.isFinite(duration) && duration > 0 ? Math.round(duration) : 4;
    switch (d) {
        case 1:
            return "whole";
        case 2:
            return "half";
        case 4:
            return "quarter";
        case 8:
            return "eighth";
        case 16:
            return "16th";
        case 32:
            return "32nd";
        case 64:
            return "64th";
        default:
            return "quarter";
    }
};
const findBalancedBlock = (source, startBracePos) => {
    if (startBracePos < 0 || startBracePos >= source.length || source[startBracePos] !== "{")
        return null;
    let depth = 0;
    for (let i = startBracePos; i < source.length; i += 1) {
        const ch = source[i];
        if (ch === "{") {
            depth += 1;
            continue;
        }
        if (ch !== "}")
            continue;
        depth -= 1;
        if (depth === 0) {
            return {
                content: source.slice(startBracePos + 1, i),
                endPos: i + 1,
            };
        }
    }
    return null;
};
const normalizeAbcClefName = (raw) => {
    const value = String(raw || "").trim().toLowerCase();
    if (value === "bass")
        return "bass";
    if (value === "alto")
        return "alto";
    if (value === "tenor")
        return "tenor";
    if (value === "percussion")
        return "perc";
    return "treble";
};
const normalizeVoiceId = (raw, fallback) => {
    const normalized = String(raw || "").trim().replace(/[^A-Za-z0-9_.-]/g, "_");
    return normalized || fallback;
};
const lilyTranspositionTokenToHint = (token) => {
    var _a;
    const parsed = parseLilyPitchToken(token);
    if (!parsed)
        return null;
    const stepToDiatonic = {
        C: 0,
        D: 1,
        E: 2,
        F: 3,
        G: 4,
        A: 5,
        B: 6,
    };
    const up = (parsed.octaveMarks.match(/'/g) || []).length;
    const down = (parsed.octaveMarks.match(/,/g) || []).length;
    const octaveShift = up - down;
    let chromatic = lilyPitchClassToSemitone(parsed.step, parsed.alter) + octaveShift * 12;
    while (chromatic > 6)
        chromatic -= 12;
    while (chromatic < -6)
        chromatic += 12;
    let diatonic = ((_a = stepToDiatonic[parsed.step]) !== null && _a !== void 0 ? _a : 0) + octaveShift * 7;
    while (diatonic > 3)
        diatonic -= 7;
    while (diatonic < -3)
        diatonic += 7;
    return { chromatic, diatonic };
};
const parseMksTransposeHints = (source) => {
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+transpose\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const chromatic = Number.parseInt(String(params.chromatic || ""), 10);
        const diatonic = Number.parseInt(String(params.diatonic || ""), 10);
        if (!voiceId || (!Number.isFinite(chromatic) && !Number.isFinite(diatonic)))
            continue;
        const hint = {};
        if (Number.isFinite(chromatic))
            hint.chromatic = Math.round(chromatic);
        if (Number.isFinite(diatonic))
            hint.diatonic = Math.round(diatonic);
        out.set(voiceId, hint);
    }
    return out;
};
const parseMksMeasureHints = (source) => {
    var _a;
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+measure\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0)
            continue;
        const hint = {};
        const numberText = String(params.number || "").trim();
        if (numberText)
            hint.number = numberText;
        const implicitRaw = String(params.implicit || "").trim().toLowerCase();
        if (implicitRaw) {
            hint.implicit = implicitRaw === "1" || implicitRaw === "true" || implicitRaw === "yes";
        }
        const repeatRaw = String(params.repeat || "").trim().toLowerCase();
        if (repeatRaw === "forward" || repeatRaw === "backward") {
            hint.repeat = repeatRaw;
        }
        const times = Number.parseInt(String(params.times || ""), 10);
        if (Number.isFinite(times) && times > 1)
            hint.times = times;
        const beats = Number.parseInt(String(params.beats || ""), 10);
        if (Number.isFinite(beats) && beats > 0)
            hint.beats = Math.max(1, Math.round(beats));
        const beatType = Number.parseInt(String(params.beattype || ""), 10);
        if (Number.isFinite(beatType) && beatType > 0)
            hint.beatType = Math.max(1, Math.round(beatType));
        const explicitTimeRaw = String(params.explicittime || "").trim().toLowerCase();
        if (explicitTimeRaw) {
            hint.explicitTime = explicitTimeRaw === "1" || explicitTimeRaw === "true" || explicitTimeRaw === "yes";
        }
        const doubleBarRaw = String(params.doublebar || "").trim().toLowerCase();
        if (doubleBarRaw === "left" || doubleBarRaw === "right" || doubleBarRaw === "both") {
            hint.doubleBar = doubleBarRaw;
        }
        const byMeasure = (_a = out.get(voiceId)) !== null && _a !== void 0 ? _a : new Map();
        byMeasure.set(measureNo, hint);
        out.set(voiceId, byMeasure);
    }
    return out;
};
const parseMksArticulationHints = (source) => {
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+articul\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        const kindRaw = String(params.kind || "").trim().toLowerCase();
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0 || !kindRaw) {
            continue;
        }
        const normalized = kindRaw
            .split(",")
            .map((k) => k.trim().toLowerCase())
            .reduce((acc, k) => {
            if (k === "staccato")
                acc.push("staccato");
            if (k === "accent")
                acc.push("accent");
            return acc;
        }, []);
        if (!normalized.length)
            continue;
        out.set(`${voiceId}#${measureNo}#${eventNo}`, Array.from(new Set(normalized)));
    }
    return out;
};
const parseMksGraceHints = (source) => {
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+grace\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0)
            continue;
        const slashRaw = String(params.slash || "").trim().toLowerCase();
        out.set(`${voiceId}#${measureNo}#${eventNo}`, { slash: slashRaw === "1" || slashRaw === "true" || slashRaw === "yes" });
    }
    return out;
};
const parseMksTupletHints = (source) => {
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+tuplet\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0)
            continue;
        const actual = Number.parseInt(String(params.actual || ""), 10);
        const normal = Number.parseInt(String(params.normal || ""), 10);
        const number = Number.parseInt(String(params.number || ""), 10);
        const startRaw = String(params.start || "").trim().toLowerCase();
        const stopRaw = String(params.stop || "").trim().toLowerCase();
        const hint = {};
        if (Number.isFinite(actual) && actual > 0)
            hint.actual = Math.round(actual);
        if (Number.isFinite(normal) && normal > 0)
            hint.normal = Math.round(normal);
        if (Number.isFinite(number) && number > 0)
            hint.number = Math.round(number);
        if (startRaw)
            hint.start = startRaw === "1" || startRaw === "true" || startRaw === "yes";
        if (stopRaw)
            hint.stop = stopRaw === "1" || stopRaw === "true" || stopRaw === "yes";
        if (hint.actual || hint.normal || hint.number || hint.start || hint.stop) {
            out.set(`${voiceId}#${measureNo}#${eventNo}`, hint);
        }
    }
    return out;
};
const parseMksAccidentalHints = (source) => {
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+accidental\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        const value = String(params.value || "").trim().toLowerCase();
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0 || !value) {
            continue;
        }
        if (!["natural", "sharp", "flat", "double-sharp", "flat-flat"].includes(value))
            continue;
        out.set(`${voiceId}#${measureNo}#${eventNo}`, value);
    }
    return out;
};
const parseMksLaneHints = (source) => {
    var _a;
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+lanes\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const encoded = String(params.data || "").trim();
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !encoded)
            continue;
        const lanes = encoded
            .split(",")
            .map((entry) => {
            try {
                return decodeURIComponent(entry);
            }
            catch (_a) {
                return "";
            }
        })
            .map((entry) => entry.trim())
            .filter(Boolean);
        if (!lanes.length)
            continue;
        const byMeasure = (_a = out.get(voiceId)) !== null && _a !== void 0 ? _a : new Map();
        byMeasure.set(measureNo, lanes);
        out.set(voiceId, byMeasure);
    }
    return out;
};
const parseMksSlurHints = (source) => {
    var _a;
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+slur\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        const typeRaw = String(params.type || "").trim().toLowerCase();
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0)
            continue;
        if (typeRaw !== "start" && typeRaw !== "stop")
            continue;
        const numberRaw = Number.parseInt(String(params.number || ""), 10);
        const placementRaw = String(params.placement || "").trim().toLowerCase();
        const key = `${voiceId}#${measureNo}#${eventNo}`;
        const arr = (_a = out.get(key)) !== null && _a !== void 0 ? _a : [];
        arr.push({
            type: typeRaw,
            number: Number.isFinite(numberRaw) && numberRaw > 0 ? Math.round(numberRaw) : undefined,
            placement: placementRaw === "above" || placementRaw === "below" ? placementRaw : undefined,
        });
        out.set(key, arr);
    }
    return out;
};
const parseMksTrillHints = (source) => {
    var _a, _b, _c, _d;
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+trill\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const eventNo = Number.parseInt(String(params.event || ""), 10);
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0 || !Number.isFinite(eventNo) || eventNo <= 0)
            continue;
        const key = `${voiceId}#${measureNo}#${eventNo}`;
        const slot = (_a = out.get(key)) !== null && _a !== void 0 ? _a : {};
        const markRaw = String(params.mark || "").trim().toLowerCase();
        if (markRaw === "1" || markRaw === "true" || markRaw === "yes") {
            slot.trillMark = true;
        }
        const wavyType = String(params.wavy || "").trim().toLowerCase();
        if (wavyType === "start" || wavyType === "stop") {
            const number = Number.parseInt(String(params.number || ""), 10);
            const arr = (_b = slot.wavy) !== null && _b !== void 0 ? _b : [];
            arr.push({
                type: wavyType,
                number: Number.isFinite(number) && number > 0 ? Math.round(number) : undefined,
            });
            slot.wavy = arr;
        }
        if (slot.trillMark || ((_d = (_c = slot.wavy) === null || _c === void 0 ? void 0 : _c.length) !== null && _d !== void 0 ? _d : 0) > 0)
            out.set(key, slot);
    }
    return out;
};
const parseMksOctaveShiftHints = (source) => {
    var _a, _b;
    const out = new Map();
    const lines = String(source || "").split("\n");
    for (const lineRaw of lines) {
        const trimmed = lineRaw.trim().replace(/^%\s*/, "");
        const m = trimmed.match(/^%@mks\s+octshift\s+(.+)$/i);
        if (!m)
            continue;
        const params = {};
        const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
        let kv;
        while ((kv = kvRegex.exec(m[1])) !== null) {
            params[String(kv[1]).toLowerCase()] = String(kv[2]);
        }
        const voiceId = normalizeVoiceId(String(params.voice || "").trim(), "");
        const measureNo = Number.parseInt(String(params.measure || ""), 10);
        const typeRaw = String(params.type || "").trim().toLowerCase();
        if (!voiceId || !Number.isFinite(measureNo) || measureNo <= 0)
            continue;
        if (typeRaw !== "up" && typeRaw !== "down" && typeRaw !== "stop")
            continue;
        const size = Number.parseInt(String(params.size || ""), 10);
        const number = Number.parseInt(String(params.number || ""), 10);
        const hint = {
            type: typeRaw,
            size: Number.isFinite(size) && size > 0 ? Math.round(size) : undefined,
            number: Number.isFinite(number) && number > 0 ? Math.round(number) : undefined,
        };
        const byMeasure = (_a = out.get(voiceId)) !== null && _a !== void 0 ? _a : new Map();
        const arr = (_b = byMeasure.get(measureNo)) !== null && _b !== void 0 ? _b : [];
        arr.push(hint);
        byMeasure.set(measureNo, arr);
        out.set(voiceId, byMeasure);
    }
    return out;
};
const inferMusicXmlTypeFromDurationDiv = (durationDiv, divisions) => {
    const safeDivisions = Math.max(1, Math.round(divisions));
    const safeDuration = Math.max(1, Math.round(durationDiv));
    const table = [
        { type: "whole", dur: safeDivisions * 4 },
        { type: "half", dur: safeDivisions * 2 },
        { type: "quarter", dur: safeDivisions },
        { type: "eighth", dur: Math.round(safeDivisions / 2) },
        { type: "16th", dur: Math.round(safeDivisions / 4) },
        { type: "32nd", dur: Math.round(safeDivisions / 8) },
        { type: "64th", dur: Math.round(safeDivisions / 16) },
    ];
    let best = table[0];
    let bestDiff = Math.abs(safeDuration - best.dur);
    for (const row of table) {
        const diff = Math.abs(safeDuration - row.dur);
        if (diff < bestDiff) {
            best = row;
            bestDiff = diff;
        }
    }
    return best.type;
};
const applyArticulationHintsToMeasures = (measures, voiceId, articulationHintByKey, graceHintByKey, tupletHintByKey, accidentalHintByKey, slurHintByKey, trillHintByKey) => {
    var _a, _b, _c;
    const divisions = 480;
    for (let mi = 0; mi < measures.length; mi += 1) {
        let noteEventNo = 0;
        for (const event of (_a = measures[mi]) !== null && _a !== void 0 ? _a : []) {
            if (event.kind === "rest" || event.kind === "backup")
                continue;
            noteEventNo += 1;
            const key = `${voiceId}#${mi + 1}#${noteEventNo}`;
            const hints = articulationHintByKey.get(key);
            if (event.kind === "note" || event.kind === "chord") {
                if (hints === null || hints === void 0 ? void 0 : hints.length) {
                    event.articulationSubtypes = Array.from(new Set([...((_b = event.articulationSubtypes) !== null && _b !== void 0 ? _b : []), ...hints]));
                }
                const graceHint = graceHintByKey.get(key);
                if (graceHint) {
                    event.graceSlash = graceHint.slash;
                    event.durationDiv = 0;
                }
                const tupletHint = tupletHintByKey.get(key);
                if (tupletHint) {
                    if (Number.isFinite(tupletHint.actual) && tupletHint.actual > 0)
                        event.tupletActual = Math.round(tupletHint.actual);
                    if (Number.isFinite(tupletHint.normal) && tupletHint.normal > 0)
                        event.tupletNormal = Math.round(tupletHint.normal);
                    if (Number.isFinite(tupletHint.number) && tupletHint.number > 0)
                        event.tupletNumber = Math.round(tupletHint.number);
                    if (tupletHint.start === true)
                        event.tupletStart = true;
                    if (tupletHint.stop === true)
                        event.tupletStop = true;
                    if (Number.isFinite(tupletHint.actual)
                        && tupletHint.actual > 0
                        && Number.isFinite(tupletHint.normal)
                        && tupletHint.normal > 0
                        && event.durationDiv > 0) {
                        const normalizedDiv = Math.round((event.durationDiv * Math.round(tupletHint.actual)) / Math.max(1, Math.round(tupletHint.normal)));
                        event.type = inferMusicXmlTypeFromDurationDiv(normalizedDiv, divisions);
                    }
                }
                const accidentalText = accidentalHintByKey.get(key);
                if (accidentalText)
                    event.accidentalText = accidentalText;
                const slurHints = slurHintByKey.get(key);
                if (slurHints === null || slurHints === void 0 ? void 0 : slurHints.length)
                    event.slurHints = slurHints.slice();
                const trillHints = trillHintByKey.get(key);
                if (trillHints) {
                    if (trillHints.trillMark)
                        event.trillMark = true;
                    if ((_c = trillHints.wavy) === null || _c === void 0 ? void 0 : _c.length)
                        event.wavyLineHints = trillHints.wavy.slice();
                }
            }
        }
    }
    return measures;
};
const extractAllStaffBlocks = (source) => {
    var _a, _b, _c;
    const out = [];
    const regex = /\\new\s+Staff/g;
    for (;;) {
        const m = regex.exec(source);
        if (!m)
            break;
        let cursor = m.index + m[0].length;
        while (cursor < source.length && /\s/.test(source[cursor]))
            cursor += 1;
        let voiceId = "";
        if (source[cursor] === "=") {
            cursor += 1;
            while (cursor < source.length && /\s/.test(source[cursor]))
                cursor += 1;
            if (source[cursor] === "\"") {
                const endQuote = source.indexOf("\"", cursor + 1);
                if (endQuote > cursor) {
                    voiceId = source.slice(cursor + 1, endQuote).trim();
                    cursor = endQuote + 1;
                }
            }
            while (cursor < source.length && /\s/.test(source[cursor]))
                cursor += 1;
        }
        if (source.startsWith("\\with", cursor)) {
            cursor += "\\with".length;
            while (cursor < source.length && /\s/.test(source[cursor]))
                cursor += 1;
            if (source[cursor] === "{") {
                const withBlock = findBalancedBlock(source, cursor);
                if (withBlock) {
                    const withInstrumentNameMatch = withBlock.content.match(/(?:^|[\s;])instrumentName\s*=\s*"([^"]*)"/i);
                    const withPartName = ((_a = withInstrumentNameMatch === null || withInstrumentNameMatch === void 0 ? void 0 : withInstrumentNameMatch[1]) !== null && _a !== void 0 ? _a : "").trim();
                    const withTranspositionMatch = withBlock.content.match(/\\transposition\s+([a-g](?:isis|eses|is|es)?[,']*)/i);
                    const withTranspose = withTranspositionMatch
                        ? lilyTranspositionTokenToHint(withTranspositionMatch[1])
                        : null;
                    cursor = withBlock.endPos;
                    while (cursor < source.length && /\s/.test(source[cursor]))
                        cursor += 1;
                    const blockStart = source.indexOf("{", cursor);
                    if (blockStart < 0)
                        continue;
                    const block = findBalancedBlock(source, blockStart);
                    if (!block)
                        continue;
                    const clefMatch = block.content.match(/\\clef\s+([A-Za-z]+)/);
                    const clef = normalizeAbcClefName((clefMatch === null || clefMatch === void 0 ? void 0 : clefMatch[1]) || "treble");
                    const bodyInstrumentNameMatch = block.content.match(/\\set\s+Staff\.instrumentName\s*=\s*"([^"]*)"/i);
                    const bodyPartName = ((_b = bodyInstrumentNameMatch === null || bodyInstrumentNameMatch === void 0 ? void 0 : bodyInstrumentNameMatch[1]) !== null && _b !== void 0 ? _b : "").trim();
                    const bodyTranspositionMatch = block.content.match(/\\transposition\s+([a-g](?:isis|eses|is|es)?[,']*)/i);
                    const bodyTranspose = bodyTranspositionMatch
                        ? lilyTranspositionTokenToHint(bodyTranspositionMatch[1])
                        : null;
                    out.push({
                        voiceId: normalizeVoiceId(voiceId, `P${out.length + 1}`),
                        partName: withPartName || bodyPartName || normalizeVoiceId(voiceId, `P${out.length + 1}`),
                        body: block.content,
                        clef,
                        transpose: withTranspose || bodyTranspose,
                    });
                    regex.lastIndex = block.endPos;
                    continue;
                }
            }
        }
        const blockStart = source.indexOf("{", cursor);
        if (blockStart < 0)
            continue;
        const block = findBalancedBlock(source, blockStart);
        if (!block)
            continue;
        const clefMatch = block.content.match(/\\clef\s+([A-Za-z]+)/);
        const clef = normalizeAbcClefName((clefMatch === null || clefMatch === void 0 ? void 0 : clefMatch[1]) || "treble");
        const bodyInstrumentNameMatch = block.content.match(/\\set\s+Staff\.instrumentName\s*=\s*"([^"]*)"/i);
        const bodyPartName = ((_c = bodyInstrumentNameMatch === null || bodyInstrumentNameMatch === void 0 ? void 0 : bodyInstrumentNameMatch[1]) !== null && _c !== void 0 ? _c : "").trim();
        const bodyTranspositionMatch = block.content.match(/\\transposition\s+([a-g](?:isis|eses|is|es)?[,']*)/i);
        const bodyTranspose = bodyTranspositionMatch
            ? lilyTranspositionTokenToHint(bodyTranspositionMatch[1])
            : null;
        const normalizedVoiceId = normalizeVoiceId(voiceId, `P${out.length + 1}`);
        out.push({
            voiceId: normalizedVoiceId,
            partName: bodyPartName || normalizedVoiceId,
            body: block.content,
            clef,
            transpose: bodyTranspose,
        });
        regex.lastIndex = block.endPos;
    }
    return out;
};
const extractStandaloneMusicBlocks = (source) => {
    const out = [];
    for (let i = 0; i < source.length; i += 1) {
        if (source[i] !== "{")
            continue;
        const block = findBalancedBlock(source, i);
        if (!block)
            continue;
        const lookbehind = source.slice(Math.max(0, i - 24), i);
        if (/\\(header|paper|layout|midi|with|bookpart|book|score)\s*$/i.test(lookbehind)) {
            i = block.endPos - 1;
            continue;
        }
        const relativePrefix = source.slice(Math.max(0, i - 64), i);
        const relativeMatch = relativePrefix.match(/\\relative(?:\s+[a-g](?:isis|eses|is|es)?[,']*)?\s*$/i);
        if (relativeMatch && relativeMatch.index !== undefined) {
            const relativeStart = Math.max(0, i - 64) + relativeMatch.index;
            out.push(source.slice(relativeStart, block.endPos));
            i = block.endPos - 1;
            continue;
        }
        out.push(block.content);
        i = block.endPos - 1;
    }
    return out;
};
const parseLilyVariableBlocks = (source) => {
    const out = new Map();
    const assignRegex = /(^|\n)\s*([A-Za-z][A-Za-z0-9_]*)\s*=\s*/g;
    let m;
    while ((m = assignRegex.exec(source)) !== null) {
        const name = String(m[2] || "").trim();
        if (!name)
            continue;
        let cursor = assignRegex.lastIndex;
        while (cursor < source.length && /\s/.test(source[cursor]))
            cursor += 1;
        if (cursor >= source.length)
            continue;
        if (source.startsWith("\\relative", cursor)) {
            const bracePos = source.indexOf("{", cursor + "\\relative".length);
            if (bracePos < 0)
                continue;
            const block = findBalancedBlock(source, bracePos);
            if (!block)
                continue;
            out.set(name, source.slice(cursor, block.endPos));
            assignRegex.lastIndex = block.endPos;
            continue;
        }
        if (source[cursor] === "{") {
            const block = findBalancedBlock(source, cursor);
            if (!block)
                continue;
            out.set(name, source.slice(cursor, block.endPos));
            assignRegex.lastIndex = block.endPos;
        }
    }
    return out;
};
const expandLilyVariablesInBody = (body, variableMap) => {
    if (!variableMap.size)
        return body;
    let expanded = String(body || "");
    const maxPasses = 8;
    for (let pass = 0; pass < maxPasses; pass += 1) {
        let replacedAny = false;
        expanded = expanded.replace(/\\([A-Za-z][A-Za-z0-9_]*)\b/g, (full, nameRaw) => {
            const name = String(nameRaw || "").trim();
            const replacement = variableMap.get(name);
            if (!replacement)
                return full;
            replacedAny = true;
            return ` ${replacement} `;
        });
        if (!replacedAny)
            break;
    }
    return expanded;
};
const extractLilyBlocksByCommand = (source, command) => {
    const out = [];
    const rx = new RegExp(`\\\\${command}\\b`, "g");
    for (;;) {
        const m = rx.exec(source);
        if (!m)
            break;
        let cursor = m.index + m[0].length;
        while (cursor < source.length && /\s/.test(source[cursor]))
            cursor += 1;
        const bracePos = source.indexOf("{", cursor);
        if (bracePos < 0)
            continue;
        const block = findBalancedBlock(source, bracePos);
        if (!block)
            continue;
        out.push(block.content);
        rx.lastIndex = block.endPos;
    }
    return out;
};
const parseLyricSyllablesFromText = (text) => {
    const clean = stripLilyComments(String(text || ""))
        .replace(/\\[A-Za-z]+/g, " ")
        .replace(/[{}]/g, " ");
    const rawTokens = clean.split(/\s+/).map((t) => t.trim()).filter(Boolean);
    const out = [];
    for (const token of rawTokens) {
        if (token === "--" || token === "__" || token === "_" || token === "~")
            continue;
        out.push(token.replace(/^"|"$/g, ""));
    }
    return out;
};
const parseLilyLyricAssignments = (source) => {
    const out = [];
    const addLyricsBlocks = extractLilyBlocksByCommand(source, "addlyrics");
    if (addLyricsBlocks.length > 0) {
        out.push({
            targetVoiceId: null,
            syllables: parseLyricSyllablesFromText(addLyricsBlocks[0]),
        });
    }
    const lyricstoRegex = /\\lyricsto\s+"([^"]+)"\s*\{/g;
    let m;
    while ((m = lyricstoRegex.exec(source)) !== null) {
        const rawTarget = String(m[1] || "").trim();
        const targetVoiceId = normalizeVoiceId(rawTarget, "");
        const bracePos = source.indexOf("{", m.index + m[0].length - 1);
        if (bracePos < 0)
            continue;
        const block = findBalancedBlock(source, bracePos);
        if (!block)
            continue;
        out.push({
            targetVoiceId: targetVoiceId || null,
            syllables: parseLyricSyllablesFromText(block.content),
        });
        lyricstoRegex.lastIndex = block.endPos;
    }
    if (out.length === 0) {
        const lyricModeBlocks = extractLilyBlocksByCommand(source, "lyricmode");
        if (lyricModeBlocks.length > 0) {
            out.push({
                targetVoiceId: null,
                syllables: parseLyricSyllablesFromText(lyricModeBlocks[0]),
            });
        }
    }
    return out;
};
const applyLyricsToMeasures = (measures, syllables) => {
    var _a;
    if (!syllables.length)
        return measures;
    let cursor = 0;
    for (let mi = 0; mi < measures.length; mi += 1) {
        for (const event of (_a = measures[mi]) !== null && _a !== void 0 ? _a : []) {
            if (event.kind !== "note" && event.kind !== "chord")
                continue;
            if (event.durationDiv <= 0)
                continue;
            if (cursor >= syllables.length)
                return measures;
            event.lyricText = syllables[cursor];
            cursor += 1;
        }
    }
    return measures;
};
const lilyPitchClassToSemitone = (step, alter) => {
    var _a;
    const baseByStep = {
        C: 0,
        D: 2,
        E: 4,
        F: 5,
        G: 7,
        A: 9,
        B: 11,
    };
    const safeStep = String(step || "").toUpperCase();
    const base = (_a = baseByStep[safeStep]) !== null && _a !== void 0 ? _a : 0;
    const alt = Number.isFinite(alter) ? Math.round(alter) : 0;
    return base + alt;
};
const parseLilyPitchToken = (token) => {
    const m = String(token || "").match(/^([a-g])(isis|eses|is|es)?([,']*)$/i);
    if (!m)
        return null;
    const step = m[1].toUpperCase();
    const accidentalText = (m[2] || "").toLowerCase();
    let alter = 0;
    if (accidentalText === "is")
        alter = 1;
    if (accidentalText === "isis")
        alter = 2;
    if (accidentalText === "es")
        alter = -1;
    if (accidentalText === "eses")
        alter = -2;
    return { step, alter, octaveMarks: m[3] || "" };
};
const parseLilyAbsolutePitch = (token) => {
    const parsed = parseLilyPitchToken(token);
    if (!parsed)
        return null;
    const up = (parsed.octaveMarks.match(/'/g) || []).length;
    const down = (parsed.octaveMarks.match(/,/g) || []).length;
    return {
        step: parsed.step,
        alter: parsed.alter,
        octave: 3 + up - down,
    };
};
const parseRelativeRoot = (token) => {
    const parsed = parseLilyPitchToken(token);
    if (!parsed)
        return null;
    let octave = 3;
    if (parsed.octaveMarks) {
        const up = (parsed.octaveMarks.match(/'/g) || []).length;
        const down = (parsed.octaveMarks.match(/,/g) || []).length;
        octave = 3 + up - down;
    }
    return {
        step: parsed.step,
        alter: parsed.alter,
        octave,
    };
};
const lilyStepToIndex = (step) => {
    const safe = String(step || "").toUpperCase();
    if (safe === "C")
        return 0;
    if (safe === "D")
        return 1;
    if (safe === "E")
        return 2;
    if (safe === "F")
        return 3;
    if (safe === "G")
        return 4;
    if (safe === "A")
        return 5;
    if (safe === "B")
        return 6;
    return 0;
};
const resolveRelativePitch = (step, alter, previousAnchor) => {
    if (!previousAnchor) {
        // LilyPond's omitted \relative root behaves like starting from c' anchor.
        // Our octave scale uses C3 as base "c", so fallback should be octave 3.
        const fallbackOctave = 3;
        return {
            step,
            octave: fallbackOctave,
            midi: fallbackOctave * 12 + lilyPitchClassToSemitone(step, alter),
        };
    }
    const prevIndex = previousAnchor.octave * 7 + lilyStepToIndex(previousAnchor.step);
    const targetStepIndex = lilyStepToIndex(step);
    let bestOctave = 4;
    let bestIndex = bestOctave * 7 + targetStepIndex;
    let bestMidi = 4 * 12 + lilyPitchClassToSemitone(step, alter);
    let bestDist = Number.POSITIVE_INFINITY;
    for (let octave = 0; octave <= 9; octave += 1) {
        const index = octave * 7 + targetStepIndex;
        const dist = Math.abs(index - prevIndex);
        const midi = octave * 12 + lilyPitchClassToSemitone(step, alter);
        if (dist < bestDist) {
            bestDist = dist;
            bestOctave = octave;
            bestIndex = index;
            bestMidi = midi;
            continue;
        }
        if (dist === bestDist && index > bestIndex) {
            bestOctave = octave;
            bestIndex = index;
            bestMidi = midi;
        }
    }
    return { step, octave: bestOctave, midi: bestMidi };
};
const applyLilyOctaveMarks = (resolved, octaveMarks, step, alter) => {
    if (!octaveMarks)
        return resolved;
    const up = (octaveMarks.match(/'/g) || []).length;
    const down = (octaveMarks.match(/,/g) || []).length;
    const octave = resolved.octave + up - down;
    return {
        step,
        octave,
        midi: octave * 12 + lilyPitchClassToSemitone(step, alter),
    };
};
const unwrapRelativeBlock = (sourceBody) => {
    const relativeMatch = sourceBody.match(/\\relative(?:\s+([a-g](?:isis|eses|is|es)?[,']*))?\s*\{/i);
    if (!relativeMatch || relativeMatch.index === undefined) {
        return { body: sourceBody, relativeMode: false, relativeRoot: null };
    }
    const bracePos = sourceBody.indexOf("{", relativeMatch.index + relativeMatch[0].length - 1);
    if (bracePos < 0)
        return { body: sourceBody, relativeMode: false, relativeRoot: null };
    const block = findBalancedBlock(sourceBody, bracePos);
    if (!block)
        return { body: sourceBody, relativeMode: false, relativeRoot: null };
    const rootToken = String(relativeMatch[1] || "").trim();
    const relativeRoot = rootToken ? parseRelativeRoot(rootToken) : null;
    return {
        body: block.content,
        relativeMode: true,
        relativeRoot,
    };
};
const hasOmittedRelativeRoot = (sourceBody) => {
    const m = String(sourceBody || "").match(/\\relative(?:\s+([a-g](?:isis|eses|is|es)?[,']*))?\s*\{/i);
    if (!m)
        return false;
    return !String(m[1] || "").trim();
};
const parseLilyDirectBody = (body, warnings, contextLabel, beats, beatType, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    const SMALL_OVERFLOW_TOLERANCE_DIV = 8;
    const relative = unwrapRelativeBlock(body);
    let previousAnchor = relative.relativeRoot
        ? {
            step: relative.relativeRoot.step,
            octave: relative.relativeRoot.octave,
            midi: relative.relativeRoot.octave * 12 + lilyPitchClassToSemitone(relative.relativeRoot.step, relative.relativeRoot.alter),
        }
        : null;
    const preprocessed = expandLilyTupletMarkers(expandLilyAlternativeMarkers(expandLilyRepeatVoltaMarkers(relative.body)));
    const clean = stripLilyComments(preprocessed)
        .replace(/\\key\s+[a-g](?:isis|eses|is|es)?[,']*\s+\\[A-Za-z]+/gi, " ")
        .replace(/\\time\s+\d+\s*\/\s*\d+/g, " ")
        .replace(/\\clef\s+"[^"]+"/g, " ")
        .replace(/\\clef\s+[A-Za-z]+/g, " ")
        .replace(/\\bar\s+\"[^\"]*\"/g, "|")
        .replace(/\"[^\"]*\"/g, " ")
        .replace(/\\bar/g, " ")
        .replace(/[{}]/g, " ");
    const tokens = clean.match(/@@MKS_(?:RPT_(?:FWD|BWD_\d+)|ENDING_(?:START|STOP)_\d+|TUPLET_START_\d+_\d+|TUPLET_STOP)@@|\\(?:ppp|pp|p|mp|mf|ff|fff|f|sfz|<|>|!|\(|\)|trill|startTrillSpan|stopTrillSpan|glissando|sustainOn|sustainOff|sostenutoOn|sostenutoOff|unaCorda|treCorde|upbow|downbow|snappizzicato|flageolet|harmonic)|(?<![A-Za-z\\])<[^>]+>(?:\d+(?:\*\d+(?:\/\d+)?)?)?\.{0,3}~?(?![A-Za-z])|(?<![A-Za-z\\])[a-grs](?:isis|eses|is|es)?[,']*(?:\d+(?:\*\d+(?:\/\d+)?)?)?\.{0,3}~?(?![A-Za-z])|(?<![A-Za-z\\])(?:\d+(?:\*\d+(?:\/\d+)?)?)\.{0,3}~?(?![A-Za-z])|[()]|\|/g) || [];
    const measures = [[]];
    let currentDurationExpr = "4";
    let currentDots = 0;
    const divisions = 480;
    const safeBeats = Number.isFinite(beats) && beats > 0 ? Math.round(beats) : 4;
    const safeBeatType = Number.isFinite(beatType) && beatType > 0 ? Math.round(beatType) : 4;
    const measureCapacity = Math.max(1, Math.round((divisions * 4 * safeBeats) / safeBeatType));
    const voiceId = options.voiceId ? normalizeVoiceId(options.voiceId, "") : "";
    const graceHintByKey = (_a = options.graceHintByKey) !== null && _a !== void 0 ? _a : new Map();
    let noteEventNoInMeasure = 0;
    let pendingTieStop = false;
    let pendingSlurStart = 0;
    let pendingArticulations = [];
    let pendingTechnicals = [];
    let pendingTrillMark = false;
    let pendingWavyHints = [];
    let pendingGlissStop = false;
    let activeTuplet = null;
    let previousPitched = null;
    const appendSlurStopToLastPitchedEvent = () => {
        var _a;
        for (let mi = measures.length - 1; mi >= 0; mi -= 1) {
            const events = measures[mi] || [];
            for (let ei = events.length - 1; ei >= 0; ei -= 1) {
                const event = events[ei];
                if (event.kind !== "note" && event.kind !== "chord")
                    continue;
                const hints = (_a = event.slurHints) !== null && _a !== void 0 ? _a : [];
                hints.push({ type: "stop" });
                event.slurHints = hints;
                return;
            }
        }
    };
    const appendToLastPitchedEvent = (updater) => {
        for (let mi = measures.length - 1; mi >= 0; mi -= 1) {
            const events = measures[mi] || [];
            for (let ei = events.length - 1; ei >= 0; ei -= 1) {
                const event = events[ei];
                if (event.kind !== "note" && event.kind !== "chord")
                    continue;
                updater(event);
                return true;
            }
        }
        return false;
    };
    const appendTupletStopToLastPitchedEvent = () => {
        for (let mi = measures.length - 1; mi >= 0; mi -= 1) {
            const events = measures[mi] || [];
            for (let ei = events.length - 1; ei >= 0; ei -= 1) {
                const event = events[ei];
                if (event.kind !== "note" && event.kind !== "chord")
                    continue;
                event.tupletStop = true;
                return;
            }
        }
    };
    const applyPendingOrnaments = (event) => {
        var _a, _b, _c;
        if (pendingArticulations.length > 0) {
            event.articulationSubtypes = [...((_a = event.articulationSubtypes) !== null && _a !== void 0 ? _a : []), ...pendingArticulations];
            pendingArticulations = [];
        }
        if (pendingTechnicals.length > 0) {
            event.technicalSubtypes = [...((_b = event.technicalSubtypes) !== null && _b !== void 0 ? _b : []), ...pendingTechnicals];
            pendingTechnicals = [];
        }
        if (pendingTrillMark) {
            event.trillMark = true;
            pendingTrillMark = false;
        }
        if (pendingWavyHints.length > 0) {
            event.wavyLineHints = [...((_c = event.wavyLineHints) !== null && _c !== void 0 ? _c : []), ...pendingWavyHints];
            pendingWavyHints = [];
        }
    };
    const pushEvent = (event) => {
        const current = measures[measures.length - 1];
        const used = current.reduce((sum, item) => sum + item.durationDiv, 0);
        if (used + event.durationDiv > measureCapacity) {
            const overflow = used + event.durationDiv - measureCapacity;
            if (overflow <= SMALL_OVERFLOW_TOLERANCE_DIV) {
                warnings.push(`${contextLabel}: accepted slight overfill due to duration rounding.`);
                current.push(event);
                return;
            }
            if (event.durationDiv > measureCapacity) {
                warnings.push(`${contextLabel}: overfull measure; dropped oversized event.`);
                return;
            }
            warnings.push(`${contextLabel}: overfull measure; carried event to next measure.`);
            measures.push([event]);
            return;
        }
        current.push(event);
    };
    for (const token of tokens) {
        if (token === "|") {
            measures.push([]);
            noteEventNoInMeasure = 0;
            continue;
        }
        if (token === "@@MKS_RPT_FWD@@") {
            pushEvent({
                kind: "direction",
                durationDiv: 0,
                xml: `<barline location="left"><repeat direction="forward"/></barline>`,
            });
            continue;
        }
        if (token.startsWith("@@MKS_RPT_BWD_")) {
            const timesText = token.replace(/^@@MKS_RPT_BWD_(\d+)@@$/, "$1");
            const times = Number.parseInt(timesText, 10);
            const endingXml = Number.isFinite(times) && times > 1
                ? `<ending number="${Math.round(times)}" type="stop"/>`
                : "";
            pushEvent({
                kind: "direction",
                durationDiv: 0,
                xml: `<barline location="right"><repeat direction="backward"/>${endingXml}</barline>`,
            });
            continue;
        }
        if (token.startsWith("@@MKS_ENDING_START_")) {
            const nText = token.replace(/^@@MKS_ENDING_START_(\d+)@@$/, "$1");
            const n = Number.parseInt(nText, 10);
            const numberAttr = Number.isFinite(n) && n > 0 ? Math.round(n) : 1;
            pushEvent({
                kind: "direction",
                durationDiv: 0,
                xml: `<barline location="left"><ending number="${numberAttr}" type="start"/></barline>`,
            });
            continue;
        }
        if (token.startsWith("@@MKS_ENDING_STOP_")) {
            const nText = token.replace(/^@@MKS_ENDING_STOP_(\d+)@@$/, "$1");
            const n = Number.parseInt(nText, 10);
            const numberAttr = Number.isFinite(n) && n > 0 ? Math.round(n) : 1;
            pushEvent({
                kind: "direction",
                durationDiv: 0,
                xml: `<barline location="right"><ending number="${numberAttr}" type="stop"/></barline>`,
            });
            continue;
        }
        if (token.startsWith("@@MKS_TUPLET_START_")) {
            const m = token.match(/^@@MKS_TUPLET_START_(\d+)_(\d+)@@$/);
            const actual = Number.parseInt((m === null || m === void 0 ? void 0 : m[1]) || "", 10);
            const normal = Number.parseInt((m === null || m === void 0 ? void 0 : m[2]) || "", 10);
            activeTuplet = {
                actual: Number.isFinite(actual) && actual > 0 ? Math.round(actual) : 3,
                normal: Number.isFinite(normal) && normal > 0 ? Math.round(normal) : 2,
                needsStart: true,
            };
            continue;
        }
        if (token === "@@MKS_TUPLET_STOP@@") {
            if (activeTuplet)
                appendTupletStopToLastPitchedEvent();
            activeTuplet = null;
            continue;
        }
        if (token === "(") {
            pendingSlurStart += 1;
            continue;
        }
        if (token === ")") {
            appendSlurStopToLastPitchedEvent();
            continue;
        }
        if (token.startsWith("\\")) {
            const dyn = token.slice(1).toLowerCase();
            const dynamicKinds = new Set(["ppp", "pp", "p", "mp", "mf", "f", "ff", "fff", "sfz"]);
            if (dynamicKinds.has(dyn)) {
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><dynamics><${dyn}/></dynamics></direction-type></direction>`,
                });
                continue;
            }
            if (dyn === "<" || dyn === ">" || dyn === "!") {
                const wedgeType = dyn === "<" ? "crescendo" : dyn === ">" ? "diminuendo" : "stop";
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><wedge type="${wedgeType}"/></direction-type></direction>`,
                });
                continue;
            }
            if (dyn === "(") {
                pendingSlurStart += 1;
                continue;
            }
            if (dyn === ")") {
                appendSlurStopToLastPitchedEvent();
                continue;
            }
            if (dyn === "trill") {
                if (!appendToLastPitchedEvent((event) => {
                    event.trillMark = true;
                })) {
                    pendingTrillMark = true;
                }
                continue;
            }
            if (dyn === "starttrillspan") {
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    const hints = (_a = event.wavyLineHints) !== null && _a !== void 0 ? _a : [];
                    hints.push({ type: "start" });
                    event.wavyLineHints = hints;
                })) {
                    pendingWavyHints.push({ type: "start" });
                }
                continue;
            }
            if (dyn === "stoptrillspan") {
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    const hints = (_a = event.wavyLineHints) !== null && _a !== void 0 ? _a : [];
                    hints.push({ type: "stop" });
                    event.wavyLineHints = hints;
                })) {
                    pendingWavyHints.push({ type: "stop" });
                }
                continue;
            }
            if (dyn === "glissando") {
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    const hints = (_a = event.glissHints) !== null && _a !== void 0 ? _a : [];
                    hints.push({ type: "start" });
                    event.glissHints = hints;
                })) {
                    // If no previous pitched note exists, start marker is not placeable.
                }
                pendingGlissStop = true;
                continue;
            }
            if (dyn === "upbow" || dyn === "downbow") {
                const articulation = dyn === "upbow" ? "up-bow" : "down-bow";
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    event.articulationSubtypes = [...((_a = event.articulationSubtypes) !== null && _a !== void 0 ? _a : []), articulation];
                })) {
                    pendingArticulations.push(articulation);
                }
                continue;
            }
            if (dyn === "snappizzicato") {
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    event.articulationSubtypes = [...((_a = event.articulationSubtypes) !== null && _a !== void 0 ? _a : []), "snap-pizzicato"];
                })) {
                    pendingArticulations.push("snap-pizzicato");
                }
                continue;
            }
            if (dyn === "flageolet" || dyn === "harmonic") {
                if (!appendToLastPitchedEvent((event) => {
                    var _a;
                    event.technicalSubtypes = [...((_a = event.technicalSubtypes) !== null && _a !== void 0 ? _a : []), "harmonic"];
                })) {
                    pendingTechnicals.push("harmonic");
                }
                continue;
            }
            if (dyn === "sustainon" || dyn === "sustainoff") {
                const type = dyn === "sustainon" ? "start" : "stop";
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><pedal type="${type}" number="1" line="yes"/></direction-type></direction>`,
                });
                continue;
            }
            if (dyn === "sostenutoon" || dyn === "sostenutooff") {
                if (dyn === "sostenutoon") {
                    pushEvent({
                        kind: "direction",
                        durationDiv: 0,
                        xml: `<direction><direction-type><words>Sost. Ped.</words></direction-type></direction>`,
                    });
                }
                const type = dyn === "sostenutoon" ? "start" : "stop";
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><pedal type="${type}" number="2" line="yes"/></direction-type></direction>`,
                });
                continue;
            }
            if (dyn === "unacorda" || dyn === "trecorde") {
                const words = dyn === "unacorda" ? "una corda" : "tre corde";
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><words>${words}</words></direction-type></direction>`,
                });
                const type = dyn === "unacorda" ? "start" : "stop";
                pushEvent({
                    kind: "direction",
                    durationDiv: 0,
                    xml: `<direction><direction-type><pedal type="${type}" number="3" line="yes"/></direction-type></direction>`,
                });
                continue;
            }
            continue;
        }
        const durationOnlyMatch = token.match(/^((?:\d+(?:\*\d+(?:\/\d+)?)?))(\.*)(~?)$/);
        if (durationOnlyMatch && previousPitched) {
            currentDurationExpr = durationOnlyMatch[1];
            currentDots = ((_b = durationOnlyMatch[2]) === null || _b === void 0 ? void 0 : _b.length) || 0;
            const parsedDuration = parseLilyDurationExpr(currentDurationExpr).base;
            const durationDiv = lilyDurationExprToDivisions(currentDurationExpr, currentDots, divisions);
            const type = lilyDurationToMusicXmlType(parsedDuration);
            if (previousPitched.kind === "note") {
                const event = {
                    kind: "note",
                    durationDiv,
                    type,
                    dots: currentDots,
                    pitch: previousPitched.pitch,
                    tieStop: pendingTieStop || undefined,
                    tieStart: durationOnlyMatch[3] === "~" ? true : undefined,
                };
                if (activeTuplet) {
                    event.tupletActual = activeTuplet.actual;
                    event.tupletNormal = activeTuplet.normal;
                    if (activeTuplet.needsStart) {
                        event.tupletStart = true;
                        activeTuplet.needsStart = false;
                    }
                }
                applyPendingOrnaments(event);
                if (pendingGlissStop) {
                    event.glissHints = [...((_c = event.glissHints) !== null && _c !== void 0 ? _c : []), { type: "stop" }];
                    pendingGlissStop = false;
                }
                if (pendingSlurStart > 0) {
                    event.slurHints = Array.from({ length: pendingSlurStart }, () => ({ type: "start" }));
                    pendingSlurStart = 0;
                }
                pendingTieStop = durationOnlyMatch[3] === "~";
                noteEventNoInMeasure += 1;
                pushEvent(event);
                previousPitched = { kind: "note", pitch: event.pitch };
            }
            else {
                const copiedPitches = previousPitched.pitches.map((pitch) => ({ ...pitch }));
                const event = {
                    kind: "chord",
                    durationDiv,
                    type,
                    dots: currentDots,
                    pitches: copiedPitches,
                    tieStop: pendingTieStop || undefined,
                    tieStart: durationOnlyMatch[3] === "~" ? true : undefined,
                };
                if (activeTuplet) {
                    event.tupletActual = activeTuplet.actual;
                    event.tupletNormal = activeTuplet.normal;
                    if (activeTuplet.needsStart) {
                        event.tupletStart = true;
                        activeTuplet.needsStart = false;
                    }
                }
                applyPendingOrnaments(event);
                if (pendingGlissStop) {
                    event.glissHints = [...((_d = event.glissHints) !== null && _d !== void 0 ? _d : []), { type: "stop" }];
                    pendingGlissStop = false;
                }
                if (pendingSlurStart > 0) {
                    event.slurHints = Array.from({ length: pendingSlurStart }, () => ({ type: "start" }));
                    pendingSlurStart = 0;
                }
                pendingTieStop = durationOnlyMatch[3] === "~";
                noteEventNoInMeasure += 1;
                pushEvent(event);
                previousPitched = { kind: "chord", pitches: copiedPitches };
            }
            continue;
        }
        const chordExprMatch = token.match(/^<([^>]+)>((?:\d+(?:\*\d+(?:\/\d+)?)?)?)(\.*)(~?)$/);
        if (chordExprMatch) {
            const durExprText = chordExprMatch[2] || "";
            const dots = ((_e = chordExprMatch[3]) === null || _e === void 0 ? void 0 : _e.length) || 0;
            if (durExprText) {
                currentDurationExpr = durExprText;
                currentDots = dots;
            }
            const effectiveExpr = durExprText || currentDurationExpr;
            const effectiveDots = durExprText ? dots : currentDots;
            const pitches = chordExprMatch[1]
                .split(/\s+/)
                .map((entry) => {
                const parsed = parseLilyPitchToken(entry);
                if (!parsed)
                    return null;
                if (relative.relativeMode) {
                    const resolvedFromAnchor = resolveRelativePitch(parsed.step, parsed.alter, previousAnchor);
                    const resolved = applyLilyOctaveMarks(resolvedFromAnchor, parsed.octaveMarks, parsed.step, parsed.alter);
                    previousAnchor = resolved;
                    return { step: parsed.step, alter: parsed.alter, octave: resolved.octave };
                }
                return parseLilyAbsolutePitch(entry);
            })
                .filter((entry) => Boolean(entry));
            if (!pitches.length) {
                warnings.push(`${contextLabel}: chord had no parseable pitches; skipped.`);
                continue;
            }
            if (relative.relativeMode) {
                // LilyPond relative anchoring after a chord follows the first chord tone.
                const firstPitch = pitches[0];
                previousAnchor = {
                    step: firstPitch.step,
                    octave: firstPitch.octave,
                    midi: firstPitch.octave * 12 + lilyPitchClassToSemitone(firstPitch.step, firstPitch.alter),
                };
            }
            const event = {
                kind: "chord",
                durationDiv: lilyDurationExprToDivisions(effectiveExpr, effectiveDots, divisions),
                type: lilyDurationToMusicXmlType(parseLilyDurationExpr(effectiveExpr).base),
                dots: effectiveDots,
                pitches,
                tieStop: pendingTieStop || undefined,
                tieStart: chordExprMatch[4] === "~" ? true : undefined,
            };
            if (activeTuplet) {
                event.tupletActual = activeTuplet.actual;
                event.tupletNormal = activeTuplet.normal;
                if (activeTuplet.needsStart) {
                    event.tupletStart = true;
                    activeTuplet.needsStart = false;
                }
            }
            applyPendingOrnaments(event);
            if (pendingGlissStop) {
                event.glissHints = [...((_f = event.glissHints) !== null && _f !== void 0 ? _f : []), { type: "stop" }];
                pendingGlissStop = false;
            }
            if (pendingSlurStart > 0) {
                event.slurHints = Array.from({ length: pendingSlurStart }, () => ({ type: "start" }));
                pendingSlurStart = 0;
            }
            pendingTieStop = chordExprMatch[4] === "~";
            noteEventNoInMeasure += 1;
            if (voiceId && graceHintByKey.size > 0) {
                const graceHint = graceHintByKey.get(`${voiceId}#${measures.length}#${noteEventNoInMeasure}`);
                if (graceHint) {
                    event.graceSlash = graceHint.slash;
                    event.durationDiv = 0;
                }
            }
            pushEvent(event);
            previousPitched = { kind: "chord", pitches: event.pitches.map((pitch) => ({ ...pitch })) };
            continue;
        }
        const m = token.match(/^([a-grs])(isis|eses|is|es)?([,']*)((?:\d+(?:\*\d+(?:\/\d+)?)?)?)(\.*)(~?)$/);
        if (!m)
            continue;
        const durExprText = m[4] || "";
        const dots = ((_g = m[5]) === null || _g === void 0 ? void 0 : _g.length) || 0;
        if (durExprText) {
            currentDurationExpr = durExprText;
            currentDots = dots;
        }
        const effectiveExpr = durExprText || currentDurationExpr;
        const effectiveDots = durExprText ? dots : currentDots;
        const parsedDuration = parseLilyDurationExpr(effectiveExpr).base;
        const durationDiv = lilyDurationExprToDivisions(effectiveExpr, effectiveDots, divisions);
        const type = lilyDurationToMusicXmlType(parsedDuration);
        if (m[1] === "r" || m[1] === "s") {
            pendingTieStop = false;
            pushEvent({ kind: "rest", durationDiv, type, dots: effectiveDots });
            continue;
        }
        const pitch = parseLilyAbsolutePitch(`${m[1]}${m[2] || ""}${m[3] || ""}`);
        const pitchResolved = relative.relativeMode
            ? (() => {
                const parsed = parseLilyPitchToken(`${m[1]}${m[2] || ""}${m[3] || ""}`);
                if (!parsed)
                    return null;
                const resolvedFromAnchor = resolveRelativePitch(parsed.step, parsed.alter, previousAnchor);
                const resolved = applyLilyOctaveMarks(resolvedFromAnchor, parsed.octaveMarks, parsed.step, parsed.alter);
                previousAnchor = resolved;
                return { step: parsed.step, alter: parsed.alter, octave: resolved.octave };
            })()
            : pitch;
        if (!pitchResolved) {
            warnings.push(`${contextLabel}: note pitch parse failed; skipped.`);
            continue;
        }
        const event = {
            kind: "note",
            durationDiv,
            type,
            dots: effectiveDots,
            pitch: pitchResolved,
            tieStop: pendingTieStop || undefined,
            tieStart: m[6] === "~" ? true : undefined,
        };
        if (activeTuplet) {
            event.tupletActual = activeTuplet.actual;
            event.tupletNormal = activeTuplet.normal;
            if (activeTuplet.needsStart) {
                event.tupletStart = true;
                activeTuplet.needsStart = false;
            }
        }
        applyPendingOrnaments(event);
        if (pendingGlissStop) {
            event.glissHints = [...((_h = event.glissHints) !== null && _h !== void 0 ? _h : []), { type: "stop" }];
            pendingGlissStop = false;
        }
        if (pendingSlurStart > 0) {
            event.slurHints = Array.from({ length: pendingSlurStart }, () => ({ type: "start" }));
            pendingSlurStart = 0;
        }
        pendingTieStop = m[6] === "~";
        noteEventNoInMeasure += 1;
        if (voiceId && graceHintByKey.size > 0) {
            const graceHint = graceHintByKey.get(`${voiceId}#${measures.length}#${noteEventNoInMeasure}`);
            if (graceHint) {
                event.graceSlash = graceHint.slash;
                event.durationDiv = 0;
            }
        }
        pushEvent(event);
        previousPitched = { kind: "note", pitch: event.pitch };
    }
    while (measures.length > 1 && measures[measures.length - 1].length === 0) {
        measures.pop();
    }
    return measures;
};
const buildDirectMusicXmlFromStaffBlocks = (params) => {
    const accidentalTextFromAlter = (alter) => {
        const safeAlter = Number.isFinite(alter) ? Math.round(alter) : 0;
        if (safeAlter === 2)
            return "double-sharp";
        if (safeAlter === 1)
            return "sharp";
        if (safeAlter === -1)
            return "flat";
        if (safeAlter === -2)
            return "flat-flat";
        return null;
    };
    const buildNoteExtrasXml = (event) => {
        var _a, _b, _c, _d, _e;
        const graceXml = event.graceSlash === undefined ? "" : `<grace${event.graceSlash ? ' slash="yes"' : ""}/>`;
        const durationXml = event.graceSlash === undefined ? `<duration>${event.durationDiv}</duration>` : "";
        const timeModXml = Number.isFinite(event.tupletActual)
            && event.tupletActual > 0
            && Number.isFinite(event.tupletNormal)
            && event.tupletNormal > 0
            ? `<time-modification><actual-notes>${Math.round(event.tupletActual)}</actual-notes><normal-notes>${Math.round(event.tupletNormal)}</normal-notes></time-modification>`
            : "";
        const tokens = Array.from(new Set((_a = event.articulationSubtypes) !== null && _a !== void 0 ? _a : []));
        const nodes = [];
        if (tokens.includes("staccato"))
            nodes.push("<staccato/>");
        if (tokens.includes("accent"))
            nodes.push("<accent/>");
        if (tokens.includes("up-bow"))
            nodes.push("<up-bow/>");
        if (tokens.includes("down-bow"))
            nodes.push("<down-bow/>");
        if (tokens.includes("snap-pizzicato"))
            nodes.push("<snap-pizzicato/>");
        const technicalTokens = Array.from(new Set((_b = event.technicalSubtypes) !== null && _b !== void 0 ? _b : []));
        const technicalNodes = [];
        if (technicalTokens.includes("harmonic"))
            technicalNodes.push("<harmonic/>");
        const tupletNodes = [];
        const tupletNumberAttr = Number.isFinite(event.tupletNumber) && event.tupletNumber > 0
            ? ` number="${Math.round(event.tupletNumber)}"`
            : "";
        if (event.tupletStart)
            tupletNodes.push(`<tuplet type="start"${tupletNumberAttr}/>`);
        if (event.tupletStop)
            tupletNodes.push(`<tuplet type="stop"${tupletNumberAttr}/>`);
        const slurNodes = ((_c = event.slurHints) !== null && _c !== void 0 ? _c : []).map((slur) => {
            const numberAttr = Number.isFinite(slur.number) && slur.number > 0
                ? ` number="${Math.round(slur.number)}"`
                : "";
            const placementAttr = slur.type === "start" && slur.placement ? ` placement="${slur.placement}"` : "";
            return `<slur type="${slur.type}"${numberAttr}${placementAttr}/>`;
        });
        const glissNodes = ((_d = event.glissHints) !== null && _d !== void 0 ? _d : []).map((gliss) => {
            const numberAttr = Number.isFinite(gliss.number) && gliss.number > 0
                ? ` number="${Math.round(gliss.number)}"`
                : "";
            return `<glissando type="${gliss.type}"${numberAttr}/>`;
        });
        const wavyNodes = ((_e = event.wavyLineHints) !== null && _e !== void 0 ? _e : []).map((wavy) => {
            const numberAttr = Number.isFinite(wavy.number) && wavy.number > 0
                ? ` number="${Math.round(wavy.number)}"`
                : "";
            return `<wavy-line type="${wavy.type}"${numberAttr}/>`;
        });
        const tieXml = `${event.tieStart ? '<tie type="start"/>' : ""}${event.tieStop ? '<tie type="stop"/>' : ""}`;
        const tiedXml = `${event.tieStart ? '<tied type="start"/>' : ""}${event.tieStop ? '<tied type="stop"/>' : ""}`;
        const ornamentsXml = event.trillMark || wavyNodes.length
            ? `<ornaments>${event.trillMark ? "<trill-mark/>" : ""}${wavyNodes.join("")}</ornaments>`
            : "";
        const lyricXml = event.lyricText
            ? `<lyric><syllabic>single</syllabic><text>${xmlEscape(event.lyricText)}</text></lyric>`
            : "";
        const notationXml = nodes.length || technicalNodes.length || tupletNodes.length || slurNodes.length || glissNodes.length || ornamentsXml || tiedXml
            ? `<notations>${nodes.length ? `<articulations>${nodes.join("")}</articulations>` : ""}${technicalNodes.length ? `<technical>${technicalNodes.join("")}</technical>` : ""}${tupletNodes.join("")}${slurNodes.join("")}${glissNodes.join("")}${tiedXml}${ornamentsXml}</notations>`
            : "";
        return `${graceXml}${durationXml}${timeModXml}${tieXml}${lyricXml}${notationXml}`;
    };
    const partList = params.staffs
        .map((staff, i) => {
        var _a;
        const name = ((_a = staff.partName) !== null && _a !== void 0 ? _a : "").trim() || staff.voiceId || `Part ${i + 1}`;
        return `<score-part id="P${i + 1}"><part-name>${xmlEscape(name)}</part-name></score-part>`;
    })
        .join("");
    const measureCount = params.staffs.reduce((max, staff) => Math.max(max, staff.measures.length), 1);
    const parts = params.staffs
        .map((staff, i) => {
        var _a, _b, _c, _d, _e, _f, _g;
        const partId = `P${i + 1}`;
        const measuresXml = [];
        const measureCapacity = Math.max(1, Math.round((480 * 4 * params.beats) / Math.max(1, params.beatType)));
        let currentBeats = Math.max(1, Math.round(params.beats));
        let currentBeatType = Math.max(1, Math.round(params.beatType));
        for (let m = 0; m < measureCount; m += 1) {
            const events = staff.measures[m] || [];
            const index1 = m + 1;
            const hint = (_b = (_a = staff.measureHintsByIndex) === null || _a === void 0 ? void 0 : _a.get(index1)) !== null && _b !== void 0 ? _b : null;
            const numberText = ((_c = hint === null || hint === void 0 ? void 0 : hint.number) === null || _c === void 0 ? void 0 : _c.trim()) || String(index1);
            const implicitAttr = (hint === null || hint === void 0 ? void 0 : hint.implicit) ? ' implicit="yes"' : "";
            const measureBeats = Math.max(1, Math.round((_d = hint === null || hint === void 0 ? void 0 : hint.beats) !== null && _d !== void 0 ? _d : currentBeats));
            const measureBeatType = Math.max(1, Math.round((_e = hint === null || hint === void 0 ? void 0 : hint.beatType) !== null && _e !== void 0 ? _e : currentBeatType));
            const shouldEmitTime = m === 0
                || (hint === null || hint === void 0 ? void 0 : hint.explicitTime) === true
                || measureBeats !== currentBeats
                || measureBeatType !== currentBeatType;
            let body = "";
            if (m === 0) {
                const clefXml = staff.clef === "bass"
                    ? "<clef><sign>F</sign><line>4</line></clef>"
                    : staff.clef === "alto"
                        ? "<clef><sign>C</sign><line>3</line></clef>"
                        : staff.clef === "tenor"
                            ? "<clef><sign>C</sign><line>4</line></clef>"
                            : "<clef><sign>G</sign><line>2</line></clef>";
                const transpose = staff.transpose || null;
                const transposeXml = transpose && (Number.isFinite(transpose.chromatic) || Number.isFinite(transpose.diatonic))
                    ? `<transpose>${Number.isFinite(transpose.diatonic) ? `<diatonic>${Math.round(Number(transpose.diatonic))}</diatonic>` : ""}${Number.isFinite(transpose.chromatic) ? `<chromatic>${Math.round(Number(transpose.chromatic))}</chromatic>` : ""}</transpose>`
                    : "";
                body += `<attributes><divisions>480</divisions><key><fifths>${params.fifths}</fifths><mode>${params.mode}</mode></key><time><beats>${measureBeats}</beats><beat-type>${measureBeatType}</beat-type></time>${transposeXml}${clefXml}</attributes>`;
            }
            else if (shouldEmitTime) {
                body += `<attributes><time><beats>${measureBeats}</beats><beat-type>${measureBeatType}</beat-type></time></attributes>`;
            }
            if ((hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "left" || (hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "both") {
                body += `<barline location="left"><bar-style>light-light</bar-style></barline>`;
            }
            const octaveShiftHints = (_g = (_f = staff.octaveShiftHintsByMeasure) === null || _f === void 0 ? void 0 : _f.get(index1)) !== null && _g !== void 0 ? _g : [];
            for (const octaveShiftHint of octaveShiftHints) {
                const sizeAttr = Number.isFinite(octaveShiftHint.size) ? ` size="${Math.round(octaveShiftHint.size)}"` : "";
                const numberAttr = Number.isFinite(octaveShiftHint.number) ? ` number="${Math.round(octaveShiftHint.number)}"` : "";
                body += `<direction><direction-type><octave-shift type="${octaveShiftHint.type}"${sizeAttr}${numberAttr}/></direction-type></direction>`;
            }
            if (!events.length) {
                body += `<note><rest/><duration>${measureCapacity}</duration><voice>1</voice><type>whole</type></note>`;
                if ((hint === null || hint === void 0 ? void 0 : hint.repeat) === "forward") {
                    body = `<barline location="left"><repeat direction="forward"/></barline>${body}`;
                }
                else if ((hint === null || hint === void 0 ? void 0 : hint.repeat) === "backward") {
                    const timesText = Number.isFinite(hint.times) && hint.times > 1
                        ? `<bar-style>light-heavy</bar-style><repeat direction="backward"/><ending number="${Math.round(hint.times)}" type="stop"/>`
                        : `<repeat direction="backward"/>`;
                    body += `<barline location="right">${timesText}</barline>`;
                }
                if ((hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "right" || (hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "both") {
                    body += `<barline location="right"><bar-style>light-light</bar-style></barline>`;
                }
                currentBeats = measureBeats;
                currentBeatType = measureBeatType;
                measuresXml.push(`<measure number="${xmlEscape(numberText)}"${implicitAttr}>${body}</measure>`);
                continue;
            }
            for (const event of events) {
                if (event.kind === "direction") {
                    body += event.xml;
                    continue;
                }
                if (event.kind === "backup") {
                    body += `<backup><duration>${event.durationDiv}</duration></backup>`;
                    continue;
                }
                if (event.kind === "rest") {
                    body += `<note><rest/><duration>${event.durationDiv}</duration><voice>1</voice><type>${event.type}</type>${"<dot/>".repeat(event.dots)}</note>`;
                    continue;
                }
                if (event.kind === "note") {
                    const accidentalText = event.accidentalText || accidentalTextFromAlter(event.pitch.alter);
                    const accidentalXml = accidentalText ? `<accidental>${accidentalText}</accidental>` : "";
                    body += `<note>${buildNoteExtrasXml(event)}<pitch><step>${event.pitch.step}</step>${event.pitch.alter !== 0 ? `<alter>${event.pitch.alter}</alter>` : ""}<octave>${event.pitch.octave}</octave></pitch><voice>1</voice><type>${event.type}</type>${"<dot/>".repeat(event.dots)}${accidentalXml}</note>`;
                    continue;
                }
                for (let pi = 0; pi < event.pitches.length; pi += 1) {
                    const pitch = event.pitches[pi];
                    const chordDurationXml = event.graceSlash === undefined ? `<duration>${event.durationDiv}</duration>` : "";
                    const accidentalText = (pi === 0 && event.accidentalText ? event.accidentalText : null)
                        || accidentalTextFromAlter(pitch.alter);
                    const accidentalXml = accidentalText ? `<accidental>${accidentalText}</accidental>` : "";
                    body += `<note>${pi > 0 ? "<chord/>" : ""}${pi === 0 ? buildNoteExtrasXml(event) : chordDurationXml}<pitch><step>${pitch.step}</step>${pitch.alter !== 0 ? `<alter>${pitch.alter}</alter>` : ""}<octave>${pitch.octave}</octave></pitch><voice>1</voice><type>${event.type}</type>${"<dot/>".repeat(event.dots)}${accidentalXml}</note>`;
                }
            }
            if ((hint === null || hint === void 0 ? void 0 : hint.repeat) === "forward") {
                body = `<barline location="left"><repeat direction="forward"/></barline>${body}`;
            }
            else if ((hint === null || hint === void 0 ? void 0 : hint.repeat) === "backward") {
                const timesText = Number.isFinite(hint.times) && hint.times > 1
                    ? `<bar-style>light-heavy</bar-style><repeat direction="backward"/><ending number="${Math.round(hint.times)}" type="stop"/>`
                    : `<repeat direction="backward"/>`;
                body += `<barline location="right">${timesText}</barline>`;
            }
            if ((hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "right" || (hint === null || hint === void 0 ? void 0 : hint.doubleBar) === "both") {
                body += `<barline location="right"><bar-style>light-light</bar-style></barline>`;
            }
            currentBeats = measureBeats;
            currentBeatType = measureBeatType;
            measuresXml.push(`<measure number="${xmlEscape(numberText)}"${implicitAttr}>${body}</measure>`);
        }
        return `<part id="${partId}">${measuresXml.join("")}</part>`;
    })
        .join("");
    const xml = `<?xml version="1.0" encoding="UTF-8"?>` +
        `<score-partwise version="4.0">` +
        `<work><work-title>${xmlEscape(params.title || "Imported LilyPond")}</work-title></work>` +
        `${params.composer ? `<identification><creator type="composer">${xmlEscape(params.composer)}</creator></identification>` : ""}` +
        `<part-list>${partList}</part-list>${parts}</score-partwise>`;
    return (0, musicxml_io_1.prettyPrintMusicXmlText)(xml);
};
const tryConvertLilyPondToMusicXmlDirect = (source) => {
    const title = parseHeaderField(source, "title") || "Imported LilyPond";
    const composer = parseHeaderField(source, "composer");
    const meter = parseTimeSignature(source);
    const keyAbc = parseKeySignature(source);
    const keyInfo = keyModeAndFifthsFromAbcKey(keyAbc);
    const staffBlocks = extractAllStaffBlocks(source);
    const transposeHintByVoiceId = parseMksTransposeHints(source);
    const measureHintByVoiceId = parseMksMeasureHints(source);
    const articulationHintByKey = parseMksArticulationHints(source);
    const graceHintByKey = parseMksGraceHints(source);
    const tupletHintByKey = parseMksTupletHints(source);
    const accidentalHintByKey = parseMksAccidentalHints(source);
    const laneHintByVoiceId = parseMksLaneHints(source);
    const slurHintByKey = parseMksSlurHints(source);
    const trillHintByKey = parseMksTrillHints(source);
    const octaveShiftHintByVoiceId = parseMksOctaveShiftHints(source);
    const lyricAssignments = parseLilyLyricAssignments(source);
    const variableMap = parseLilyVariableBlocks(source);
    const standaloneBlocks = extractStandaloneMusicBlocks(source);
    if (!staffBlocks.length && !standaloneBlocks.length)
        return null;
    const warnings = [];
    const staffsFromStaffBlocks = staffBlocks.map((staff, index) => {
        var _a;
        const normalizedVoiceId = normalizeVoiceId(staff.voiceId, `P${index + 1}`);
        const expandedBody = expandLilyVariablesInBody(staff.body, variableMap);
        const measures = parseLilyDirectBody(expandedBody, warnings, `staff ${index + 1}`, meter.beats, meter.beatType, {
            voiceId: normalizedVoiceId,
            graceHintByKey,
        });
        const laneHintsForVoice = laneHintByVoiceId.get(normalizedVoiceId);
        if (laneHintsForVoice && laneHintsForVoice.size > 0) {
            for (const [measureNo, laneBodies] of laneHintsForVoice.entries()) {
                if (!Number.isFinite(measureNo) || measureNo <= 0 || laneBodies.length <= 1)
                    continue;
                const merged = [];
                let previousLaneDuration = 0;
                for (let laneIndex = 0; laneIndex < laneBodies.length; laneIndex += 1) {
                    const laneParsed = parseLilyDirectBody(laneBodies[laneIndex], warnings, `staff ${index + 1} lane ${laneIndex + 1}`, meter.beats, meter.beatType, {
                        voiceId: normalizedVoiceId,
                        graceHintByKey,
                    });
                    const laneEvents = (_a = laneParsed[0]) !== null && _a !== void 0 ? _a : [];
                    if (laneIndex > 0 && previousLaneDuration > 0) {
                        merged.push({ kind: "backup", durationDiv: previousLaneDuration });
                    }
                    merged.push(...laneEvents);
                    previousLaneDuration = laneEvents.reduce((sum, event) => sum + (event.kind === "backup" ? 0 : event.durationDiv), 0);
                }
                measures[measureNo - 1] = merged;
            }
        }
        const explicitClef = /\\clef\s+/i.test(staff.body);
        const omittedRelativeRoot = hasOmittedRelativeRoot(staff.body);
        return {
            voiceId: staff.voiceId || `P${index + 1}`,
            partName: (staff.partName || "").trim() || staff.voiceId || `P${index + 1}`,
            clef: explicitClef
                ? normalizeAbcClefName(staff.clef || "treble")
                : omittedRelativeRoot
                    ? "treble"
                    : chooseLilyClefFromMeasures(measures),
            measures: applyArticulationHintsToMeasures(measures, normalizedVoiceId, articulationHintByKey, graceHintByKey, tupletHintByKey, accidentalHintByKey, slurHintByKey, trillHintByKey),
            transpose: transposeHintByVoiceId.get(normalizedVoiceId) || staff.transpose || null,
            measureHintsByIndex: measureHintByVoiceId.get(normalizedVoiceId) || undefined,
            octaveShiftHintsByMeasure: octaveShiftHintByVoiceId.get(normalizedVoiceId) || undefined,
            autoSplitEligible: !explicitClef,
        };
    });
    const staffsFromStandaloneBlocks = staffBlocks.length > 0
        ? []
        : standaloneBlocks
            .map((body, index) => {
            const voiceId = `P${index + 1}`;
            const omittedRelativeRoot = hasOmittedRelativeRoot(body);
            const measures = parseLilyDirectBody(body, warnings, `block ${index + 1}`, meter.beats, meter.beatType, {
                voiceId,
                graceHintByKey,
            });
            return {
                voiceId,
                partName: voiceId,
                clef: omittedRelativeRoot ? "treble" : chooseLilyClefFromMeasures(measures),
                measures: applyArticulationHintsToMeasures(measures, voiceId, articulationHintByKey, graceHintByKey, tupletHintByKey, accidentalHintByKey, slurHintByKey, trillHintByKey),
                transpose: transposeHintByVoiceId.get(voiceId) || null,
                measureHintsByIndex: measureHintByVoiceId.get(voiceId) || undefined,
                octaveShiftHintsByMeasure: octaveShiftHintByVoiceId.get(voiceId) || undefined,
                // Keep bare blocks conservative: avoid auto grand-staff split unless user writes explicit staff blocks.
                autoSplitEligible: false,
            };
        })
            .filter((staff) => staff.measures.some((measure) => measure.length > 0));
    const mergedStaffs = staffsFromStaffBlocks.length
        ? staffsFromStaffBlocks
        : staffsFromStandaloneBlocks;
    const staffs = [];
    for (const staff of mergedStaffs) {
        if (!staff.autoSplitEligible) {
            staffs.push(staff);
            continue;
        }
        const split = autoSplitMeasuresToGrandStaff(staff.measures);
        if (!split.splitApplied) {
            staffs.push(staff);
            continue;
        }
        staffs.push({
            ...staff,
            voiceId: `${staff.voiceId}_s1`,
            clef: "treble",
            measures: split.upper,
            autoSplitEligible: false,
        });
        staffs.push({
            ...staff,
            voiceId: `${staff.voiceId}_s2`,
            clef: "bass",
            measures: split.lower,
            autoSplitEligible: false,
        });
    }
    if (lyricAssignments.length > 0 && staffs.length > 0) {
        for (const assignment of lyricAssignments) {
            if (!assignment.syllables.length)
                continue;
            if (!assignment.targetVoiceId) {
                applyLyricsToMeasures(staffs[0].measures, assignment.syllables);
                continue;
            }
            const target = staffs.find((staff) => normalizeVoiceId(staff.voiceId, "") === assignment.targetVoiceId);
            if (target) {
                applyLyricsToMeasures(target.measures, assignment.syllables);
            }
            else {
                const fallbackSplitTarget = staffs.find((staff) => normalizeVoiceId(staff.voiceId, "").startsWith(`${assignment.targetVoiceId}_s`));
                applyLyricsToMeasures((fallbackSplitTarget || staffs[0]).measures, assignment.syllables);
            }
        }
    }
    if (!staffs.some((staff) => staff.measures.some((measure) => measure.length > 0))) {
        return null;
    }
    const xml = buildDirectMusicXmlFromStaffBlocks({
        title,
        composer,
        beats: meter.beats,
        beatType: meter.beatType,
        fifths: keyInfo.fifths,
        mode: keyInfo.mode,
        staffs,
    });
    return { xml, warnings };
};
const parseLilyBodyToAbc = (body, warnings, contextLabel) => {
    var _a, _b;
    const relative = unwrapRelativeBlock(body);
    const clean = stripLilyComments(relative.body).replace(/~/g, " ");
    const tokens = clean.match(/<[^>]+>\d*\.{0,3}|[a-grs](?:isis|eses|is|es)?[,']*\d*\.{0,3}|\\[A-Za-z]+|\\bar|[|:]+|[{}()]/g) || [];
    const out = [];
    // LilyPond absolute octave baseline: c = C3, c' = C4, c'' = C5.
    let currentOctave = 3;
    let previousAnchor = relative.relativeRoot
        ? {
            step: relative.relativeRoot.step,
            octave: relative.relativeRoot.octave,
            midi: relative.relativeRoot.octave * 12 + lilyPitchClassToSemitone(relative.relativeRoot.step, relative.relativeRoot.alter),
        }
        : null;
    let currentDuration = 4;
    for (const token of tokens) {
        if (!token || token === "{" || token === "}" || token === "(" || token === ")")
            continue;
        if (token === "|" || token === "||" || token === "|." || token === "|:" || token === ":|") {
            out.push("|");
            continue;
        }
        if (token.startsWith("\\")) {
            const lower = token.toLowerCase();
            if (lower === "\\bar" || lower === "\\clef" || lower === "\\tempo" || lower === "\\partial")
                continue;
            warnings.push(`${contextLabel}: unsupported command skipped: ${token}`);
            continue;
        }
        if (token.startsWith("<") && token.includes(">")) {
            const chordMatch = token.match(/^<([^>]+)>(\d+)?(\.*)$/);
            if (!chordMatch) {
                warnings.push(`${contextLabel}: unsupported chord token skipped: ${token}`);
                continue;
            }
            const bodyText = chordMatch[1].trim();
            const durText = chordMatch[2] || "";
            const dots = ((_a = chordMatch[3]) === null || _a === void 0 ? void 0 : _a.length) || 0;
            if (durText) {
                const parsedDuration = Number.parseInt(durText, 10);
                if (Number.isFinite(parsedDuration) && parsedDuration > 0)
                    currentDuration = parsedDuration;
            }
            const len = lilyDurationToAbcLen(currentDuration, dots);
            const chordMembers = [];
            let chordFirstAnchor = null;
            for (const memberRaw of bodyText.split(/\s+/).filter(Boolean)) {
                const parsed = parseLilyPitchToken(memberRaw);
                if (!parsed) {
                    warnings.push(`${contextLabel}: unsupported chord pitch skipped: ${memberRaw}`);
                    continue;
                }
                let octave = currentOctave;
                if (relative.relativeMode) {
                    const resolvedFromAnchor = resolveRelativePitch(parsed.step, parsed.alter, previousAnchor);
                    const resolved = applyLilyOctaveMarks(resolvedFromAnchor, parsed.octaveMarks, parsed.step, parsed.alter);
                    octave = resolved.octave;
                    if (!chordFirstAnchor)
                        chordFirstAnchor = resolved;
                    previousAnchor = resolved;
                }
                else if (parsed.octaveMarks.length > 0) {
                    const up = (parsed.octaveMarks.match(/'/g) || []).length;
                    const down = (parsed.octaveMarks.match(/,/g) || []).length;
                    octave = 3 + up - down;
                }
                else {
                    // Absolute LilyPond: no octave mark means base octave (C3) for note letters.
                    octave = 3;
                }
                currentOctave = octave;
                const accidental = parsed.alter > 0 ? "^".repeat(Math.min(2, parsed.alter)) : parsed.alter < 0 ? "_".repeat(Math.min(2, Math.abs(parsed.alter))) : "";
                chordMembers.push(`${accidental}${abcPitchFromStepOctave(parsed.step, octave)}`);
            }
            if (chordMembers.length > 0) {
                out.push(`[${chordMembers.join("")}]${len}`);
                if (relative.relativeMode && chordFirstAnchor)
                    previousAnchor = chordFirstAnchor;
            }
            continue;
        }
        const m = token.match(/^([a-g]|r|s)(isis|eses|is|es)?([,']*)(\d+)?(\.*)$/);
        if (!m) {
            warnings.push(`${contextLabel}: unsupported token skipped: ${token}`);
            continue;
        }
        const isRest = m[1] === "r" || m[1] === "s";
        const accidentalText = m[2] || "";
        const octaveMarks = m[3] || "";
        const durText = m[4] || "";
        const dots = ((_b = m[5]) === null || _b === void 0 ? void 0 : _b.length) || 0;
        const duration = durText ? Number.parseInt(durText, 10) : currentDuration;
        if (durText && Number.isFinite(duration) && duration > 0) {
            currentDuration = duration;
        }
        const len = lilyDurationToAbcLen(currentDuration, dots);
        if (isRest) {
            out.push(`z${len}`);
            continue;
        }
        const step = m[1].toUpperCase();
        if (relative.relativeMode) {
            let alter = 0;
            if (accidentalText === "is")
                alter = 1;
            if (accidentalText === "isis")
                alter = 2;
            if (accidentalText === "es")
                alter = -1;
            if (accidentalText === "eses")
                alter = -2;
            const resolvedFromAnchor = resolveRelativePitch(step, alter, previousAnchor);
            const resolved = applyLilyOctaveMarks(resolvedFromAnchor, octaveMarks, step, alter);
            currentOctave = resolved.octave;
            previousAnchor = resolved;
        }
        else if (octaveMarks.length > 0) {
            const up = (octaveMarks.match(/'/g) || []).length;
            const down = (octaveMarks.match(/,/g) || []).length;
            currentOctave = 3 + up - down;
        }
        else {
            // Absolute LilyPond: no octave mark means base octave (C3).
            currentOctave = 3;
        }
        let accidental = "";
        if (accidentalText === "is")
            accidental = "^";
        if (accidentalText === "isis")
            accidental = "^^";
        if (accidentalText === "es")
            accidental = "_";
        if (accidentalText === "eses")
            accidental = "__";
        out.push(`${accidental}${abcPitchFromStepOctave(step, currentOctave)}${len}`);
    }
    return out.join(" ").replace(/\s+\|/g, " |").replace(/\|\s+\|/g, " |");
};
const buildLilySourceMiscFields = (source) => {
    const raw = String(source !== null && source !== void 0 ? source : "");
    if (!raw.length)
        return [];
    const encoded = raw
        .replace(/\\/g, "\\\\")
        .replace(/\r/g, "\\r")
        .replace(/\n/g, "\\n");
    const chunkSize = 240;
    const maxChunks = 512;
    const chunks = [];
    for (let i = 0; i < encoded.length && chunks.length < maxChunks; i += chunkSize) {
        chunks.push(encoded.slice(i, i + chunkSize));
    }
    const truncated = chunks.join("").length < encoded.length;
    const fields = [
        { name: "mks:src:lilypond:raw-encoding", value: "escape-v1" },
        { name: "mks:src:lilypond:raw-length", value: String(raw.length) },
        { name: "mks:src:lilypond:raw-encoded-length", value: String(encoded.length) },
        { name: "mks:src:lilypond:raw-chunks", value: String(chunks.length) },
        { name: "mks:src:lilypond:raw-truncated", value: truncated ? "1" : "0" },
    ];
    for (let i = 0; i < chunks.length; i += 1) {
        fields.push({
            name: `mks:src:lilypond:raw-${String(i + 1).padStart(4, "0")}`,
            value: chunks[i],
        });
    }
    return fields;
};
const buildLilyDiagMiscFields = (warnings) => {
    if (!warnings.length)
        return [];
    const maxEntries = Math.min(256, warnings.length);
    const fields = [
        { name: "mks:diag:count", value: String(maxEntries) },
    ];
    for (let i = 0; i < maxEntries; i += 1) {
        const payload = `level=warn;code=LILYPOND_IMPORT_WARNING;fmt=lilypond;message=${warnings[i]}`;
        fields.push({
            name: `mks:diag:${String(i + 1).padStart(4, "0")}`,
            value: payload,
        });
    }
    return fields;
};
const appendMiscFieldsToFirstMeasure = (xmlText, fields) => {
    if (!fields.length)
        return xmlText;
    const doc = (0, musicxml_io_1.parseMusicXmlDocument)(xmlText);
    if (!doc)
        return xmlText;
    const measure = doc.querySelector("score-partwise > part > measure");
    if (!measure)
        return xmlText;
    let attributes = measure.querySelector(":scope > attributes");
    if (!attributes) {
        attributes = doc.createElement("attributes");
        measure.insertBefore(attributes, measure.firstChild);
    }
    let misc = attributes.querySelector(":scope > miscellaneous");
    if (!misc) {
        misc = doc.createElement("miscellaneous");
        attributes.appendChild(misc);
    }
    for (const field of fields) {
        const node = doc.createElement("miscellaneous-field");
        node.setAttribute("name", field.name);
        node.textContent = field.value;
        misc.appendChild(node);
    }
    return (0, musicxml_io_1.serializeMusicXmlDocument)(doc);
};
const extractSimpleComposerFromDoc = (doc) => {
    var _a, _b;
    const creator = (_b = (_a = doc.querySelector('score-partwise > identification > creator[type="composer"]')) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim();
    if (creator)
        return creator;
    return "";
};
const noteTypeToLilyDuration = (typeText) => {
    const normalized = String(typeText || "").trim().toLowerCase();
    switch (normalized) {
        case "whole":
            return "1";
        case "half":
            return "2";
        case "quarter":
            return "4";
        case "eighth":
            return "8";
        case "16th":
            return "16";
        case "32nd":
            return "32";
        case "64th":
            return "64";
        default:
            return "4";
    }
};
const noteTypeToDivisionsFallback = (typeText, divisions) => {
    const safeDiv = Math.max(1, Math.round(divisions));
    const normalized = String(typeText || "").trim().toLowerCase();
    switch (normalized) {
        case "whole":
            return safeDiv * 4;
        case "half":
            return safeDiv * 2;
        case "quarter":
            return safeDiv;
        case "eighth":
            return Math.max(1, Math.round(safeDiv / 2));
        case "16th":
            return Math.max(1, Math.round(safeDiv / 4));
        case "32nd":
            return Math.max(1, Math.round(safeDiv / 8));
        case "64th":
            return Math.max(1, Math.round(safeDiv / 16));
        default:
            return safeDiv;
    }
};
const collectStaffNumbersForPart = (part) => {
    const set = new Set();
    for (const stavesNode of Array.from(part.querySelectorAll(":scope > measure > attributes > staves"))) {
        const count = Number.parseInt(stavesNode.textContent || "", 10);
        if (!Number.isFinite(count) || count <= 0)
            continue;
        for (let i = 1; i <= count; i += 1)
            set.add(i);
    }
    for (const staffNode of Array.from(part.querySelectorAll(":scope > measure > note > staff"))) {
        const staff = Number.parseInt(staffNode.textContent || "", 10);
        if (Number.isFinite(staff) && staff > 0)
            set.add(staff);
    }
    if (!set.size)
        set.add(1);
    return Array.from(set.values()).sort((a, b) => a - b);
};
const collectActiveStaffNumbersForPart = (part) => {
    var _a;
    const set = new Set();
    for (const note of Array.from(part.querySelectorAll(":scope > measure > note"))) {
        if (note.querySelector(":scope > rest"))
            continue;
        const hasPitch = Boolean(note.querySelector(":scope > pitch > step"));
        if (!hasPitch)
            continue;
        const staff = Number.parseInt(((_a = note.querySelector(":scope > staff")) === null || _a === void 0 ? void 0 : _a.textContent) || "1", 10);
        if (Number.isFinite(staff) && staff > 0)
            set.add(staff);
    }
    return Array.from(set.values()).sort((a, b) => a - b);
};
const resolveLilyClefForPartStaff = (part, staffNo) => {
    var _a, _b, _c, _d, _e, _f;
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const clefNodes = Array.from(measure.querySelectorAll(":scope > attributes > clef"));
        for (const clefNode of clefNodes) {
            const numberAttr = clefNode.getAttribute("number");
            const applies = numberAttr === null ? staffNo === 1 : Number.parseInt(numberAttr, 10) === staffNo;
            if (!applies)
                continue;
            const sign = (((_a = clefNode.querySelector(":scope > sign")) === null || _a === void 0 ? void 0 : _a.textContent) || "").trim().toUpperCase();
            const line = Number.parseInt(((_b = clefNode.querySelector(":scope > line")) === null || _b === void 0 ? void 0 : _b.textContent) || "", 10);
            if (sign === "F" && line === 4)
                return "bass";
            if (sign === "G" && line === 2)
                return "treble";
            if (sign === "C" && line === 3)
                return "alto";
            if (sign === "C" && line === 4)
                return "tenor";
            if (sign === "PERCUSSION")
                return "percussion";
            return "treble";
        }
    }
    const keys = [];
    for (const note of Array.from(part.querySelectorAll(":scope > measure > note"))) {
        const noteStaff = Number.parseInt(((_c = note.querySelector(":scope > staff")) === null || _c === void 0 ? void 0 : _c.textContent) || "1", 10);
        if (noteStaff !== staffNo)
            continue;
        if (note.querySelector(":scope > rest"))
            continue;
        const step = (((_d = note.querySelector(":scope > pitch > step")) === null || _d === void 0 ? void 0 : _d.textContent) || "").trim().toUpperCase();
        const alter = Number.parseInt(((_e = note.querySelector(":scope > pitch > alter")) === null || _e === void 0 ? void 0 : _e.textContent) || "0", 10);
        const octave = Number.parseInt(((_f = note.querySelector(":scope > pitch > octave")) === null || _f === void 0 ? void 0 : _f.textContent) || "", 10);
        const midi = pitchToMidiKey(step, alter, octave);
        if (midi !== null)
            keys.push(midi);
    }
    return (0, staffClefPolicy_1.chooseSingleClefByKeys)(keys) === "F" ? "bass" : "treble";
};
const buildLilyBodyFromPart = (part, warnings, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
    const SMALL_OVERFLOW_TOLERANCE_DIV = 8;
    const targetStaffNo = (_a = options.targetStaffNo) !== null && _a !== void 0 ? _a : null;
    const laneHintVoiceId = (_b = options.laneHintVoiceId) !== null && _b !== void 0 ? _b : "";
    const laneHintCommentsOut = options.laneHintCommentsOut;
    const tokens = [];
    let currentDivisions = 480;
    let currentBeats = 4;
    let currentBeatType = 4;
    const measures = Array.from(part.querySelectorAll(":scope > measure"));
    for (let measureIndex = 0; measureIndex < measures.length; measureIndex += 1) {
        const measure = measures[measureIndex];
        const parsedDivisions = Number.parseInt(((_c = measure.querySelector(":scope > attributes > divisions")) === null || _c === void 0 ? void 0 : _c.textContent) || "", 10);
        if (Number.isFinite(parsedDivisions) && parsedDivisions > 0) {
            currentDivisions = parsedDivisions;
        }
        const parsedBeats = Number.parseInt(((_d = measure.querySelector(":scope > attributes > time > beats")) === null || _d === void 0 ? void 0 : _d.textContent) || "", 10);
        if (Number.isFinite(parsedBeats) && parsedBeats > 0) {
            currentBeats = parsedBeats;
        }
        const parsedBeatType = Number.parseInt(((_e = measure.querySelector(":scope > attributes > time > beat-type")) === null || _e === void 0 ? void 0 : _e.textContent) || "", 10);
        if (Number.isFinite(parsedBeatType) && parsedBeatType > 0) {
            currentBeatType = parsedBeatType;
        }
        const measureCapacityDiv = Math.max(1, Math.round((currentDivisions * 4 * currentBeats) / Math.max(1, currentBeatType)));
        const measureTokens = [];
        let occupiedDiv = 0;
        let laneNoteCount = 0;
        const finalizedLanes = [];
        let bestLaneTokens = [];
        let bestLaneOccupiedDiv = -1;
        let bestLaneNoteCount = -1;
        const finalizeLane = () => {
            if (targetStaffNo === null)
                return;
            const hasAny = measureTokens.length > 0;
            if (!hasAny)
                return;
            finalizedLanes.push({
                tokens: measureTokens.slice(),
                occupiedDiv,
                noteCount: laneNoteCount,
            });
            // Prefer lane with richer note content; tie-break by occupied timeline.
            if (laneNoteCount > bestLaneNoteCount
                || (laneNoteCount === bestLaneNoteCount && occupiedDiv > bestLaneOccupiedDiv)) {
                bestLaneTokens = measureTokens.slice();
                bestLaneOccupiedDiv = occupiedDiv;
                bestLaneNoteCount = laneNoteCount;
            }
        };
        const children = Array.from(measure.children);
        for (let childIndex = 0; childIndex < children.length; childIndex += 1) {
            const child = children[childIndex];
            if (child.tagName === "backup") {
                const backupDur = Number.parseInt(((_f = child.querySelector(":scope > duration")) === null || _f === void 0 ? void 0 : _f.textContent) || "0", 10);
                if (targetStaffNo !== null) {
                    // In per-staff export, treat backup as lane boundary and keep the densest lane.
                    if (Number.isFinite(backupDur) && backupDur > 0) {
                        finalizeLane();
                        measureTokens.length = 0;
                        occupiedDiv = 0;
                        laneNoteCount = 0;
                    }
                    continue;
                }
                if (Number.isFinite(backupDur) && backupDur > 0) {
                    // Voice reset for simultaneous lanes; avoid double-counting in single-lane LilyPond export.
                    break;
                }
                continue;
            }
            if (child.tagName !== "note")
                continue;
            const note = child;
            const noteStaff = Number.parseInt(((_g = note.querySelector(":scope > staff")) === null || _g === void 0 ? void 0 : _g.textContent) || "1", 10);
            if (targetStaffNo !== null && noteStaff !== targetStaffNo)
                continue;
            if (note.querySelector(":scope > chord")) {
                warnings.push("export: skipped malformed standalone chord-follow note.");
                continue;
            }
            const dots = note.querySelectorAll(":scope > dot").length;
            const durationDivRaw = Number.parseInt(((_h = note.querySelector(":scope > duration")) === null || _h === void 0 ? void 0 : _h.textContent) || "0", 10);
            const durationDiv = Number.isFinite(durationDivRaw) && durationDivRaw > 0
                ? durationDivRaw
                : noteTypeToDivisionsFallback(((_j = note.querySelector(":scope > type")) === null || _j === void 0 ? void 0 : _j.textContent) || "", currentDivisions);
            const timelineDurationDiv = note.querySelector(":scope > grace") ? 0 : durationDiv;
            const durWithDots = noteDurationToLilyToken(((_k = note.querySelector(":scope > type")) === null || _k === void 0 ? void 0 : _k.textContent) || "", dots, durationDiv, currentDivisions);
            if (occupiedDiv + timelineDurationDiv > measureCapacityDiv) {
                const overflow = occupiedDiv + timelineDurationDiv - measureCapacityDiv;
                if (overflow > SMALL_OVERFLOW_TOLERANCE_DIV) {
                    warnings.push("export: dropped note/rest that would overfill a measure.");
                    continue;
                }
            }
            if (note.querySelector(":scope > rest")) {
                measureTokens.push(`r${durWithDots}`);
                occupiedDiv += durationDiv;
                continue;
            }
            const chordNotes = [note];
            for (let lookahead = childIndex + 1; lookahead < children.length; lookahead += 1) {
                const next = children[lookahead];
                if (next.tagName !== "note")
                    break;
                const nextStaff = Number.parseInt(((_l = next.querySelector(":scope > staff")) === null || _l === void 0 ? void 0 : _l.textContent) || "1", 10);
                if (targetStaffNo !== null && nextStaff !== targetStaffNo)
                    break;
                if (!next.querySelector(":scope > chord"))
                    break;
                chordNotes.push(next);
                childIndex = lookahead;
            }
            const chordPitches = [];
            for (const chordNote of chordNotes) {
                const step = ((_o = (_m = chordNote.querySelector(":scope > pitch > step")) === null || _m === void 0 ? void 0 : _m.textContent) === null || _o === void 0 ? void 0 : _o.trim().toUpperCase()) || "C";
                const octave = Number.parseInt(((_p = chordNote.querySelector(":scope > pitch > octave")) === null || _p === void 0 ? void 0 : _p.textContent) || "4", 10);
                const alter = Number.parseInt(((_q = chordNote.querySelector(":scope > pitch > alter")) === null || _q === void 0 ? void 0 : _q.textContent) || "0", 10);
                if (!/^[A-G]$/.test(step) || !Number.isFinite(octave)) {
                    warnings.push("export: skipped unsupported note pitch.");
                    continue;
                }
                chordPitches.push(lilyPitchFromStepAlterOctave(step, alter, octave));
            }
            if (!chordPitches.length)
                continue;
            if (chordPitches.length === 1) {
                measureTokens.push(`${chordPitches[0]}${durWithDots}`);
            }
            else {
                measureTokens.push(`<${chordPitches.join(" ")}>${durWithDots}`);
            }
            laneNoteCount += 1;
            occupiedDiv += timelineDurationDiv;
        }
        finalizeLane();
        if (targetStaffNo !== null && finalizedLanes.length > 1 && laneHintVoiceId && laneHintCommentsOut) {
            const encodedLanes = finalizedLanes
                .map((lane) => encodeURIComponent(lane.tokens.join(" ")))
                .join(",");
            laneHintCommentsOut.push(`%@mks lanes voice=${laneHintVoiceId} measure=${measureIndex + 1} data=${encodedLanes}`);
        }
        if (targetStaffNo !== null && bestLaneTokens.length > 0) {
            measureTokens.length = 0;
            measureTokens.push(...bestLaneTokens);
            occupiedDiv = Math.max(0, bestLaneOccupiedDiv);
        }
        if (!measureTokens.length) {
            const safeBeats = Math.max(1, Math.round(currentBeats));
            const safeBeatType = Math.max(1, Math.round(currentBeatType));
            for (let i = 0; i < safeBeats; i += 1) {
                measureTokens.push(`r${safeBeatType}`);
            }
        }
        tokens.push(measureTokens.join(" "));
    }
    return tokens.join(" | ");
};
const convertLilyPondToMusicXml = (lilySource, options = {}) => {
    const source = String(lilySource !== null && lilySource !== void 0 ? lilySource : "");
    const warnings = [];
    const direct = tryConvertLilyPondToMusicXmlDirect(source);
    if (!direct) {
        throw new Error("No parseable notes/rests were found in LilyPond source.");
    }
    warnings.push(...direct.warnings);
    const extraFields = [
        ...buildLilyDiagMiscFields(warnings),
        ...(options.sourceMetadata === false ? [] : buildLilySourceMiscFields(source)),
    ];
    const xml = appendMiscFieldsToFirstMeasure(direct.xml, extraFields);
    const normalized = (0, musicxml_io_1.applyImplicitBeamsToMusicXmlText)(xml);
    if (options.debugPrettyPrint === false) {
        const doc = (0, musicxml_io_1.parseMusicXmlDocument)(normalized);
        return doc ? (0, musicxml_io_1.serializeMusicXmlDocument)(doc) : normalized;
    }
    return (0, musicxml_io_1.prettyPrintMusicXmlText)(normalized);
};
exports.convertLilyPondToMusicXml = convertLilyPondToMusicXml;
const exportMusicXmlDomToLilyPond = (doc) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    if (!parts.length) {
        throw new Error("MusicXML part is missing.");
    }
    const partNameById = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("score-partwise > part-list > score-part"))) {
        const partId = (_b = (_a = scorePart.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        const partName = ((_d = (_c = scorePart.querySelector(":scope > part-name")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) ||
            ((_f = (_e = scorePart.querySelector(":scope > part-abbreviation")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) ||
            partId;
        partNameById.set(partId, partName);
    }
    const title = ((_h = (_g = doc.querySelector("score-partwise > work > work-title")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) ||
        ((_k = (_j = doc.querySelector("score-partwise > movement-title")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) ||
        "mikuscore export";
    const composer = extractSimpleComposerFromDoc(doc);
    const firstMeasure = doc.querySelector("score-partwise > part > measure");
    const beats = Number.parseInt(((_l = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector(":scope > attributes > time > beats")) === null || _l === void 0 ? void 0 : _l.textContent) || "4", 10);
    const beatType = Number.parseInt(((_m = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector(":scope > attributes > time > beat-type")) === null || _m === void 0 ? void 0 : _m.textContent) || "4", 10);
    const fifths = Number.parseInt(((_o = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector(":scope > attributes > key > fifths")) === null || _o === void 0 ? void 0 : _o.textContent) || "0", 10);
    const mode = ((_q = (_p = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector(":scope > attributes > key > mode")) === null || _p === void 0 ? void 0 : _p.textContent) === null || _q === void 0 ? void 0 : _q.trim().toLowerCase()) === "minor"
        ? "minor"
        : "major";
    const keyByFifthsMajor = ["ces", "ges", "des", "aes", "ees", "bes", "f", "c", "g", "d", "a", "e", "b", "fis", "cis"];
    const keyByFifthsMinor = ["aes", "ees", "bes", "f", "c", "g", "d", "a", "e", "b", "fis", "cis", "gis", "dis", "ais"];
    const keyIndex = Math.max(0, Math.min(14, (Number.isFinite(fifths) ? Math.round(fifths) : 0) + 7));
    const keyToken = mode === "minor" ? keyByFifthsMinor[keyIndex] : keyByFifthsMajor[keyIndex];
    const warnings = [];
    const transposeComments = [];
    const measureComments = [];
    const blocks = [];
    for (let i = 0; i < parts.length; i += 1) {
        const part = parts[i];
        const partId = part.getAttribute("id") || `P${i + 1}`;
        const partName = partNameById.get(partId) || partId;
        let partTranspose = null;
        for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
            const transposeNode = measure.querySelector(":scope > attributes > transpose");
            if (!transposeNode)
                continue;
            const chromatic = Number.parseInt(((_r = transposeNode.querySelector(":scope > chromatic")) === null || _r === void 0 ? void 0 : _r.textContent) || "", 10);
            const diatonic = Number.parseInt(((_s = transposeNode.querySelector(":scope > diatonic")) === null || _s === void 0 ? void 0 : _s.textContent) || "", 10);
            if (!Number.isFinite(chromatic) && !Number.isFinite(diatonic))
                continue;
            partTranspose = {};
            if (Number.isFinite(chromatic))
                partTranspose.chromatic = Math.round(chromatic);
            if (Number.isFinite(diatonic))
                partTranspose.diatonic = Math.round(diatonic);
            break;
        }
        const transposeCommentForVoice = (voiceId) => {
            if (!partTranspose)
                return null;
            const fields = [`%@mks transpose voice=${voiceId}`];
            if (Number.isFinite(partTranspose.chromatic))
                fields.push(`chromatic=${Math.round(Number(partTranspose.chromatic))}`);
            if (Number.isFinite(partTranspose.diatonic))
                fields.push(`diatonic=${Math.round(Number(partTranspose.diatonic))}`);
            return fields.length > 1 ? fields.join(" ") : null;
        };
        const measureCommentsForVoice = (voiceId, targetStaffNo = null) => {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
            const out = [];
            const measures = Array.from(part.querySelectorAll(":scope > measure"));
            for (let mi = 0; mi < measures.length; mi += 1) {
                const measure = measures[mi];
                const fields = [`%@mks measure voice=${voiceId} measure=${mi + 1}`];
                const rawNo = (measure.getAttribute("number") || "").trim();
                if (rawNo)
                    fields.push(`number=${rawNo}`);
                const implicitRaw = (measure.getAttribute("implicit") || "").trim().toLowerCase();
                const isImplicit = implicitRaw === "yes" || implicitRaw === "true" || implicitRaw === "1";
                fields.push(`implicit=${isImplicit ? 1 : 0}`);
                const leftRepeat = measure.querySelector(':scope > barline[location="left"] > repeat[direction="forward"]');
                const rightRepeat = measure.querySelector(':scope > barline[location="right"] > repeat[direction="backward"]');
                const explicitTimeNode = measure.querySelector(":scope > attributes > time");
                const beats = Number.parseInt(((_a = explicitTimeNode === null || explicitTimeNode === void 0 ? void 0 : explicitTimeNode.querySelector(":scope > beats")) === null || _a === void 0 ? void 0 : _a.textContent) || "", 10);
                const beatType = Number.parseInt(((_b = explicitTimeNode === null || explicitTimeNode === void 0 ? void 0 : explicitTimeNode.querySelector(":scope > beat-type")) === null || _b === void 0 ? void 0 : _b.textContent) || "", 10);
                const hasLeftDouble = (((_c = measure.querySelector(':scope > barline[location="left"] > bar-style')) === null || _c === void 0 ? void 0 : _c.textContent) || "")
                    .trim()
                    .toLowerCase() === "light-light";
                const hasRightDouble = (((_d = measure.querySelector(':scope > barline[location="right"] > bar-style')) === null || _d === void 0 ? void 0 : _d.textContent) || "")
                    .trim()
                    .toLowerCase() === "light-light";
                if (leftRepeat) {
                    fields.push("repeat=forward");
                }
                else if (rightRepeat) {
                    fields.push("repeat=backward");
                    const times = Number.parseInt(((_e = measure.querySelector(':scope > barline[location="right"] > ending[type="stop"]')) === null || _e === void 0 ? void 0 : _e.getAttribute("number")) || "", 10);
                    if (Number.isFinite(times) && times > 1)
                        fields.push(`times=${times}`);
                }
                if (explicitTimeNode) {
                    fields.push("explicitTime=1");
                    if (Number.isFinite(beats) && beats > 0)
                        fields.push(`beats=${Math.round(beats)}`);
                    if (Number.isFinite(beatType) && beatType > 0)
                        fields.push(`beatType=${Math.round(beatType)}`);
                }
                if (hasLeftDouble && hasRightDouble) {
                    fields.push("doubleBar=both");
                }
                else if (hasLeftDouble) {
                    fields.push("doubleBar=left");
                }
                else if (hasRightDouble) {
                    fields.push("doubleBar=right");
                }
                out.push(fields.join(" "));
                const octaveShiftNodes = Array.from(measure.querySelectorAll(":scope > direction > direction-type > octave-shift"));
                for (const octaveShiftNode of octaveShiftNodes) {
                    const type = (octaveShiftNode.getAttribute("type") || "").trim().toLowerCase();
                    if (type !== "up" && type !== "down" && type !== "stop")
                        continue;
                    const octFields = [`%@mks octshift voice=${voiceId} measure=${mi + 1} type=${type}`];
                    const size = Number.parseInt(octaveShiftNode.getAttribute("size") || "", 10);
                    if (Number.isFinite(size) && size > 0)
                        octFields.push(`size=${Math.round(size)}`);
                    const number = Number.parseInt(octaveShiftNode.getAttribute("number") || "", 10);
                    if (Number.isFinite(number) && number > 0)
                        octFields.push(`number=${Math.round(number)}`);
                    out.push(octFields.join(" "));
                }
                let eventNo = 0;
                const children = Array.from(measure.children);
                for (let ci = 0; ci < children.length; ci += 1) {
                    const child = children[ci];
                    if (child.tagName !== "note")
                        continue;
                    if (targetStaffNo !== null) {
                        const noteStaff = Number.parseInt(((_f = child.querySelector(":scope > staff")) === null || _f === void 0 ? void 0 : _f.textContent) || "1", 10);
                        if (noteStaff !== targetStaffNo)
                            continue;
                    }
                    if (child.querySelector(":scope > chord"))
                        continue;
                    if (child.querySelector(":scope > rest"))
                        continue;
                    eventNo += 1;
                    const kinds = [];
                    if (child.querySelector(":scope > notations > articulations > staccato"))
                        kinds.push("staccato");
                    if (child.querySelector(":scope > notations > articulations > accent"))
                        kinds.push("accent");
                    if (kinds.length) {
                        out.push(`%@mks articul voice=${voiceId} measure=${mi + 1} event=${eventNo} kind=${kinds.join(",")}`);
                    }
                    const slurs = Array.from(child.querySelectorAll(":scope > notations > slur"));
                    for (const slur of slurs) {
                        const slurType = (slur.getAttribute("type") || "").trim().toLowerCase();
                        if (slurType !== "start" && slurType !== "stop")
                            continue;
                        const slurFields = [`%@mks slur voice=${voiceId} measure=${mi + 1} event=${eventNo} type=${slurType}`];
                        const slurNumber = Number.parseInt(slur.getAttribute("number") || "", 10);
                        if (Number.isFinite(slurNumber) && slurNumber > 0)
                            slurFields.push(`number=${Math.round(slurNumber)}`);
                        const slurPlacement = (slur.getAttribute("placement") || "").trim().toLowerCase();
                        if (slurPlacement === "above" || slurPlacement === "below")
                            slurFields.push(`placement=${slurPlacement}`);
                        out.push(slurFields.join(" "));
                    }
                    const trillMark = child.querySelector(":scope > notations > ornaments > trill-mark");
                    if (trillMark) {
                        out.push(`%@mks trill voice=${voiceId} measure=${mi + 1} event=${eventNo} mark=1`);
                    }
                    const wavyLines = Array.from(child.querySelectorAll(":scope > notations > ornaments > wavy-line"));
                    for (const wavy of wavyLines) {
                        const wavyType = (wavy.getAttribute("type") || "").trim().toLowerCase();
                        if (wavyType !== "start" && wavyType !== "stop")
                            continue;
                        const wavyFields = [`%@mks trill voice=${voiceId} measure=${mi + 1} event=${eventNo} wavy=${wavyType}`];
                        const wavyNumber = Number.parseInt(wavy.getAttribute("number") || "", 10);
                        if (Number.isFinite(wavyNumber) && wavyNumber > 0)
                            wavyFields.push(`number=${Math.round(wavyNumber)}`);
                        out.push(wavyFields.join(" "));
                    }
                    const accidentalText = ((_h = (_g = child.querySelector(":scope > accidental")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim().toLowerCase()) || "";
                    if (accidentalText) {
                        out.push(`%@mks accidental voice=${voiceId} measure=${mi + 1} event=${eventNo} value=${accidentalText}`);
                    }
                    const grace = child.querySelector(":scope > grace");
                    if (grace) {
                        out.push(`%@mks grace voice=${voiceId} measure=${mi + 1} event=${eventNo} slash=${grace.getAttribute("slash") === "yes" ? 1 : 0}`);
                    }
                    const timeMod = child.querySelector(":scope > time-modification");
                    const actualNotes = Number.parseInt(((_j = timeMod === null || timeMod === void 0 ? void 0 : timeMod.querySelector(":scope > actual-notes")) === null || _j === void 0 ? void 0 : _j.textContent) || "", 10);
                    const normalNotes = Number.parseInt(((_k = timeMod === null || timeMod === void 0 ? void 0 : timeMod.querySelector(":scope > normal-notes")) === null || _k === void 0 ? void 0 : _k.textContent) || "", 10);
                    const tupletNode = child.querySelector(":scope > notations > tuplet");
                    const tupletType = ((_l = tupletNode === null || tupletNode === void 0 ? void 0 : tupletNode.getAttribute("type")) === null || _l === void 0 ? void 0 : _l.trim().toLowerCase()) || "";
                    const tupletNumber = Number.parseInt((tupletNode === null || tupletNode === void 0 ? void 0 : tupletNode.getAttribute("number")) || "", 10);
                    const tupletFields = [`%@mks tuplet voice=${voiceId} measure=${mi + 1} event=${eventNo}`];
                    if (Number.isFinite(actualNotes) && actualNotes > 0)
                        tupletFields.push(`actual=${Math.round(actualNotes)}`);
                    if (Number.isFinite(normalNotes) && normalNotes > 0)
                        tupletFields.push(`normal=${Math.round(normalNotes)}`);
                    if (tupletType === "start")
                        tupletFields.push("start=1");
                    if (tupletType === "stop")
                        tupletFields.push("stop=1");
                    if (Number.isFinite(tupletNumber) && tupletNumber > 0)
                        tupletFields.push(`number=${Math.round(tupletNumber)}`);
                    if (tupletFields.length > 1)
                        out.push(tupletFields.join(" "));
                }
            }
            return out;
        };
        const declaredStaffNumbers = collectStaffNumbersForPart(part);
        const activeStaffNumbers = collectActiveStaffNumbersForPart(part);
        const staffNumbers = activeStaffNumbers.length ? activeStaffNumbers : declaredStaffNumbers.slice(0, 1);
        if (staffNumbers.length <= 1) {
            const staffNo = (_t = staffNumbers[0]) !== null && _t !== void 0 ? _t : 1;
            const body = buildLilyBodyFromPart(part, warnings, {
                targetStaffNo: staffNo,
                laneHintVoiceId: partId,
                laneHintCommentsOut: measureComments,
            });
            const clef = resolveLilyClefForPartStaff(part, staffNo);
            const clefPrefix = clef === "treble" ? "" : `\\clef ${clef} `;
            const withPartName = `\\with { instrumentName = "${xmlEscape(partName)}" }`;
            blocks.push(`\\new Staff = "${partId}" ${withPartName} { ${clefPrefix}${body} }`);
            const transposeComment = transposeCommentForVoice(partId);
            if (transposeComment)
                transposeComments.push(transposeComment);
            measureComments.push(...measureCommentsForVoice(partId, staffNo));
            continue;
        }
        const staffBlocks = staffNumbers.map((staffNo) => {
            const voiceId = `${partId}_s${staffNo}`;
            const body = buildLilyBodyFromPart(part, warnings, {
                targetStaffNo: staffNo,
                laneHintVoiceId: voiceId,
                laneHintCommentsOut: measureComments,
            });
            const clef = resolveLilyClefForPartStaff(part, staffNo);
            const clefPrefix = clef === "treble" ? "" : `\\clef ${clef} `;
            const transposeComment = transposeCommentForVoice(voiceId);
            if (transposeComment)
                transposeComments.push(transposeComment);
            measureComments.push(...measureCommentsForVoice(voiceId, staffNo));
            const withPartName = `\\with { instrumentName = "${xmlEscape(partName)}" }`;
            return `\\new Staff = "${partId}_s${staffNo}" ${withPartName} { ${clefPrefix}${body} }`;
        });
        blocks.push(`\\new PianoStaff = "${partId}" << ${staffBlocks.join(" ")} >>`);
    }
    const diagComments = [];
    for (const measure of Array.from(doc.querySelectorAll("score-partwise > part > measure"))) {
        const measureNo = (measure.getAttribute("number") || "").trim() || "1";
        for (const field of Array.from(measure.querySelectorAll(':scope > attributes > miscellaneous > miscellaneous-field[name^="mks:diag:"]'))) {
            const name = ((_u = field.getAttribute("name")) === null || _u === void 0 ? void 0 : _u.trim()) || "";
            if (!name)
                continue;
            const value = ((_v = field.textContent) === null || _v === void 0 ? void 0 : _v.trim()) || "";
            diagComments.push(`%@mks diag measure=${measureNo} name=${name} enc=uri-v1 value=${encodeURIComponent(value)}`);
        }
    }
    const warningCountByMessage = new Map();
    for (const warning of warnings) {
        warningCountByMessage.set(warning, ((_w = warningCountByMessage.get(warning)) !== null && _w !== void 0 ? _w : 0) + 1);
    }
    const warningComments = Array.from(warningCountByMessage.entries()).map(([warning, count]) => `%@mks diag name=diag:export value=${encodeURIComponent(`level=warn;code=LILYPOND_EXPORT_WARNING;fmt=lilypond;count=${count};message=${warning}`)}`);
    const head = [
        "\\version \"2.24.0\"",
        "\\header {",
        `  title = "${xmlEscape(title)}"`,
        composer ? `  composer = "${xmlEscape(composer)}"` : "",
        "}",
        `\\time ${Number.isFinite(beats) && beats > 0 ? beats : 4}/${Number.isFinite(beatType) && beatType > 0 ? beatType : 4}`,
        `\\key ${keyToken} \\${mode}`,
        ...transposeComments.map((line) => `% ${line}`),
        ...measureComments.map((line) => `% ${line}`),
        ...diagComments.map((line) => `% ${line}`),
        ...warningComments.map((line) => `% ${line}`),
        "\\score {",
        "  <<",
        ...blocks.map((line) => `    ${line}`),
        "  >>",
        "  \\layout { }",
        "}",
    ].filter(Boolean);
    return head.join("\n");
};
exports.exportMusicXmlDomToLilyPond = exportMusicXmlDomToLilyPond;

  },
  "src/ts/mei-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertMeiToMusicXml = exports.exportMusicXmlDomToMei = void 0;
const musicxml_io_1 = require("./musicxml-io");
const esc = (value) => String(value)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
const parseIntSafe = (value, fallback) => {
    const parsed = Number.parseInt(String(value !== null && value !== void 0 ? value : "").trim(), 10);
    return Number.isFinite(parsed) ? parsed : fallback;
};
const noteTypeToDur = (typeText) => {
    const normalized = String(typeText || "").trim().toLowerCase();
    switch (normalized) {
        case "maxima":
            return "maxima";
        case "long":
            return "long";
        case "breve":
            return "breve";
        case "whole":
            return "1";
        case "half":
            return "2";
        case "quarter":
            return "4";
        case "eighth":
            return "8";
        case "16th":
            return "16";
        case "32nd":
            return "32";
        case "64th":
            return "64";
        case "128th":
            return "128";
        default:
            return "4";
    }
};
const alterToAccid = (alterText) => {
    const alter = Number.parseInt(String(alterText !== null && alterText !== void 0 ? alterText : "").trim(), 10);
    if (!Number.isFinite(alter))
        return null;
    if (alter <= -2)
        return "ff";
    if (alter === -1)
        return "f";
    if (alter === 0)
        return "n";
    if (alter === 1)
        return "s";
    if (alter >= 2)
        return "ss";
    return null;
};
const musicXmlAccidentalToAccid = (accidentalText) => {
    const normalized = String(accidentalText !== null && accidentalText !== void 0 ? accidentalText : "").trim().toLowerCase();
    if (!normalized)
        return null;
    if (normalized === "sharp")
        return "s";
    if (normalized === "flat")
        return "f";
    if (normalized === "natural")
        return "n";
    if (normalized === "double-sharp" || normalized === "sharp-sharp")
        return "ss";
    if (normalized === "flat-flat" || normalized === "double-flat")
        return "ff";
    return null;
};
const fifthsToMeiKeySig = (fifths) => {
    if (!Number.isFinite(fifths) || fifths === 0)
        return "0";
    if (fifths > 0)
        return `${Math.min(7, Math.round(fifths))}s`;
    return `${Math.min(7, Math.abs(Math.round(fifths)))}f`;
};
const toPname = (stepText) => {
    const step = String(stepText || "").trim().toLowerCase();
    if (/^[a-g]$/.test(step))
        return step;
    return "c";
};
const lyricWordposFromSyllabic = (syllabicText) => {
    const v = String(syllabicText || "").trim().toLowerCase();
    if (v === "begin")
        return "i";
    if (v === "middle")
        return "m";
    if (v === "end")
        return "t";
    return "";
};
const lyricSyllabicFromWordpos = (wordposText) => {
    const v = String(wordposText || "").trim().toLowerCase();
    if (v === "i")
        return "begin";
    if (v === "m")
        return "middle";
    if (v === "t")
        return "end";
    return "single";
};
const extractMusicXmlLyric = (note) => {
    var _a, _b, _c, _d, _e, _f;
    const lyric = note.querySelector(":scope > lyric");
    if (!lyric)
        return null;
    const text = (_c = (_b = (_a = lyric.querySelector(":scope > text")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
    if (!text)
        return null;
    const syllabic = (_f = (_e = (_d = lyric.querySelector(":scope > syllabic")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
    return { text, syllabic };
};
const extractMeiLyric = (meiNote) => {
    var _a, _b;
    const syl = meiNote.querySelector(":scope > verse > syl");
    if (!syl)
        return null;
    const text = (_b = (_a = syl.textContent) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
    if (!text)
        return null;
    const syllabic = lyricSyllabicFromWordpos(syl.getAttribute("wordpos") || "");
    return { text, syllabic };
};
const readPartNameMap = (doc) => {
    var _a, _b, _c, _d, _e, _f;
    const map = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("score-partwise > part-list > score-part"))) {
        const id = (_b = (_a = scorePart.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!id)
            continue;
        const name = ((_d = (_c = scorePart.querySelector(":scope > part-name")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) ||
            ((_f = (_e = scorePart.querySelector(":scope > part-abbreviation")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) ||
            id;
        map.set(id, name);
    }
    return map;
};
const detectStaffCountForPart = (part) => {
    let maxStaff = 1;
    for (const stavesEl of Array.from(part.querySelectorAll(":scope > measure > attributes > staves"))) {
        maxStaff = Math.max(maxStaff, parseIntSafe(stavesEl.textContent, 1));
    }
    for (const staffEl of Array.from(part.querySelectorAll(":scope > measure > note > staff"))) {
        maxStaff = Math.max(maxStaff, parseIntSafe(staffEl.textContent, 1));
    }
    return Math.max(1, maxStaff);
};
const collectStaffSlots = (doc) => {
    var _a, _b, _c;
    const partNameMap = readPartNameMap(doc);
    const slots = [];
    let global = 1;
    for (const part of Array.from(doc.querySelectorAll("score-partwise > part"))) {
        const partId = (_b = (_a = part.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!partId)
            continue;
        const partName = (_c = partNameMap.get(partId)) !== null && _c !== void 0 ? _c : partId;
        const count = detectStaffCountForPart(part);
        for (let staffNo = 1; staffNo <= count; staffNo += 1) {
            slots.push({
                partId,
                localStaff: staffNo,
                globalStaff: global,
                label: count > 1 ? `${partName} (${staffNo})` : partName,
            });
            global += 1;
        }
    }
    return slots;
};
const resolveClefForSlot = (part, localStaff) => {
    var _a, _b, _c;
    if (!part)
        return { shape: "G", line: 2 };
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const clefs = Array.from(measure.querySelectorAll(":scope > attributes > clef"));
        for (const clef of clefs) {
            const numberText = clef.getAttribute("number");
            const applies = numberText === null
                ? localStaff === 1
                : parseIntSafe(numberText, 1) === localStaff;
            if (!applies)
                continue;
            const sign = (((_b = (_a = clef.querySelector(":scope > sign")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || "G").toUpperCase();
            const line = parseIntSafe((_c = clef.querySelector(":scope > line")) === null || _c === void 0 ? void 0 : _c.textContent, 2);
            return { shape: sign, line };
        }
    }
    return { shape: "G", line: 2 };
};
const resolveTransposeForSlot = (part, localStaff) => {
    var _a, _b;
    if (!part)
        return null;
    for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
        const attrs = Array.from(measure.querySelectorAll(":scope > attributes"));
        for (const attr of attrs) {
            const transpose = attr.querySelector(":scope > transpose");
            if (!transpose)
                continue;
            const chromatic = parseIntSafe((_a = transpose.querySelector(":scope > chromatic")) === null || _a === void 0 ? void 0 : _a.textContent, NaN);
            const diatonic = parseIntSafe((_b = transpose.querySelector(":scope > diatonic")) === null || _b === void 0 ? void 0 : _b.textContent, NaN);
            const out = {};
            if (Number.isFinite(chromatic))
                out.chromatic = Math.round(chromatic);
            if (Number.isFinite(diatonic))
                out.diatonic = Math.round(diatonic);
            if (Object.keys(out).length > 0)
                return out;
        }
        if (localStaff === 1)
            break;
    }
    return null;
};
const toMksDur480 = (durationTicks, sourceDivisions) => {
    const base = Math.max(1, Math.round(sourceDivisions));
    return Math.max(1, Math.round((durationTicks * 480) / base));
};
const extractMeiTieFromMusicXmlNote = (note) => {
    const tieTypes = Array.from(note.querySelectorAll(":scope > tie"))
        .map((node) => (node.getAttribute("type") || "").trim().toLowerCase())
        .filter(Boolean);
    const hasStart = tieTypes.includes("start");
    const hasStop = tieTypes.includes("stop");
    if (hasStart && hasStop)
        return "m";
    if (hasStart)
        return "i";
    if (hasStop)
        return "t";
    return "";
};
const extractMeiSlurFromMusicXmlNote = (note) => {
    const slurNodes = Array.from(note.querySelectorAll(":scope > notations > slur"));
    if (slurNodes.length === 0)
        return "";
    const tokens = [];
    for (const slur of slurNodes) {
        const type = (slur.getAttribute("type") || "").trim().toLowerCase();
        const number = Math.max(1, parseIntSafe(slur.getAttribute("number"), 1));
        if (type === "start")
            tokens.push(`i${number}`);
        if (type === "stop")
            tokens.push(`t${number}`);
    }
    return tokens.join(" ");
};
const buildSimplePitchNote = (note, sourceDivisions, includeGraceAttr = true) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
    const typeText = (_c = (_b = (_a = note.querySelector(":scope > type")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "quarter";
    const dur = noteTypeToDur(typeText);
    const dots = note.querySelectorAll(":scope > dot").length;
    const step = (_f = (_e = (_d = note.querySelector(":scope > pitch > step")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "C";
    const octaveText = (_j = (_h = (_g = note.querySelector(":scope > pitch > octave")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "4";
    const alterText = (_l = (_k = note.querySelector(":scope > pitch > alter")) === null || _k === void 0 ? void 0 : _k.textContent) !== null && _l !== void 0 ? _l : null;
    const explicitAccid = musicXmlAccidentalToAccid((_o = (_m = note.querySelector(":scope > accidental")) === null || _m === void 0 ? void 0 : _m.textContent) !== null && _o !== void 0 ? _o : null);
    const accid = explicitAccid !== null && explicitAccid !== void 0 ? explicitAccid : alterToAccid(alterText);
    const attrs = [
        `pname="${esc(toPname(step))}"`,
        `oct="${esc(octaveText)}"`,
        `dur="${esc(dur)}"`,
    ];
    const durationTicks = parseIntSafe((_p = note.querySelector(":scope > duration")) === null || _p === void 0 ? void 0 : _p.textContent, NaN);
    if (Number.isFinite(durationTicks) && durationTicks > 0) {
        attrs.push(`mks-dur-480="${toMksDur480(durationTicks, sourceDivisions)}"`);
        attrs.push(`mks-dur-div="${Math.max(1, Math.round(sourceDivisions))}"`);
        attrs.push(`mks-dur-ticks="${Math.round(durationTicks)}"`);
    }
    const actual = parseIntSafe((_q = note.querySelector(":scope > time-modification > actual-notes")) === null || _q === void 0 ? void 0 : _q.textContent, NaN);
    const normal = parseIntSafe((_r = note.querySelector(":scope > time-modification > normal-notes")) === null || _r === void 0 ? void 0 : _r.textContent, NaN);
    const hasTupletStart = note.querySelector(':scope > notations > tuplet[type="start"]') !== null;
    const hasTupletStop = note.querySelector(':scope > notations > tuplet[type="stop"]') !== null;
    const arts = [];
    if (note.querySelector(":scope > notations > articulations > staccato"))
        arts.push("stacc");
    if (note.querySelector(":scope > notations > articulations > accent"))
        arts.push("acc");
    if (dots > 0)
        attrs.push(`dots="${dots}"`);
    if (accid)
        attrs.push(`accid="${accid}"`);
    if (Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0) {
        attrs.push(`num="${Math.round(actual)}"`);
        attrs.push(`numbase="${Math.round(normal)}"`);
    }
    if (hasTupletStart)
        attrs.push('mks-tuplet-start="1"');
    if (hasTupletStop)
        attrs.push('mks-tuplet-stop="1"');
    if (includeGraceAttr && note.querySelector(":scope > grace")) {
        const slash = ((_t = (_s = note.querySelector(":scope > grace")) === null || _s === void 0 ? void 0 : _s.getAttribute("slash")) !== null && _t !== void 0 ? _t : "").trim().toLowerCase() === "yes";
        attrs.push(`grace="${slash ? "acc" : "unacc"}"`);
    }
    const tieAttr = extractMeiTieFromMusicXmlNote(note);
    if (tieAttr)
        attrs.push(`tie="${esc(tieAttr)}"`);
    const slurAttr = extractMeiSlurFromMusicXmlNote(note);
    if (slurAttr)
        attrs.push(`slur="${esc(slurAttr)}"`);
    if (arts.length)
        attrs.push(`artic="${esc(arts.join(" "))}"`);
    const lyric = extractMusicXmlLyric(note);
    if (lyric) {
        const wordpos = lyricWordposFromSyllabic(lyric.syllabic);
        const wordposAttr = wordpos ? ` wordpos="${esc(wordpos)}"` : "";
        return `<note ${attrs.join(" ")}><verse n="1"><syl${wordposAttr}>${esc(lyric.text)}</syl></verse></note>`;
    }
    return `<note ${attrs.join(" ")}/>`;
};
const buildSimpleRest = (note, sourceDivisions) => {
    var _a, _b, _c, _d;
    const typeText = (_c = (_b = (_a = note.querySelector(":scope > type")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "quarter";
    const dur = noteTypeToDur(typeText);
    const dots = note.querySelectorAll(":scope > dot").length;
    const attrs = [`dur="${esc(dur)}"`];
    const durationTicks = parseIntSafe((_d = note.querySelector(":scope > duration")) === null || _d === void 0 ? void 0 : _d.textContent, NaN);
    if (Number.isFinite(durationTicks) && durationTicks > 0) {
        attrs.push(`mks-dur-480="${toMksDur480(durationTicks, sourceDivisions)}"`);
        attrs.push(`mks-dur-div="${Math.max(1, Math.round(sourceDivisions))}"`);
        attrs.push(`mks-dur-ticks="${Math.round(durationTicks)}"`);
    }
    if (dots > 0)
        attrs.push(`dots="${dots}"`);
    const isInvisible = (note.getAttribute("print-object") || "").trim().toLowerCase() === "no";
    return `<${isInvisible ? "space" : "rest"} ${attrs.join(" ")}/>`;
};
const gatherMeasureNumbers = (parts) => {
    var _a;
    const out = [];
    for (const part of parts) {
        for (const measure of Array.from(part.querySelectorAll(":scope > measure"))) {
            const number = ((_a = measure.getAttribute("number")) === null || _a === void 0 ? void 0 : _a.trim()) || String(out.length + 1);
            if (!out.includes(number))
                out.push(number);
        }
    }
    return out;
};
const voiceSort = (a, b) => {
    const ai = Number.parseInt(a, 10);
    const bi = Number.parseInt(b, 10);
    if (Number.isFinite(ai) && Number.isFinite(bi))
        return ai - bi;
    return a.localeCompare(b);
};
const buildLayerContent = (notes, sourceDivisions, measureTicks) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const pitchNotes = notes.filter((n) => !n.querySelector(":scope > rest"));
    const simpleRests = notes.filter((n) => n.querySelector(":scope > rest"));
    if (pitchNotes.length === 0 && simpleRests.length === 1 && notes.length === 1) {
        const only = simpleRests[0];
        const isGrace = only.querySelector(":scope > grace") !== null;
        const durationTicks = parseIntSafe((_a = only.querySelector(":scope > duration")) === null || _a === void 0 ? void 0 : _a.textContent, 0);
        if (!isGrace && durationTicks === measureTicks && measureTicks > 0) {
            const isInvisible = (only.getAttribute("print-object") || "").trim().toLowerCase() === "no";
            const tagName = isInvisible ? "mSpace" : "mRest";
            const inferred = inferMeiDurAndDotsFromTicks(measureTicks, sourceDivisions);
            const dotsAttr = inferred.dots > 0 ? ` dots="${inferred.dots}"` : "";
            return `<${tagName} dur="${inferred.dur}"${dotsAttr} mks-dur-480="${toMksDur480(measureTicks, sourceDivisions)}" mks-dur-div="${Math.max(1, Math.round(sourceDivisions))}" mks-dur-ticks="${Math.round(measureTicks)}"/>`;
        }
    }
    const out = [];
    for (let i = 0; i < notes.length; i += 1) {
        const note = notes[i];
        const isRest = Boolean(note.querySelector(":scope > rest"));
        const hasChordFlag = Boolean(note.querySelector(":scope > chord"));
        const isGracePitchNote = !isRest && !hasChordFlag && note.querySelector(":scope > grace") !== null;
        if (isGracePitchNote) {
            const graceGroup = [note];
            let hasSlash = ((_c = (_b = note.querySelector(":scope > grace")) === null || _b === void 0 ? void 0 : _b.getAttribute("slash")) !== null && _c !== void 0 ? _c : "").trim().toLowerCase() === "yes";
            for (let j = i + 1; j < notes.length; j += 1) {
                const next = notes[j];
                const nextIsRest = Boolean(next.querySelector(":scope > rest"));
                const nextHasChordFlag = Boolean(next.querySelector(":scope > chord"));
                const nextIsGracePitch = !nextIsRest && !nextHasChordFlag && next.querySelector(":scope > grace") !== null;
                if (!nextIsGracePitch)
                    break;
                graceGroup.push(next);
                hasSlash = hasSlash || ((_e = (_d = next.querySelector(":scope > grace")) === null || _d === void 0 ? void 0 : _d.getAttribute("slash")) !== null && _e !== void 0 ? _e : "").trim().toLowerCase() === "yes";
                i = j;
            }
            const members = graceGroup.map((g) => buildSimplePitchNote(g, sourceDivisions, false)).join("");
            out.push(`<graceGrp slash="${hasSlash ? "yes" : "no"}">${members}</graceGrp>`);
            continue;
        }
        if (isRest || hasChordFlag) {
            if (isRest)
                out.push(buildSimpleRest(note, sourceDivisions));
            else
                out.push(buildSimplePitchNote(note, sourceDivisions));
            continue;
        }
        const chordNotes = [note];
        for (let j = i + 1; j < notes.length; j += 1) {
            const next = notes[j];
            if (!next.querySelector(":scope > chord"))
                break;
            chordNotes.push(next);
            i = j;
        }
        if (chordNotes.length === 1) {
            out.push(buildSimplePitchNote(note, sourceDivisions));
            continue;
        }
        const typeText = (_h = (_g = (_f = note.querySelector(":scope > type")) === null || _f === void 0 ? void 0 : _f.textContent) === null || _g === void 0 ? void 0 : _g.trim()) !== null && _h !== void 0 ? _h : "quarter";
        const dur = noteTypeToDur(typeText);
        const dots = note.querySelectorAll(":scope > dot").length;
        const chordAttrs = [`dur="${esc(dur)}"`];
        const chordDurationTicks = parseIntSafe((_j = note.querySelector(":scope > duration")) === null || _j === void 0 ? void 0 : _j.textContent, NaN);
        if (Number.isFinite(chordDurationTicks) && chordDurationTicks > 0) {
            chordAttrs.push(`mks-dur-480="${toMksDur480(chordDurationTicks, sourceDivisions)}"`);
            chordAttrs.push(`mks-dur-div="${Math.max(1, Math.round(sourceDivisions))}"`);
            chordAttrs.push(`mks-dur-ticks="${Math.round(chordDurationTicks)}"`);
        }
        if (dots > 0)
            chordAttrs.push(`dots="${dots}"`);
        const members = chordNotes.map((n) => {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
            const step = (_c = (_b = (_a = n.querySelector(":scope > pitch > step")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "C";
            const octaveText = (_f = (_e = (_d = n.querySelector(":scope > pitch > octave")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "4";
            const alterText = (_h = (_g = n.querySelector(":scope > pitch > alter")) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : null;
            const explicitAccid = musicXmlAccidentalToAccid((_k = (_j = n.querySelector(":scope > accidental")) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : null);
            const accid = explicitAccid !== null && explicitAccid !== void 0 ? explicitAccid : alterToAccid(alterText);
            const noteAttrs = [
                `pname="${esc(toPname(step))}"`,
                `oct="${esc(octaveText)}"`,
            ];
            if (accid)
                noteAttrs.push(`accid="${accid}"`);
            const tieAttr = extractMeiTieFromMusicXmlNote(n);
            if (tieAttr)
                noteAttrs.push(`tie="${esc(tieAttr)}"`);
            const slurAttr = extractMeiSlurFromMusicXmlNote(n);
            if (slurAttr)
                noteAttrs.push(`slur="${esc(slurAttr)}"`);
            const lyric = extractMusicXmlLyric(n);
            if (lyric) {
                const wordpos = lyricWordposFromSyllabic(lyric.syllabic);
                const wordposAttr = wordpos ? ` wordpos="${esc(wordpos)}"` : "";
                return `<note ${noteAttrs.join(" ")}><verse n="1"><syl${wordposAttr}>${esc(lyric.text)}</syl></verse></note>`;
            }
            return `<note ${noteAttrs.join(" ")}/>`;
        });
        out.push(`<chord ${chordAttrs.join(" ")}>${members.join("")}</chord>`);
    }
    return out.join("");
};
const extractMiscellaneousFieldsFromMeasure = (measure) => {
    var _a, _b, _c, _d;
    const out = [];
    const fields = Array.from(measure.querySelectorAll(":scope > attributes > miscellaneous > miscellaneous-field"));
    for (const field of fields) {
        const name = (_b = (_a = field.getAttribute("name")) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
        if (!name)
            continue;
        out.push({
            name,
            value: (_d = (_c = field.textContent) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "",
        });
    }
    return out;
};
const encodeMeasureMetaForMei = (measure) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const rawNo = ((_a = measure.getAttribute("number")) !== null && _a !== void 0 ? _a : "").trim();
    const implicitRaw = ((_b = measure.getAttribute("implicit")) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
    const isImplicit = implicitRaw === "yes" || implicitRaw === "true" || implicitRaw === "1";
    const leftRepeat = measure.querySelector(':scope > barline[location="left"] > repeat[direction="forward"]');
    const rightRepeat = measure.querySelector(':scope > barline[location="right"] > repeat[direction="backward"]');
    const repeat = rightRepeat ? "backward" : (leftRepeat ? "forward" : "");
    const times = Number.parseInt((_d = (_c = measure.querySelector(':scope > barline[location="right"] > ending[type="stop"]')) === null || _c === void 0 ? void 0 : _c.getAttribute("number")) !== null && _d !== void 0 ? _d : "", 10);
    const explicitTime = measure.querySelector(":scope > attributes > time") !== null;
    const beats = parseIntSafe((_e = measure.querySelector(":scope > attributes > time > beats")) === null || _e === void 0 ? void 0 : _e.textContent, NaN);
    const beatType = parseIntSafe((_f = measure.querySelector(":scope > attributes > time > beat-type")) === null || _f === void 0 ? void 0 : _f.textContent, NaN);
    const hasLeftDouble = (((_h = (_g = measure.querySelector(':scope > barline[location="left"] > bar-style')) === null || _g === void 0 ? void 0 : _g.textContent) !== null && _h !== void 0 ? _h : "")
        .trim()
        .toLowerCase()) === "light-light";
    const hasRightDouble = (((_k = (_j = measure.querySelector(':scope > barline[location="right"] > bar-style')) === null || _j === void 0 ? void 0 : _j.textContent) !== null && _k !== void 0 ? _k : "")
        .trim()
        .toLowerCase()) === "light-light";
    const doubleBar = hasLeftDouble && hasRightDouble ? "both" : hasLeftDouble ? "left" : hasRightDouble ? "right" : "";
    const parts = [];
    if (rawNo)
        parts.push(`number=${rawNo}`);
    if (isImplicit)
        parts.push("implicit=1");
    if (repeat)
        parts.push(`repeat=${repeat}`);
    if (Number.isFinite(times) && times > 1)
        parts.push(`times=${Math.round(times)}`);
    if (explicitTime) {
        parts.push("explicitTime=1");
        if (Number.isFinite(beats) && beats > 0)
            parts.push(`beats=${Math.round(beats)}`);
        if (Number.isFinite(beatType) && beatType > 0)
            parts.push(`beatType=${Math.round(beatType)}`);
    }
    if (doubleBar)
        parts.push(`doubleBar=${doubleBar}`);
    return parts.length ? parts.join(";") : null;
};
const accidentalTextFromAlter = (alter) => {
    if (!Number.isFinite(alter) || alter === 0)
        return "";
    if (alter === 1)
        return "#";
    if (alter === -1)
        return "b";
    if (alter === 2)
        return "##";
    if (alter === -2)
        return "bb";
    return "";
};
const suffixFromHarmonyKind = (kindNode) => {
    if (!kindNode)
        return { suffix: "", fromText: false };
    const textAttr = (kindNode.getAttribute("text") || "").trim();
    if (textAttr)
        return { suffix: textAttr, fromText: true };
    const kind = (kindNode.textContent || "").trim().toLowerCase();
    if (kind === "major")
        return { suffix: "", fromText: false };
    if (kind === "minor")
        return { suffix: "m", fromText: false };
    if (kind === "dominant")
        return { suffix: "7", fromText: false };
    if (kind === "major-seventh")
        return { suffix: "maj7", fromText: false };
    if (kind === "minor-seventh")
        return { suffix: "m7", fromText: false };
    if (kind === "diminished")
        return { suffix: "dim", fromText: false };
    if (kind === "augmented")
        return { suffix: "aug", fromText: false };
    return { suffix: kind && kind !== "other" ? kind : "", fromText: false };
};
const degreeSuffixFromHarmony = (harmony) => {
    var _a, _b;
    const out = [];
    for (const degree of Array.from(harmony.querySelectorAll(":scope > degree"))) {
        const value = Number.parseInt(((_a = degree.querySelector(":scope > degree-value")) === null || _a === void 0 ? void 0 : _a.textContent) || "", 10);
        const alter = Number.parseInt(((_b = degree.querySelector(":scope > degree-alter")) === null || _b === void 0 ? void 0 : _b.textContent) || "", 10);
        if (!Number.isFinite(value) || !Number.isFinite(alter) || alter === 0)
            continue;
        out.push(`${accidentalTextFromAlter(alter)}${Math.round(value)}`);
    }
    return out.join("");
};
const offsetTicksToTstamp = (offsetTicks, divisions, beatType) => {
    const ticksPerBeat = Math.max(1, (4 * Math.max(1, divisions)) / Math.max(1, beatType));
    const beatPos = 1 + (Math.max(0, offsetTicks) / ticksPerBeat);
    const rounded = Math.round(beatPos * 1000) / 1000;
    return String(rounded).replace(/\.0+$/, "").replace(/(\.\d*?)0+$/, "$1");
};
const buildMeiHarmFromMusicXmlHarmony = (harmony, sourceDivisions, beatType) => {
    var _a, _b, _c, _d, _e;
    const rootStep = (((_a = harmony.querySelector(":scope > root > root-step")) === null || _a === void 0 ? void 0 : _a.textContent) || "").trim().toUpperCase();
    if (!/^[A-G]$/.test(rootStep))
        return null;
    const rootAlter = Number.parseInt(((_b = harmony.querySelector(":scope > root > root-alter")) === null || _b === void 0 ? void 0 : _b.textContent) || "0", 10);
    const kindNode = harmony.querySelector(":scope > kind");
    const kindSuffix = suffixFromHarmonyKind(kindNode);
    const suffix = `${kindSuffix.suffix}${kindSuffix.fromText ? "" : degreeSuffixFromHarmony(harmony)}`;
    const bassStep = (((_c = harmony.querySelector(":scope > bass > bass-step")) === null || _c === void 0 ? void 0 : _c.textContent) || "").trim().toUpperCase();
    const bassAlter = Number.parseInt(((_d = harmony.querySelector(":scope > bass > bass-alter")) === null || _d === void 0 ? void 0 : _d.textContent) || "0", 10);
    const chordText = `${rootStep}${accidentalTextFromAlter(rootAlter)}${suffix}${/^[A-G]$/.test(bassStep) ? `/${bassStep}${accidentalTextFromAlter(bassAlter)}` : ""}`;
    if (!chordText)
        return null;
    const offsetTicks = parseIntSafe((_e = harmony.querySelector(":scope > offset")) === null || _e === void 0 ? void 0 : _e.textContent, 0);
    const tstamp = offsetTicks > 0 ? offsetTicksToTstamp(offsetTicks, sourceDivisions, beatType) : "1";
    return `<harm tstamp="${esc(tstamp)}">${esc(chordText)}</harm>`;
};
const collectMeiHarmsForStaff = (measure, localStaff, sourceDivisions, beatType) => {
    var _a;
    const out = [];
    for (const harmony of Array.from(measure.querySelectorAll(":scope > harmony"))) {
        const staffNo = parseIntSafe((_a = harmony.querySelector(":scope > staff")) === null || _a === void 0 ? void 0 : _a.textContent, 1);
        if (staffNo !== localStaff)
            continue;
        const harm = buildMeiHarmFromMusicXmlHarmony(harmony, sourceDivisions, beatType);
        if (harm)
            out.push(harm);
    }
    return out;
};
const directionOffsetTicks = (direction) => {
    var _a;
    return Math.max(0, parseIntSafe((_a = direction.querySelector(":scope > offset")) === null || _a === void 0 ? void 0 : _a.textContent, 0));
};
const directionTstamp = (direction, divisions, beatType) => {
    return offsetTicksToTstamp(directionOffsetTicks(direction), divisions, beatType);
};
const directionStaffMatches = (direction, localStaff) => {
    var _a;
    const staffNo = parseIntSafe((_a = direction.querySelector(":scope > staff")) === null || _a === void 0 ? void 0 : _a.textContent, 1);
    return staffNo === localStaff;
};
const collectMeiDirectionControlsForStaff = (measure, localStaff, sourceDivisions, beatType) => {
    var _a, _b;
    const out = [];
    const directions = Array.from(measure.querySelectorAll(":scope > direction")).filter((direction) => directionStaffMatches(direction, localStaff));
    for (const direction of directions) {
        const placement = (direction.getAttribute("placement") || "").trim().toLowerCase();
        const placeAttr = placement === "above" || placement === "below" ? ` place="${esc(placement)}"` : "";
        const tstamp = directionTstamp(direction, sourceDivisions, beatType);
        const dynamicsNode = direction.querySelector(":scope > direction-type > dynamics");
        if (dynamicsNode) {
            const symbol = Array.from(dynamicsNode.children)
                .map((child) => localNameOf(child))
                .find((name) => !!name);
            if (symbol) {
                out.push(`<dynam tstamp="${esc(tstamp)}"${placeAttr}>${esc(symbol)}</dynam>`);
                continue;
            }
        }
        const words = (((_a = direction.querySelector(":scope > direction-type > words")) === null || _a === void 0 ? void 0 : _a.textContent) || "").trim();
        if (words) {
            out.push(`<dynam tstamp="${esc(tstamp)}"${placeAttr}>${esc(words)}</dynam>`);
        }
    }
    const pendingByNumber = new Map();
    for (const direction of directions) {
        const wedge = direction.querySelector(":scope > direction-type > wedge");
        if (!wedge)
            continue;
        const type = (wedge.getAttribute("type") || "").trim().toLowerCase();
        const number = (wedge.getAttribute("number") || "1").trim() || "1";
        const tstamp = directionTstamp(direction, sourceDivisions, beatType);
        const placement = (direction.getAttribute("placement") || "").trim().toLowerCase();
        const placeAttr = placement === "above" || placement === "below" ? ` place="${esc(placement)}"` : "";
        if (type === "crescendo" || type === "diminuendo") {
            pendingByNumber.set(number, { tstamp, form: type === "diminuendo" ? "dim" : "cres", placeAttr });
            continue;
        }
        if (type === "stop") {
            const pending = pendingByNumber.get(number);
            if (!pending)
                continue;
            out.push(`<hairpin form="${pending.form}" tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"${pending.placeAttr}/>`);
            pendingByNumber.delete(number);
        }
    }
    for (const pending of pendingByNumber.values()) {
        out.push(`<hairpin form="${pending.form}" tstamp="${esc(pending.tstamp)}"${pending.placeAttr}/>`);
    }
    const pendingPedalByNumber = new Map();
    for (const direction of directions) {
        const pedal = direction.querySelector(":scope > direction-type > pedal");
        if (!pedal)
            continue;
        const type = (pedal.getAttribute("type") || "").trim().toLowerCase();
        const number = (pedal.getAttribute("number") || "1").trim() || "1";
        const tstamp = directionTstamp(direction, sourceDivisions, beatType);
        const placement = (direction.getAttribute("placement") || "").trim().toLowerCase();
        const placeAttr = placement === "above" || placement === "below" ? ` place="${esc(placement)}"` : "";
        if (type === "start" || type === "resume" || type === "change") {
            pendingPedalByNumber.set(number, { tstamp, placeAttr });
            continue;
        }
        if (type === "stop" || type === "discontinue") {
            const pending = pendingPedalByNumber.get(number);
            if (pending) {
                out.push(`<pedal tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"${pending.placeAttr}/>`);
                pendingPedalByNumber.delete(number);
            }
            else {
                out.push(`<pedal tstamp="${esc(tstamp)}" type="stop"${placeAttr}/>`);
            }
        }
    }
    for (const pending of pendingPedalByNumber.values()) {
        out.push(`<pedal tstamp="${esc(pending.tstamp)}"${pending.placeAttr}/>`);
    }
    const pendingOctaveByNumber = new Map();
    for (const direction of directions) {
        const octave = direction.querySelector(":scope > direction-type > octave-shift");
        if (!octave)
            continue;
        const type = (octave.getAttribute("type") || "").trim().toLowerCase();
        const number = (octave.getAttribute("number") || "1").trim() || "1";
        const size = parseIntSafe(octave.getAttribute("size"), 8);
        const dis = Math.max(1, Math.round(size));
        const disPlace = type === "down" ? "below" : "above";
        const tstamp = directionTstamp(direction, sourceDivisions, beatType);
        const placement = (direction.getAttribute("placement") || "").trim().toLowerCase();
        const placeAttr = placement === "above" || placement === "below" ? ` place="${esc(placement)}"` : "";
        if (type === "up" || type === "down") {
            pendingOctaveByNumber.set(number, { tstamp, dis, disPlace, placeAttr });
            continue;
        }
        if (type === "stop" || type === "continue") {
            const pending = pendingOctaveByNumber.get(number);
            if (pending) {
                out.push(`<octave dis="${pending.dis}" dis.place="${pending.disPlace}" tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"${pending.placeAttr}/>`);
                pendingOctaveByNumber.delete(number);
            }
            else {
                out.push(`<octave dis="${dis}" tstamp="${esc(tstamp)}" type="stop"${placeAttr}/>`);
            }
        }
    }
    for (const pending of pendingOctaveByNumber.values()) {
        out.push(`<octave dis="${pending.dis}" dis.place="${pending.disPlace}" tstamp="${esc(pending.tstamp)}"${pending.placeAttr}/>`);
    }
    for (const direction of directions) {
        const tstamp = directionTstamp(direction, sourceDivisions, beatType);
        const placement = (direction.getAttribute("placement") || "").trim().toLowerCase();
        const placeAttr = placement === "above" || placement === "below" ? ` place="${esc(placement)}"` : "";
        const segno = direction.querySelector(":scope > direction-type > segno");
        if (segno) {
            out.push(`<repeatMark tstamp="${esc(tstamp)}"${placeAttr}>segno</repeatMark>`);
            continue;
        }
        const coda = direction.querySelector(":scope > direction-type > coda");
        if (coda) {
            out.push(`<repeatMark tstamp="${esc(tstamp)}"${placeAttr}>coda</repeatMark>`);
            continue;
        }
        const words = (((_b = direction.querySelector(":scope > direction-type > words")) === null || _b === void 0 ? void 0 : _b.textContent) || "").trim();
        if (!words)
            continue;
        const lowered = words.toLowerCase();
        if (lowered === "fine"
            || lowered === "d.c."
            || lowered === "da capo"
            || lowered === "d.s."
            || lowered === "dal segno") {
            out.push(`<repeatMark tstamp="${esc(tstamp)}"${placeAttr}>${esc(words)}</repeatMark>`);
        }
    }
    return out;
};
const collectStaffTimelineForExport = (measure, localStaff, divisions) => {
    var _a, _b, _c, _d;
    const out = [];
    let cursor = 0;
    for (const child of Array.from(measure.children)) {
        const name = localNameOf(child);
        if (name === "backup") {
            const dur = parseIntSafe((_a = child.querySelector(":scope > duration")) === null || _a === void 0 ? void 0 : _a.textContent, 0);
            cursor = Math.max(0, cursor - Math.max(0, dur));
            continue;
        }
        if (name === "forward") {
            const dur = parseIntSafe((_b = child.querySelector(":scope > duration")) === null || _b === void 0 ? void 0 : _b.textContent, 0);
            cursor += Math.max(0, dur);
            continue;
        }
        if (name !== "note")
            continue;
        const note = child;
        const staffNo = parseIntSafe((_c = note.querySelector(":scope > staff")) === null || _c === void 0 ? void 0 : _c.textContent, 1);
        const isChordContinuation = note.querySelector(":scope > chord") !== null;
        const dur = parseIntSafe((_d = note.querySelector(":scope > duration")) === null || _d === void 0 ? void 0 : _d.textContent, 0);
        if (staffNo === localStaff) {
            out.push({ note, onset: cursor });
        }
        if (!isChordContinuation) {
            cursor += Math.max(0, dur);
        }
    }
    return out;
};
const collectMeiGlissSlideControlsForStaff = (measure, localStaff, divisions, beatType) => {
    const out = [];
    const timeline = collectStaffTimelineForExport(measure, localStaff, divisions);
    const pendingByKey = new Map();
    for (const item of timeline) {
        const note = item.note;
        const tstamp = offsetTicksToTstamp(item.onset, divisions, beatType);
        const notations = note.querySelectorAll(":scope > notations > glissando, :scope > notations > slide");
        for (const node of Array.from(notations)) {
            const kind = localNameOf(node) === "slide" ? "slide" : "gliss";
            const type = (node.getAttribute("type") || "").trim().toLowerCase();
            const number = (node.getAttribute("number") || "1").trim() || "1";
            const key = `${kind}:${number}`;
            if (type === "start") {
                pendingByKey.set(key, { kind, tstamp });
            }
            else if (type === "stop") {
                const pending = pendingByKey.get(key);
                if (pending) {
                    out.push(`<${pending.kind} tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"/>`);
                    pendingByKey.delete(key);
                }
                else {
                    out.push(`<${kind} tstamp="${esc(tstamp)}"/>`);
                }
            }
        }
    }
    for (const pending of pendingByKey.values()) {
        out.push(`<${pending.kind} tstamp="${esc(pending.tstamp)}"/>`);
    }
    return out;
};
const tiePitchKeyFromMusicXmlNote = (note) => {
    var _a, _b, _c, _d;
    const pitch = note.querySelector(":scope > pitch");
    if (!pitch)
        return null;
    const step = (((_a = pitch.querySelector(":scope > step")) === null || _a === void 0 ? void 0 : _a.textContent) || "").trim().toUpperCase();
    const octave = (((_b = pitch.querySelector(":scope > octave")) === null || _b === void 0 ? void 0 : _b.textContent) || "").trim();
    const alter = (((_c = pitch.querySelector(":scope > alter")) === null || _c === void 0 ? void 0 : _c.textContent) || "0").trim();
    if (!/^[A-G]$/.test(step) || !/^-?\d+$/.test(octave))
        return null;
    const voice = (((_d = note.querySelector(":scope > voice")) === null || _d === void 0 ? void 0 : _d.textContent) || "1").trim() || "1";
    return `${step}:${alter}:${octave}:v${voice}`;
};
const collectMeiTieSlurControlsForStaff = (measure, localStaff, divisions, beatType) => {
    const out = [];
    const timeline = collectStaffTimelineForExport(measure, localStaff, divisions);
    const pendingSlurByNumber = new Map();
    const pendingTieByPitch = new Map();
    for (const item of timeline) {
        const note = item.note;
        const tstamp = offsetTicksToTstamp(item.onset, divisions, beatType);
        const slurs = Array.from(note.querySelectorAll(":scope > notations > slur"));
        for (const slur of slurs) {
            const type = (slur.getAttribute("type") || "").trim().toLowerCase();
            const number = String(Math.max(1, parseIntSafe(slur.getAttribute("number"), 1)));
            if (type === "start") {
                pendingSlurByNumber.set(number, { tstamp });
                continue;
            }
            if (type === "stop") {
                const pending = pendingSlurByNumber.get(number);
                if (pending) {
                    out.push(`<slur tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"/>`);
                    pendingSlurByNumber.delete(number);
                }
            }
        }
        const tieTypes = Array.from(note.querySelectorAll(":scope > tie"))
            .map((n) => (n.getAttribute("type") || "").trim().toLowerCase())
            .filter(Boolean);
        if (tieTypes.length > 0) {
            const pitchKey = tiePitchKeyFromMusicXmlNote(note);
            if (pitchKey) {
                const hasStop = tieTypes.includes("stop");
                const hasStart = tieTypes.includes("start");
                if (hasStop) {
                    const pending = pendingTieByPitch.get(pitchKey);
                    if (pending) {
                        out.push(`<tie tstamp="${esc(pending.tstamp)}" tstamp2="${esc(tstamp)}"/>`);
                        pendingTieByPitch.delete(pitchKey);
                    }
                }
                if (hasStart) {
                    pendingTieByPitch.set(pitchKey, { tstamp });
                }
            }
        }
    }
    return out;
};
const collectMeiOrnamentAndBreathControlsForStaff = (measure, localStaff, divisions, beatType) => {
    const out = [];
    const timeline = collectStaffTimelineForExport(measure, localStaff, divisions);
    for (const item of timeline) {
        const note = item.note;
        const tstamp = offsetTicksToTstamp(item.onset, divisions, beatType);
        const notePitch = note.querySelector(":scope > pitch");
        if (!notePitch)
            continue;
        const notations = note.querySelector(":scope > notations");
        if (!notations)
            continue;
        if (notations.querySelector(":scope > ornaments > trill-mark")) {
            out.push(`<trill tstamp="${esc(tstamp)}"/>`);
        }
        if (notations.querySelector(":scope > ornaments > turn")) {
            out.push(`<turn tstamp="${esc(tstamp)}" type="upper"/>`);
        }
        if (notations.querySelector(":scope > ornaments > inverted-turn")) {
            out.push(`<turn tstamp="${esc(tstamp)}" type="inverted"/>`);
        }
        if (notations.querySelector(":scope > ornaments > mordent")) {
            out.push(`<mordent tstamp="${esc(tstamp)}" type="upper"/>`);
        }
        if (notations.querySelector(":scope > ornaments > inverted-mordent")) {
            out.push(`<mordent tstamp="${esc(tstamp)}" type="inverted"/>`);
        }
        const fermata = notations.querySelector(":scope > fermata");
        if (fermata) {
            const type = (fermata.getAttribute("type") || "").trim().toLowerCase();
            const placeAttr = type === "inverted" ? ` place="below"` : "";
            out.push(`<fermata tstamp="${esc(tstamp)}"${placeAttr}/>`);
        }
        if (notations.querySelector(":scope > articulations > breath-mark")) {
            out.push(`<breath tstamp="${esc(tstamp)}"/>`);
        }
        if (notations.querySelector(":scope > articulations > caesura")) {
            out.push(`<caesura tstamp="${esc(tstamp)}"/>`);
        }
    }
    return out;
};
const normalizeMeiVersion = (raw) => {
    const v = String(raw !== null && raw !== void 0 ? raw : "").trim();
    if (/^\d+\.\d+(\.\d+)?$/.test(v))
        return v;
    return "5.1";
};
const exportMusicXmlDomToMei = (doc, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;
    const meiVersion = normalizeMeiVersion(options.meiVersion);
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    if (parts.length === 0) {
        throw new Error("MusicXML part is missing.");
    }
    const title = ((_b = (_a = doc.querySelector("score-partwise > work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) ||
        ((_d = (_c = doc.querySelector("score-partwise > movement-title")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) ||
        "mikuscore";
    const scoreDefSource = doc.querySelector("score-partwise > part > measure > attributes");
    const meterCount = parseIntSafe((_e = scoreDefSource === null || scoreDefSource === void 0 ? void 0 : scoreDefSource.querySelector(":scope > time > beats")) === null || _e === void 0 ? void 0 : _e.textContent, 4);
    const meterUnit = parseIntSafe((_f = scoreDefSource === null || scoreDefSource === void 0 ? void 0 : scoreDefSource.querySelector(":scope > time > beat-type")) === null || _f === void 0 ? void 0 : _f.textContent, 4);
    const keySig = fifthsToMeiKeySig(parseIntSafe((_g = scoreDefSource === null || scoreDefSource === void 0 ? void 0 : scoreDefSource.querySelector(":scope > key > fifths")) === null || _g === void 0 ? void 0 : _g.textContent, 0));
    const slots = collectStaffSlots(doc);
    const slotByPartStaff = new Map();
    for (const slot of slots) {
        slotByPartStaff.set(`${slot.partId}:${slot.localStaff}`, slot);
    }
    const scoreDefLines = [];
    scoreDefLines.push(`<scoreDef meter.count="${meterCount}" meter.unit="${meterUnit}" key.sig="${esc(keySig)}">`);
    scoreDefLines.push("<staffGrp>");
    for (const slot of slots) {
        const partEl = (_h = parts.find((part) => { var _a; return ((_a = part.getAttribute("id")) !== null && _a !== void 0 ? _a : "") === slot.partId; })) !== null && _h !== void 0 ? _h : null;
        const clef = resolveClefForSlot(partEl, slot.localStaff);
        const transpose = resolveTransposeForSlot(partEl, slot.localStaff);
        const transposeAttrs = [
            Number.isFinite(transpose === null || transpose === void 0 ? void 0 : transpose.diatonic) ? ` trans.diat="${Math.round(Number(transpose === null || transpose === void 0 ? void 0 : transpose.diatonic))}"` : "",
            Number.isFinite(transpose === null || transpose === void 0 ? void 0 : transpose.chromatic) ? ` trans.semi="${Math.round(Number(transpose === null || transpose === void 0 ? void 0 : transpose.chromatic))}"` : "",
        ].join("");
        scoreDefLines.push(`<staffDef n="${slot.globalStaff}" label="${esc(slot.label)}" lines="5" clef.shape="${esc(clef.shape)}" clef.line="${clef.line}"${transposeAttrs}/>`);
    }
    scoreDefLines.push("</staffGrp>");
    scoreDefLines.push("</scoreDef>");
    const measuresOut = [];
    const measureNumbers = gatherMeasureNumbers(parts);
    const currentDivisionsByPart = new Map();
    for (const part of parts) {
        const partId = ((_j = part.getAttribute("id")) !== null && _j !== void 0 ? _j : "").trim();
        if (!partId)
            continue;
        const firstDivisions = parseIntSafe((_k = part.querySelector(":scope > measure > attributes > divisions")) === null || _k === void 0 ? void 0 : _k.textContent, 1);
        currentDivisionsByPart.set(partId, Math.max(1, firstDivisions));
    }
    for (const number of measureNumbers) {
        const measureLines = [];
        measureLines.push(`<measure n="${esc(number)}">`);
        for (const slot of slots) {
            const part = parts.find((candidate) => { var _a; return ((_a = candidate.getAttribute("id")) !== null && _a !== void 0 ? _a : "") === slot.partId; });
            if (!part)
                continue;
            const measure = Array.from(part.querySelectorAll(":scope > measure")).find((m) => { var _a; return (((_a = m.getAttribute("number")) === null || _a === void 0 ? void 0 : _a.trim()) || "") === number; });
            if (!measure)
                continue;
            const partId = ((_l = part.getAttribute("id")) !== null && _l !== void 0 ? _l : "").trim();
            const measureDivisions = parseIntSafe((_m = measure.querySelector(":scope > attributes > divisions")) === null || _m === void 0 ? void 0 : _m.textContent, NaN);
            if (Number.isFinite(measureDivisions) && measureDivisions > 0 && partId) {
                currentDivisionsByPart.set(partId, Math.round(measureDivisions));
            }
            const sourceDivisions = Math.max(1, Math.round((_o = currentDivisionsByPart.get(partId)) !== null && _o !== void 0 ? _o : 1));
            const beatType = parseIntSafe((_p = measure.querySelector(":scope > attributes > time > beat-type")) === null || _p === void 0 ? void 0 : _p.textContent, meterUnit);
            const voiceMap = new Map();
            for (const note of Array.from(measure.querySelectorAll(":scope > note"))) {
                const localStaff = parseIntSafe((_q = note.querySelector(":scope > staff")) === null || _q === void 0 ? void 0 : _q.textContent, 1);
                if (localStaff !== slot.localStaff)
                    continue;
                const voice = ((_s = (_r = note.querySelector(":scope > voice")) === null || _r === void 0 ? void 0 : _r.textContent) === null || _s === void 0 ? void 0 : _s.trim()) || "1";
                if (!voiceMap.has(voice))
                    voiceMap.set(voice, []);
                (_t = voiceMap.get(voice)) === null || _t === void 0 ? void 0 : _t.push(note);
            }
            if (voiceMap.size === 0)
                continue;
            measureLines.push(`<staff n="${slot.globalStaff}">`);
            const miscFields = extractMiscellaneousFieldsFromMeasure(measure);
            for (const field of miscFields) {
                measureLines.push(`<annot type="musicxml-misc-field" label="${esc(field.name)}">${esc(field.value)}</annot>`);
            }
            const measureMeta = encodeMeasureMetaForMei(measure);
            if (measureMeta) {
                measureLines.push(`<annot type="musicxml-measure-meta" label="mks:measure-meta">${esc(measureMeta)}</annot>`);
            }
            const controlNodes = collectMeiDirectionControlsForStaff(measure, slot.localStaff, sourceDivisions, beatType);
            for (const controlNode of controlNodes) {
                measureLines.push(controlNode);
            }
            const glissSlideNodes = collectMeiGlissSlideControlsForStaff(measure, slot.localStaff, sourceDivisions, beatType);
            for (const node of glissSlideNodes) {
                measureLines.push(node);
            }
            const tieSlurNodes = collectMeiTieSlurControlsForStaff(measure, slot.localStaff, sourceDivisions, beatType);
            for (const node of tieSlurNodes) {
                measureLines.push(node);
            }
            const ornamentNodes = collectMeiOrnamentAndBreathControlsForStaff(measure, slot.localStaff, sourceDivisions, beatType);
            for (const node of ornamentNodes) {
                measureLines.push(node);
            }
            const harmNodes = collectMeiHarmsForStaff(measure, slot.localStaff, sourceDivisions, beatType);
            for (const harmNode of harmNodes) {
                measureLines.push(harmNode);
            }
            for (const voice of Array.from(voiceMap.keys()).sort(voiceSort)) {
                const notes = (_u = voiceMap.get(voice)) !== null && _u !== void 0 ? _u : [];
                const measureBeats = parseIntSafe((_v = measure.querySelector(":scope > attributes > time > beats")) === null || _v === void 0 ? void 0 : _v.textContent, meterCount);
                const measureTicks = Math.max(1, Math.round((measureBeats * 4 * sourceDivisions) / Math.max(1, beatType)));
                const layer = buildLayerContent(notes, sourceDivisions, measureTicks);
                measureLines.push(`<layer n="${esc(voice)}">${layer}</layer>`);
            }
            measureLines.push("</staff>");
        }
        measureLines.push("</measure>");
        measuresOut.push(measureLines.join(""));
    }
    return [
        `<?xml version="1.0" encoding="UTF-8"?>`,
        `<mei xmlns="http://www.music-encoding.org/ns/mei" meiversion="${esc(meiVersion)}">`,
        `<meiHead><fileDesc><titleStmt><title>${esc(title)}</title></titleStmt><pubStmt><p>Generated by mikuscore</p></pubStmt></fileDesc></meiHead>`,
        `<music><body><mdiv><score>`,
        scoreDefLines.join(""),
        `<section>${measuresOut.join("")}</section>`,
        `</score></mdiv></body></music>`,
        `</mei>`,
    ].join("");
};
exports.exportMusicXmlDomToMei = exportMusicXmlDomToMei;
const xmlEscape = (value) => String(value)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
const localNameOf = (node) => {
    var _a;
    const raw = node.localName || node.tagName || "";
    return raw.includes(":") ? (_a = raw.split(":").pop()) !== null && _a !== void 0 ? _a : raw : raw;
};
const childElementsByName = (parent, name) => {
    return Array.from(parent.children).filter((child) => localNameOf(child) === name);
};
const firstDescendantText = (root, name) => {
    var _a;
    const all = Array.from(root.querySelectorAll("*"));
    for (const node of all) {
        if (!(node instanceof Element))
            continue;
        if (localNameOf(node) !== name)
            continue;
        const text = (_a = node.textContent) === null || _a === void 0 ? void 0 : _a.trim();
        if (text)
            return text;
    }
    return "";
};
const meiDurToMusicXmlType = (dur) => {
    const normalized = String(dur || "").trim().toLowerCase();
    switch (normalized) {
        case "maxima":
            return "maxima";
        case "long":
            return "long";
        case "breve":
            return "breve";
        case "1":
            return "whole";
        case "2":
            return "half";
        case "4":
            return "quarter";
        case "8":
            return "eighth";
        case "16":
            return "16th";
        case "32":
            return "32nd";
        case "64":
            return "64th";
        case "128":
            return "128th";
        default:
            return "quarter";
    }
};
const meiDurToQuarterLength = (dur) => {
    const normalized = String(dur || "").trim().toLowerCase();
    if (normalized === "maxima")
        return 32;
    if (normalized === "long")
        return 16;
    if (normalized === "breve")
        return 8;
    const denom = Number.parseInt(normalized, 10);
    if (!Number.isFinite(denom) || denom <= 0)
        return 1;
    return 4 / denom;
};
const meiDurToBeamDepth = (dur) => {
    const normalized = String(dur || "").trim().toLowerCase();
    const denom = Number.parseInt(normalized, 10);
    if (!Number.isFinite(denom) || denom < 8)
        return 0;
    let depth = 0;
    let value = denom;
    while (value >= 8 && Number.isFinite(value)) {
        depth += 1;
        value /= 2;
        if (!Number.isFinite(value) || value <= 0)
            break;
    }
    return Math.max(0, depth);
};
const dotsMultiplier = (dots) => {
    const safeDots = Math.max(0, Math.min(4, Math.floor(dots)));
    let sum = 1;
    let add = 0.5;
    for (let i = 0; i < safeDots; i += 1) {
        sum += add;
        add /= 2;
    }
    return sum;
};
const inferMeiDurAndDotsFromTicks = (ticks, divisions) => {
    const safeTicks = Math.max(1, Math.round(ticks));
    const safeDiv = Math.max(1, Math.round(divisions));
    const candidates = ["1", "2", "4", "8", "16", "32", "64", "128"];
    let best = { dur: "4", dots: 0, diff: Number.POSITIVE_INFINITY };
    for (const dur of candidates) {
        const base = meiDurToQuarterLength(dur) * safeDiv;
        for (let dots = 0; dots <= 3; dots += 1) {
            const candidate = Math.max(1, Math.round(base * dotsMultiplier(dots)));
            const diff = Math.abs(candidate - safeTicks);
            if (diff < best.diff)
                best = { dur, dots, diff };
            if (diff === 0)
                return { dur, dots };
        }
    }
    return { dur: best.dur, dots: best.dots };
};
const accidToAlter = (accid) => {
    const normalized = String(accid || "").trim().toLowerCase();
    if (!normalized)
        return null;
    if (normalized === "s" || normalized === "#")
        return 1;
    if (normalized === "ss" || normalized === "x")
        return 2;
    if (normalized === "f" || normalized === "b")
        return -1;
    if (normalized === "ff" || normalized === "bb")
        return -2;
    if (normalized === "n")
        return 0;
    return null;
};
const accidToMusicXmlAccidental = (accid) => {
    const normalized = String(accid || "").trim().toLowerCase();
    if (!normalized)
        return null;
    if (normalized === "s" || normalized === "#")
        return "sharp";
    if (normalized === "f" || normalized === "b")
        return "flat";
    if (normalized === "n")
        return "natural";
    if (normalized === "ss" || normalized === "x")
        return "double-sharp";
    if (normalized === "ff" || normalized === "bb")
        return "flat-flat";
    return null;
};
const readMeiSoundingAccid = (node) => {
    const visualAccid = (node.getAttribute("accid") || "").trim();
    const gesturalAccid = (node.getAttribute("accid.ges") || node.getAttribute("accid-ges") || "").trim();
    const soundingAccid = visualAccid || gesturalAccid;
    return { visualAccid, soundingAccid };
};
const accidToPitchAlterXml = (accid) => {
    const alter = accidToAlter(accid);
    // Prefer omitting <alter>0</alter>; keep explicit accidental display separately.
    if (alter === null || alter === 0)
        return "";
    return `<alter>${alter}</alter>`;
};
const impliedAlterFromFifths = (step, fifths) => {
    const normalizedStep = String(step || "").trim().toUpperCase();
    if (!/^[A-G]$/.test(normalizedStep))
        return 0;
    const n = Math.max(-7, Math.min(7, Math.round(Number(fifths) || 0)));
    if (n === 0)
        return 0;
    const sharpOrder = ["F", "C", "G", "D", "A", "E", "B"];
    const flatOrder = ["B", "E", "A", "D", "G", "C", "F"];
    if (n > 0)
        return sharpOrder.slice(0, n).includes(normalizedStep) ? 1 : 0;
    return flatOrder.slice(0, Math.abs(n)).includes(normalizedStep) ? -1 : 0;
};
const parseMeiKeySigToFifths = (value) => {
    const normalized = String(value || "").trim().toLowerCase();
    if (!normalized || normalized === "0")
        return 0;
    const num = Number.parseInt(normalized, 10);
    if (!Number.isFinite(num))
        return 0;
    if (normalized.endsWith("s"))
        return Math.max(-7, Math.min(7, num));
    if (normalized.endsWith("f"))
        return Math.max(-7, Math.min(7, -Math.abs(num)));
    return Math.max(-7, Math.min(7, num));
};
const readMeiKeySigAttr = (element) => {
    if (!element)
        return "";
    return (element.getAttribute("key.sig") || element.getAttribute("keysig") || "").trim();
};
const parseMeiKeyAccidToAlter = (value) => {
    const v = String(value || "").trim().toLowerCase();
    if (!v || v === "n")
        return 0;
    if (v === "s" || v === "#")
        return 1;
    if (v === "ss" || v === "x" || v === "##")
        return 2;
    if (v === "f" || v === "b" || v === "â™­")
        return -1;
    if (v === "ff" || v === "bb")
        return -2;
    return 0;
};
const tonicToFifths = (pname, accid, mode) => {
    var _a, _b;
    const step = String(pname || "").trim().toUpperCase();
    if (!/^[A-G]$/.test(step))
        return null;
    const alter = parseMeiKeyAccidToAlter(accid);
    const normalizedMode = String(mode || "").trim().toLowerCase();
    const tonic = `${step}${alter > 0 ? "#".repeat(alter) : alter < 0 ? "b".repeat(Math.abs(alter)) : ""}`;
    const majorMap = {
        C: 0, G: 1, D: 2, A: 3, E: 4, B: 5, "F#": 6, "C#": 7,
        F: -1, Bb: -2, Eb: -3, Ab: -4, Db: -5, Gb: -6, Cb: -7,
    };
    const minorMap = {
        A: 0, E: 1, B: 2, "F#": 3, "C#": 4, "G#": 5, "D#": 6, "A#": 7,
        D: -1, G: -2, C: -3, F: -4, Bb: -5, Eb: -6, Ab: -7,
    };
    if (normalizedMode === "minor")
        return (_a = minorMap[tonic]) !== null && _a !== void 0 ? _a : null;
    return (_b = majorMap[tonic]) !== null && _b !== void 0 ? _b : null;
};
const parseMeiKeyFifthsFromElement = (element) => {
    if (!element)
        return null;
    const keySig = readMeiKeySigAttr(element);
    if (keySig)
        return parseMeiKeySigToFifths(keySig);
    const keyPname = element.getAttribute("key.pname") || "";
    const keyAccid = element.getAttribute("key.accid") || "";
    const keyMode = element.getAttribute("key.mode") || "major";
    return tonicToFifths(keyPname, keyAccid, keyMode);
};
const toHex = (value, width = 2) => {
    const safe = Math.max(0, Math.round(Number(value) || 0));
    return `0x${safe.toString(16).toUpperCase().padStart(width, "0")}`;
};
const resolveDurTicksFromMetadata = (source, fallbackTicks, targetDivisions) => {
    const dur480 = parseIntSafe(source.getAttribute("mks-dur-480"), NaN);
    if (Number.isFinite(dur480) && dur480 > 0)
        return Math.round(dur480);
    const legacyTicks = parseIntSafe(source.getAttribute("mks-dur-ticks"), NaN);
    if (!Number.isFinite(legacyTicks) || legacyTicks <= 0)
        return fallbackTicks;
    const legacyDivisions = parseIntSafe(source.getAttribute("mks-dur-div"), NaN);
    if (Number.isFinite(legacyDivisions) && legacyDivisions > 0) {
        return Math.max(1, Math.round((legacyTicks * targetDivisions) / legacyDivisions));
    }
    // Legacy MEI without source divisions should keep semantic duration from dur/dots.
    return fallbackTicks;
};
const parseMeiTieFlags = (raw) => {
    const normalized = String(raw || "").trim().toLowerCase();
    if (!normalized)
        return { start: false, stop: false };
    const hasMiddle = normalized.includes("m");
    const start = hasMiddle || normalized.includes("i");
    const stop = hasMiddle || normalized.includes("t");
    return { start, stop };
};
const parseMeiSlurNotations = (raw) => {
    const normalized = String(raw || "").trim().toLowerCase();
    if (!normalized)
        return [];
    const out = [];
    const rx = /([imt])\s*(\d+)?|(\d+)\s*([imt])/g;
    let m;
    while ((m = rx.exec(normalized)) !== null) {
        const kind = (m[1] || m[4] || "").toLowerCase();
        const nRaw = m[2] || m[3] || "1";
        const number = Math.max(1, parseIntSafe(nRaw, 1));
        if (kind === "i" || kind === "m")
            out.push({ type: "start", number });
        if (kind === "t" || kind === "m")
            out.push({ type: "stop", number });
    }
    return out;
};
const buildMusicXmlNoteFromMeiNote = (meiNote, durationTicks, typeText, dots, voice, measureFifths) => {
    var _a, _b;
    const pname = (meiNote.getAttribute("pname") || "c").trim().toUpperCase();
    const octave = parseIntSafe(meiNote.getAttribute("oct"), 4);
    const { visualAccid, soundingAccid } = readMeiSoundingAccid(meiNote);
    const explicitAlterXml = accidToPitchAlterXml(soundingAccid);
    const impliedAlter = impliedAlterFromFifths(pname, measureFifths);
    const alterXml = explicitAlterXml || (impliedAlter !== 0 ? `<alter>${impliedAlter}</alter>` : "");
    const accidentalText = accidToMusicXmlAccidental(visualAccid);
    const accidentalXml = accidentalText ? `<accidental>${xmlEscape(accidentalText)}</accidental>` : "";
    const dotXml = Array.from({ length: dots }, () => "<dot/>").join("");
    const actual = parseIntSafe(meiNote.getAttribute("num"), NaN);
    const normal = parseIntSafe(meiNote.getAttribute("numbase"), NaN);
    const hasTimeModification = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0;
    const timeModificationXml = hasTimeModification
        ? `<time-modification><actual-notes>${Math.round(actual)}</actual-notes><normal-notes>${Math.round(normal)}</normal-notes></time-modification>`
        : "";
    const hasTupletStart = ((_a = meiNote.getAttribute("mks-tuplet-start")) !== null && _a !== void 0 ? _a : "").trim() === "1";
    const hasTupletStop = ((_b = meiNote.getAttribute("mks-tuplet-stop")) !== null && _b !== void 0 ? _b : "").trim() === "1";
    const articRaw = (meiNote.getAttribute("artic") || "").trim().toLowerCase();
    const articTokens = articRaw.split(/\s+/).filter(Boolean);
    const arts = [];
    if (articTokens.includes("stacc"))
        arts.push("<staccato/>");
    if (articTokens.includes("acc"))
        arts.push("<accent/>");
    const tieFlags = parseMeiTieFlags(meiNote.getAttribute("tie") || "");
    const tieXml = `${tieFlags.start ? '<tie type="start"/>' : ""}${tieFlags.stop ? '<tie type="stop"/>' : ""}`;
    const tiedXml = `${tieFlags.start ? '<tied type="start"/>' : ""}${tieFlags.stop ? '<tied type="stop"/>' : ""}`;
    const slurXml = parseMeiSlurNotations(meiNote.getAttribute("slur") || "")
        .map((entry) => `<slur type="${entry.type}" number="${entry.number}"/>`)
        .join("");
    const tupletXml = `${hasTupletStart ? '<tuplet type="start"/>' : ""}${hasTupletStop ? '<tuplet type="stop"/>' : ""}`;
    const hasNotations = arts.length > 0 || tupletXml.length > 0 || tiedXml.length > 0 || slurXml.length > 0;
    const notationsXml = hasNotations
        ? `<notations>${arts.length ? `<articulations>${arts.join("")}</articulations>` : ""}${tupletXml}${tiedXml}${slurXml}</notations>`
        : "";
    const graceAttr = (meiNote.getAttribute("grace") || "").trim().toLowerCase();
    const isGrace = graceAttr === "acc" || graceAttr === "unacc";
    const stemMod = (meiNote.getAttribute("stem.mod") || "").trim().toLowerCase();
    const hasStemSlash = stemMod.includes("slash");
    const graceXml = isGrace ? `<grace${graceAttr === "acc" || hasStemSlash ? ' slash="yes"' : ""}/>` : "";
    const durationXml = isGrace ? "" : `<duration>${durationTicks}</duration>`;
    const stemDir = (meiNote.getAttribute("stem.dir") || "").trim().toLowerCase();
    const stemXml = stemDir === "up" || stemDir === "down" ? `<stem>${xmlEscape(stemDir)}</stem>` : "";
    const lyric = extractMeiLyric(meiNote);
    const lyricXml = lyric
        ? `<lyric>${lyric.syllabic ? `<syllabic>${xmlEscape(lyric.syllabic)}</syllabic>` : ""}<text>${xmlEscape(lyric.text)}</text></lyric>`
        : "";
    return `<note>${graceXml}<pitch><step>${xmlEscape(pname)}</step>${alterXml}<octave>${octave}</octave></pitch>${tieXml}${durationXml}<voice>${xmlEscape(voice)}</voice><type>${xmlEscape(typeText)}</type>${dotXml}${stemXml}${accidentalXml}${timeModificationXml}${notationsXml}${lyricXml}</note>`;
};
const parseLayerEvents = (layer, divisions, voice, measureTicks, measureFifths, tieCarryIn = new Map()) => {
    const events = [];
    const idToEventIndex = new Map();
    const tieCarryByPitch = new Map(tieCarryIn);
    const measureAccidentalByPitch = new Map();
    const tiePitchKey = (pname, octave) => `${String(pname || "").trim().toUpperCase()}:${Math.round(Number(octave) || 0)}`;
    const breaksecFromNode = (node) => {
        const raw = parseIntSafe(node.getAttribute("breaksec"), NaN);
        if (!Number.isFinite(raw) || raw <= 0)
            return null;
        return Math.round(raw);
    };
    const parseStemSlashCount = (node) => {
        const stemMod = String(node.getAttribute("stem.mod") || "").trim().toLowerCase();
        if (!stemMod.includes("slash"))
            return 0;
        const m = stemMod.match(/(\d+)\s*slash/);
        const count = m ? parseIntSafe(m[1], 1) : 1;
        return Math.max(1, Math.min(4, Math.round(count)));
    };
    const expandStemSlashNodes = (node) => {
        const name = localNameOf(node);
        if (name !== "note" && name !== "chord")
            return null;
        const graceAttr = (node.getAttribute("grace") || "").trim().toLowerCase();
        if (graceAttr === "acc" || graceAttr === "unacc")
            return null;
        const slashCount = parseStemSlashCount(node);
        if (slashCount <= 0)
            return null;
        const durAttr = node.getAttribute("dur") || "4";
        const dots = parseIntSafe(node.getAttribute("dots"), 0);
        const actual = parseIntSafe(node.getAttribute("num"), NaN);
        const normal = parseIntSafe(node.getAttribute("numbase"), NaN);
        const tupletRatio = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0
            ? Math.max(0.0001, Math.round(normal) / Math.round(actual))
            : 1;
        const baseTicks = Math.max(1, Math.round(meiDurToQuarterLength(durAttr) * dotsMultiplier(dots) * divisions * tupletRatio));
        const totalTicks = resolveDurTicksFromMetadata(node, baseTicks, divisions);
        const unitTicks = Math.max(1, Math.round(divisions / (2 ** slashCount)));
        if (totalTicks < unitTicks * 2 || totalTicks % unitTicks !== 0)
            return null;
        const repeatCount = Math.max(2, Math.round(totalTicks / unitTicks));
        const expanded = [];
        for (let i = 0; i < repeatCount; i += 1) {
            const clone = node.cloneNode(true);
            const inferred = inferMeiDurAndDotsFromTicks(unitTicks, divisions);
            clone.setAttribute("dur", inferred.dur);
            if (inferred.dots > 0)
                clone.setAttribute("dots", String(inferred.dots));
            else
                clone.removeAttribute("dots");
            clone.removeAttribute("stem.mod");
            clone.setAttribute("mks-dur-div", String(Math.max(1, Math.round(divisions))));
            clone.setAttribute("mks-dur-480", String(toMksDur480(unitTicks, divisions)));
            clone.setAttribute("mks-dur-ticks", String(unitTicks));
            if (i > 0) {
                clone.removeAttribute("xml:id");
                clone.removeAttribute("id");
                clone.removeAttribute("tie");
                clone.removeAttribute("slur");
                clone.removeAttribute("mks-tuplet-start");
                for (const child of Array.from(clone.children)) {
                    if (!(child instanceof Element))
                        continue;
                    if (localNameOf(child) !== "note")
                        continue;
                    child.removeAttribute("xml:id");
                    child.removeAttribute("id");
                    child.removeAttribute("tie");
                    child.removeAttribute("slur");
                }
            }
            if (i < repeatCount - 1) {
                clone.removeAttribute("mks-tuplet-stop");
            }
            expanded.push(clone);
        }
        return expanded;
    };
    const pushNoteEvent = (node, forcedTuplet = null) => {
        let effectiveNode = node;
        if (forcedTuplet
            && !effectiveNode.getAttribute("num")
            && !effectiveNode.getAttribute("numbase")) {
            effectiveNode = node.cloneNode(true);
            effectiveNode.setAttribute("num", String(Math.round(forcedTuplet.num)));
            effectiveNode.setAttribute("numbase", String(Math.round(forcedTuplet.numbase)));
        }
        const durAttr = effectiveNode.getAttribute("dur") || "4";
        const dots = parseIntSafe(node.getAttribute("dots"), 0);
        const typeText = meiDurToMusicXmlType(durAttr);
        const graceAttr = (effectiveNode.getAttribute("grace") || "").trim().toLowerCase();
        const isGrace = graceAttr === "acc" || graceAttr === "unacc";
        const actual = parseIntSafe(effectiveNode.getAttribute("num"), NaN);
        const normal = parseIntSafe(effectiveNode.getAttribute("numbase"), NaN);
        const tupletRatio = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0
            ? Math.max(0.0001, Math.round(normal) / Math.round(actual))
            : 1;
        const ticks = isGrace
            ? 0
            : Math.max(1, Math.round(meiDurToQuarterLength(durAttr) * dotsMultiplier(dots) * divisions * tupletRatio));
        const resolvedTicks = isGrace
            ? 0
            : resolveDurTicksFromMetadata(node, ticks, divisions);
        const eventIndex = events.length;
        const pname = (effectiveNode.getAttribute("pname") || "c").trim().toUpperCase();
        const octave = parseIntSafe(effectiveNode.getAttribute("oct"), 4);
        const tieFlags = parseMeiTieFlags(effectiveNode.getAttribute("tie") || "");
        const { visualAccid, soundingAccid } = readMeiSoundingAccid(effectiveNode);
        const explicitAlter = accidToAlter(soundingAccid);
        const impliedAlter = impliedAlterFromFifths(pname, measureFifths);
        const pitchKey = tiePitchKey(pname, octave);
        const carriedAlter = tieFlags.stop && explicitAlter === null
            ? tieCarryByPitch.get(pitchKey)
            : undefined;
        const measureCarriedAlter = explicitAlter === null
            ? measureAccidentalByPitch.get(pitchKey)
            : undefined;
        const resolvedAlter = explicitAlter !== null
            ? explicitAlter
            : Number.isFinite(carriedAlter)
                ? Math.round(Number(carriedAlter))
                : Number.isFinite(measureCarriedAlter)
                    ? Math.round(Number(measureCarriedAlter))
                    : impliedAlter;
        const alterXml = resolvedAlter !== 0 ? `<alter>${resolvedAlter}</alter>` : "";
        const accidentalText = accidToMusicXmlAccidental(visualAccid);
        const accidentalXml = accidentalText ? `<accidental>${xmlEscape(accidentalText)}</accidental>` : "";
        const tiedXml = `${tieFlags.start ? '<tied type="start"/>' : ""}${tieFlags.stop ? '<tied type="stop"/>' : ""}`;
        const tieXml = `${tieFlags.start ? '<tie type="start"/>' : ""}${tieFlags.stop ? '<tie type="stop"/>' : ""}`;
        const slurXml = parseMeiSlurNotations(effectiveNode.getAttribute("slur") || "")
            .map((entry) => `<slur type="${entry.type}" number="${entry.number}"/>`)
            .join("");
        const hasNotations = tiedXml.length > 0 || slurXml.length > 0;
        const notationsXml = hasNotations ? `<notations>${tiedXml}${slurXml}</notations>` : "";
        events.push({
            kind: "note",
            durationTicks: resolvedTicks,
            xml: (() => {
                var _a, _b;
                const graceAttr = (effectiveNode.getAttribute("grace") || "").trim().toLowerCase();
                const isGrace = graceAttr === "acc" || graceAttr === "unacc";
                const stemMod = (effectiveNode.getAttribute("stem.mod") || "").trim().toLowerCase();
                const hasStemSlash = stemMod.includes("slash");
                const graceXml = isGrace ? `<grace${graceAttr === "acc" || hasStemSlash ? ' slash="yes"' : ""}/>` : "";
                const durationXml = isGrace ? "" : `<duration>${resolvedTicks}</duration>`;
                const dotXml = Array.from({ length: dots }, () => "<dot/>").join("");
                const stemDir = (effectiveNode.getAttribute("stem.dir") || "").trim().toLowerCase();
                const stemXml = stemDir === "up" || stemDir === "down" ? `<stem>${xmlEscape(stemDir)}</stem>` : "";
                const lyric = extractMeiLyric(effectiveNode);
                const lyricXml = lyric
                    ? `<lyric>${lyric.syllabic ? `<syllabic>${xmlEscape(lyric.syllabic)}</syllabic>` : ""}<text>${xmlEscape(lyric.text)}</text></lyric>`
                    : "";
                const actual = parseIntSafe(effectiveNode.getAttribute("num"), NaN);
                const normal = parseIntSafe(effectiveNode.getAttribute("numbase"), NaN);
                const hasTimeModification = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0;
                const timeModificationXml = hasTimeModification
                    ? `<time-modification><actual-notes>${Math.round(actual)}</actual-notes><normal-notes>${Math.round(normal)}</normal-notes></time-modification>`
                    : "";
                const articRaw = (effectiveNode.getAttribute("artic") || "").trim().toLowerCase();
                const articTokens = articRaw.split(/\s+/).filter(Boolean);
                const arts = [];
                if (articTokens.includes("stacc"))
                    arts.push("<staccato/>");
                if (articTokens.includes("acc"))
                    arts.push("<accent/>");
                const tupletStart = ((_a = effectiveNode.getAttribute("mks-tuplet-start")) !== null && _a !== void 0 ? _a : "").trim() === "1";
                const tupletStop = ((_b = effectiveNode.getAttribute("mks-tuplet-stop")) !== null && _b !== void 0 ? _b : "").trim() === "1";
                const tupletXml = `${tupletStart ? '<tuplet type="start"/>' : ""}${tupletStop ? '<tuplet type="stop"/>' : ""}`;
                const fullNotationsXml = arts.length > 0 || tupletXml.length > 0 || tiedXml.length > 0 || slurXml.length > 0
                    ? `<notations>${arts.length ? `<articulations>${arts.join("")}</articulations>` : ""}${tupletXml}${tiedXml}${slurXml}</notations>`
                    : "";
                return `<note>${graceXml}<pitch><step>${xmlEscape(pname)}</step>${alterXml}<octave>${octave}</octave></pitch>${tieXml}${durationXml}<voice>${xmlEscape(voice)}</voice><type>${xmlEscape(typeText)}</type>${dotXml}${stemXml}${accidentalXml}${timeModificationXml}${fullNotationsXml}${lyricXml}</note>`;
            })(),
            beamDepth: meiDurToBeamDepth(durAttr),
            breaksecAfter: breaksecFromNode(effectiveNode),
        });
        if (tieFlags.start) {
            tieCarryByPitch.set(pitchKey, resolvedAlter);
        }
        else if (tieFlags.stop) {
            tieCarryByPitch.delete(pitchKey);
        }
        if (explicitAlter !== null) {
            measureAccidentalByPitch.set(pitchKey, resolvedAlter);
        }
        const xmlId = (effectiveNode.getAttribute("xml:id") || effectiveNode.getAttribute("id") || "").trim();
        if (xmlId)
            idToEventIndex.set(xmlId, eventIndex);
    };
    const pushRestEvent = (node, forcedTuplet = null) => {
        let effectiveNode = node;
        if (forcedTuplet
            && !effectiveNode.getAttribute("num")
            && !effectiveNode.getAttribute("numbase")) {
            effectiveNode = node.cloneNode(true);
            effectiveNode.setAttribute("num", String(Math.round(forcedTuplet.num)));
            effectiveNode.setAttribute("numbase", String(Math.round(forcedTuplet.numbase)));
        }
        const graceAttr = (effectiveNode.getAttribute("grace") || "").trim().toLowerCase();
        const isGrace = graceAttr === "acc" || graceAttr === "unacc";
        if (isGrace)
            return;
        const durAttr = effectiveNode.getAttribute("dur") || "4";
        const dots = parseIntSafe(effectiveNode.getAttribute("dots"), 0);
        const actual = parseIntSafe(effectiveNode.getAttribute("num"), NaN);
        const normal = parseIntSafe(effectiveNode.getAttribute("numbase"), NaN);
        const tupletRatio = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0
            ? Math.max(0.0001, Math.round(normal) / Math.round(actual))
            : 1;
        const typeText = meiDurToMusicXmlType(durAttr);
        const ticks = Math.max(1, Math.round(meiDurToQuarterLength(durAttr) * dotsMultiplier(dots) * divisions * tupletRatio));
        const resolvedTicks = resolveDurTicksFromMetadata(effectiveNode, ticks, divisions);
        const dotXml = Array.from({ length: dots }, () => "<dot/>").join("");
        events.push({
            kind: "rest",
            durationTicks: resolvedTicks,
            xml: `<note><rest/><duration>${resolvedTicks}</duration><voice>${xmlEscape(voice)}</voice><type>${xmlEscape(typeText)}</type>${dotXml}</note>`,
            beamDepth: meiDurToBeamDepth(durAttr),
            breaksecAfter: null,
        });
    };
    const pushChordEvent = (node, forcedTuplet = null) => {
        var _a, _b;
        let effectiveNode = node;
        if (forcedTuplet
            && !effectiveNode.getAttribute("num")
            && !effectiveNode.getAttribute("numbase")) {
            effectiveNode = node.cloneNode(true);
            effectiveNode.setAttribute("num", String(Math.round(forcedTuplet.num)));
            effectiveNode.setAttribute("numbase", String(Math.round(forcedTuplet.numbase)));
        }
        const durAttr = effectiveNode.getAttribute("dur") || "4";
        const dots = parseIntSafe(effectiveNode.getAttribute("dots"), 0);
        const typeText = meiDurToMusicXmlType(durAttr);
        const graceAttr = (effectiveNode.getAttribute("grace") || "").trim().toLowerCase();
        const isGrace = graceAttr === "acc" || graceAttr === "unacc";
        const actual = parseIntSafe(effectiveNode.getAttribute("num"), NaN);
        const normal = parseIntSafe(effectiveNode.getAttribute("numbase"), NaN);
        const tupletRatio = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0
            ? Math.max(0.0001, Math.round(normal) / Math.round(actual))
            : 1;
        const ticks = isGrace ? 0 : Math.max(1, Math.round(meiDurToQuarterLength(durAttr) * dotsMultiplier(dots) * divisions * tupletRatio));
        const resolvedTicks = isGrace ? 0 : resolveDurTicksFromMetadata(effectiveNode, ticks, divisions);
        const noteChildren = childElementsByName(effectiveNode, "note");
        if (noteChildren.length === 0)
            return;
        const dotXml = Array.from({ length: dots }, () => "<dot/>").join("");
        const chordTupletStart = ((_a = effectiveNode.getAttribute("mks-tuplet-start")) !== null && _a !== void 0 ? _a : "").trim() === "1";
        const chordTupletStop = ((_b = effectiveNode.getAttribute("mks-tuplet-stop")) !== null && _b !== void 0 ? _b : "").trim() === "1";
        const timeModificationXml = Number.isFinite(actual) && Number.isFinite(normal) && actual > 0 && normal > 0
            ? `<time-modification><actual-notes>${Math.round(actual)}</actual-notes><normal-notes>${Math.round(normal)}</normal-notes></time-modification>`
            : "";
        const chordArticRaw = (effectiveNode.getAttribute("artic") || "").trim().toLowerCase();
        const graceXml = isGrace ? `<grace${graceAttr === "acc" ? ' slash="yes"' : ""}/>` : "";
        const durationXml = isGrace ? "" : `<duration>${resolvedTicks}</duration>`;
        const noteXml = noteChildren
            .map((note, index) => {
            const pname = (note.getAttribute("pname") || "c").trim().toUpperCase();
            const octave = parseIntSafe(note.getAttribute("oct"), 4);
            const { visualAccid, soundingAccid } = readMeiSoundingAccid(note);
            const explicitAlter = accidToAlter(soundingAccid);
            const impliedAlter = impliedAlterFromFifths(pname, measureFifths);
            const tieFlags = parseMeiTieFlags(note.getAttribute("tie") || "");
            const pitchKey = tiePitchKey(pname, octave);
            const carriedAlter = tieFlags.stop && explicitAlter === null
                ? tieCarryByPitch.get(pitchKey)
                : undefined;
            const measureCarriedAlter = explicitAlter === null
                ? measureAccidentalByPitch.get(pitchKey)
                : undefined;
            const resolvedAlter = explicitAlter !== null
                ? explicitAlter
                : Number.isFinite(carriedAlter)
                    ? Math.round(Number(carriedAlter))
                    : Number.isFinite(measureCarriedAlter)
                        ? Math.round(Number(measureCarriedAlter))
                        : impliedAlter;
            const alterXml = resolvedAlter !== 0 ? `<alter>${resolvedAlter}</alter>` : "";
            const accidentalText = accidToMusicXmlAccidental(visualAccid);
            const accidentalXml = accidentalText ? `<accidental>${xmlEscape(accidentalText)}</accidental>` : "";
            const chordXml = index > 0 ? "<chord/>" : "";
            const mergedArticRaw = `${chordArticRaw} ${(note.getAttribute("artic") || "").trim().toLowerCase()}`.trim();
            const articTokens = mergedArticRaw.split(/\s+/).filter(Boolean);
            const arts = [];
            if (articTokens.includes("stacc"))
                arts.push("<staccato/>");
            if (articTokens.includes("acc"))
                arts.push("<accent/>");
            const tieXml = `${tieFlags.start ? '<tie type="start"/>' : ""}${tieFlags.stop ? '<tie type="stop"/>' : ""}`;
            const tiedXml = `${tieFlags.start ? '<tied type="start"/>' : ""}${tieFlags.stop ? '<tied type="stop"/>' : ""}`;
            const slurXml = parseMeiSlurNotations(note.getAttribute("slur") || "")
                .map((entry) => `<slur type="${entry.type}" number="${entry.number}"/>`)
                .join("");
            const tupletXml = index === 0
                ? `${chordTupletStart ? '<tuplet type="start"/>' : ""}${chordTupletStop ? '<tuplet type="stop"/>' : ""}`
                : "";
            const notationsXml = (index === 0 && (arts.length > 0 || tupletXml.length > 0)) || tiedXml.length > 0 || slurXml.length > 0
                ? `<notations>${index === 0 && arts.length ? `<articulations>${arts.join("")}</articulations>` : ""}${index === 0 ? tupletXml : ""}${tiedXml}${slurXml}</notations>`
                : "";
            const lyric = extractMeiLyric(note);
            const lyricXml = lyric
                ? `<lyric>${lyric.syllabic ? `<syllabic>${xmlEscape(lyric.syllabic)}</syllabic>` : ""}<text>${xmlEscape(lyric.text)}</text></lyric>`
                : "";
            if (tieFlags.start) {
                tieCarryByPitch.set(pitchKey, resolvedAlter);
            }
            else if (tieFlags.stop) {
                tieCarryByPitch.delete(pitchKey);
            }
            if (explicitAlter !== null) {
                measureAccidentalByPitch.set(pitchKey, resolvedAlter);
            }
            return `<note>${chordXml}${graceXml}<pitch><step>${xmlEscape(pname)}</step>${alterXml}<octave>${octave}</octave></pitch>${tieXml}${durationXml}<voice>${xmlEscape(voice)}</voice><type>${xmlEscape(typeText)}</type>${dotXml}${accidentalXml}${timeModificationXml}${notationsXml}${lyricXml}</note>`;
        })
            .join("");
        const eventIndex = events.length;
        events.push({ kind: "chord", durationTicks: resolvedTicks, xml: noteXml });
        events[eventIndex] = {
            ...events[eventIndex],
            beamDepth: meiDurToBeamDepth(durAttr),
            breaksecAfter: breaksecFromNode(effectiveNode),
        };
        const xmlId = (effectiveNode.getAttribute("xml:id") || effectiveNode.getAttribute("id") || "").trim();
        if (xmlId)
            idToEventIndex.set(xmlId, eventIndex);
        for (const chordNote of noteChildren) {
            const noteId = (chordNote.getAttribute("xml:id") || chordNote.getAttribute("id") || "").trim();
            if (noteId && !idToEventIndex.has(noteId)) {
                idToEventIndex.set(noteId, eventIndex);
            }
        }
    };
    const processElement = (node, forcedGrace = null, forcedTuplet = null) => {
        const name = localNameOf(node);
        if (name === "beam") {
            const startIndex = events.length;
            for (const child of Array.from(node.children)) {
                if (child instanceof Element)
                    processElement(child, forcedGrace, forcedTuplet);
            }
            const endIndex = events.length;
            const pitchedIndexes = [];
            for (let i = startIndex; i < endIndex; i += 1) {
                if (events[i].kind !== "rest")
                    pitchedIndexes.push(i);
            }
            if (pitchedIndexes.length >= 2) {
                const depths = pitchedIndexes.map((idx) => Math.max(1, events[idx].beamDepth || 1));
                const breaksecs = pitchedIndexes.map((idx) => { var _a; return (_a = events[idx].breaksecAfter) !== null && _a !== void 0 ? _a : null; });
                const maxDepth = Math.max(1, ...depths);
                const canConnect = (leftIdx, level) => {
                    if (leftIdx < 0 || leftIdx >= pitchedIndexes.length - 1)
                        return false;
                    if (depths[leftIdx] < level)
                        return false;
                    if (depths[leftIdx + 1] < level)
                        return false;
                    const keep = breaksecs[leftIdx];
                    if (Number.isFinite(keep) && keep < level)
                        return false;
                    return true;
                };
                for (let level = 1; level <= maxDepth; level += 1) {
                    for (let i = 0; i < pitchedIndexes.length; i += 1) {
                        if (depths[i] < level)
                            continue;
                        const prev = canConnect(i - 1, level);
                        const next = canConnect(i, level);
                        if (!prev && !next)
                            continue;
                        const value = !prev && next ? "begin" : prev && !next ? "end" : "continue";
                        const eventIndex = pitchedIndexes[i];
                        events[eventIndex].xml = addBeamToEventXml(events[eventIndex].xml, value, level);
                    }
                }
            }
            return;
        }
        if (name === "tuplet") {
            const num = parseIntSafe(node.getAttribute("num"), NaN);
            const numbase = parseIntSafe(node.getAttribute("numbase"), NaN);
            const nextTuplet = Number.isFinite(num) && Number.isFinite(numbase) && num > 0 && numbase > 0
                ? { num: Math.round(num), numbase: Math.round(numbase) }
                : forcedTuplet;
            for (const child of Array.from(node.children)) {
                if (child instanceof Element)
                    processElement(child, forcedGrace, nextTuplet);
            }
            return;
        }
        if (name === "graceGrp") {
            const raw = (node.getAttribute("grace") || "").trim().toLowerCase();
            const slash = (node.getAttribute("slash") || "").trim().toLowerCase() === "yes";
            const groupGrace = raw === "acc" || raw === "unacc"
                ? raw
                : (slash ? "acc" : "unacc");
            for (const child of Array.from(node.children)) {
                if (child instanceof Element)
                    processElement(child, forcedGrace !== null && forcedGrace !== void 0 ? forcedGrace : groupGrace, forcedTuplet);
            }
            return;
        }
        let effectiveNode = node;
        if (forcedGrace && !effectiveNode.getAttribute("grace") && (name === "note" || name === "chord" || name === "rest")) {
            effectiveNode = node.cloneNode(true);
            effectiveNode.setAttribute("grace", forcedGrace);
        }
        if (name === "note" || name === "chord") {
            const slashExpanded = expandStemSlashNodes(effectiveNode);
            if (slashExpanded && slashExpanded.length > 1) {
                for (const expandedNode of slashExpanded) {
                    if (name === "note")
                        pushNoteEvent(expandedNode, forcedTuplet);
                    else
                        pushChordEvent(expandedNode, forcedTuplet);
                }
                return;
            }
        }
        if (name === "note") {
            pushNoteEvent(effectiveNode, forcedTuplet);
            return;
        }
        if (name === "rest" || name === "space" || name === "mSpace" || name === "mRest") {
            if ((name === "mSpace" || name === "mRest") && !effectiveNode.getAttribute("mks-dur-ticks")) {
                const inferred = inferMeiDurAndDotsFromTicks(measureTicks, divisions);
                effectiveNode = effectiveNode.cloneNode(true);
                effectiveNode.setAttribute("dur", inferred.dur);
                if (inferred.dots > 0)
                    effectiveNode.setAttribute("dots", String(inferred.dots));
                effectiveNode.setAttribute("mks-dur-div", String(Math.max(1, Math.round(divisions))));
                effectiveNode.setAttribute("mks-dur-480", String(toMksDur480(measureTicks, divisions)));
                effectiveNode.setAttribute("mks-dur-ticks", String(Math.max(1, Math.round(measureTicks))));
            }
            pushRestEvent(effectiveNode, forcedTuplet);
            return;
        }
        if (name === "chord") {
            pushChordEvent(effectiveNode, forcedTuplet);
        }
    };
    for (const child of Array.from(layer.children)) {
        if (child instanceof Element)
            processElement(child, null, null);
    }
    return { events, idToEventIndex, tieCarryOut: new Map(tieCarryByPitch) };
};
const addSlurNotationToSingleNoteXml = (noteXml, type, number) => {
    const slurXml = `<slur type="${type}" number="${number}"/>`;
    if (noteXml.includes("<notations>")) {
        return noteXml.replace("</notations>", `${slurXml}</notations>`);
    }
    return noteXml.replace("</note>", `<notations>${slurXml}</notations></note>`);
};
const addTieToSingleNoteXml = (noteXml, type) => {
    const tieXml = `<tie type="${type}"/>`;
    const tiedXml = `<tied type="${type}"/>`;
    const withTie = noteXml.includes("<duration>")
        ? noteXml.replace("<duration>", `${tieXml}<duration>`)
        : noteXml.replace("</note>", `${tieXml}</note>`);
    if (withTie.includes("<notations>")) {
        return withTie.replace("</notations>", `${tiedXml}</notations>`);
    }
    return withTie.replace("</note>", `<notations>${tiedXml}</notations></note>`);
};
const addNotationXmlToSingleNoteXml = (noteXml, notationXml) => {
    if (noteXml.includes("<notations>")) {
        return noteXml.replace("</notations>", `${notationXml}</notations>`);
    }
    return noteXml.replace("</note>", `<notations>${notationXml}</notations></note>`);
};
const addOrnamentXmlToSingleNoteXml = (noteXml, ornamentXml) => {
    if (noteXml.includes("<ornaments>")) {
        return noteXml.replace("</ornaments>", `${ornamentXml}</ornaments>`);
    }
    return addNotationXmlToSingleNoteXml(noteXml, `<ornaments>${ornamentXml}</ornaments>`);
};
const addArticulationXmlToSingleNoteXml = (noteXml, articulationXml) => {
    if (noteXml.includes("<articulations>")) {
        return noteXml.replace("</articulations>", `${articulationXml}</articulations>`);
    }
    return addNotationXmlToSingleNoteXml(noteXml, `<articulations>${articulationXml}</articulations>`);
};
const addSlurNotationToEventXml = (eventXml, type, number) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addSlurNotationToSingleNoteXml(noteBlock, type, number) + after;
};
const addTieNotationToEventXml = (eventXml, type) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addTieToSingleNoteXml(noteBlock, type) + after;
};
const addTrillNotationToEventXml = (eventXml) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addOrnamentXmlToSingleNoteXml(noteBlock, "<trill-mark/>") + after;
};
const addFermataNotationToEventXml = (eventXml, isBelow) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    const typeAttr = isBelow ? ' type="inverted"' : "";
    return before + addNotationXmlToSingleNoteXml(noteBlock, `<fermata${typeAttr}/>`) + after;
};
const addGlissNotationToEventXml = (eventXml, type, number) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addNotationXmlToSingleNoteXml(noteBlock, `<glissando type="${type}" number="${number}"/>`) + after;
};
const addSlideNotationToEventXml = (eventXml, type, number) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addNotationXmlToSingleNoteXml(noteBlock, `<slide type="${type}" number="${number}"/>`) + after;
};
const addTurnNotationToEventXml = (eventXml, isInverted) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addOrnamentXmlToSingleNoteXml(noteBlock, isInverted ? "<inverted-turn/>" : "<turn/>") + after;
};
const addMordentNotationToEventXml = (eventXml, isInverted) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addOrnamentXmlToSingleNoteXml(noteBlock, isInverted ? "<inverted-mordent/>" : "<mordent/>") + after;
};
const addBreathNotationToEventXml = (eventXml) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addArticulationXmlToSingleNoteXml(noteBlock, "<breath-mark/>") + after;
};
const addCaesuraNotationToEventXml = (eventXml) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addArticulationXmlToSingleNoteXml(noteBlock, "<caesura/>") + after;
};
const addTupletNotationToEventXml = (eventXml, type, number) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addNotationXmlToSingleNoteXml(noteBlock, `<tuplet type="${type}" number="${number}"/>`) + after;
};
const addBeamToSingleNoteXml = (noteXml, value, number = 1) => {
    if (noteXml.includes(`<beam number="${number}">`))
        return noteXml;
    return noteXml.replace("</note>", `<beam number="${number}">${value}</beam></note>`);
};
const addBeamToEventXml = (eventXml, value, number = 1) => {
    const firstNoteStart = eventXml.indexOf("<note>");
    if (firstNoteStart < 0)
        return eventXml;
    const firstNoteEnd = eventXml.indexOf("</note>", firstNoteStart);
    if (firstNoteEnd < 0)
        return eventXml;
    const before = eventXml.slice(0, firstNoteStart);
    const noteBlock = eventXml.slice(firstNoteStart, firstNoteEnd + "</note>".length);
    const after = eventXml.slice(firstNoteEnd + "</note>".length);
    return before + addBeamToSingleNoteXml(noteBlock, value, number) + after;
};
const parseMeiTstampToTicks = (tstamp, divisions, beatType) => {
    const raw = String(tstamp || "").trim();
    if (!/^\d+(\.\d+)?$/.test(raw))
        return null;
    const beatPos = Number.parseFloat(raw);
    if (!Number.isFinite(beatPos) || beatPos < 1)
        return null;
    const ticksPerBeat = Math.max(1, (4 * divisions) / Math.max(1, beatType));
    return Math.max(0, Math.round((beatPos - 1) * ticksPerBeat));
};
const resolveEventIndexByTstamp = (events, targetTick) => {
    if (!Number.isFinite(targetTick) || targetTick < 0)
        return null;
    let cursor = 0;
    let lastPitchedIndex = null;
    for (let i = 0; i < events.length; i += 1) {
        const event = events[i];
        if (event.kind !== "rest") {
            lastPitchedIndex = i;
            if (cursor >= targetTick)
                return i;
        }
        cursor += Math.max(0, event.durationTicks);
    }
    return lastPitchedIndex;
};
const resolveEventStartTickByIndex = (events, eventIndex) => {
    if (!Number.isInteger(eventIndex) || eventIndex < 0 || eventIndex >= events.length)
        return null;
    let cursor = 0;
    for (let i = 0; i < events.length; i += 1) {
        if (i === eventIndex)
            return cursor;
        cursor += Math.max(0, events[i].durationTicks);
    }
    return null;
};
const resolveControlEventEndpointIndex = (rawId, tstamp, idToEventIndex, events, divisions, beatType, rawPlist, idToEventTick) => {
    const id = rawId.startsWith("#") ? rawId.slice(1) : "";
    if (id) {
        const idx = idToEventIndex.get(id);
        if (Number.isInteger(idx))
            return idx;
        const tick = idToEventTick === null || idToEventTick === void 0 ? void 0 : idToEventTick.get(id);
        if (Number.isFinite(tick)) {
            const byTick = resolveEventIndexByTstamp(events, Math.max(0, Math.round(tick)));
            if (Number.isInteger(byTick))
                return byTick;
        }
    }
    const plist = String(rawPlist || "").trim();
    if (plist) {
        const candidates = plist
            .split(/\s+/)
            .map((token) => token.trim())
            .filter(Boolean)
            .map((token) => (token.startsWith("#") ? token.slice(1) : token));
        for (const candidate of candidates) {
            const idx = idToEventIndex.get(candidate);
            if (Number.isInteger(idx))
                return idx;
            const tick = idToEventTick === null || idToEventTick === void 0 ? void 0 : idToEventTick.get(candidate);
            if (Number.isFinite(tick)) {
                const byTick = resolveEventIndexByTstamp(events, Math.max(0, Math.round(tick)));
                if (Number.isInteger(byTick))
                    return byTick;
            }
        }
    }
    const ticks = parseMeiTstampToTicks(tstamp, divisions, beatType);
    if (ticks === null)
        return null;
    return resolveEventIndexByTstamp(events, ticks);
};
const DYNAMICS_TAGS = new Set([
    "pppp", "ppp", "pp", "p", "mp", "mf", "f", "ff", "fff", "ffff", "fp", "sf", "sfz", "sffz", "rfz", "rf", "fz",
]);
const parseHarmonyAlter = (token) => {
    const v = token.trim();
    if (v === "#" || v === "â™¯")
        return 1;
    if (v === "b" || v === "â™­")
        return -1;
    if (v === "x" || v === "##")
        return 2;
    return 0;
};
const collectScoreDefsInDocOrder = (root) => Array.from(root.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "scoreDef");
const collectStaffDefsInDocOrder = (root) => Array.from(root.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "staffDef");
const findEffectiveScoreDefForNode = (node, scoreDefs) => {
    let out = null;
    for (const scoreDef of scoreDefs) {
        const relation = scoreDef.compareDocumentPosition(node);
        if ((relation & Node.DOCUMENT_POSITION_FOLLOWING) !== 0 || scoreDef === node) {
            out = scoreDef;
            continue;
        }
        if ((relation & Node.DOCUMENT_POSITION_PRECEDING) !== 0) {
            break;
        }
    }
    return out;
};
const findEffectiveStaffDefForNode = (node, staffNo, staffDefs) => {
    let out = null;
    for (const staffDef of staffDefs) {
        const relation = staffDef.compareDocumentPosition(node);
        if ((relation & Node.DOCUMENT_POSITION_FOLLOWING) !== 0 || staffDef === node) {
            const n = (staffDef.getAttribute("n") || "").trim();
            if (!n || n === staffNo)
                out = staffDef;
            continue;
        }
        if ((relation & Node.DOCUMENT_POSITION_PRECEDING) !== 0) {
            break;
        }
    }
    return out;
};
const parseTransposeFromStaffDefElement = (staffDef) => {
    if (!staffDef)
        return null;
    const out = {};
    const diatonic = parseIntSafe(staffDef.getAttribute("trans.diat"), NaN);
    const chromatic = parseIntSafe(staffDef.getAttribute("trans.semi"), NaN);
    if (Number.isFinite(chromatic))
        out.chromatic = Math.round(chromatic);
    if (Number.isFinite(diatonic))
        out.diatonic = Math.round(diatonic);
    return Object.keys(out).length ? out : null;
};
const parseClefFromScoreDefForStaff = (scoreDef, staffNo) => {
    var _a;
    if (!scoreDef)
        return null;
    const staffDefs = Array.from(scoreDef.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "staffDef");
    const matched = (_a = staffDefs.find((staffDef) => { var _a; return (((_a = staffDef.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || "") === staffNo; })) !== null && _a !== void 0 ? _a : staffDefs.find((staffDef) => !staffDef.getAttribute("n"));
    if (!matched)
        return null;
    const clefFromDef = parseClefFromStaffDefElement(matched);
    if (!clefFromDef)
        return null;
    const clefSign = clefFromDef.clefSign;
    const clefLine = clefFromDef.clefLine;
    if (!clefSign || !Number.isFinite(clefLine))
        return null;
    return { clefSign, clefLine: Math.max(1, Math.round(clefLine)) };
};
const parseClefFromStaffDefElement = (staffDef) => {
    var _a;
    if (!staffDef)
        return null;
    const attrSign = (((_a = staffDef.getAttribute("clef.shape")) === null || _a === void 0 ? void 0 : _a.trim().toUpperCase()) || "").trim();
    const attrLine = parseIntSafe(staffDef.getAttribute("clef.line"), NaN);
    if (attrSign && Number.isFinite(attrLine)) {
        return { clefSign: attrSign, clefLine: Math.max(1, Math.round(attrLine)) };
    }
    const clefChild = childElementsByName(staffDef, "clef")[0];
    if (!clefChild)
        return null;
    const childSign = (clefChild.getAttribute("shape")
        || clefChild.getAttribute("clef.shape")
        || "").trim().toUpperCase();
    const childLine = parseIntSafe(clefChild.getAttribute("line") || clefChild.getAttribute("clef.line"), NaN);
    if (!childSign || !Number.isFinite(childLine))
        return null;
    return { clefSign: childSign, clefLine: Math.max(1, Math.round(childLine)) };
};
const parseKeySigFromScoreDefForStaff = (scoreDef, staffNo, fallbackFifths) => {
    var _a;
    if (!scoreDef)
        return fallbackFifths;
    const staffDefs = Array.from(scoreDef.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "staffDef");
    const matched = (_a = staffDefs.find((staffDef) => { var _a; return (((_a = staffDef.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || "") === staffNo; })) !== null && _a !== void 0 ? _a : staffDefs.find((staffDef) => !staffDef.getAttribute("n"));
    const staffFifths = parseMeiKeyFifthsFromElement(matched);
    if (staffFifths !== null)
        return staffFifths;
    const scoreFifths = parseMeiKeyFifthsFromElement(scoreDef);
    if (scoreFifths !== null)
        return scoreFifths;
    return fallbackFifths;
};
const parseTransposeFromScoreDefForStaff = (scoreDef, staffNo) => {
    var _a;
    if (!scoreDef)
        return null;
    const staffDefs = Array.from(scoreDef.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "staffDef");
    const matched = (_a = staffDefs.find((staffDef) => { var _a; return (((_a = staffDef.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || "") === staffNo; })) !== null && _a !== void 0 ? _a : staffDefs.find((staffDef) => !staffDef.getAttribute("n"));
    const out = {};
    const matchedDiatonic = parseIntSafe(matched === null || matched === void 0 ? void 0 : matched.getAttribute("trans.diat"), NaN);
    const matchedChromatic = parseIntSafe(matched === null || matched === void 0 ? void 0 : matched.getAttribute("trans.semi"), NaN);
    if (Number.isFinite(matchedChromatic))
        out.chromatic = Math.round(matchedChromatic);
    if (Number.isFinite(matchedDiatonic))
        out.diatonic = Math.round(matchedDiatonic);
    if (Object.keys(out).length)
        return out;
    const scoreDiatonic = parseIntSafe(scoreDef.getAttribute("trans.diat"), NaN);
    const scoreChromatic = parseIntSafe(scoreDef.getAttribute("trans.semi"), NaN);
    if (Number.isFinite(scoreChromatic))
        out.chromatic = Math.round(scoreChromatic);
    if (Number.isFinite(scoreDiatonic))
        out.diatonic = Math.round(scoreDiatonic);
    return Object.keys(out).length ? out : null;
};
const buildTransposeXml = (transpose) => {
    if (!transpose)
        return "";
    const chromatic = Number.isFinite(transpose.chromatic) ? Math.round(Number(transpose.chromatic)) : null;
    const diatonic = Number.isFinite(transpose.diatonic) ? Math.round(Number(transpose.diatonic)) : null;
    if (chromatic === null && diatonic === null)
        return "";
    return `<transpose>${diatonic !== null ? `<diatonic>${diatonic}</diatonic>` : ""}${chromatic !== null ? `<chromatic>${chromatic}</chromatic>` : ""}</transpose>`;
};
const parseMeiHarmText = (text) => {
    const raw = text.trim();
    const m = raw.match(/^([A-Ga-g])([#bxâ™­â™¯]?)([^/]*)(?:\/([A-Ga-g])([#bxâ™­â™¯]?))?$/);
    if (!m)
        return null;
    const rootStep = m[1].toUpperCase();
    const rootAlter = parseHarmonyAlter(m[2] || "");
    const suffix = (m[3] || "").trim();
    const bassStep = m[4] ? m[4].toUpperCase() : undefined;
    const bassAlter = parseHarmonyAlter(m[5] || "");
    const suffixLower = suffix.toLowerCase();
    let kind = "major";
    let kindText = "";
    if (!suffix) {
        kind = "major";
    }
    else if (suffixLower === "m" || suffixLower === "min" || suffixLower === "-") {
        kind = "minor";
    }
    else if (suffixLower === "7") {
        kind = "dominant";
    }
    else if (suffixLower === "maj7" || suffixLower === "m7+" || suffixLower === "Î”7".toLowerCase()) {
        kind = "major-seventh";
    }
    else if (suffixLower === "m7" || suffixLower === "min7" || suffixLower === "-7") {
        kind = "minor-seventh";
    }
    else if (suffixLower === "dim" || suffixLower === "o") {
        kind = "diminished";
    }
    else if (suffixLower === "aug" || suffixLower === "+") {
        kind = "augmented";
    }
    else {
        kind = "other";
        kindText = suffix;
    }
    const degrees = [];
    const degreeRe = /([#bâ™¯â™­x]|##)\s*(\d{1,2})/g;
    let dm = degreeRe.exec(suffix);
    while (dm) {
        const alter = parseHarmonyAlter(dm[1] || "");
        const value = Number.parseInt(dm[2] || "", 10);
        if (Number.isFinite(value) && value > 0 && alter !== 0) {
            degrees.push({ value: Math.round(value), alter });
        }
        dm = degreeRe.exec(suffix);
    }
    return {
        rootStep,
        rootAlter: rootAlter !== 0 ? rootAlter : undefined,
        kind,
        kindText: kindText || undefined,
        bassStep,
        bassAlter: bassStep && bassAlter !== 0 ? bassAlter : undefined,
        degrees,
    };
};
const buildMusicXmlDirectionFromMeiDynam = (dynam, divisions, beatType, voice, staffNo) => {
    const rawText = (dynam.textContent || "").trim();
    if (!rawText)
        return null;
    const normalized = rawText.toLowerCase();
    const placement = (dynam.getAttribute("place") || dynam.getAttribute("placement") || "").trim().toLowerCase();
    const placementAttr = placement === "above" || placement === "below" ? ` placement="${placement}"` : "";
    const offsetTicks = parseMeiTstampToTicks(dynam.getAttribute("tstamp"), divisions, beatType);
    const offsetXml = Number.isFinite(offsetTicks) && offsetTicks > 0
        ? `<offset>${Math.round(offsetTicks)}</offset>`
        : "";
    const directionType = DYNAMICS_TAGS.has(normalized)
        ? `<dynamics><${normalized}/></dynamics>`
        : `<words>${xmlEscape(rawText)}</words>`;
    return `<direction${placementAttr}><direction-type>${directionType}</direction-type>${offsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
};
const buildMusicXmlDirectionsFromMeiHairpin = (hairpin, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick) => {
    const formRaw = (hairpin.getAttribute("form") || hairpin.getAttribute("type") || "").trim().toLowerCase();
    const wedgeType = formRaw.includes("dim") || formRaw.includes("decresc") ? "diminuendo" : "crescendo";
    const placement = (hairpin.getAttribute("place") || hairpin.getAttribute("placement") || "").trim().toLowerCase();
    const placementAttr = placement === "above" || placement === "below" ? ` placement="${placement}"` : "";
    const startIndex = resolveControlEventEndpointIndex((hairpin.getAttribute("startid") || "").trim(), hairpin.getAttribute("tstamp"), idToEventIndex, events, divisions, beatType, hairpin.getAttribute("plist"), idToEventTick);
    const endIndex = resolveControlEventEndpointIndex((hairpin.getAttribute("endid") || "").trim(), hairpin.getAttribute("tstamp2"), idToEventIndex, events, divisions, beatType, undefined, idToEventTick);
    const startTick = Number.isInteger(startIndex) ? resolveEventStartTickByIndex(events, startIndex) : null;
    const endTick = Number.isInteger(endIndex) ? resolveEventStartTickByIndex(events, endIndex) : null;
    const startOffsetXml = Number.isFinite(startTick) && startTick > 0
        ? `<offset>${Math.round(startTick)}</offset>`
        : "";
    const endOffsetXml = Number.isFinite(endTick) && endTick > 0
        ? `<offset>${Math.round(endTick)}</offset>`
        : "";
    const startDir = `<direction${placementAttr}><direction-type><wedge type="${wedgeType}"/></direction-type>${startOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
    const stopDir = `<direction${placementAttr}><direction-type><wedge type="stop"/></direction-type>${endOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
    return `${startDir}${stopDir}`;
};
const buildMusicXmlDirectionsFromMeiPedal = (pedal, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick) => {
    const placement = (pedal.getAttribute("place") || pedal.getAttribute("placement") || "").trim().toLowerCase();
    const placementAttr = placement === "above" || placement === "below" ? ` placement="${placement}"` : "";
    const semanticRaw = (pedal.getAttribute("type")
        || pedal.getAttribute("state")
        || pedal.getAttribute("func")
        || pedal.getAttribute("val")
        || "").trim().toLowerCase();
    const isExplicitStop = semanticRaw.includes("stop")
        || semanticRaw.includes("end")
        || semanticRaw.includes("off")
        || semanticRaw.includes("up")
        || semanticRaw.includes("release");
    const startIndex = resolveControlEventEndpointIndex((pedal.getAttribute("startid") || "").trim(), pedal.getAttribute("tstamp"), idToEventIndex, events, divisions, beatType, pedal.getAttribute("plist"), idToEventTick);
    const endIndex = resolveControlEventEndpointIndex((pedal.getAttribute("endid") || "").trim(), pedal.getAttribute("tstamp2"), idToEventIndex, events, divisions, beatType, undefined, idToEventTick);
    const startTick = Number.isInteger(startIndex) ? resolveEventStartTickByIndex(events, startIndex) : null;
    const endTick = Number.isInteger(endIndex) ? resolveEventStartTickByIndex(events, endIndex) : null;
    const startOffsetXml = Number.isFinite(startTick) && startTick > 0
        ? `<offset>${Math.round(startTick)}</offset>`
        : "";
    const endOffsetXml = Number.isFinite(endTick) && endTick > 0
        ? `<offset>${Math.round(endTick)}</offset>`
        : "";
    if (Number.isInteger(endIndex)) {
        const startDir = `<direction${placementAttr}><direction-type><pedal type="start" number="1" line="yes"/></direction-type>${startOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
        const stopDir = `<direction${placementAttr}><direction-type><pedal type="stop" number="1" line="yes"/></direction-type>${endOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
        return `${startDir}${stopDir}`;
    }
    const singleType = isExplicitStop ? "stop" : "start";
    return `<direction${placementAttr}><direction-type><pedal type="${singleType}" number="1" line="yes"/></direction-type>${startOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
};
const buildMusicXmlDirectionsFromMeiOctave = (octave, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick) => {
    const placement = (octave.getAttribute("place") || octave.getAttribute("placement") || "").trim().toLowerCase();
    const placementAttr = placement === "above" || placement === "below" ? ` placement="${placement}"` : "";
    const semanticRaw = (octave.getAttribute("type")
        || octave.getAttribute("state")
        || octave.getAttribute("func")
        || octave.getAttribute("val")
        || "").trim().toLowerCase();
    const isExplicitStop = semanticRaw.includes("stop")
        || semanticRaw.includes("end")
        || semanticRaw.includes("off");
    const disRaw = (octave.getAttribute("dis") || octave.getAttribute("size") || "").trim();
    const dis = Number.parseInt(disRaw, 10);
    const size = Number.isFinite(dis) && dis > 0 ? Math.round(dis) : 8;
    const disPlace = (octave.getAttribute("dis.place") || placement).trim().toLowerCase();
    const shiftType = disPlace === "below" ? "down" : "up";
    const startIndex = resolveControlEventEndpointIndex((octave.getAttribute("startid") || "").trim(), octave.getAttribute("tstamp"), idToEventIndex, events, divisions, beatType, octave.getAttribute("plist"), idToEventTick);
    const endIndex = resolveControlEventEndpointIndex((octave.getAttribute("endid") || "").trim(), octave.getAttribute("tstamp2"), idToEventIndex, events, divisions, beatType, undefined, idToEventTick);
    const startTick = Number.isInteger(startIndex) ? resolveEventStartTickByIndex(events, startIndex) : null;
    const endTick = Number.isInteger(endIndex) ? resolveEventStartTickByIndex(events, endIndex) : null;
    const startOffsetXml = Number.isFinite(startTick) && startTick > 0
        ? `<offset>${Math.round(startTick)}</offset>`
        : "";
    const endOffsetXml = Number.isFinite(endTick) && endTick > 0
        ? `<offset>${Math.round(endTick)}</offset>`
        : "";
    if (Number.isInteger(endIndex)) {
        const startDir = `<direction${placementAttr}><direction-type><octave-shift type="${shiftType}" size="${size}" number="1"/></direction-type>${startOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
        const stopDir = `<direction${placementAttr}><direction-type><octave-shift type="stop" size="${size}" number="1"/></direction-type>${endOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
        return `${startDir}${stopDir}`;
    }
    const singleType = isExplicitStop ? "stop" : shiftType;
    return `<direction${placementAttr}><direction-type><octave-shift type="${singleType}" size="${size}" number="1"/></direction-type>${startOffsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
};
const buildMusicXmlDirectionFromMeiRepeatMark = (repeatMark, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick) => {
    const textRaw = (repeatMark.getAttribute("func")
        || repeatMark.getAttribute("type")
        || repeatMark.getAttribute("label")
        || repeatMark.textContent
        || "").trim();
    if (!textRaw)
        return null;
    const normalized = textRaw.toLowerCase();
    const placement = (repeatMark.getAttribute("place") || repeatMark.getAttribute("placement") || "").trim().toLowerCase();
    const placementAttr = placement === "above" || placement === "below" ? ` placement="${placement}"` : "";
    const startIndex = resolveControlEventEndpointIndex((repeatMark.getAttribute("startid") || "").trim(), repeatMark.getAttribute("tstamp"), idToEventIndex, events, divisions, beatType, repeatMark.getAttribute("plist"), idToEventTick);
    const startTick = Number.isInteger(startIndex) ? resolveEventStartTickByIndex(events, startIndex) : null;
    const offsetXml = Number.isFinite(startTick) && startTick > 0
        ? `<offset>${Math.round(startTick)}</offset>`
        : "";
    let directionType = `<words>${xmlEscape(textRaw)}</words>`;
    if (normalized.includes("segno"))
        directionType = "<segno/>";
    else if (normalized.includes("coda"))
        directionType = "<coda/>";
    else if (normalized.includes("fine"))
        directionType = "<words>Fine</words>";
    else if (normalized.includes("dacapo") || normalized.includes("da capo") || normalized.includes("d.c."))
        directionType = "<words>D.C.</words>";
    else if (normalized.includes("dalsegno") || normalized.includes("dal segno") || normalized.includes("d.s."))
        directionType = "<words>D.S.</words>";
    return `<direction${placementAttr}><direction-type>${directionType}</direction-type>${offsetXml}<voice>${xmlEscape(voice)}</voice><staff>${xmlEscape(staffNo)}</staff></direction>`;
};
const buildMusicXmlHarmonyFromMeiHarm = (harm, divisions, beatType, staffNo, events, idToEventIndex, idToEventTick) => {
    const raw = (harm.textContent || harm.getAttribute("type") || harm.getAttribute("label") || "").trim();
    if (!raw)
        return null;
    const parsed = parseMeiHarmText(raw);
    if (!parsed) {
        return `<harmony><kind text="${xmlEscape(raw)}">other</kind><staff>${xmlEscape(staffNo)}</staff></harmony>`;
    }
    const rootXml = `<root><root-step>${xmlEscape(parsed.rootStep)}</root-step>${Number.isFinite(parsed.rootAlter) ? `<root-alter>${Math.round(parsed.rootAlter)}</root-alter>` : ""}</root>`;
    const kindXml = parsed.kindText
        ? `<kind text="${xmlEscape(parsed.kindText)}">${xmlEscape(parsed.kind)}</kind>`
        : `<kind>${xmlEscape(parsed.kind)}</kind>`;
    const bassXml = parsed.bassStep
        ? `<bass><bass-step>${xmlEscape(parsed.bassStep)}</bass-step>${Number.isFinite(parsed.bassAlter) ? `<bass-alter>${Math.round(parsed.bassAlter)}</bass-alter>` : ""}</bass>`
        : "";
    const degreeXml = parsed.degrees
        .map((deg) => `<degree><degree-value>${deg.value}</degree-value><degree-alter>${deg.alter}</degree-alter><degree-type>add</degree-type></degree>`)
        .join("");
    const startIndex = resolveControlEventEndpointIndex((harm.getAttribute("startid") || "").trim(), harm.getAttribute("tstamp"), idToEventIndex, events, divisions, beatType, harm.getAttribute("plist"), idToEventTick);
    const startTick = Number.isInteger(startIndex) ? resolveEventStartTickByIndex(events, startIndex) : null;
    const offsetXml = Number.isFinite(startTick) && startTick > 0
        ? `<offset>${Math.round(startTick)}</offset>`
        : "";
    return `<harmony>${rootXml}${kindXml}${bassXml}${degreeXml}${offsetXml}<staff>${xmlEscape(staffNo)}</staff></harmony>`;
};
const collectLayerHarmonyXml = (staff, layer, divisions, beatType, events, idToEventIndex, idToEventTick) => {
    const staffNo = (staff.getAttribute("n") || "1").trim() || "1";
    const harms = [...childElementsByName(layer, "harm"), ...childElementsByName(staff, "harm")];
    const out = [];
    for (const harm of harms) {
        const xml = buildMusicXmlHarmonyFromMeiHarm(harm, divisions, beatType, staffNo, events, idToEventIndex, idToEventTick);
        if (xml)
            out.push(xml);
    }
    return out.join("");
};
const parseMeiTargetList = (raw) => {
    const value = String(raw || "").trim();
    if (!value)
        return [];
    return value
        .split(/[\s,]+/)
        .map((v) => v.trim())
        .filter(Boolean);
};
const controlEventAppliesToLayer = (control, staffNo, layerNo, primaryLayerNo) => {
    const staffTargets = parseMeiTargetList(control.getAttribute("staff") || "");
    if (staffTargets.length > 0 && !staffTargets.includes(staffNo))
        return false;
    const layerTargets = parseMeiTargetList(control.getAttribute("layer") || "");
    if (layerTargets.length > 0)
        return layerTargets.includes(layerNo);
    // Unscoped staff/measure-level controls should be emitted once (primary layer only).
    const parent = control.parentElement;
    const parentName = parent ? localNameOf(parent) : "";
    if (parentName === "staff" || parentName === "measure") {
        return layerNo === primaryLayerNo;
    }
    return true;
};
const collectControlEventsForLayer = (name, staff, layer, staffNo, layerNo, primaryLayerNo) => {
    const measure = staff.parentElement && localNameOf(staff.parentElement) === "measure" ? staff.parentElement : null;
    const controls = [
        ...childElementsByName(layer, name),
        ...childElementsByName(staff, name),
        ...(measure ? childElementsByName(measure, name) : []),
    ];
    return controls.filter((control) => controlEventAppliesToLayer(control, staffNo, layerNo, primaryLayerNo));
};
const collectLayerDirectionXml = (staff, layer, divisions, beatType, voice, events, idToEventIndex, idToEventTick) => {
    var _a;
    const staffNo = (staff.getAttribute("n") || "1").trim() || "1";
    const layerNo = (layer.getAttribute("n") || "1").trim() || "1";
    const primaryLayerNo = (((_a = childElementsByName(staff, "layer")[0]) === null || _a === void 0 ? void 0 : _a.getAttribute("n")) || "1").trim() || "1";
    const dyns = collectControlEventsForLayer("dynam", staff, layer, staffNo, layerNo, primaryLayerNo);
    const hairpins = collectControlEventsForLayer("hairpin", staff, layer, staffNo, layerNo, primaryLayerNo);
    const pedals = collectControlEventsForLayer("pedal", staff, layer, staffNo, layerNo, primaryLayerNo);
    const octaves = collectControlEventsForLayer("octave", staff, layer, staffNo, layerNo, primaryLayerNo);
    const repeatMarks = collectControlEventsForLayer("repeatMark", staff, layer, staffNo, layerNo, primaryLayerNo);
    const out = [];
    for (const dynam of dyns) {
        const xml = buildMusicXmlDirectionFromMeiDynam(dynam, divisions, beatType, voice, staffNo);
        if (xml)
            out.push(xml);
    }
    for (const hairpin of hairpins) {
        const xml = buildMusicXmlDirectionsFromMeiHairpin(hairpin, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick);
        if (xml)
            out.push(xml);
    }
    for (const pedal of pedals) {
        const xml = buildMusicXmlDirectionsFromMeiPedal(pedal, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick);
        if (xml)
            out.push(xml);
    }
    for (const octave of octaves) {
        const xml = buildMusicXmlDirectionsFromMeiOctave(octave, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick);
        if (xml)
            out.push(xml);
    }
    for (const repeatMark of repeatMarks) {
        const xml = buildMusicXmlDirectionFromMeiRepeatMark(repeatMark, divisions, beatType, voice, staffNo, events, idToEventIndex, idToEventTick);
        if (xml)
            out.push(xml);
    }
    return out.join("");
};
const applyStaffSlurControlEvents = (staff, layer, layerEvents, idToEventIndex, idToEventTick, divisions, beatType) => {
    if (layerEvents.length === 0)
        return layerEvents;
    const out = layerEvents.slice();
    const slurs = [...childElementsByName(layer, "slur"), ...childElementsByName(staff, "slur")];
    let slurNumber = 1;
    for (const slur of slurs) {
        const startIdRaw = (slur.getAttribute("startid") || "").trim();
        const endIdRaw = (slur.getAttribute("endid") || "").trim();
        const startIndex = resolveControlEventEndpointIndex(startIdRaw, slur.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, slur.getAttribute("plist"), idToEventTick);
        const endIndex = resolveControlEventEndpointIndex(endIdRaw, slur.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType, undefined, idToEventTick);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const endEvent = out[endIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addSlurNotationToEventXml(startEvent.xml, "start", slurNumber) };
        }
        if (endEvent.kind !== "rest") {
            out[endIndex] = { ...endEvent, xml: addSlurNotationToEventXml(endEvent.xml, "stop", slurNumber) };
        }
        slurNumber += 1;
    }
    const ties = [...childElementsByName(layer, "tie"), ...childElementsByName(staff, "tie")];
    for (const tie of ties) {
        const startIdRaw = (tie.getAttribute("startid") || "").trim();
        const endIdRaw = (tie.getAttribute("endid") || "").trim();
        const startIndex = resolveControlEventEndpointIndex(startIdRaw, tie.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, tie.getAttribute("plist"), idToEventTick);
        const endIndex = resolveControlEventEndpointIndex(endIdRaw, tie.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType, undefined, idToEventTick);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const endEvent = out[endIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addTieNotationToEventXml(startEvent.xml, "start") };
        }
        if (endEvent.kind !== "rest") {
            out[endIndex] = { ...endEvent, xml: addTieNotationToEventXml(endEvent.xml, "stop") };
        }
    }
    const trills = [...childElementsByName(layer, "trill"), ...childElementsByName(staff, "trill")];
    for (const trill of trills) {
        const startIndex = resolveControlEventEndpointIndex((trill.getAttribute("startid") || "").trim(), trill.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, trill.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addTrillNotationToEventXml(startEvent.xml) };
        }
    }
    const fermatas = [...childElementsByName(layer, "fermata"), ...childElementsByName(staff, "fermata")];
    for (const fermata of fermatas) {
        const startIndex = resolveControlEventEndpointIndex((fermata.getAttribute("startid") || "").trim(), fermata.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, fermata.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const placement = (fermata.getAttribute("place") || fermata.getAttribute("placement") || "").trim().toLowerCase();
        if (startEvent.kind !== "rest") {
            out[startIndex] = {
                ...startEvent,
                xml: addFermataNotationToEventXml(startEvent.xml, placement === "below"),
            };
        }
    }
    const turns = [...childElementsByName(layer, "turn"), ...childElementsByName(staff, "turn")];
    for (const turn of turns) {
        const startIndex = resolveControlEventEndpointIndex((turn.getAttribute("startid") || "").trim(), turn.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, turn.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const turnType = (turn.getAttribute("type") || turn.getAttribute("form") || "").trim().toLowerCase();
        const isInverted = turnType.includes("inv") || turnType.includes("lower") || turnType.includes("down");
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addTurnNotationToEventXml(startEvent.xml, isInverted) };
        }
    }
    const mordents = [...childElementsByName(layer, "mordent"), ...childElementsByName(staff, "mordent")];
    for (const mordent of mordents) {
        const startIndex = resolveControlEventEndpointIndex((mordent.getAttribute("startid") || "").trim(), mordent.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, mordent.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const mordentType = (mordent.getAttribute("type") || mordent.getAttribute("form") || "").trim().toLowerCase();
        const isInverted = mordentType.includes("inv") || mordentType.includes("lower") || mordentType.includes("down");
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addMordentNotationToEventXml(startEvent.xml, isInverted) };
        }
    }
    const breaths = [...childElementsByName(layer, "breath"), ...childElementsByName(staff, "breath")];
    for (const breath of breaths) {
        const startIndex = resolveControlEventEndpointIndex((breath.getAttribute("startid") || "").trim(), breath.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, breath.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addBreathNotationToEventXml(startEvent.xml) };
        }
    }
    const caesuras = [...childElementsByName(layer, "caesura"), ...childElementsByName(staff, "caesura")];
    for (const caesura of caesuras) {
        const startIndex = resolveControlEventEndpointIndex((caesura.getAttribute("startid") || "").trim(), caesura.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, caesura.getAttribute("plist"), idToEventTick);
        if (!Number.isInteger(startIndex))
            continue;
        if (startIndex < 0 || startIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addCaesuraNotationToEventXml(startEvent.xml) };
        }
    }
    const tupletSpans = [...childElementsByName(layer, "tupletSpan"), ...childElementsByName(staff, "tupletSpan")];
    let tupletNumber = 1;
    const beamSpans = [...childElementsByName(layer, "beamSpan"), ...childElementsByName(staff, "beamSpan")];
    for (const beamSpan of beamSpans) {
        const startIndex = resolveControlEventEndpointIndex((beamSpan.getAttribute("startid") || "").trim(), beamSpan.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, beamSpan.getAttribute("plist"));
        const endIndex = resolveControlEventEndpointIndex((beamSpan.getAttribute("endid") || "").trim(), beamSpan.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const plistRaw = String(beamSpan.getAttribute("plist") || "").trim();
        const plistIndexes = plistRaw
            ? plistRaw
                .split(/\s+/)
                .map((token) => token.trim())
                .filter(Boolean)
                .map((token) => (token.startsWith("#") ? token.slice(1) : token))
                .map((id) => idToEventIndex.get(id))
                .filter((idx) => Number.isInteger(idx))
            : [];
        const spanIndexes = plistIndexes.length > 0
            ? plistIndexes
            : (() => {
                const from = Math.min(startIndex, endIndex);
                const to = Math.max(startIndex, endIndex);
                const arr = [];
                for (let i = from; i <= to; i += 1)
                    arr.push(i);
                return arr;
            })();
        const pitchedIndexes = spanIndexes.filter((idx) => idx >= 0 && idx < out.length && out[idx].kind !== "rest");
        if (pitchedIndexes.length < 2)
            continue;
        for (let i = 0; i < pitchedIndexes.length; i += 1) {
            const idx = pitchedIndexes[i];
            const value = i === 0 ? "begin" : i === pitchedIndexes.length - 1 ? "end" : "continue";
            out[idx] = { ...out[idx], xml: addBeamToEventXml(out[idx].xml, value, 1) };
        }
    }
    for (const tupletSpan of tupletSpans) {
        const startIndex = resolveControlEventEndpointIndex((tupletSpan.getAttribute("startid") || "").trim(), tupletSpan.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, tupletSpan.getAttribute("plist"), idToEventTick);
        const endIndex = resolveControlEventEndpointIndex((tupletSpan.getAttribute("endid") || "").trim(), tupletSpan.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType, undefined, idToEventTick);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const endEvent = out[endIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addTupletNotationToEventXml(startEvent.xml, "start", tupletNumber) };
        }
        if (endEvent.kind !== "rest") {
            out[endIndex] = { ...endEvent, xml: addTupletNotationToEventXml(endEvent.xml, "stop", tupletNumber) };
        }
        tupletNumber += 1;
    }
    const glissandi = [...childElementsByName(layer, "gliss"), ...childElementsByName(staff, "gliss")];
    let glissNumber = 1;
    for (const gliss of glissandi) {
        const startIndex = resolveControlEventEndpointIndex((gliss.getAttribute("startid") || "").trim(), gliss.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, gliss.getAttribute("plist"), idToEventTick);
        const endIndex = resolveControlEventEndpointIndex((gliss.getAttribute("endid") || "").trim(), gliss.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType, undefined, idToEventTick);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const endEvent = out[endIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addGlissNotationToEventXml(startEvent.xml, "start", glissNumber) };
        }
        if (endEvent.kind !== "rest") {
            out[endIndex] = { ...endEvent, xml: addGlissNotationToEventXml(endEvent.xml, "stop", glissNumber) };
        }
        glissNumber += 1;
    }
    const slides = [...childElementsByName(layer, "slide"), ...childElementsByName(staff, "slide")];
    let slideNumber = 1;
    for (const slide of slides) {
        const startIndex = resolveControlEventEndpointIndex((slide.getAttribute("startid") || "").trim(), slide.getAttribute("tstamp"), idToEventIndex, out, divisions, beatType, slide.getAttribute("plist"), idToEventTick);
        const endIndex = resolveControlEventEndpointIndex((slide.getAttribute("endid") || "").trim(), slide.getAttribute("tstamp2"), idToEventIndex, out, divisions, beatType, undefined, idToEventTick);
        if (!Number.isInteger(startIndex) || !Number.isInteger(endIndex))
            continue;
        if (startIndex < 0 || endIndex < 0 || startIndex >= out.length || endIndex >= out.length)
            continue;
        const startEvent = out[startIndex];
        const endEvent = out[endIndex];
        if (startEvent.kind !== "rest") {
            out[startIndex] = { ...startEvent, xml: addSlideNotationToEventXml(startEvent.xml, "start", slideNumber) };
        }
        if (endEvent.kind !== "rest") {
            out[endIndex] = { ...endEvent, xml: addSlideNotationToEventXml(endEvent.xml, "stop", slideNumber) };
        }
        slideNumber += 1;
    }
    return out;
};
const applyTieCarryAccidentalsForLayerEvents = (events, tieCarryIn) => {
    if (events.length === 0) {
        return { events, tieCarryOut: new Map(tieCarryIn) };
    }
    const tieCarryByPitch = new Map(tieCarryIn);
    const tiePitchKey = (pname, octave) => `${String(pname || "").trim().toUpperCase()}:${Math.round(Number(octave) || 0)}`;
    const out = events.map((event) => {
        var _a, _b;
        if (event.kind === "rest")
            return event;
        if (!event.xml.includes("<note>"))
            return event;
        const wrapped = `<root>${event.xml}</root>`;
        const parsed = new DOMParser().parseFromString(wrapped, "application/xml");
        const root = parsed.documentElement;
        if (!root || localNameOf(root) !== "root")
            return event;
        const noteNodes = Array.from(root.querySelectorAll(":scope > note"));
        if (noteNodes.length === 0)
            return event;
        let changed = false;
        for (const noteNode of noteNodes) {
            const step = (((_a = noteNode.querySelector(":scope > pitch > step")) === null || _a === void 0 ? void 0 : _a.textContent) || "").trim().toUpperCase();
            const octave = parseIntSafe((_b = noteNode.querySelector(":scope > pitch > octave")) === null || _b === void 0 ? void 0 : _b.textContent, NaN);
            if (!/^[A-G]$/.test(step) || !Number.isFinite(octave))
                continue;
            const pitchKey = tiePitchKey(step, octave);
            const pitchNode = noteNode.querySelector(":scope > pitch");
            if (!pitchNode)
                continue;
            const tieTypes = Array.from(noteNode.querySelectorAll(":scope > tie"))
                .map((tie) => (tie.getAttribute("type") || "").trim().toLowerCase());
            const hasStart = tieTypes.includes("start");
            const hasStop = tieTypes.includes("stop");
            let alterNode = noteNode.querySelector(":scope > pitch > alter");
            const alterMissing = alterNode === null;
            if (hasStop && alterMissing) {
                const carryAlter = tieCarryByPitch.get(pitchKey);
                if (Number.isFinite(carryAlter)) {
                    const newAlter = parsed.createElement("alter");
                    newAlter.textContent = String(Math.round(carryAlter));
                    const octaveNode = noteNode.querySelector(":scope > pitch > octave");
                    if (octaveNode) {
                        pitchNode.insertBefore(newAlter, octaveNode);
                    }
                    else {
                        pitchNode.appendChild(newAlter);
                    }
                    alterNode = newAlter;
                    changed = true;
                }
            }
            const resolvedAlter = parseIntSafe(alterNode === null || alterNode === void 0 ? void 0 : alterNode.textContent, 0);
            if (hasStart) {
                tieCarryByPitch.set(pitchKey, resolvedAlter);
            }
            else if (hasStop) {
                tieCarryByPitch.delete(pitchKey);
            }
        }
        if (!changed)
            return event;
        const serialized = new XMLSerializer().serializeToString(root);
        const xml = serialized.replace(/^<root>/, "").replace(/<\/root>$/, "");
        return { ...event, xml };
    });
    return { events: out, tieCarryOut: tieCarryByPitch };
};
const trimLayerEventsToMeasureCapacity = (events, measureTicks) => {
    const kept = [];
    let totalTicks = 0;
    let droppedCount = 0;
    let droppedTicks = 0;
    let trimmedCount = 0;
    let trimmedTicks = 0;
    for (const event of events) {
        const nextTotal = totalTicks + event.durationTicks;
        if (nextTotal <= measureTicks) {
            kept.push(event);
            totalTicks += event.durationTicks;
            continue;
        }
        const overflow = nextTotal - measureTicks;
        const isMinorOverflow = overflow > 0 && overflow <= Math.max(12, Math.round(event.durationTicks * 0.1));
        if (isMinorOverflow) {
            // Keep tiny overflow as-is to avoid silent note loss from rounding drift
            // (common around tuplet-heavy imported sources).
            kept.push(event);
            totalTicks = nextTotal;
            trimmedCount += 1;
            trimmedTicks += overflow;
            continue;
        }
        droppedCount += 1;
        droppedTicks += event.durationTicks;
    }
    return { events: kept, totalTicks, droppedCount, droppedTicks, trimmedCount, trimmedTicks };
};
const extractMiscFieldsFromMeiStaff = (staff) => {
    var _a, _b, _c;
    const out = [];
    const normalizeName = (rawName) => {
        const name = rawName.trim();
        if (!name)
            return "";
        if (name.startsWith("mks:"))
            return name;
        if (name.startsWith("src:"))
            return `mks:${name}`;
        if (name.startsWith("diag:"))
            return `mks:${name}`;
        return `mks:src:mei:${name}`;
    };
    for (const child of Array.from(staff.children)) {
        if (localNameOf(child) !== "annot")
            continue;
        if ((child.getAttribute("type") || "").trim() !== "musicxml-misc-field")
            continue;
        const name = normalizeName((_a = child.getAttribute("label")) !== null && _a !== void 0 ? _a : "");
        if (!name)
            continue;
        out.push({
            name,
            value: (_c = (_b = child.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "",
        });
    }
    return out;
};
const buildMeiSourceRawMiscFields = (source) => {
    const raw = String(source !== null && source !== void 0 ? source : "");
    if (!raw.length)
        return [];
    const encoded = raw
        .replace(/\\/g, "\\\\")
        .replace(/\r/g, "\\r")
        .replace(/\n/g, "\\n");
    const chunkSize = 240;
    const maxChunks = 512;
    const chunks = [];
    for (let i = 0; i < encoded.length && chunks.length < maxChunks; i += chunkSize) {
        chunks.push(encoded.slice(i, i + chunkSize));
    }
    const truncated = chunks.join("").length < encoded.length;
    const fields = [
        { name: "mks:src:mei:raw-encoding", value: "escape-v1" },
        { name: "mks:src:mei:raw-length", value: String(raw.length) },
        { name: "mks:src:mei:raw-encoded-length", value: String(encoded.length) },
        { name: "mks:src:mei:raw-chunks", value: String(chunks.length) },
        { name: "mks:src:mei:raw-truncated", value: truncated ? "1" : "0" },
    ];
    for (let i = 0; i < chunks.length; i += 1) {
        fields.push({
            name: `mks:src:mei:raw-${String(i + 1).padStart(4, "0")}`,
            value: chunks[i],
        });
    }
    return fields;
};
const parseMeasureMetaFromMeiStaff = (staff) => {
    var _a;
    const metaAnnot = childElementsByName(staff, "annot").find((annot) => {
        var _a, _b;
        const type = ((_a = annot.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
        const label = ((_b = annot.getAttribute("label")) !== null && _b !== void 0 ? _b : "").trim().toLowerCase();
        return type === "musicxml-measure-meta" || label === "mks:measure-meta";
    });
    if (!metaAnnot)
        return null;
    const text = ((_a = metaAnnot.textContent) !== null && _a !== void 0 ? _a : "").trim();
    if (!text)
        return null;
    const out = {};
    for (const token of text.split(";")) {
        const trimmed = token.trim();
        if (!trimmed)
            continue;
        const eq = trimmed.indexOf("=");
        if (eq <= 0)
            continue;
        const k = trimmed.slice(0, eq).trim().toLowerCase();
        const v = trimmed.slice(eq + 1).trim();
        if (!k)
            continue;
        if (k === "number" && v)
            out.number = v;
        if (k === "implicit")
            out.implicit = v === "1" || v.toLowerCase() === "true" || v.toLowerCase() === "yes";
        if (k === "repeat" && (v === "forward" || v === "backward"))
            out.repeat = v;
        if (k === "times") {
            const n = Number.parseInt(v, 10);
            if (Number.isFinite(n) && n > 1)
                out.times = Math.round(n);
        }
        if (k === "explicittime")
            out.explicitTime = v === "1" || v.toLowerCase() === "true" || v.toLowerCase() === "yes";
        if (k === "beats") {
            const n = Number.parseInt(v, 10);
            if (Number.isFinite(n) && n > 0)
                out.beats = Math.max(1, Math.round(n));
        }
        if (k === "beattype") {
            const n = Number.parseInt(v, 10);
            if (Number.isFinite(n) && n > 0)
                out.beatType = Math.max(1, Math.round(n));
        }
        if (k === "doublebar" && (v === "left" || v === "right" || v === "both"))
            out.doubleBar = v;
    }
    return out;
};
const buildMeiDebugFieldsFromStaff = (staff, measureNo, divisions) => {
    var _a, _b;
    const entries = [];
    const layerNodes = childElementsByName(staff, "layer");
    for (let layerIndex = 0; layerIndex < layerNodes.length; layerIndex += 1) {
        const layer = layerNodes[layerIndex];
        const voice = ((_a = layer.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || String(layerIndex + 1);
        let entryIndexInLayer = 0;
        for (const child of Array.from(layer.children)) {
            const kind = localNameOf(child);
            if (kind !== "note" && kind !== "rest" && kind !== "chord")
                continue;
            const durAttr = child.getAttribute("dur") || "4";
            const dots = parseIntSafe(child.getAttribute("dots"), 0);
            const ticks = Math.max(1, Math.round(meiDurToQuarterLength(durAttr) * dotsMultiplier(dots) * divisions));
            const base = [
                `idx=${toHex(entries.length, 4)}`,
                `m=${xmlEscape(measureNo)}`,
                `stf=${xmlEscape(((_b = staff.getAttribute("n")) === null || _b === void 0 ? void 0 : _b.trim()) || "1")}`,
                `ly=${xmlEscape(voice)}`,
                `li=${toHex(entryIndexInLayer, 4)}`,
                `k=${kind}`,
                `du=${xmlEscape(durAttr)}`,
                `dt=${toHex(ticks, 4)}`,
            ];
            if (kind === "note") {
                base.push(`pn=${xmlEscape((child.getAttribute("pname") || "c").toUpperCase())}`);
                base.push(`oc=${xmlEscape(child.getAttribute("oct") || "4")}`);
                const accid = child.getAttribute("accid");
                if (accid)
                    base.push(`ac=${xmlEscape(accid)}`);
            }
            else if (kind === "chord") {
                const chordNotes = childElementsByName(child, "note");
                base.push(`cn=${toHex(chordNotes.length, 2)}`);
            }
            entries.push(base.join(";"));
            entryIndexInLayer += 1;
        }
    }
    if (entries.length === 0)
        return [];
    const fields = [
        { name: "mks:dbg:mei:notes:count", value: toHex(entries.length, 4) },
    ];
    for (let i = 0; i < entries.length; i += 1) {
        fields.push({
            name: `mks:dbg:mei:notes:${String(i + 1).padStart(4, "0")}`,
            value: entries[i],
        });
    }
    return fields;
};
const convertMeiToMusicXml = (meiSource, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const debugMetadata = (_a = options.debugMetadata) !== null && _a !== void 0 ? _a : true;
    const sourceMetadata = (_b = options.sourceMetadata) !== null && _b !== void 0 ? _b : true;
    const meiSourceRawFields = buildMeiSourceRawMiscFields(meiSource);
    const failOnOverfullDrop = (_c = options.failOnOverfullDrop) !== null && _c !== void 0 ? _c : false;
    const meiCorpusIndex = Number.isFinite(options.meiCorpusIndex)
        ? Math.max(0, Math.floor(options.meiCorpusIndex))
        : null;
    const parser = new DOMParser();
    const doc = parser.parseFromString(String(meiSource || ""), "application/xml");
    if (doc.querySelector("parsererror")) {
        throw new Error("Invalid MEI XML.");
    }
    const meiRoot = doc.documentElement;
    if (!meiRoot) {
        throw new Error("MEI root is missing.");
    }
    let meiImportRoot = null;
    const rootName = localNameOf(meiRoot);
    if (rootName === "mei") {
        meiImportRoot = meiRoot;
    }
    else if (rootName === "meiCorpus") {
        const meiNodes = Array.from(meiRoot.children).filter((node) => node instanceof Element && localNameOf(node) === "mei");
        if (meiCorpusIndex !== null) {
            meiImportRoot = (_d = meiNodes[meiCorpusIndex]) !== null && _d !== void 0 ? _d : null;
            if (!meiImportRoot) {
                throw new Error(`MEI corpus index out of range: ${meiCorpusIndex} (size=${meiNodes.length}).`);
            }
        }
        else {
            meiImportRoot =
                (_f = (_e = meiNodes.find((node) => node.querySelector("measure") !== null)) !== null && _e !== void 0 ? _e : meiNodes[0]) !== null && _f !== void 0 ? _f : null;
        }
        if (!meiImportRoot) {
            throw new Error("MEI corpus has no child <mei>.");
        }
    }
    else {
        throw new Error("MEI root must be <mei> or <meiCorpus>.");
    }
    const title = firstDescendantText(meiImportRoot, "title") || "mikuscore";
    const scoreDefs = collectScoreDefsInDocOrder(meiImportRoot);
    const staffDefsInDocOrder = collectStaffDefsInDocOrder(meiImportRoot);
    const scoreDef = scoreDefs[0];
    const meterCount = parseIntSafe(scoreDef === null || scoreDef === void 0 ? void 0 : scoreDef.getAttribute("meter.count"), 4);
    const meterUnit = parseIntSafe(scoreDef === null || scoreDef === void 0 ? void 0 : scoreDef.getAttribute("meter.unit"), 4);
    const fifths = (_g = parseMeiKeyFifthsFromElement(scoreDef)) !== null && _g !== void 0 ? _g : 0;
    const divisions = 480;
    const staffDefs = Array.from(meiImportRoot.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "staffDef");
    const staffMeta = new Map();
    for (const staffDef of staffDefs) {
        const n = (_h = staffDef.getAttribute("n")) === null || _h === void 0 ? void 0 : _h.trim();
        if (!n)
            continue;
        const parsedClef = parseClefFromStaffDefElement(staffDef);
        const prev = staffMeta.get(n);
        staffMeta.set(n, {
            label: ((_j = staffDef.getAttribute("label")) === null || _j === void 0 ? void 0 : _j.trim()) || (prev === null || prev === void 0 ? void 0 : prev.label) || `Staff ${n}`,
            clefSign: (parsedClef === null || parsedClef === void 0 ? void 0 : parsedClef.clefSign) || (prev === null || prev === void 0 ? void 0 : prev.clefSign) || "G",
            clefLine: (parsedClef === null || parsedClef === void 0 ? void 0 : parsedClef.clefLine) || (prev === null || prev === void 0 ? void 0 : prev.clefLine) || 2,
        });
    }
    const measureNodes = Array.from(meiImportRoot.querySelectorAll("*")).filter((node) => node instanceof Element && localNameOf(node) === "measure");
    if (measureNodes.length === 0) {
        throw new Error("MEI has no <measure>.");
    }
    const staffNumbers = new Set();
    for (const measure of measureNodes) {
        for (const staff of childElementsByName(measure, "staff")) {
            const n = (_k = staff.getAttribute("n")) === null || _k === void 0 ? void 0 : _k.trim();
            if (n)
                staffNumbers.add(n);
        }
    }
    if (staffNumbers.size === 0) {
        throw new Error("MEI has no <staff> content.");
    }
    const sortedStaffNumbers = Array.from(staffNumbers).sort((a, b) => parseIntSafe(a, 0) - parseIntSafe(b, 0));
    const partListXml = sortedStaffNumbers
        .map((staffNo, idx) => {
        var _a;
        const partId = `P${idx + 1}`;
        const partName = ((_a = staffMeta.get(staffNo)) === null || _a === void 0 ? void 0 : _a.label) || `Staff ${staffNo}`;
        return `<score-part id="${partId}"><part-name>${xmlEscape(partName)}</part-name></score-part>`;
    })
        .join("");
    const partsXml = sortedStaffNumbers
        .map((staffNo, idx) => {
        const partId = `P${idx + 1}`;
        const clef = staffMeta.get(staffNo) || { label: `Staff ${staffNo}`, clefSign: "G", clefLine: 2 };
        let currentBeats = Math.max(1, Math.round(meterCount));
        let currentBeatType = Math.max(1, Math.round(meterUnit));
        let currentFifths = fifths;
        let currentClefSign = clef.clefSign;
        let currentClefLine = clef.clefLine;
        let currentTranspose = parseTransposeFromScoreDefForStaff(scoreDef, staffNo);
        let hasEmittedInitialAttributes = false;
        const tieCarryByVoice = new Map();
        const measuresXml = measureNodes
            .map((measureNode, measureIndex) => {
            var _a, _b, _c, _d, _e;
            const sourceMeasureNo = ((_a = measureNode.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || String(measureIndex + 1);
            const targetStaff = childElementsByName(measureNode, "staff").find((staff) => { var _a; return (((_a = staff.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || "") === staffNo; });
            if (!targetStaff) {
                return `<measure number="${xmlEscape(sourceMeasureNo)}"></measure>`;
            }
            const effectiveScoreDef = findEffectiveScoreDefForNode(targetStaff, scoreDefs);
            const effectiveStaffDef = findEffectiveStaffDefForNode(targetStaff, staffNo, staffDefsInDocOrder);
            const measureMeta = parseMeasureMetaFromMeiStaff(targetStaff);
            const measureNo = ((_b = measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.number) !== null && _b !== void 0 ? _b : sourceMeasureNo).trim() || sourceMeasureNo;
            const implicitFromMeta = Boolean(measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.implicit);
            const scoreDefBeats = parseIntSafe(effectiveScoreDef === null || effectiveScoreDef === void 0 ? void 0 : effectiveScoreDef.getAttribute("meter.count"), currentBeats);
            const scoreDefBeatType = parseIntSafe(effectiveScoreDef === null || effectiveScoreDef === void 0 ? void 0 : effectiveScoreDef.getAttribute("meter.unit"), currentBeatType);
            const scoreDefFifths = parseKeySigFromScoreDefForStaff(effectiveScoreDef, staffNo, currentFifths);
            const scoreDefClef = parseClefFromScoreDefForStaff(effectiveScoreDef, staffNo);
            const scoreDefTranspose = parseTransposeFromScoreDefForStaff(effectiveScoreDef, staffNo);
            const staffDefFifths = parseMeiKeyFifthsFromElement(effectiveStaffDef);
            const staffDefClef = parseClefFromStaffDefElement(effectiveStaffDef);
            const staffDefTranspose = parseTransposeFromStaffDefElement(effectiveStaffDef);
            const measureBeats = Math.max(1, Math.round((_c = measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.beats) !== null && _c !== void 0 ? _c : scoreDefBeats));
            const measureBeatType = Math.max(1, Math.round((_d = measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.beatType) !== null && _d !== void 0 ? _d : scoreDefBeatType));
            const measureFifths = Number.isFinite(staffDefFifths)
                ? Math.round(staffDefFifths)
                : Number.isFinite(scoreDefFifths)
                    ? Math.round(scoreDefFifths)
                    : currentFifths;
            const measureClefSign = (staffDefClef === null || staffDefClef === void 0 ? void 0 : staffDefClef.clefSign) || (scoreDefClef === null || scoreDefClef === void 0 ? void 0 : scoreDefClef.clefSign) || currentClefSign;
            const measureClefLine = (staffDefClef === null || staffDefClef === void 0 ? void 0 : staffDefClef.clefLine) || (scoreDefClef === null || scoreDefClef === void 0 ? void 0 : scoreDefClef.clefLine) || currentClefLine;
            const measureTranspose = (_e = staffDefTranspose !== null && staffDefTranspose !== void 0 ? staffDefTranspose : scoreDefTranspose) !== null && _e !== void 0 ? _e : currentTranspose;
            const measureTicks = Math.max(1, Math.round((measureBeats * 4 * divisions) / Math.max(1, measureBeatType)));
            const shouldEmitTime = measureIndex === 0
                || (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.explicitTime) === true
                || measureBeats !== currentBeats
                || measureBeatType !== currentBeatType;
            const shouldEmitKey = measureIndex === 0 || measureFifths !== currentFifths;
            const shouldEmitClef = measureIndex === 0
                || measureClefSign !== currentClefSign
                || measureClefLine !== currentClefLine;
            const currentChromatic = Number.isFinite(currentTranspose === null || currentTranspose === void 0 ? void 0 : currentTranspose.chromatic) ? Math.round(Number(currentTranspose === null || currentTranspose === void 0 ? void 0 : currentTranspose.chromatic)) : null;
            const currentDiatonic = Number.isFinite(currentTranspose === null || currentTranspose === void 0 ? void 0 : currentTranspose.diatonic) ? Math.round(Number(currentTranspose === null || currentTranspose === void 0 ? void 0 : currentTranspose.diatonic)) : null;
            const measureChromatic = Number.isFinite(measureTranspose === null || measureTranspose === void 0 ? void 0 : measureTranspose.chromatic) ? Math.round(Number(measureTranspose === null || measureTranspose === void 0 ? void 0 : measureTranspose.chromatic)) : null;
            const measureDiatonic = Number.isFinite(measureTranspose === null || measureTranspose === void 0 ? void 0 : measureTranspose.diatonic) ? Math.round(Number(measureTranspose === null || measureTranspose === void 0 ? void 0 : measureTranspose.diatonic)) : null;
            const shouldEmitTranspose = measureIndex === 0 || measureChromatic !== currentChromatic || measureDiatonic !== currentDiatonic;
            const layerNodes = childElementsByName(targetStaff, "layer");
            const parsedLayers = layerNodes.map((layer, i) => {
                var _a, _b;
                const voice = ((_a = layer.getAttribute("n")) === null || _a === void 0 ? void 0 : _a.trim()) || String(i + 1);
                const tieCarryIn = (_b = tieCarryByVoice.get(voice)) !== null && _b !== void 0 ? _b : new Map();
                const parsedLayer = parseLayerEvents(layer, divisions, voice, measureTicks, measureFifths, tieCarryIn);
                return { layer, voice, parsedLayer, tieCarryIn };
            });
            const staffIdToEventTick = new Map();
            for (const entry of parsedLayers) {
                for (const [id, idx] of entry.parsedLayer.idToEventIndex.entries()) {
                    const tick = resolveEventStartTickByIndex(entry.parsedLayer.events, idx);
                    if (Number.isFinite(tick))
                        staffIdToEventTick.set(id, Math.max(0, Math.round(tick)));
                }
            }
            const layers = parsedLayers
                .map(({ layer, voice, parsedLayer, tieCarryIn }) => {
                const slurAppliedEvents = applyStaffSlurControlEvents(targetStaff, layer, parsedLayer.events, parsedLayer.idToEventIndex, staffIdToEventTick, divisions, measureBeatType);
                const tieApplied = applyTieCarryAccidentalsForLayerEvents(slurAppliedEvents, tieCarryIn);
                tieCarryByVoice.set(voice, tieApplied.tieCarryOut);
                const directionXml = collectLayerDirectionXml(targetStaff, layer, divisions, measureBeatType, voice, tieApplied.events, parsedLayer.idToEventIndex, staffIdToEventTick);
                const harmonyXml = collectLayerHarmonyXml(targetStaff, layer, divisions, measureBeatType, tieApplied.events, parsedLayer.idToEventIndex, staffIdToEventTick);
                const sourceTotalTicks = tieApplied.events.reduce((sum, event) => sum + event.durationTicks, 0);
                const trimmed = trimLayerEventsToMeasureCapacity(tieApplied.events, measureTicks);
                return {
                    voice,
                    xml: `${harmonyXml}${directionXml}${trimmed.events.map((event) => event.xml).join("")}`,
                    totalTicks: trimmed.totalTicks,
                    sourceTotalTicks,
                    droppedCount: trimmed.droppedCount,
                    droppedTicks: trimmed.droppedTicks,
                    trimmedCount: trimmed.trimmedCount,
                    trimmedTicks: trimmed.trimmedTicks,
                };
            })
                .filter((layer) => layer.xml.length > 0);
            const maxLayerTicks = layers.reduce((max, layer) => Math.max(max, layer.totalTicks), 0);
            const isLikelyPickupMeasure = !implicitFromMeta &&
                measureIndex === 0 &&
                maxLayerTicks > 0 &&
                maxLayerTicks < measureTicks;
            const implicitAttr = implicitFromMeta || isLikelyPickupMeasure ? ' implicit="yes"' : "";
            let body = "";
            if (layers.length > 0) {
                body += layers[0].xml;
                const backupTicks = Math.max(measureTicks, layers[0].totalTicks);
                for (let i = 1; i < layers.length; i += 1) {
                    body += `<backup><duration>${backupTicks}</duration></backup>`;
                    body += layers[i].xml;
                }
            }
            const miscFields = sourceMetadata ? extractMiscFieldsFromMeiStaff(targetStaff) : [];
            const rawSourceFields = !hasEmittedInitialAttributes ? meiSourceRawFields : [];
            const meiDebugFields = debugMetadata
                ? buildMeiDebugFieldsFromStaff(targetStaff, measureNo, divisions)
                : [];
            const droppedEvents = layers.reduce((sum, layer) => sum + layer.droppedCount, 0);
            const droppedTicks = layers.reduce((sum, layer) => sum + layer.droppedTicks, 0);
            const trimmedEvents = layers.reduce((sum, layer) => sum + layer.trimmedCount, 0);
            const trimmedTicks = layers.reduce((sum, layer) => sum + layer.trimmedTicks, 0);
            const sourceTotalTicks = layers.reduce((sum, layer) => sum + layer.sourceTotalTicks, 0);
            const overfullDetected = layers.some((layer) => layer.sourceTotalTicks > measureTicks);
            if (failOnOverfullDrop && droppedEvents > 0) {
                throw new Error(`MEI overfull would drop events (measure=${measureNo}, staff=${staffNo}, droppedEvents=${droppedEvents}, droppedTicks=${droppedTicks}).`);
            }
            const overflowFields = overfullDetected
                ? [
                    { name: "mks:diag:count", value: "1" },
                    {
                        name: "mks:diag:0001",
                        value: `level=warn;code=OVERFULL_CLAMPED;fmt=mei;measure=${measureNo};staff=${staffNo};action=clamped;sourceTicks=${sourceTotalTicks};capacityTicks=${measureTicks};droppedEvents=${droppedEvents};droppedTicks=${droppedTicks};trimmedEvents=${trimmedEvents};trimmedTicks=${trimmedTicks}`,
                    },
                ]
                : [];
            const allFields = [...rawSourceFields, ...miscFields, ...meiDebugFields, ...overflowFields];
            const miscellaneousXml = allFields.length > 0
                ? `<miscellaneous>${allFields
                    .map((field) => `<miscellaneous-field name="${xmlEscape(field.name)}">${xmlEscape(field.value)}</miscellaneous-field>`)
                    .join("")}</miscellaneous>`
                : "";
            let attributesXml = "";
            if (!hasEmittedInitialAttributes) {
                attributesXml =
                    `<attributes><divisions>${divisions}</divisions><key><fifths>${measureFifths}</fifths></key>` +
                        `<time><beats>${measureBeats}</beats><beat-type>${measureBeatType}</beat-type></time>` +
                        `${buildTransposeXml(measureTranspose)}` +
                        `<clef><sign>${xmlEscape(measureClefSign)}</sign><line>${measureClefLine}</line></clef>` +
                        `${miscellaneousXml}</attributes>`;
            }
            else if (shouldEmitTime || shouldEmitKey || shouldEmitTranspose || shouldEmitClef || miscellaneousXml) {
                attributesXml =
                    `<attributes>${shouldEmitKey ? `<key><fifths>${measureFifths}</fifths></key>` : ""}${shouldEmitTime ? `<time><beats>${measureBeats}</beats><beat-type>${measureBeatType}</beat-type></time>` : ""}${shouldEmitTranspose ? `${buildTransposeXml(measureTranspose)}` : ""}${shouldEmitClef ? `<clef><sign>${xmlEscape(measureClefSign)}</sign><line>${measureClefLine}</line></clef>` : ""}${miscellaneousXml}</attributes>`;
            }
            let leftBarlineXml = "";
            let rightBarlineXml = "";
            if ((measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.doubleBar) === "left" || (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.doubleBar) === "both") {
                leftBarlineXml += `<barline location="left"><bar-style>light-light</bar-style></barline>`;
            }
            if ((measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.repeat) === "forward") {
                leftBarlineXml += `<barline location="left"><repeat direction="forward"/></barline>`;
            }
            if ((measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.repeat) === "backward") {
                const repeatInner = Number.isFinite(measureMeta.times) && measureMeta.times > 1
                    ? `<bar-style>light-heavy</bar-style><repeat direction="backward"/><ending number="${Math.round(measureMeta.times)}" type="stop"/>`
                    : `<repeat direction="backward"/>`;
                rightBarlineXml += `<barline location="right">${repeatInner}</barline>`;
            }
            if ((measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.doubleBar) === "right" || (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.doubleBar) === "both") {
                rightBarlineXml += `<barline location="right"><bar-style>light-light</bar-style></barline>`;
            }
            currentBeats = measureBeats;
            currentBeatType = measureBeatType;
            currentFifths = measureFifths;
            currentClefSign = measureClefSign;
            currentClefLine = measureClefLine;
            currentTranspose = measureTranspose;
            hasEmittedInitialAttributes = true;
            return `<measure number="${xmlEscape(measureNo)}"${implicitAttr}>${attributesXml}${leftBarlineXml}${body}${rightBarlineXml}</measure>`;
        })
            .join("");
        return `<part id="${partId}">${measuresXml}</part>`;
    })
        .join("");
    const xml = `<?xml version="1.0" encoding="UTF-8"?><score-partwise version="4.0"><work><work-title>${xmlEscape(title)}</work-title></work><part-list>${partListXml}</part-list>${partsXml}</score-partwise>`;
    return (0, musicxml_io_1.prettyPrintMusicXmlText)((0, musicxml_io_1.applyImplicitBeamsToMusicXmlText)(xml));
};
exports.convertMeiToMusicXml = convertMeiToMusicXml;

  },
  "src/ts/abc-io.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertAbcToMusicXml = exports.clefXmlFromAbcClef = exports.exportMusicXmlDomToAbc = exports.AbcCompatParser = exports.AbcCommon = void 0;
// @ts-nocheck
const beam_common_1 = require("./beam-common");
const staffClefPolicy_1 = require("../../core/staffClefPolicy");
const DEFAULT_UNIT = { num: 1, den: 8 };
const DEFAULT_RATIO = { num: 1, den: 1 };
const gcd = (a, b) => {
    let x = Math.abs(Number(a) || 0);
    let y = Math.abs(Number(b) || 0);
    while (y !== 0) {
        const t = x % y;
        x = y;
        y = t;
    }
    return x || 1;
};
const reduceFraction = (num, den, fallback = DEFAULT_RATIO) => {
    if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0) {
        return { num: fallback.num, den: fallback.den };
    }
    const sign = den < 0 ? -1 : 1;
    const n = num * sign;
    const d = den * sign;
    const g = gcd(n, d);
    return { num: n / g, den: d / g };
};
const multiplyFractions = (a, b, fallback = DEFAULT_RATIO) => {
    return reduceFraction(a.num * b.num, a.den * b.den, fallback);
};
const divideFractions = (a, b, fallback = DEFAULT_RATIO) => {
    return reduceFraction(a.num * b.den, a.den * b.num, fallback);
};
const parseFractionText = (text, fallback = DEFAULT_UNIT) => {
    const m = String(text || "").match(/^\s*(\d+)\/(\d+)\s*$/);
    if (!m) {
        return { num: fallback.num, den: fallback.den };
    }
    const num = Number.parseInt(m[1], 10);
    const den = Number.parseInt(m[2], 10);
    if (!num || !den) {
        return { num: fallback.num, den: fallback.den };
    }
    return reduceFraction(num, den, fallback);
};
const parseAbcLengthToken = (token, lineNo) => {
    if (!token) {
        return { num: 1, den: 1 };
    }
    if (token === "/") {
        return { num: 1, den: 2 };
    }
    if (/^\d+$/.test(token)) {
        return { num: Number(token), den: 1 };
    }
    if (/^\/\d+$/.test(token)) {
        return { num: 1, den: Number(token.slice(1)) };
    }
    if (/^\d+\/\d+$/.test(token)) {
        const p = token.split("/");
        return reduceFraction(Number(p[0]), Number(p[1]), { num: 1, den: 1 });
    }
    throw new Error(`line ${lineNo}: Could not parse length token: ${token}`);
};
const abcLengthTokenFromFraction = (ratio) => {
    const reduced = reduceFraction(ratio.num, ratio.den, { num: 1, den: 1 });
    if (reduced.num === reduced.den)
        return "";
    if (reduced.den === 1)
        return String(reduced.num);
    if (reduced.num === 1 && reduced.den === 2)
        return "/";
    if (reduced.num === 1)
        return `/${reduced.den}`;
    return `${reduced.num}/${reduced.den}`;
};
const abcPitchFromStepOctave = (step, octave) => {
    const upperStep = String(step || "").toUpperCase();
    if (!/^[A-G]$/.test(upperStep)) {
        return "C";
    }
    if (octave >= 5) {
        return upperStep.toLowerCase() + "'".repeat(octave - 5);
    }
    return upperStep + ",".repeat(Math.max(0, 4 - octave));
};
const accidentalFromAlter = (alter) => {
    if (alter === 0)
        return "";
    if (alter > 0)
        return "^".repeat(Math.min(2, alter));
    return "_".repeat(Math.min(2, Math.abs(alter)));
};
const keyFromFifthsMode = (fifths, mode) => {
    const major = ["Cb", "Gb", "Db", "Ab", "Eb", "Bb", "F", "C", "G", "D", "A", "E", "B", "F#", "C#"];
    const minor = ["Abm", "Ebm", "Bbm", "Fm", "Cm", "Gm", "Dm", "Am", "Em", "Bm", "F#m", "C#m", "G#m", "D#m", "A#m"];
    const idx = Number(fifths) + 7;
    if (idx < 0 || idx >= major.length) {
        return "C";
    }
    const lowerMode = String(mode || "").toLowerCase();
    if (lowerMode === "minor") {
        return minor[idx];
    }
    return major[idx];
};
const fifthsFromAbcKey = (raw) => {
    const table = {
        C: 0,
        G: 1,
        D: 2,
        A: 3,
        E: 4,
        B: 5,
        "F#": 6,
        "C#": 7,
        F: -1,
        Bb: -2,
        Eb: -3,
        Ab: -4,
        Db: -5,
        Gb: -6,
        Cb: -7,
        Am: 0,
        Em: 1,
        Bm: 2,
        "F#m": 3,
        "C#m": 4,
        "G#m": 5,
        "D#m": 6,
        "A#m": 7,
        Dm: -1,
        Gm: -2,
        Cm: -3,
        Fm: -4,
        Bbm: -5,
        Ebm: -6,
        Abm: -7,
    };
    const normalized = String(raw || "").trim().replace(/\s+/g, "");
    if (Object.prototype.hasOwnProperty.call(table, normalized)) {
        return table[normalized];
    }
    return null;
};
exports.AbcCommon = {
    gcd,
    reduceFraction,
    multiplyFractions,
    divideFractions,
    parseFractionText,
    parseAbcLengthToken,
    abcLengthTokenFromFraction,
    abcPitchFromStepOctave,
    accidentalFromAlter,
    keyFromFifthsMode,
    fifthsFromAbcKey,
};
if (typeof window !== "undefined") {
    window.AbcCommon = exports.AbcCommon;
}
const abcCommon = exports.AbcCommon;
function parseTempoFromQ(rawQ, warnings) {
    const raw = String(rawQ || "").trim();
    if (!raw) {
        return null;
    }
    const withoutQuoted = raw.replace(/"[^"]*"/g, " ").trim();
    let m = withoutQuoted.match(/(\d+)\s*\/\s*(\d+)\s*=\s*(\d+(?:\.\d+)?)/);
    if (m) {
        const num = Number(m[1]);
        const den = Number(m[2]);
        const bpm = Number(m[3]);
        if (num > 0 && den > 0 && Number.isFinite(bpm) && bpm > 0) {
            const quarterBpm = bpm * ((4 * num) / den);
            return Math.max(20, Math.min(300, Math.round(quarterBpm)));
        }
    }
    m = withoutQuoted.match(/=\s*(\d+(?:\.\d+)?)/);
    if (m) {
        const bpm = Number(m[1]);
        if (Number.isFinite(bpm) && bpm > 0) {
            return Math.max(20, Math.min(300, Math.round(bpm)));
        }
    }
    m = withoutQuoted.match(/^(\d+(?:\.\d+)?)$/);
    if (m) {
        const bpm = Number(m[1]);
        if (Number.isFinite(bpm) && bpm > 0) {
            return Math.max(20, Math.min(300, Math.round(bpm)));
        }
    }
    warnings.push("Q: unsupported tempo format; ignored: " + rawQ);
    return null;
}
function parseForMusicXml(source, settings) {
    const warnings = [];
    const lines = String(source || "").split("\n");
    const trillWidthHintByKey = new Map();
    const keyHintFifthsByKey = new Map();
    const measureMetaByKey = new Map();
    const transposeHintByVoiceId = new Map();
    const headers = {};
    const bodyEntries = [];
    const declaredVoiceIds = [];
    const voiceNameById = {};
    const voiceClefById = {};
    const voiceTransposeById = {};
    let currentVoiceId = "1";
    let scoreDirective = "";
    for (let i = 0; i < lines.length; i += 1) {
        const lineNo = i + 1;
        const raw = lines[i];
        const rawTrimmed = raw.trim();
        const metaMatch = rawTrimmed.match(/^%@mks\s+trill\s+(.+)$/i);
        if (metaMatch) {
            const params = {};
            const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
            let kv;
            while ((kv = kvRegex.exec(metaMatch[1])) !== null) {
                params[String(kv[1]).toLowerCase()] = String(kv[2]);
            }
            const voiceId = String(params.voice || "").trim();
            const measureNo = Number.parseInt(String(params.measure || ""), 10);
            const eventNo = Number.parseInt(String(params.event || ""), 10);
            const upper = String(params.upper || "").trim();
            if (voiceId && Number.isFinite(measureNo) && measureNo > 0 && Number.isFinite(eventNo) && eventNo > 0 && upper) {
                trillWidthHintByKey.set(`${voiceId}#${measureNo}#${eventNo}`, upper);
            }
            continue;
        }
        const keyMetaMatch = rawTrimmed.match(/^%@mks\s+key\s+(.+)$/i);
        if (keyMetaMatch) {
            const params = {};
            const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
            let kv;
            while ((kv = kvRegex.exec(keyMetaMatch[1])) !== null) {
                params[String(kv[1]).toLowerCase()] = String(kv[2]);
            }
            const voiceId = String(params.voice || "").trim();
            const measureNo = Number.parseInt(String(params.measure || ""), 10);
            const fifths = Number.parseInt(String(params.fifths || ""), 10);
            if (voiceId && Number.isFinite(measureNo) && measureNo > 0 && Number.isFinite(fifths)) {
                const key = `${voiceId}#${measureNo}`;
                if (!keyHintFifthsByKey.has(key)) {
                    keyHintFifthsByKey.set(key, Math.max(-7, Math.min(7, Math.round(fifths))));
                }
            }
            continue;
        }
        const measureMetaMatch = rawTrimmed.match(/^%@mks\s+measure\s+(.+)$/i);
        if (measureMetaMatch) {
            const params = {};
            const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
            let kv;
            while ((kv = kvRegex.exec(measureMetaMatch[1])) !== null) {
                params[String(kv[1]).toLowerCase()] = String(kv[2]);
            }
            const voiceId = String(params.voice || "").trim();
            const measureNo = Number.parseInt(String(params.measure || ""), 10);
            if (voiceId && Number.isFinite(measureNo) && measureNo > 0) {
                const measureNumberText = String(params.number || "").trim();
                const implicitRaw = String(params.implicit || "").trim().toLowerCase();
                const repeatRaw = String(params.repeat || "").trim().toLowerCase();
                const repeatTimesRaw = Number.parseInt(String(params.times || ""), 10);
                measureMetaByKey.set(`${voiceId}#${measureNo}`, {
                    number: measureNumberText || String(measureNo),
                    implicit: implicitRaw === "1" || implicitRaw === "true" || implicitRaw === "yes",
                    repeat: repeatRaw === "forward" || repeatRaw === "backward"
                        ? repeatRaw
                        : "",
                    repeatTimes: Number.isFinite(repeatTimesRaw) && repeatTimesRaw > 1 ? repeatTimesRaw : null
                });
            }
            continue;
        }
        const transposeMetaMatch = rawTrimmed.match(/^%@mks\s+transpose\s+(.+)$/i);
        if (transposeMetaMatch) {
            const params = {};
            const kvRegex = /([A-Za-z][A-Za-z0-9_-]*)=([^\s]+)/g;
            let kv;
            while ((kv = kvRegex.exec(transposeMetaMatch[1])) !== null) {
                params[String(kv[1]).toLowerCase()] = String(kv[2]);
            }
            const voiceId = String(params.voice || "").trim();
            const chromatic = Number.parseInt(String(params.chromatic || ""), 10);
            const diatonic = Number.parseInt(String(params.diatonic || ""), 10);
            if (voiceId && (Number.isFinite(chromatic) || Number.isFinite(diatonic))) {
                const metaTranspose = {};
                if (Number.isFinite(chromatic))
                    metaTranspose.chromatic = chromatic;
                if (Number.isFinite(diatonic))
                    metaTranspose.diatonic = diatonic;
                if (Object.keys(metaTranspose).length > 0) {
                    transposeHintByVoiceId.set(voiceId, metaTranspose);
                }
            }
            continue;
        }
        const noComment = raw.split("%")[0];
        const trimmed = noComment.trim();
        if (!trimmed) {
            continue;
        }
        const scoreMatch = trimmed.match(/^%%\s*score\s+(.+)$/i);
        if (scoreMatch) {
            scoreDirective = scoreMatch[1].trim();
            continue;
        }
        const headerMatch = trimmed.match(/^([A-Za-z]):\s*(.*)$/);
        if (headerMatch && /^[A-Za-z]$/.test(headerMatch[1])) {
            const key = headerMatch[1];
            const value = headerMatch[2].trim();
            if (key === "V") {
                const m = value.match(/^(\S+)\s*(.*)$/);
                if (!m) {
                    continue;
                }
                currentVoiceId = m[1];
                if (!declaredVoiceIds.includes(currentVoiceId)) {
                    declaredVoiceIds.push(currentVoiceId);
                }
                const rest = m[2].trim();
                const parsedVoice = parseVoiceDirectiveTail(rest);
                if (parsedVoice.name) {
                    voiceNameById[currentVoiceId] = parsedVoice.name;
                }
                if (parsedVoice.clef) {
                    voiceClefById[currentVoiceId] = parsedVoice.clef;
                }
                if (parsedVoice.transpose) {
                    voiceTransposeById[currentVoiceId] = parsedVoice.transpose;
                }
                if (parsedVoice.bodyText) {
                    bodyEntries.push({ text: parsedVoice.bodyText, lineNo, voiceId: currentVoiceId });
                }
                continue;
            }
            headers[key] = value;
            continue;
        }
        if (!declaredVoiceIds.includes(currentVoiceId)) {
            declaredVoiceIds.push(currentVoiceId);
        }
        bodyEntries.push({ text: noComment, lineNo, voiceId: currentVoiceId });
    }
    if (bodyEntries.length === 0) {
        throw new Error("Body not found. Please provide ABC note content. (line 1)");
    }
    const meter = parseMeter(headers.M || "4/4", warnings);
    const unitLength = parseFraction(headers.L || "1/8", "L", warnings);
    const keyInfo = parseKey(headers.K || "C", warnings);
    const tempoBpm = parseTempoFromQ(headers.Q || "", warnings);
    const keySignatureAccidentals = keySignatureAlterByStep(keyInfo.fifths);
    const measuresByVoice = {};
    let noteCount = 0;
    function ensureVoice(voiceId) {
        if (!Object.prototype.hasOwnProperty.call(measuresByVoice, voiceId)) {
            measuresByVoice[voiceId] = [[]];
        }
        return measuresByVoice[voiceId];
    }
    for (const entry of bodyEntries) {
        const measures = ensureVoice(entry.voiceId);
        let currentMeasure = measures[measures.length - 1];
        let measureAccidentals = {};
        let lastNote = null;
        let lastEventNotes = [];
        let pendingTieToNext = false;
        let pendingTrill = false;
        let pendingTurn = "";
        let pendingStaccato = false;
        let pendingSlurStart = 0;
        let pendingRhythmScale = null;
        let tupletRemaining = 0;
        let tupletScale = null;
        let tupletSpec = null;
        let currentMeasureNo = Math.max(1, measures.length);
        let currentEventNo = 0;
        let idx = 0;
        const text = entry.text;
        while (idx < text.length) {
            const ch = text[idx];
            if (ch === " " || ch === "\t") {
                idx += 1;
                continue;
            }
            if (ch === "," || ch === "'") {
                // Lenient compatibility: some real-world sources include standalone octave marks.
                // They are non-standard in strict ABC, but skipping them improves interoperability.
                idx += 1;
                continue;
            }
            if (ch === "|" || ch === ":") {
                if (ch === "|" && (currentMeasure.length > 0 || measures.length === 0)) {
                    currentMeasure = [];
                    measures.push(currentMeasure);
                    currentMeasureNo = Math.max(1, measures.length);
                    currentEventNo = 0;
                }
                if (ch === "|") {
                    measureAccidentals = {};
                    lastNote = null;
                }
                idx += 1;
                continue;
            }
            if (ch === ">" || ch === "<") {
                if (!lastEventNotes || lastEventNotes.length === 0 || lastEventNotes.some((n) => n.isRest)) {
                    warnings.push("line " + entry.lineNo + ": broken rhythm(" + ch + ")  has no preceding note; skipped.");
                    idx += 1;
                    continue;
                }
                const lastScale = ch === ">" ? { num: 3, den: 2 } : { num: 1, den: 2 };
                pendingRhythmScale = ch === ">" ? { num: 1, den: 2 } : { num: 3, den: 2 };
                scaleNotesDuration(lastEventNotes, lastScale);
                idx += 1;
                continue;
            }
            if (ch === "(") {
                const tupletMatch = text.slice(idx).match(/^\((\d)(?::(\d))?(?::(\d))?/);
                if (tupletMatch) {
                    const n = Number(tupletMatch[1] || 0);
                    const qRaw = tupletMatch[2] ? Number(tupletMatch[2]) : NaN;
                    const rRaw = tupletMatch[3] ? Number(tupletMatch[3]) : NaN;
                    const q = Number.isFinite(qRaw) && qRaw > 0 ? qRaw : (n === 3 ? 2 : n);
                    const r = Number.isFinite(rRaw) && rRaw > 0 ? rRaw : n;
                    if (n > 0 && q > 0 && r > 0) {
                        tupletScale = { num: q, den: n };
                        tupletRemaining = r;
                        tupletSpec = { actual: n, normal: q, remaining: r };
                    }
                    else {
                        warnings.push("line " + entry.lineNo + ": Failed to parse tuplet notation: " + tupletMatch[0]);
                    }
                    idx += tupletMatch[0].length;
                    continue;
                }
                pendingSlurStart += 1;
                idx += 1;
                continue;
            }
            if (ch === "-") {
                if (lastNote && !lastNote.isRest) {
                    lastNote.tieStart = true;
                    pendingTieToNext = true;
                }
                else {
                    warnings.push("line " + entry.lineNo + ": tie(-)  has no preceding note; skipped.");
                }
                idx += 1;
                continue;
            }
            if (ch === "\"") {
                const endQuote = text.indexOf("\"", idx + 1);
                if (endQuote >= 0) {
                    idx = endQuote + 1;
                }
                else {
                    idx = text.length;
                }
                warnings.push("line " + entry.lineNo + ': Skipped inline string ("...").');
                continue;
            }
            if (ch === "!" || ch === "+") {
                const endMark = text.indexOf(ch, idx + 1);
                if (endMark < 0) {
                    idx += 1;
                    warnings.push("line " + entry.lineNo + ": Unterminated decoration marker: " + ch);
                    continue;
                }
                const decoration = text.slice(idx + 1, endMark).trim().toLowerCase();
                if (decoration === "trill" || decoration === "tr" || decoration === "triller") {
                    pendingTrill = true;
                }
                else if (decoration === "turn") {
                    pendingTurn = "turn";
                }
                else if (decoration === "invertedturn" || decoration === "inverted-turn" || decoration === "lowerturn") {
                    pendingTurn = "inverted-turn";
                }
                else if (decoration === "staccato" ||
                    decoration === "stacc" ||
                    decoration === "stac" ||
                    decoration === "staccatissimo") {
                    pendingStaccato = true;
                }
                else if (decoration) {
                    warnings.push("line " + entry.lineNo + ": Skipped decoration: " + ch + decoration + ch);
                }
                idx = endMark + 1;
                continue;
            }
            if (ch === "{") {
                const graceResult = parseGraceGroupAt(text, idx, entry.lineNo, unitLength, keySignatureAccidentals, measureAccidentals, entry.voiceId);
                if (!graceResult) {
                    warnings.push("line " + entry.lineNo + ": Failed to parse grace group; skipped.");
                    idx += 1;
                    continue;
                }
                idx = graceResult.nextIdx;
                for (const graceNote of graceResult.notes) {
                    currentMeasure.push(graceNote);
                    noteCount += 1;
                }
                continue;
            }
            if (ch === ".") {
                pendingStaccato = true;
                idx += 1;
                continue;
            }
            if (ch === "[") {
                const chordResult = parseChordAt(text, idx, entry.lineNo);
                if (!chordResult) {
                    warnings.push("line " + entry.lineNo + ": Failed to parse chord notation; skipped.");
                    idx += 1;
                    continue;
                }
                idx = chordResult.nextIdx;
                let chordLength = parseLengthToken(chordResult.lengthToken, entry.lineNo);
                if (!chordResult.lengthToken && chordResult.notes.length > 0 && chordResult.notes[0].lengthToken) {
                    chordLength = parseLengthToken(chordResult.notes[0].lengthToken, entry.lineNo);
                }
                let absoluteLength = multiplyFractions(unitLength, chordLength);
                if (pendingRhythmScale) {
                    absoluteLength = multiplyFractions(absoluteLength, pendingRhythmScale);
                    pendingRhythmScale = null;
                }
                const activeTuplet = tupletRemaining > 0 && tupletScale && tupletSpec
                    ? { actual: tupletSpec.actual, normal: tupletSpec.normal, remaining: tupletSpec.remaining }
                    : null;
                if (tupletRemaining > 0 && tupletScale) {
                    absoluteLength = multiplyFractions(absoluteLength, tupletScale);
                    tupletRemaining -= 1;
                    if (tupletSpec) {
                        tupletSpec.remaining -= 1;
                    }
                    if (tupletRemaining <= 0) {
                        tupletScale = null;
                        tupletSpec = null;
                    }
                }
                if (idx < text.length && (text[idx] === ">" || text[idx] === "<")) {
                    const rhythmChar = text[idx];
                    idx += 1;
                    if (rhythmChar === ">") {
                        absoluteLength = multiplyFractions(absoluteLength, { num: 3, den: 2 });
                        pendingRhythmScale = { num: 1, den: 2 };
                    }
                    else {
                        absoluteLength = multiplyFractions(absoluteLength, { num: 1, den: 2 });
                        pendingRhythmScale = { num: 3, den: 2 };
                    }
                }
                const dur = durationInDivisions(absoluteLength, 960);
                if (dur <= 0) {
                    throw new Error("line " + entry.lineNo + ": Invalid length");
                }
                const chordNotes = [];
                currentEventNo += 1;
                const trillHint = trillWidthHintByKey.get(`${entry.voiceId}#${currentMeasureNo}#${currentEventNo}`) || "";
                for (let chordIndex = 0; chordIndex < chordResult.notes.length; chordIndex += 1) {
                    const chordNote = chordResult.notes[chordIndex];
                    const note = buildNoteData(chordNote.pitchChar, chordNote.accidentalText, chordNote.octaveShift, absoluteLength, dur, entry.lineNo, keySignatureAccidentals, measureAccidentals);
                    note.voice = entry.voiceId;
                    if (chordIndex === 0 && pendingTrill && !note.isRest) {
                        note.trill = true;
                        pendingTrill = false;
                    }
                    if (chordIndex === 0 && pendingTurn && !note.isRest) {
                        note.turnType = pendingTurn;
                        pendingTurn = "";
                    }
                    if (chordIndex === 0 && pendingSlurStart > 0 && !note.isRest) {
                        note.slurStart = true;
                        pendingSlurStart = 0;
                    }
                    if (chordIndex === 0 && note.trill && trillHint) {
                        note.trillAccidentalText = trillHint;
                    }
                    if (chordIndex === 0 && pendingStaccato && !note.isRest) {
                        note.staccato = true;
                        pendingStaccato = false;
                    }
                    if (chordIndex > 0) {
                        note.chord = true;
                    }
                    if (chordIndex === 0 && activeTuplet) {
                        note.timeModification = { actual: activeTuplet.actual, normal: activeTuplet.normal };
                        if (activeTuplet.remaining === activeTuplet.actual) {
                            note.tupletStart = true;
                        }
                        if (activeTuplet.remaining === 1) {
                            note.tupletStop = true;
                        }
                    }
                    chordNotes.push(note);
                }
                if (pendingTieToNext && chordNotes.length > 0) {
                    chordNotes[0].tieStop = true;
                    pendingTieToNext = false;
                }
                for (const note of chordNotes) {
                    currentMeasure.push(note);
                }
                lastNote = chordNotes[0] || null;
                lastEventNotes = chordNotes;
                noteCount += chordNotes.length;
                continue;
            }
            if (ch === ")") {
                if (lastNote && !lastNote.isRest) {
                    lastNote.slurStop = true;
                }
                else {
                    warnings.push("line " + entry.lineNo + ": slur stop()) has no preceding note; skipped.");
                }
                idx += 1;
                continue;
            }
            if (ch === "]" || ch === "}") {
                warnings.push("line " + entry.lineNo + ": Skipped unsupported notation: " + ch);
                idx += 1;
                continue;
            }
            let accidentalText = "";
            while (idx < text.length && (text[idx] === "^" || text[idx] === "_" || text[idx] === "=")) {
                accidentalText += text[idx];
                idx += 1;
                if (accidentalText === "=" || accidentalText.startsWith("^") || accidentalText.startsWith("_")) {
                    if (accidentalText.length >= 2 && accidentalText[0] !== accidentalText[1]) {
                        break;
                    }
                    if (accidentalText.length >= 2 && accidentalText[0] === "=") {
                        accidentalText = "=";
                        break;
                    }
                }
            }
            const pitchChar = text[idx];
            if (!pitchChar || !/[A-Ga-gzZxX]/.test(pitchChar)) {
                throw new Error("line " + entry.lineNo + ": Failed to parse note/rest: " + text.slice(idx, idx + 12));
            }
            idx += 1;
            let octaveShift = "";
            while (idx < text.length && (text[idx] === "'" || text[idx] === ",")) {
                octaveShift += text[idx];
                idx += 1;
            }
            let lengthToken = "";
            const lengthMatch = text.slice(idx).match(/^(\d+\/\d+|\d+|\/\d+|\/)/);
            if (lengthMatch) {
                lengthToken = lengthMatch[1];
                idx += lengthToken.length;
            }
            const len = parseLengthToken(lengthToken, entry.lineNo);
            let absoluteLength = multiplyFractions(unitLength, len);
            if (pendingRhythmScale) {
                absoluteLength = multiplyFractions(absoluteLength, pendingRhythmScale);
                pendingRhythmScale = null;
            }
            const activeTuplet = tupletRemaining > 0 && tupletScale && tupletSpec
                ? { actual: tupletSpec.actual, normal: tupletSpec.normal, remaining: tupletSpec.remaining }
                : null;
            if (tupletRemaining > 0 && tupletScale) {
                absoluteLength = multiplyFractions(absoluteLength, tupletScale);
                tupletRemaining -= 1;
                if (tupletSpec) {
                    tupletSpec.remaining -= 1;
                }
                if (tupletRemaining <= 0) {
                    tupletScale = null;
                    tupletSpec = null;
                }
            }
            if (idx < text.length && (text[idx] === ">" || text[idx] === "<")) {
                const rhythmChar = text[idx];
                idx += 1;
                if (rhythmChar === ">") {
                    absoluteLength = multiplyFractions(absoluteLength, { num: 3, den: 2 });
                    pendingRhythmScale = { num: 1, den: 2 };
                }
                else {
                    absoluteLength = multiplyFractions(absoluteLength, { num: 1, den: 2 });
                    pendingRhythmScale = { num: 3, den: 2 };
                }
            }
            const dur = durationInDivisions(absoluteLength, 960);
            if (dur <= 0) {
                throw new Error("line " + entry.lineNo + ": Invalid length");
            }
            const note = buildNoteData(pitchChar, accidentalText, octaveShift, absoluteLength, dur, entry.lineNo, keySignatureAccidentals, measureAccidentals);
            if (pendingTrill && !note.isRest) {
                note.trill = true;
                pendingTrill = false;
            }
            if (pendingTurn && !note.isRest) {
                note.turnType = pendingTurn;
                pendingTurn = "";
            }
            if (pendingSlurStart > 0 && !note.isRest) {
                note.slurStart = true;
                pendingSlurStart = 0;
            }
            currentEventNo += 1;
            const trillHint = trillWidthHintByKey.get(`${entry.voiceId}#${currentMeasureNo}#${currentEventNo}`) || "";
            if (note.trill && trillHint) {
                note.trillAccidentalText = trillHint;
            }
            if (pendingStaccato && !note.isRest) {
                note.staccato = true;
                pendingStaccato = false;
            }
            if (pendingTieToNext && !note.isRest) {
                note.tieStop = true;
                pendingTieToNext = false;
            }
            else if (note.isRest && pendingTieToNext) {
                warnings.push("line " + entry.lineNo + ": tie(-) was followed by a rest; tie removed.");
                pendingTieToNext = false;
            }
            if (activeTuplet) {
                note.timeModification = { actual: activeTuplet.actual, normal: activeTuplet.normal };
                if (activeTuplet.remaining === activeTuplet.actual) {
                    note.tupletStart = true;
                }
                if (activeTuplet.remaining === 1) {
                    note.tupletStop = true;
                }
            }
            note.voice = entry.voiceId;
            currentMeasure.push(note);
            lastNote = note;
            lastEventNotes = [note];
            noteCount += 1;
        }
    }
    for (const voiceId of Object.keys(measuresByVoice)) {
        const measures = measuresByVoice[voiceId];
        while (measures.length > 1 && measures[measures.length - 1].length === 0) {
            measures.pop();
        }
    }
    if (noteCount === 0) {
        throw new Error("No notes or rests were found. (line 1)");
    }
    const orderedVoiceIds = parseScoreVoiceOrder(scoreDirective, declaredVoiceIds);
    const measureCapacity = Math.max(1, Math.round((Number(meter.beats) || 4) * (4 / (Number(meter.beatType) || 4)) * 960));
    const importDiagnostics = [];
    const overfullCompatibilityMode = (settings === null || settings === void 0 ? void 0 : settings.overfullCompatibilityMode) !== false;
    const parts = orderedVoiceIds.map((voiceId, index) => {
        const partName = voiceNameById[voiceId] || ("Voice " + voiceId);
        const transpose = transposeHintByVoiceId.get(voiceId) ||
            voiceTransposeById[voiceId] ||
            (settings.inferTransposeFromPartName ? inferTransposeFromPartName(partName) : null);
        const normalized = overfullCompatibilityMode
            ? normalizeMeasuresToCapacity(measuresByVoice[voiceId] || [[]], measureCapacity)
            : { measures: measuresByVoice[voiceId] || [[]], diagnostics: [] };
        const normalizedMeasures = normalized.measures;
        if (overfullCompatibilityMode) {
            for (const diag of normalized.diagnostics) {
                importDiagnostics.push({
                    level: "warn",
                    code: "OVERFULL_REFLOWED",
                    fmt: "abc",
                    voiceId,
                    measure: diag.sourceMeasure,
                    action: "reflowed",
                    movedEvents: diag.movedEvents,
                });
            }
        }
        const keyByMeasure = {};
        const measureMetaByIndex = {};
        for (let m = 1; m <= normalizedMeasures.length; m += 1) {
            const hinted = keyHintFifthsByKey.get(`${voiceId}#${m}`);
            if (Number.isFinite(hinted)) {
                keyByMeasure[m] = Number(hinted);
            }
            const meta = measureMetaByKey.get(`${voiceId}#${m}`);
            if (meta) {
                measureMetaByIndex[m] = meta;
            }
        }
        return {
            partId: "P" + String(index + 1),
            partName,
            clef: voiceClefById[voiceId] || "",
            transpose,
            voiceId,
            keyByMeasure,
            measureMetaByIndex,
            measures: normalizedMeasures
        };
    });
    const measureCount = parts.reduce((acc, part) => Math.max(acc, part.measures.length), 0);
    const warningDiagnostics = warnings.map((message) => ({
        level: "warn",
        code: "ABC_IMPORT_WARNING",
        fmt: "abc",
        message,
    }));
    return {
        meta: {
            title: headers.T || settings.defaultTitle,
            composer: headers.C || settings.defaultComposer,
            meter,
            meterText: headers.M || "4/4",
            unitLength,
            unitLengthText: headers.L || "1/8",
            keyInfo,
            keyText: headers.K || "C",
            tempoBpm
        },
        parts,
        measures: parts[0] ? parts[0].measures : [[]],
        voiceCount: parts.length,
        measureCount,
        noteCount,
        warnings,
        diagnostics: warningDiagnostics.concat(importDiagnostics)
    };
}
function parseScoreVoiceOrder(raw, declaredVoiceIds) {
    const baseOrder = Array.from(declaredVoiceIds || []);
    if (!raw) {
        return baseOrder.length > 0 ? baseOrder : ["1"];
    }
    const ordered = [];
    const seen = new Set();
    const groupRegex = /\(([^)]*)\)|([^\s()]+)/g;
    let m;
    while ((m = groupRegex.exec(raw)) !== null) {
        const chunk = m[1] || m[2] || "";
        const ids = chunk
            .split(/\s+/)
            .map((v) => v.trim())
            .filter((v) => /^[A-Za-z0-9_.-]+$/.test(v));
        for (const id of ids) {
            if (!seen.has(id)) {
                seen.add(id);
                ordered.push(id);
            }
        }
    }
    for (const id of baseOrder) {
        if (!seen.has(id)) {
            seen.add(id);
            ordered.push(id);
        }
    }
    return ordered.length > 0 ? ordered : ["1"];
}
function parseVoiceDirectiveTail(raw) {
    if (!raw) {
        return { name: "", clef: "", transpose: null, bodyText: "" };
    }
    let bodyText = String(raw);
    let name = "";
    let clef = "";
    let transpose = null;
    const attrRegex = /([A-Za-z][A-Za-z0-9_-]*)\s*=\s*("([^"]*)"|(\S+))/g;
    bodyText = bodyText.replace(attrRegex, (_full, key, _quotedValue, quotedInner, bareValue) => {
        const lowerKey = String(key).toLowerCase();
        if (lowerKey === "name") {
            name = quotedInner || bareValue || "";
        }
        else if (lowerKey === "clef") {
            clef = String(quotedInner || bareValue || "").trim().toLowerCase();
        }
        else if (lowerKey === "transpose") {
            const parsed = Number.parseInt(String(quotedInner || bareValue || "").trim(), 10);
            if (Number.isFinite(parsed) && parsed >= -24 && parsed <= 24) {
                transpose = { chromatic: parsed };
            }
        }
        return " ";
    });
    return {
        name: name.trim(),
        clef: clef.trim(),
        transpose,
        bodyText: bodyText.trim()
    };
}
function inferTransposeFromPartName(partName) {
    if (!partName) {
        return null;
    }
    const normalized = String(partName).replace(/[â™­]/g, "b").replace(/[â™¯]/g, "#");
    const m = normalized.match(/\bin\s+([A-Ga-g])([#b]?)/);
    if (!m) {
        return null;
    }
    const tonic = String(m[1]).toUpperCase() + (m[2] || "");
    const semitoneByTonic = {
        C: 0,
        "C#": 1,
        Db: 1,
        D: 2,
        "D#": 3,
        Eb: 3,
        E: 4,
        F: 5,
        "F#": 6,
        Gb: 6,
        G: 7,
        "G#": 8,
        Ab: 8,
        A: 9,
        "A#": 10,
        Bb: 10,
        B: 11
    };
    if (!Object.prototype.hasOwnProperty.call(semitoneByTonic, tonic)) {
        return null;
    }
    let chromatic = semitoneByTonic[tonic];
    if (chromatic > 6) {
        chromatic -= 12;
    }
    if (chromatic === 0) {
        return null;
    }
    return { chromatic };
}
function parseMeter(raw, warnings) {
    const normalized = String(raw || "").trim();
    if (normalized === "C") {
        return { beats: 4, beatType: 4 };
    }
    if (normalized === "C|") {
        return { beats: 2, beatType: 2 };
    }
    const m = normalized.match(/^(\d+)\/(\d+)$/);
    if (!m) {
        warnings.push("Invalid meter M: format; defaulted to 4/4: " + raw);
        return { beats: 4, beatType: 4 };
    }
    return { beats: Number(m[1]), beatType: Number(m[2]) };
}
function parseFraction(raw, fieldName, warnings) {
    const parsed = abcCommon.parseFractionText(raw, { num: 1, den: 8 });
    if (parsed.num === 1 && parsed.den === 8 && !/^\s*\d+\/\d+\s*$/.test(String(raw || ""))) {
        warnings.push(fieldName + " has invalid format; defaulted to 1/8: " + raw);
        return parsed;
    }
    const m = String(raw || "").match(/^\s*(\d+)\/(\d+)\s*$/);
    if (!m || !Number(m[1]) || !Number(m[2])) {
        warnings.push(fieldName + " has invalid value; defaulted to 1/8: " + raw);
        return { num: 1, den: 8 };
    }
    return parsed;
}
function parseKey(raw, warnings) {
    const key = raw.trim();
    const fifths = abcCommon.fifthsFromAbcKey(key);
    if (fifths !== null) {
        return { fifths };
    }
    warnings.push("K: unsupported key; defaulted to C: " + key);
    return { fifths: 0 };
}
function parseLengthToken(token, lineNo) {
    return abcCommon.parseAbcLengthToken(token, lineNo);
}
function parseChordAt(text, startIdx, lineNo) {
    if (text[startIdx] !== "[") {
        return null;
    }
    const closeIdx = text.indexOf("]", startIdx + 1);
    if (closeIdx < 0) {
        return null;
    }
    const inner = text.slice(startIdx + 1, closeIdx);
    const noteRegex = /(\^{1,2}|_{1,2}|=)?([A-Ga-g])([',]*)(\d+\/\d+|\d+|\/\d+|\/)?/g;
    const notes = [];
    let match;
    while ((match = noteRegex.exec(inner)) !== null) {
        notes.push({
            accidentalText: match[1] || "",
            pitchChar: match[2],
            octaveShift: match[3] || "",
            lengthToken: match[4] || ""
        });
    }
    if (notes.length === 0) {
        return null;
    }
    const after = text.slice(closeIdx + 1);
    const lengthMatch = after.match(/^(\d+\/\d+|\d+|\/\d+|\/)/);
    const lengthToken = lengthMatch ? lengthMatch[1] : "";
    const nextIdx = closeIdx + 1 + (lengthMatch ? lengthMatch[1].length : 0);
    return {
        notes,
        lengthToken,
        nextIdx
    };
}
function parseGraceGroupAt(text, startIdx, lineNo, unitLength, keySignatureAccidentals, measureAccidentals, voiceId) {
    if (text[startIdx] !== "{")
        return null;
    const closeIdx = text.indexOf("}", startIdx + 1);
    if (closeIdx < 0)
        return null;
    const inner = text.slice(startIdx + 1, closeIdx);
    const graceAccidentals = { ...measureAccidentals };
    const notes = [];
    let idx = 0;
    let graceSlashPending = false;
    while (idx < inner.length) {
        const ch = inner[idx];
        if (ch === " " || ch === "\t") {
            idx += 1;
            continue;
        }
        if (ch === "/") {
            graceSlashPending = true;
            idx += 1;
            continue;
        }
        let accidentalText = "";
        while (idx < inner.length && (inner[idx] === "^" || inner[idx] === "_" || inner[idx] === "=")) {
            accidentalText += inner[idx];
            idx += 1;
        }
        const pitchChar = inner[idx];
        if (!pitchChar || !/[A-Ga-gzZxX]/.test(pitchChar)) {
            idx += 1;
            continue;
        }
        idx += 1;
        let octaveShift = "";
        while (idx < inner.length && (inner[idx] === "'" || inner[idx] === ",")) {
            octaveShift += inner[idx];
            idx += 1;
        }
        let lengthToken = "";
        const lengthMatch = inner.slice(idx).match(/^(\d+\/\d+|\d+|\/\d+|\/)/);
        if (lengthMatch) {
            lengthToken = lengthMatch[1];
            idx += lengthToken.length;
        }
        const len = parseLengthToken(lengthToken, lineNo);
        const absoluteLength = multiplyFractions(unitLength, len);
        const dur = durationInDivisions(absoluteLength, 960);
        if (dur <= 0)
            continue;
        const note = buildNoteData(pitchChar, accidentalText, octaveShift, absoluteLength, dur, lineNo, keySignatureAccidentals, graceAccidentals);
        note.voice = voiceId;
        note.grace = true;
        note.graceSlash = graceSlashPending;
        graceSlashPending = false;
        notes.push(note);
    }
    return { notes, nextIdx: closeIdx + 1 };
}
function scaleNotesDuration(notes, scale) {
    if (!Array.isArray(notes) || notes.length === 0 || !scale) {
        return;
    }
    for (const note of notes) {
        note.duration = Math.max(1, Math.round(note.duration * (scale.num / scale.den)));
        note.type = typeFromDuration(note.duration, 960);
    }
}
function accidentalToAlter(accidental) {
    if (!accidental) {
        return null;
    }
    if (accidental === "=") {
        return 0;
    }
    if (/^\^+$/.test(accidental)) {
        return accidental.length;
    }
    if (/^_+$/.test(accidental)) {
        return -accidental.length;
    }
    return null;
}
function buildNoteData(pitchChar, accidental, octaveShift, absoluteLength, duration, lineNo, keySignatureAccidentals, measureAccidentals) {
    const isRest = /[zZxX]/.test(pitchChar);
    if (isRest) {
        return {
            isRest: true,
            duration,
            type: typeFromFraction(absoluteLength)
        };
    }
    const step = pitchChar.toUpperCase();
    const isLower = /[a-g]/.test(pitchChar);
    let octave = isLower ? 5 : 4;
    for (const ch of octaveShift) {
        if (ch === "'") {
            octave += 1;
        }
        else if (ch === ",") {
            octave -= 1;
        }
    }
    if (octave < 0 || octave > 9) {
        throw new Error("line " + lineNo + ": Octave out of range");
    }
    let alter = null;
    let accidentalText = null;
    const explicitAlter = accidentalToAlter(accidental);
    if (explicitAlter !== null) {
        alter = explicitAlter;
        if (explicitAlter === 0) {
            accidentalText = "natural";
        }
        else if (explicitAlter > 0) {
            accidentalText = explicitAlter >= 2 ? "double-sharp" : "sharp";
        }
        else {
            accidentalText = explicitAlter <= -2 ? "flat-flat" : "flat";
        }
        measureAccidentals[step] = explicitAlter;
    }
    else {
        let resolvedAlter = 0;
        if (Object.prototype.hasOwnProperty.call(measureAccidentals, step)) {
            resolvedAlter = measureAccidentals[step];
        }
        else if (Object.prototype.hasOwnProperty.call(keySignatureAccidentals, step)) {
            resolvedAlter = keySignatureAccidentals[step];
        }
        alter = resolvedAlter === 0 ? null : resolvedAlter;
    }
    return {
        isRest: false,
        step,
        octave,
        alter,
        accidentalText,
        duration,
        type: typeFromFraction(absoluteLength)
    };
}
function keySignatureAlterByStep(fifths) {
    const map = {};
    const sharpOrder = ["F", "C", "G", "D", "A", "E", "B"];
    const flatOrder = ["B", "E", "A", "D", "G", "C", "F"];
    const f = Number.isFinite(fifths) ? Math.max(-7, Math.min(7, Math.trunc(fifths))) : 0;
    if (f > 0) {
        for (let i = 0; i < f; i += 1) {
            map[sharpOrder[i]] = 1;
        }
    }
    else if (f < 0) {
        for (let i = 0; i < Math.abs(f); i += 1) {
            map[flatOrder[i]] = -1;
        }
    }
    return map;
}
function typeFromFraction(frac) {
    const value = frac.num / frac.den;
    if (value >= 1) {
        return "whole";
    }
    if (value >= 0.5) {
        return "half";
    }
    if (value >= 0.25) {
        return "quarter";
    }
    if (value >= 0.125) {
        return "eighth";
    }
    if (value >= 0.0625) {
        return "16th";
    }
    return "32nd";
}
function durationInDivisions(wholeFraction, divisionsPerQuarter) {
    return Math.round((wholeFraction.num / wholeFraction.den) * 4 * divisionsPerQuarter);
}
function typeFromDuration(duration, divisionsPerQuarter) {
    const whole = Number(duration) / (4 * divisionsPerQuarter);
    if (whole >= 1) {
        return "whole";
    }
    if (whole >= 0.5) {
        return "half";
    }
    if (whole >= 0.25) {
        return "quarter";
    }
    if (whole >= 0.125) {
        return "eighth";
    }
    if (whole >= 0.0625) {
        return "16th";
    }
    return "32nd";
}
function normalizeMeasuresToCapacity(measures, capacity) {
    if (!Array.isArray(measures) || measures.length === 0) {
        return { measures: [[]], diagnostics: [] };
    }
    if (!Number.isFinite(capacity) || capacity <= 0) {
        return { measures, diagnostics: [] };
    }
    const normalized = [];
    let carry = [];
    let measureIdx = 0;
    const diagnostics = [];
    while (measureIdx < measures.length || carry.length > 0) {
        const source = measureIdx < measures.length ? measures[measureIdx] : [];
        measureIdx += 1;
        const events = carry.concat(Array.isArray(source) ? source : []);
        carry = [];
        const out = [];
        let occupied = 0;
        for (let i = 0; i < events.length; i += 1) {
            const note = events[i];
            if (!note || typeof note !== "object")
                continue;
            if (note.chord) {
                if (out.length === 0) {
                    out.push({ ...note, chord: false });
                }
                else {
                    out.push(note);
                }
                continue;
            }
            // Grace notes are notation-time ornaments and should not consume measure capacity.
            const duration = note.grace
                ? 0
                : Math.max(1, Math.round(Number(note.duration) || 1));
            if (occupied + duration <= capacity || out.length === 0) {
                out.push(note);
                occupied += duration;
                continue;
            }
            carry = events.slice(i);
            diagnostics.push({
                sourceMeasure: normalized.length + 1,
                movedEvents: Math.max(1, carry.length),
            });
            break;
        }
        normalized.push(out);
    }
    while (normalized.length > 1 && normalized[normalized.length - 1].length === 0) {
        normalized.pop();
    }
    return {
        measures: normalized.length > 0 ? normalized : [[]],
        diagnostics,
    };
}
exports.AbcCompatParser = {
    parseForMusicXml
};
if (typeof window !== "undefined") {
    window.AbcCompatParser = exports.AbcCompatParser;
}
const exportMusicXmlDomToAbc = (doc) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;
    const title = ((_b = (_a = doc.querySelector("work > work-title")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) ||
        ((_d = (_c = doc.querySelector("movement-title")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim()) ||
        "mikuscore";
    const composer = ((_f = (_e = doc.querySelector('identification > creator[type="composer"]')) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) || "";
    const firstMeasure = doc.querySelector("score-partwise > part > measure");
    const meterBeats = ((_h = (_g = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector("attributes > time > beats")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) || "4";
    const meterBeatType = ((_k = (_j = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector("attributes > time > beat-type")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) || "4";
    const fifths = Number(((_m = (_l = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector("attributes > key > fifths")) === null || _l === void 0 ? void 0 : _l.textContent) === null || _m === void 0 ? void 0 : _m.trim()) || "0");
    const mode = ((_p = (_o = firstMeasure === null || firstMeasure === void 0 ? void 0 : firstMeasure.querySelector("attributes > key > mode")) === null || _o === void 0 ? void 0 : _o.textContent) === null || _p === void 0 ? void 0 : _p.trim()) || "major";
    const key = exports.AbcCommon.keyFromFifthsMode(Number.isFinite(fifths) ? fifths : 0, mode);
    const explicitTempo = Number((_r = (_q = doc.querySelector("sound[tempo]")) === null || _q === void 0 ? void 0 : _q.getAttribute("tempo")) !== null && _r !== void 0 ? _r : "");
    const metronomeTempo = Number((_u = (_t = (_s = doc.querySelector("direction-type > metronome > per-minute")) === null || _s === void 0 ? void 0 : _s.textContent) === null || _t === void 0 ? void 0 : _t.trim()) !== null && _u !== void 0 ? _u : "");
    const tempoBpm = Number.isFinite(explicitTempo) && explicitTempo > 0
        ? explicitTempo
        : (Number.isFinite(metronomeTempo) && metronomeTempo > 0 ? metronomeTempo : NaN);
    const partNameById = new Map();
    for (const scorePart of Array.from(doc.querySelectorAll("part-list > score-part"))) {
        const id = (_v = scorePart.getAttribute("id")) !== null && _v !== void 0 ? _v : "";
        if (!id)
            continue;
        const name = ((_x = (_w = scorePart.querySelector("part-name")) === null || _w === void 0 ? void 0 : _w.textContent) === null || _x === void 0 ? void 0 : _x.trim()) || id;
        partNameById.set(id, name);
    }
    const unitLength = { num: 1, den: 8 };
    const abcClefFromMusicXmlPart = (part) => {
        var _a, _b, _c, _d, _e, _f;
        const firstClef = part.querySelector(":scope > measure > attributes > clef");
        if (!firstClef)
            return "";
        const sign = (_c = (_b = (_a = firstClef.querySelector(":scope > sign")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim().toUpperCase()) !== null && _c !== void 0 ? _c : "";
        const line = Number((_f = (_e = (_d = firstClef.querySelector(":scope > line")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "");
        if (sign === "F" && line === 4)
            return "bass";
        if (sign === "G" && line === 2)
            return "treble";
        if (sign === "C" && line === 3)
            return "alto";
        if (sign === "C" && line === 4)
            return "tenor";
        return "";
    };
    const keySignatureAlterByStep = (fifthsValue) => {
        const map = { C: 0, D: 0, E: 0, F: 0, G: 0, A: 0, B: 0 };
        const sharpOrder = ["F", "C", "G", "D", "A", "E", "B"];
        const flatOrder = ["B", "E", "A", "D", "G", "C", "F"];
        const safeFifths = Math.max(-7, Math.min(7, Math.round(fifthsValue)));
        if (safeFifths > 0) {
            for (let i = 0; i < safeFifths; i += 1)
                map[sharpOrder[i]] = 1;
        }
        else if (safeFifths < 0) {
            for (let i = 0; i < Math.abs(safeFifths); i += 1)
                map[flatOrder[i]] = -1;
        }
        return map;
    };
    const accidentalTextToAlter = (text) => {
        const normalized = text.trim().toLowerCase();
        if (!normalized)
            return null;
        if (normalized === "sharp")
            return 1;
        if (normalized === "flat")
            return -1;
        if (normalized === "natural")
            return 0;
        if (normalized === "double-sharp")
            return 2;
        if (normalized === "flat-flat")
            return -2;
        return null;
    };
    const parseOptionalNumber = (text) => {
        const raw = String(text !== null && text !== void 0 ? text : "").trim();
        if (!raw)
            return null;
        const parsed = Number(raw);
        return Number.isFinite(parsed) ? parsed : null;
    };
    const headerLines = [
        "X:1",
        `T:${title}`,
        composer ? `C:${composer}` : "",
        `M:${meterBeats}/${meterBeatType}`,
        "L:1/8",
        Number.isFinite(tempoBpm) ? `Q:1/4=${Math.round(tempoBpm)}` : "",
        `K:${key}`,
    ].filter(Boolean);
    const bodyLines = [];
    const metaLines = [];
    const emittedKeyMetaByVoiceMeasure = new Set();
    const emitDiagMetaForMeasure = (normalizedVoiceId, measure, safeMeasureNumber) => {
        const fields = Array.from(measure.querySelectorAll(':scope > attributes > miscellaneous > miscellaneous-field[name^="mks:diag:"]'));
        if (!fields.length)
            return;
        const byName = new Map();
        for (const field of fields) {
            const name = (field.getAttribute("name") || "").trim();
            if (!name)
                continue;
            const value = (field.textContent || "").trim();
            byName.set(name, value);
        }
        const orderedNames = Array.from(byName.keys()).sort((a, b) => {
            const isCountA = a === "mks:diag:count";
            const isCountB = b === "mks:diag:count";
            if (isCountA && !isCountB)
                return -1;
            if (!isCountA && isCountB)
                return 1;
            return a.localeCompare(b);
        });
        for (const name of orderedNames) {
            const value = byName.get(name) || "";
            metaLines.push(`%@mks diag voice=${normalizedVoiceId} measure=${safeMeasureNumber} name=${name} enc=uri-v1 value=${encodeURIComponent(value)}`);
        }
    };
    const parts = Array.from(doc.querySelectorAll("score-partwise > part"));
    parts.forEach((part, partIndex) => {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19;
        const partId = part.getAttribute("id") || `P${partIndex + 1}`;
        const partName = partNameById.get(partId) || partId;
        const measures = Array.from(part.querySelectorAll(":scope > measure"));
        const laneMap = new Map();
        for (const note of Array.from(part.querySelectorAll(":scope > measure > note"))) {
            const staffText = (_c = (_b = (_a = note.querySelector(":scope > staff")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
            const voiceText = (_f = (_e = (_d = note.querySelector(":scope > voice")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
            const staff = staffText ? staffText : null;
            const voice = voiceText ? voiceText : "1";
            const key = `${staff !== null && staff !== void 0 ? staff : ""}::${voice !== null && voice !== void 0 ? voice : ""}`;
            if (!laneMap.has(key)) {
                laneMap.set(key, { staff, voice });
            }
        }
        const laneDefsRaw = laneMap.size > 0 ? Array.from(laneMap.values()) : [{ staff: null, voice: null }];
        const laneDefs = laneDefsRaw
            .sort((a, b) => {
            var _a, _b;
            const staffA = a.staff === null ? Number.POSITIVE_INFINITY : Number(a.staff);
            const staffB = b.staff === null ? Number.POSITIVE_INFINITY : Number(b.staff);
            if (staffA !== staffB)
                return staffA - staffB;
            const voiceANum = a.voice !== null ? Number(a.voice) : Number.POSITIVE_INFINITY;
            const voiceBNum = b.voice !== null ? Number(b.voice) : Number.POSITIVE_INFINITY;
            if (Number.isFinite(voiceANum) && Number.isFinite(voiceBNum) && voiceANum !== voiceBNum) {
                return voiceANum - voiceBNum;
            }
            const voiceA = (_a = a.voice) !== null && _a !== void 0 ? _a : "";
            const voiceB = (_b = b.voice) !== null && _b !== void 0 ? _b : "";
            return voiceA.localeCompare(voiceB);
        })
            .map((lane, laneIndex) => {
            if (laneDefsRaw.length === 1) {
                return { ...lane, voiceId: partId };
            }
            const staffSuffix = lane.staff ? `_s${lane.staff}` : "";
            const voiceSuffix = lane.voice ? `_v${lane.voice}` : "";
            return { ...lane, voiceId: `${partId}${staffSuffix}${voiceSuffix || `_l${laneIndex + 1}`}` };
        });
        const resolveLaneClef = (staff) => {
            var _a, _b, _c, _d, _e, _f;
            if (!staff)
                return abcClefFromMusicXmlPart(part);
            for (const measure of measures) {
                const clefNode = measure.querySelector(`:scope > attributes > clef[number="${staff}"]`);
                if (!clefNode)
                    continue;
                const sign = (_c = (_b = (_a = clefNode.querySelector(":scope > sign")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim().toUpperCase()) !== null && _c !== void 0 ? _c : "";
                const line = Number((_f = (_e = (_d = clefNode.querySelector(":scope > line")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "");
                if (sign === "F" && line === 4)
                    return "bass";
                if (sign === "G" && line === 2)
                    return "treble";
                if (sign === "C" && line === 3)
                    return "alto";
                if (sign === "C" && line === 4)
                    return "tenor";
            }
            return abcClefFromMusicXmlPart(part);
        };
        for (const lane of laneDefs) {
            const normalizedVoiceId = lane.voiceId.replace(/[^A-Za-z0-9_.-]/g, "_");
            const laneName = laneDefs.length <= 1
                ? partName
                : lane.staff && lane.voice
                    ? `${partName} (Staff ${lane.staff} Voice ${lane.voice})`
                    : lane.staff
                        ? `${partName} (Staff ${lane.staff})`
                        : lane.voice
                            ? `${partName} (Voice ${lane.voice})`
                            : `${partName} (Lane)`;
            const abcClef = resolveLaneClef(lane.staff);
            const clefSuffix = abcClef ? ` clef=${abcClef}` : "";
            headerLines.push(`V:${normalizedVoiceId} name="${laneName}"${clefSuffix}`);
            for (const measure of measures) {
                const transposeNode = measure.querySelector(":scope > attributes > transpose");
                if (!transposeNode)
                    continue;
                const chromatic = Number(((_h = (_g = transposeNode.querySelector(":scope > chromatic")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) || "");
                const diatonic = Number(((_k = (_j = transposeNode.querySelector(":scope > diatonic")) === null || _j === void 0 ? void 0 : _j.textContent) === null || _k === void 0 ? void 0 : _k.trim()) || "");
                if (Number.isFinite(chromatic) || Number.isFinite(diatonic)) {
                    const parts = [`%@mks transpose voice=${normalizedVoiceId}`];
                    if (Number.isFinite(chromatic))
                        parts.push(`chromatic=${Math.round(chromatic)}`);
                    if (Number.isFinite(diatonic))
                        parts.push(`diatonic=${Math.round(diatonic)}`);
                    metaLines.push(parts.join(" "));
                }
                break;
            }
            const partInitialFifthsRaw = parseOptionalNumber((_l = part.querySelector(":scope > measure > attributes > key > fifths")) === null || _l === void 0 ? void 0 : _l.textContent);
            const partInitialFifths = partInitialFifthsRaw !== null
                ? Math.round(partInitialFifthsRaw)
                : (Number.isFinite(fifths) ? Math.round(fifths) : 0);
            let currentDivisions = 480;
            let currentFifths = partInitialFifths;
            let lastEmittedKeyFifths = null;
            let currentBeats = Number(meterBeats) || 4;
            let currentBeatType = Number(meterBeatType) || 4;
            const measureTexts = [];
            for (const measure of measures) {
                let activeTuplet = null;
                let eventNo = 0;
                const parsedDiv = parseOptionalNumber((_m = measure.querySelector("attributes > divisions")) === null || _m === void 0 ? void 0 : _m.textContent);
                if (parsedDiv !== null && parsedDiv > 0) {
                    currentDivisions = parsedDiv;
                }
                const parsedFifths = parseOptionalNumber((_o = measure.querySelector("attributes > key > fifths")) === null || _o === void 0 ? void 0 : _o.textContent);
                if (parsedFifths !== null) {
                    currentFifths = Math.round(parsedFifths);
                }
                const safeMeasureNumber = measureTexts.length + 1;
                const rawMeasureNumber = (measure.getAttribute("number") || "").trim() || String(safeMeasureNumber);
                const implicitAttr = (measure.getAttribute("implicit") || "").trim().toLowerCase();
                const isImplicit = implicitAttr === "yes" || implicitAttr === "true" || implicitAttr === "1";
                const leftRepeatNode = measure.querySelector(':scope > barline[location="left"] > repeat');
                const rightRepeatNode = measure.querySelector(':scope > barline[location="right"] > repeat');
                const leftRepeatDir = ((leftRepeatNode === null || leftRepeatNode === void 0 ? void 0 : leftRepeatNode.getAttribute("direction")) || "").trim().toLowerCase();
                const rightRepeatDir = ((rightRepeatNode === null || rightRepeatNode === void 0 ? void 0 : rightRepeatNode.getAttribute("direction")) || "").trim().toLowerCase();
                const repeatDir = rightRepeatDir === "backward"
                    ? "backward"
                    : (leftRepeatDir === "forward" ? "forward" : "");
                const repeatTimes = Number.parseInt(String((rightRepeatNode === null || rightRepeatNode === void 0 ? void 0 : rightRepeatNode.getAttribute("times")) || ""), 10);
                if (isImplicit || repeatDir || rawMeasureNumber !== String(safeMeasureNumber)) {
                    const metaChunks = [
                        `%@mks measure voice=${normalizedVoiceId} measure=${safeMeasureNumber}`,
                        `number=${rawMeasureNumber}`,
                        `implicit=${isImplicit ? 1 : 0}`,
                    ];
                    if (repeatDir) {
                        metaChunks.push(`repeat=${repeatDir}`);
                    }
                    if (repeatDir === "backward" && Number.isFinite(repeatTimes) && repeatTimes > 1) {
                        metaChunks.push(`times=${Math.round(repeatTimes)}`);
                    }
                    metaLines.push(metaChunks.join(" "));
                }
                emitDiagMetaForMeasure(normalizedVoiceId, measure, safeMeasureNumber);
                const isFirstMeasureForLane = measureTexts.length === 0;
                const hasExplicitKeyInMeasure = parsedFifths !== null;
                const shouldEmitMeasureHint = hasExplicitKeyInMeasure || isFirstMeasureForLane;
                if (shouldEmitMeasureHint) {
                    if (lastEmittedKeyFifths === null || lastEmittedKeyFifths !== currentFifths) {
                        const metaKey = `${normalizedVoiceId}#${safeMeasureNumber}`;
                        if (!emittedKeyMetaByVoiceMeasure.has(metaKey)) {
                            metaLines.push(`%@mks key voice=${normalizedVoiceId} measure=${safeMeasureNumber} fifths=${Math.max(-7, Math.min(7, Math.round(currentFifths)))}`);
                            emittedKeyMetaByVoiceMeasure.add(metaKey);
                        }
                        lastEmittedKeyFifths = currentFifths;
                    }
                }
                const parsedBeats = parseOptionalNumber((_p = measure.querySelector("attributes > time > beats")) === null || _p === void 0 ? void 0 : _p.textContent);
                if (parsedBeats !== null && parsedBeats > 0) {
                    currentBeats = parsedBeats;
                }
                const parsedBeatType = parseOptionalNumber((_q = measure.querySelector("attributes > time > beat-type")) === null || _q === void 0 ? void 0 : _q.textContent);
                if (parsedBeatType !== null && parsedBeatType > 0) {
                    currentBeatType = parsedBeatType;
                }
                const keyAlterMap = keySignatureAlterByStep(currentFifths);
                const measureAccidentalByStepOctave = new Map();
                let pending = null;
                const pendingGraceTokens = [];
                const tokens = [];
                const flush = () => {
                    if (!pending)
                        return;
                    if (pending.pitches.length === 1) {
                        tokens.push(`${pending.prefix}${pending.pitches[0]}${pending.len}${pending.tie ? "-" : ""}${pending.slurStop ? ")" : ""}`);
                    }
                    else {
                        tokens.push(`${pending.prefix}[${pending.pitches.join("")}]${pending.len}${pending.tie ? "-" : ""}${pending.slurStop ? ")" : ""}`);
                    }
                    pending = null;
                };
                for (const child of Array.from(measure.children)) {
                    if (child.tagName !== "note")
                        continue;
                    if (lane.staff) {
                        const noteStaff = (_t = (_s = (_r = child.querySelector(":scope > staff")) === null || _r === void 0 ? void 0 : _r.textContent) === null || _s === void 0 ? void 0 : _s.trim()) !== null && _t !== void 0 ? _t : "";
                        if (noteStaff !== lane.staff)
                            continue;
                    }
                    if (lane.voice) {
                        const noteVoiceRaw = (_w = (_v = (_u = child.querySelector(":scope > voice")) === null || _u === void 0 ? void 0 : _u.textContent) === null || _v === void 0 ? void 0 : _v.trim()) !== null && _w !== void 0 ? _w : "";
                        const noteVoice = noteVoiceRaw || "1";
                        if (noteVoice !== lane.voice)
                            continue;
                    }
                    const isChord = Boolean(child.querySelector(":scope > chord"));
                    const isGrace = Boolean(child.querySelector(":scope > grace"));
                    const duration = Number(((_y = (_x = child.querySelector(":scope > duration")) === null || _x === void 0 ? void 0 : _x.textContent) === null || _y === void 0 ? void 0 : _y.trim()) || "0");
                    if (!isGrace && (!Number.isFinite(duration) || duration <= 0))
                        continue;
                    const noteDuration = isGrace
                        ? (Number.isFinite(duration) && duration > 0 ? duration : Math.round(currentDivisions / 2))
                        : duration;
                    const hasTieStart = Boolean(child.querySelector(':scope > tie[type="start"]'));
                    const hasTrillMark = Boolean(child.querySelector(":scope > notations > ornaments > trill-mark"));
                    const hasTurn = Boolean(child.querySelector(":scope > notations > ornaments > turn"));
                    const hasInvertedTurn = Boolean(child.querySelector(":scope > notations > ornaments > inverted-turn"));
                    const hasWavyLineStart = Array.from(child.querySelectorAll(":scope > notations > ornaments > wavy-line")).some((node) => {
                        var _a;
                        const type = ((_a = node.getAttribute("type")) !== null && _a !== void 0 ? _a : "").trim().toLowerCase();
                        return type === "" || type === "start";
                    });
                    const hasTrill = hasTrillMark || hasWavyLineStart;
                    const turnType = hasInvertedTurn ? "inverted-turn" : (hasTurn ? "turn" : "");
                    const trillAccidentalText = ((_0 = (_z = child.querySelector(":scope > notations > ornaments > accidental-mark")) === null || _z === void 0 ? void 0 : _z.textContent) === null || _0 === void 0 ? void 0 : _0.trim()) || "";
                    const hasStaccato = Boolean(child.querySelector(":scope > notations > articulations > staccato"));
                    const hasSlurStart = Boolean(child.querySelector(':scope > notations > slur[type="start"]'));
                    const hasSlurStop = Boolean(child.querySelector(':scope > notations > slur[type="stop"]'));
                    const hasGraceSlash = ((_2 = (_1 = child.querySelector(":scope > grace")) === null || _1 === void 0 ? void 0 : _1.getAttribute("slash")) !== null && _2 !== void 0 ? _2 : "").trim().toLowerCase() === "yes";
                    const hasTupletStart = Boolean(child.querySelector(':scope > notations > tuplet[type="start"]'));
                    const tmActual = Number(((_4 = (_3 = child.querySelector(":scope > time-modification > actual-notes")) === null || _3 === void 0 ? void 0 : _3.textContent) === null || _4 === void 0 ? void 0 : _4.trim()) || "");
                    const tmNormal = Number(((_6 = (_5 = child.querySelector(":scope > time-modification > normal-notes")) === null || _5 === void 0 ? void 0 : _5.textContent) === null || _6 === void 0 ? void 0 : _6.trim()) || "");
                    const hasTimeModification = Number.isFinite(tmActual) && tmActual > 0 && Number.isFinite(tmNormal) && tmNormal > 0;
                    const rawWholeFraction = exports.AbcCommon.reduceFraction(noteDuration, currentDivisions * 4, { num: 1, den: 4 });
                    const abcBaseWholeFraction = hasTimeModification
                        ? exports.AbcCommon.multiplyFractions(rawWholeFraction, {
                            num: Math.round(tmActual),
                            den: Math.round(tmNormal)
                        }, { num: 1, den: 4 })
                        : rawWholeFraction;
                    const lenRatio = exports.AbcCommon.divideFractions(abcBaseWholeFraction, unitLength, { num: 1, den: 1 });
                    const len = exports.AbcCommon.abcLengthTokenFromFraction(lenRatio);
                    let pitchToken = "z";
                    if (!child.querySelector(":scope > rest")) {
                        const step = ((_8 = (_7 = child.querySelector(":scope > pitch > step")) === null || _7 === void 0 ? void 0 : _7.textContent) === null || _8 === void 0 ? void 0 : _8.trim()) || "C";
                        const octave = Number(((_10 = (_9 = child.querySelector(":scope > pitch > octave")) === null || _9 === void 0 ? void 0 : _9.textContent) === null || _10 === void 0 ? void 0 : _10.trim()) || "4");
                        const upperStep = /^[A-G]$/.test(step.toUpperCase()) ? step.toUpperCase() : "C";
                        const safeOctave = Number.isFinite(octave) ? Math.max(0, Math.min(9, Math.round(octave))) : 4;
                        const stepOctaveKey = `${upperStep}${safeOctave}`;
                        const alterRaw = (_13 = (_12 = (_11 = child.querySelector(":scope > pitch > alter")) === null || _11 === void 0 ? void 0 : _11.textContent) === null || _12 === void 0 ? void 0 : _12.trim()) !== null && _13 !== void 0 ? _13 : "";
                        const explicitAlter = alterRaw !== "" && Number.isFinite(Number(alterRaw)) ? Math.round(Number(alterRaw)) : null;
                        const accidentalText = (_16 = (_15 = (_14 = child.querySelector(":scope > accidental")) === null || _14 === void 0 ? void 0 : _14.textContent) === null || _15 === void 0 ? void 0 : _15.trim()) !== null && _16 !== void 0 ? _16 : "";
                        const accidentalAlter = accidentalTextToAlter(accidentalText);
                        const keyAlter = (_17 = keyAlterMap[upperStep]) !== null && _17 !== void 0 ? _17 : 0;
                        const currentAlter = measureAccidentalByStepOctave.has(stepOctaveKey)
                            ? (_18 = measureAccidentalByStepOctave.get(stepOctaveKey)) !== null && _18 !== void 0 ? _18 : 0
                            : keyAlter;
                        // In MusicXML pitch, omitted <alter> means natural (0), not "follow key accidental".
                        // Key signature context is only used to decide whether an explicit accidental token is needed.
                        let targetAlter = explicitAlter !== null ? explicitAlter : 0;
                        if (accidentalAlter !== null) {
                            targetAlter = accidentalAlter;
                        }
                        // Keep explicit non-natural accidentals (e.g. cautionary sharp/flat),
                        // but avoid emitting redundant naturals when pitch is already natural in context.
                        const shouldEmitAccidental = targetAlter !== currentAlter || (accidentalAlter !== null && accidentalAlter !== 0);
                        const accidental = shouldEmitAccidental
                            ? (targetAlter === 0 ? "=" : exports.AbcCommon.accidentalFromAlter(targetAlter))
                            : "";
                        measureAccidentalByStepOctave.set(stepOctaveKey, targetAlter);
                        pitchToken = `${accidental}${exports.AbcCommon.abcPitchFromStepOctave(step, Number.isFinite(octave) ? octave : 4)}`;
                    }
                    if (isGrace) {
                        const graceSlashPrefix = hasGraceSlash ? "/" : "";
                        if (!isChord || pendingGraceTokens.length === 0) {
                            pendingGraceTokens.push(`${graceSlashPrefix}${pitchToken}${len}${hasTieStart ? "-" : ""}`);
                        }
                        else {
                            const last = (_19 = pendingGraceTokens.pop()) !== null && _19 !== void 0 ? _19 : "";
                            const merged = last.startsWith("[")
                                ? last.replace("]", `${graceSlashPrefix}${pitchToken}]`)
                                : `[${last}${graceSlashPrefix}${pitchToken}]`;
                            pendingGraceTokens.push(merged);
                        }
                        continue;
                    }
                    const gracePrefix = pendingGraceTokens.length > 0 ? `{${pendingGraceTokens.join("")}}` : "";
                    if (!isGrace && !isChord) {
                        if (hasTupletStart && hasTimeModification) {
                            activeTuplet = { actual: Math.round(tmActual), normal: Math.round(tmNormal), remaining: Math.round(tmActual) };
                        }
                        else if (!activeTuplet && hasTimeModification) {
                            activeTuplet = { actual: Math.round(tmActual), normal: Math.round(tmNormal), remaining: Math.round(tmActual) };
                        }
                    }
                    const tupletPrefix = !isGrace && !isChord && activeTuplet
                        ? (activeTuplet.remaining === activeTuplet.actual
                            ? `(${activeTuplet.actual}:${activeTuplet.normal}:${activeTuplet.actual}`
                            : "")
                        : "";
                    const trillPrefix = hasTrill ? "!trill!" : "";
                    const turnPrefix = turnType === "inverted-turn" ? "!invertedturn!" : (turnType === "turn" ? "!turn!" : "");
                    const staccatoPrefix = hasStaccato ? "!staccato!" : "";
                    const slurStartPrefix = hasSlurStart ? "(" : "";
                    const eventPrefix = `${tupletPrefix}${slurStartPrefix}${gracePrefix}${trillPrefix}${turnPrefix}${staccatoPrefix}`;
                    if (pendingGraceTokens.length > 0) {
                        pendingGraceTokens.length = 0;
                    }
                    if (!isChord) {
                        eventNo += 1;
                        if (hasTrill && trillAccidentalText) {
                            metaLines.push(`%@mks trill voice=${normalizedVoiceId} measure=${measure.getAttribute("number") || (measureTexts.length + 1)} event=${eventNo} upper=${trillAccidentalText}`);
                        }
                        flush();
                        pending = { pitches: [pitchToken], len, tie: hasTieStart, slurStop: hasSlurStop, prefix: eventPrefix };
                    }
                    else if (!pending) {
                        eventNo += 1;
                        if (hasTrill && trillAccidentalText) {
                            metaLines.push(`%@mks trill voice=${normalizedVoiceId} measure=${measure.getAttribute("number") || (measureTexts.length + 1)} event=${eventNo} upper=${trillAccidentalText}`);
                        }
                        pending = { pitches: [pitchToken], len, tie: hasTieStart, slurStop: hasSlurStop, prefix: eventPrefix };
                    }
                    else {
                        pending.pitches.push(pitchToken);
                        pending.tie = pending.tie || hasTieStart;
                        pending.slurStop = pending.slurStop || hasSlurStop;
                    }
                    if (!isGrace && !isChord && activeTuplet) {
                        activeTuplet.remaining -= 1;
                        if (activeTuplet.remaining <= 0) {
                            activeTuplet = null;
                        }
                    }
                }
                if (pendingGraceTokens.length > 0) {
                    tokens.push(`{${pendingGraceTokens.join("")}}`);
                    pendingGraceTokens.length = 0;
                }
                flush();
                if (tokens.length === 0) {
                    const measureDuration = Math.max(1, Math.round(currentDivisions * Number(currentBeats) * (4 / Number(currentBeatType || 4))));
                    const wholeFraction = exports.AbcCommon.reduceFraction(measureDuration, currentDivisions * 4, { num: 1, den: 4 });
                    const lenRatio = exports.AbcCommon.divideFractions(wholeFraction, unitLength, { num: 1, den: 1 });
                    tokens.push(`z${exports.AbcCommon.abcLengthTokenFromFraction(lenRatio)}`);
                }
                measureTexts.push(tokens.join(" "));
            }
            bodyLines.push(`V:${normalizedVoiceId}`);
            bodyLines.push(`${measureTexts.join(" | ")} |`);
        }
    });
    const metaBlock = metaLines.length > 0 ? `\n${metaLines.join("\n")}\n` : "\n";
    return `${headerLines.join("\n")}\n\n${bodyLines.join("\n")}${metaBlock}`;
};
exports.exportMusicXmlDomToAbc = exportMusicXmlDomToAbc;
const xmlEscape = (text) => text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&apos;");
const normalizeTypeForMusicXml = (t) => {
    const raw = String(t || "").trim();
    if (!raw)
        return "quarter";
    if (raw === "16th" || raw === "32nd" || raw === "64th" || raw === "128th")
        return raw;
    if (raw === "whole" || raw === "half" || raw === "quarter" || raw === "eighth")
        return raw;
    return "quarter";
};
const normalizeVoiceForMusicXml = (voice) => {
    const raw = String(voice || "").trim();
    if (!raw)
        return "1";
    if (/^[1-9]\d*$/.test(raw))
        return raw;
    const m = raw.match(/\d+/);
    if (!m)
        return "1";
    const n = Number(m[0]);
    if (!Number.isFinite(n) || n <= 0)
        return "1";
    return String(Math.round(n));
};
const midiByStepForAbcImport = {
    C: 0,
    D: 2,
    E: 4,
    F: 5,
    G: 7,
    A: 9,
    B: 11,
};
const noteToMidiForAbcClefInference = (note) => {
    if (!note || note.isRest)
        return null;
    const step = String(note.step || "").trim().toUpperCase();
    if (!Object.prototype.hasOwnProperty.call(midiByStepForAbcImport, step)) {
        return null;
    }
    const octave = Number.isFinite(note.octave) ? Math.round(Number(note.octave)) : 4;
    const alter = Number.isFinite(note.alter) ? Math.round(Number(note.alter)) : 0;
    return (octave + 1) * 12 + midiByStepForAbcImport[step] + alter;
};
const resolveAbcImportClef = (part) => {
    const explicit = String((part === null || part === void 0 ? void 0 : part.clef) || "").trim().toLowerCase();
    if (explicit)
        return explicit;
    const keys = [];
    for (const measure of (part === null || part === void 0 ? void 0 : part.measures) || []) {
        for (const note of measure || []) {
            const midi = noteToMidiForAbcClefInference(note);
            if (Number.isFinite(midi)) {
                keys.push(midi);
            }
        }
    }
    if (!keys.length)
        return "";
    return (0, staffClefPolicy_1.chooseSingleClefByKeys)(keys) === "F" ? "bass" : "treble";
};
const clefXmlFromAbcClef = (rawClef) => {
    const clef = String(rawClef || "").trim().toLowerCase();
    if (clef === "bass" || clef === "f") {
        return "<clef><sign>F</sign><line>4</line></clef>";
    }
    if (clef === "alto" || clef === "c3") {
        return "<clef><sign>C</sign><line>3</line></clef>";
    }
    if (clef === "tenor" || clef === "c4") {
        return "<clef><sign>C</sign><line>4</line></clef>";
    }
    return "<clef><sign>G</sign><line>2</line></clef>";
};
exports.clefXmlFromAbcClef = clefXmlFromAbcClef;
const toHex = (value, width = 2) => {
    const safe = Math.max(0, Math.round(Number(value) || 0));
    return `0x${safe.toString(16).toUpperCase().padStart(width, "0")}`;
};
const buildAbcMeasureDebugMiscXml = (notes, measureNo) => {
    if (!notes.length)
        return "";
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:dbg:abc:meta:count">${toHex(notes.length, 4)}</miscellaneous-field>`;
    for (let i = 0; i < notes.length; i += 1) {
        const note = notes[i];
        const voice = normalizeVoiceForMusicXml(note.voice);
        const step = note.isRest ? "R" : (/^[A-G]$/.test(String(note.step || "").toUpperCase()) ? String(note.step).toUpperCase() : "C");
        const octave = Number.isFinite(note.octave) ? Math.max(0, Math.min(9, Math.round(Number(note.octave)))) : 4;
        const alter = Number.isFinite(note.alter) ? Math.round(Number(note.alter)) : 0;
        const dur = note.grace ? 0 : Math.max(1, Math.round(Number(note.duration) || 1));
        const payload = [
            `idx=${toHex(i, 4)}`,
            `m=${toHex(measureNo, 4)}`,
            `v=${xmlEscape(voice)}`,
            `r=${note.isRest ? "1" : "0"}`,
            `g=${note.grace ? "1" : "0"}`,
            `ch=${note.chord ? "1" : "0"}`,
            `st=${step}`,
            `al=${String(alter)}`,
            `oc=${toHex(octave, 2)}`,
            `dd=${toHex(dur, 4)}`,
            `tp=${xmlEscape(normalizeTypeForMusicXml(note.type))}`,
        ].join(";");
        xml += `<miscellaneous-field name="mks:dbg:abc:meta:${String(i + 1).padStart(4, "0")}">${payload}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildAbcSourceMiscXml = (abcSource) => {
    const source = String(abcSource !== null && abcSource !== void 0 ? abcSource : "");
    if (!source.length)
        return "";
    const encoded = source
        .replace(/\\/g, "\\\\")
        .replace(/\r/g, "\\r")
        .replace(/\n/g, "\\n");
    const CHUNK_SIZE = 240;
    const MAX_CHUNKS = 512;
    const chunks = [];
    for (let i = 0; i < encoded.length && chunks.length < MAX_CHUNKS; i += CHUNK_SIZE) {
        chunks.push(encoded.slice(i, i + CHUNK_SIZE));
    }
    const truncated = chunks.join("").length < encoded.length;
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:src:abc:raw-encoding">escape-v1</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:abc:raw-length">${xmlEscape(String(source.length))}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:abc:raw-encoded-length">${xmlEscape(String(encoded.length))}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:abc:raw-chunks">${xmlEscape(String(chunks.length))}</miscellaneous-field>`;
    xml += `<miscellaneous-field name="mks:src:abc:raw-truncated">${truncated ? "1" : "0"}</miscellaneous-field>`;
    for (let i = 0; i < chunks.length; i += 1) {
        xml += `<miscellaneous-field name="mks:src:abc:raw-${String(i + 1).padStart(4, "0")}">${xmlEscape(chunks[i])}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const buildAbcDiagMiscXml = (diagnostics) => {
    if (!diagnostics.length)
        return "";
    const maxEntries = Math.min(256, diagnostics.length);
    let xml = "<attributes><miscellaneous>";
    xml += `<miscellaneous-field name="mks:diag:count">${maxEntries}</miscellaneous-field>`;
    for (let i = 0; i < maxEntries; i += 1) {
        const item = diagnostics[i];
        const payload = [
            `level=${item.level}`,
            `code=${item.code}`,
            `fmt=${item.fmt}`,
            Number.isFinite(item.measure) ? `measure=${Math.max(1, Math.round(Number(item.measure)))}` : "",
            item.voiceId ? `voice=${xmlEscape(item.voiceId)}` : "",
            item.action ? `action=${xmlEscape(item.action)}` : "",
            item.message ? `message=${xmlEscape(item.message)}` : "",
            Number.isFinite(item.movedEvents) ? `movedEvents=${Math.max(0, Math.round(Number(item.movedEvents)))}` : "",
        ]
            .filter(Boolean)
            .join(";");
        xml += `<miscellaneous-field name="mks:diag:${String(i + 1).padStart(4, "0")}">${payload}</miscellaneous-field>`;
    }
    xml += "</miscellaneous></attributes>";
    return xml;
};
const prettyPrintXml = (xml) => {
    const compact = xml.replace(/>\s+</g, "><").trim();
    const split = compact.replace(/(>)(<)(\/*)/g, "$1\n$2$3").split("\n");
    let indent = 0;
    const lines = [];
    for (const rawToken of split) {
        const token = rawToken.trim();
        if (!token)
            continue;
        if (/^<\//.test(token))
            indent = Math.max(0, indent - 1);
        lines.push(`${"  ".repeat(indent)}${token}`);
        const isOpening = /^<[^!?/][^>]*>$/.test(token);
        const isSelfClosing = /\/>$/.test(token);
        if (isOpening && !isSelfClosing)
            indent += 1;
    }
    return lines.join("\n");
};
const buildMusicXmlFromAbcParsed = (parsed, abcSource, options = {}) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
    const debugMetadata = (_a = options.debugMetadata) !== null && _a !== void 0 ? _a : true;
    const sourceMetadata = (_b = options.sourceMetadata) !== null && _b !== void 0 ? _b : true;
    const debugPrettyPrint = (_c = options.debugPrettyPrint) !== null && _c !== void 0 ? _c : debugMetadata;
    const parts = parsed.parts && parsed.parts.length > 0
        ? parsed.parts
        : [{ partId: "P1", partName: "Voice 1", measures: [[]] }];
    const resolvedParts = parts.map((part) => ({
        ...part,
        clef: resolveAbcImportClef(part),
    }));
    const measureCount = resolvedParts.reduce((max, part) => Math.max(max, part.measures.length), 1);
    const title = ((_d = parsed.meta) === null || _d === void 0 ? void 0 : _d.title) || "mikuscore";
    const composer = ((_e = parsed.meta) === null || _e === void 0 ? void 0 : _e.composer) || "Unknown";
    const beats = ((_g = (_f = parsed.meta) === null || _f === void 0 ? void 0 : _f.meter) === null || _g === void 0 ? void 0 : _g.beats) || 4;
    const beatType = ((_j = (_h = parsed.meta) === null || _h === void 0 ? void 0 : _h.meter) === null || _j === void 0 ? void 0 : _j.beatType) || 4;
    const defaultFifths = Number.isFinite((_l = (_k = parsed.meta) === null || _k === void 0 ? void 0 : _k.keyInfo) === null || _l === void 0 ? void 0 : _l.fifths) ? parsed.meta.keyInfo.fifths : 0;
    const divisions = 960;
    const beatDiv = Math.max(1, Math.round((divisions * 4) / Math.max(1, Math.round(beatType))));
    const measureDurationDiv = Math.max(1, Math.round((divisions * 4 * Math.max(1, Math.round(beats))) / Math.max(1, Math.round(beatType))));
    const emptyMeasureRestType = normalizeTypeForMusicXml(typeFromDuration(measureDurationDiv, divisions));
    const tempoBpm = Number.isFinite((_m = parsed.meta) === null || _m === void 0 ? void 0 : _m.tempoBpm) && Number((_o = parsed.meta) === null || _o === void 0 ? void 0 : _o.tempoBpm) > 0
        ? Math.max(20, Math.min(300, Math.round(Number((_p = parsed.meta) === null || _p === void 0 ? void 0 : _p.tempoBpm))))
        : null;
    const partListXml = resolvedParts
        .map((part, index) => {
        const midiChannel = ((index % 16) + 1 === 10) ? 11 : ((index % 16) + 1);
        return [
            `<score-part id="${xmlEscape(part.partId)}">`,
            `<part-name>${xmlEscape(part.partName || part.partId)}</part-name>`,
            `<midi-instrument id="${xmlEscape(part.partId)}-I1">`,
            `<midi-channel>${midiChannel}</midi-channel>`,
            `<midi-program>6</midi-program>`,
            "</midi-instrument>",
            "</score-part>",
        ].join("");
    })
        .join("");
    const partBodyXml = resolvedParts
        .map((part, partIndex) => {
        var _a, _b, _c, _d, _e, _f;
        const measuresXml = [];
        let currentPartFifths = Math.max(-7, Math.min(7, Math.round(defaultFifths)));
        for (let i = 0; i < measureCount; i += 1) {
            const measureNo = i + 1;
            const notes = (_a = part.measures[i]) !== null && _a !== void 0 ? _a : [];
            const measureMeta = (_c = (_b = part.measureMetaByIndex) === null || _b === void 0 ? void 0 : _b[measureNo]) !== null && _c !== void 0 ? _c : null;
            const hintedFifths = Number.isFinite((_d = part.keyByMeasure) === null || _d === void 0 ? void 0 : _d[measureNo])
                ? Math.max(-7, Math.min(7, Math.round(Number((_e = part.keyByMeasure) === null || _e === void 0 ? void 0 : _e[measureNo]))))
                : null;
            if (hintedFifths !== null) {
                currentPartFifths = hintedFifths;
            }
            const header = i === 0
                ? [
                    "<attributes>",
                    "<divisions>960</divisions>",
                    `<key><fifths>${Math.round(currentPartFifths)}</fifths></key>`,
                    `<time><beats>${Math.round(beats)}</beats><beat-type>${Math.round(beatType)}</beat-type></time>`,
                    part.transpose && (Number.isFinite(part.transpose.chromatic) || Number.isFinite(part.transpose.diatonic))
                        ? [
                            "<transpose>",
                            Number.isFinite(part.transpose.diatonic)
                                ? `<diatonic>${Math.round(Number(part.transpose.diatonic))}</diatonic>`
                                : "",
                            Number.isFinite(part.transpose.chromatic)
                                ? `<chromatic>${Math.round(Number(part.transpose.chromatic))}</chromatic>`
                                : "",
                            "</transpose>",
                        ].join("")
                        : "",
                    (0, exports.clefXmlFromAbcClef)(part.clef),
                    "</attributes>",
                    tempoBpm !== null && partIndex === 0
                        ? `<direction><direction-type><metronome><beat-unit>quarter</beat-unit><per-minute>${tempoBpm}</per-minute></metronome></direction-type><sound tempo="${tempoBpm}"/></direction>`
                        : "",
                ].join("")
                : hintedFifths !== null
                    ? `<attributes><key><fifths>${Math.round(currentPartFifths)}</fifths></key></attributes>`
                    : "";
            const notesXml = notes.length > 0
                ? (() => {
                    const beamXmlByNoteIndex = (() => {
                        var _a;
                        const out = new Map();
                        const levelFromType = (typeText) => {
                            switch (String(typeText || "").trim().toLowerCase()) {
                                case "eighth":
                                    return 1;
                                case "16th":
                                    return 2;
                                case "32nd":
                                    return 3;
                                case "64th":
                                    return 4;
                                default:
                                    return 0;
                            }
                        };
                        const byVoice = new Map();
                        for (let i = 0; i < notes.length; i += 1) {
                            const n = notes[i];
                            const voice = normalizeVoiceForMusicXml(n.voice);
                            const bucket = (_a = byVoice.get(voice)) !== null && _a !== void 0 ? _a : [];
                            bucket.push({ note: n, noteIndex: i });
                            byVoice.set(voice, bucket);
                        }
                        for (const events of byVoice.values()) {
                            const primary = events.filter((ev) => { var _a; return !((_a = ev.note) === null || _a === void 0 ? void 0 : _a.chord); });
                            if (!primary.length)
                                continue;
                            const assignments = (0, beam_common_1.computeBeamAssignments)(primary, beatDiv, (ev) => {
                                var _a, _b, _c, _d, _e;
                                const type = normalizeTypeForMusicXml((_a = ev.note) === null || _a === void 0 ? void 0 : _a.type);
                                return {
                                    timed: true,
                                    chord: !Boolean((_b = ev.note) === null || _b === void 0 ? void 0 : _b.isRest),
                                    grace: Boolean((_c = ev.note) === null || _c === void 0 ? void 0 : _c.grace),
                                    durationDiv: ((_d = ev.note) === null || _d === void 0 ? void 0 : _d.grace) ? 0 : Math.max(1, Math.round(Number((_e = ev.note) === null || _e === void 0 ? void 0 : _e.duration) || 1)),
                                    levels: levelFromType(type),
                                };
                            }, { splitAtBeatBoundaryWhenImplicit: true });
                            for (const [eventIndex, assignment] of assignments.entries()) {
                                if (!assignment || assignment.levels <= 0)
                                    continue;
                                let beamXml = "";
                                for (let level = 1; level <= assignment.levels; level += 1) {
                                    beamXml += `<beam number="${level}">${assignment.state}</beam>`;
                                }
                                if (!beamXml)
                                    continue;
                                const target = primary[eventIndex];
                                if (!target)
                                    continue;
                                out.set(target.noteIndex, beamXml);
                            }
                        }
                        return out;
                    })();
                    return notes
                        .map((note, noteIndex) => {
                        const chunks = ["<note>"];
                        if (note.chord)
                            chunks.push("<chord/>");
                        if (note.grace) {
                            chunks.push(note.graceSlash ? '<grace slash="yes"/>' : "<grace/>");
                        }
                        if (note.isRest) {
                            chunks.push("<rest/>");
                        }
                        else {
                            const step = /^[A-G]$/.test(String(note.step || "").toUpperCase())
                                ? String(note.step).toUpperCase()
                                : "C";
                            const octave = Number.isFinite(note.octave)
                                ? Math.max(0, Math.min(9, Math.round(note.octave)))
                                : 4;
                            chunks.push("<pitch>");
                            chunks.push(`<step>${step}</step>`);
                            if (Number.isFinite(note.alter) && Number(note.alter) !== 0) {
                                chunks.push(`<alter>${Math.round(Number(note.alter))}</alter>`);
                            }
                            chunks.push(`<octave>${octave}</octave>`);
                            chunks.push("</pitch>");
                        }
                        if (!note.grace) {
                            const duration = Math.max(1, Math.round(Number(note.duration) || 1));
                            chunks.push(`<duration>${duration}</duration>`);
                        }
                        chunks.push(`<voice>${xmlEscape(normalizeVoiceForMusicXml(note.voice))}</voice>`);
                        chunks.push(`<type>${normalizeTypeForMusicXml(note.type)}</type>`);
                        if (!note.chord && beamXmlByNoteIndex.has(noteIndex)) {
                            chunks.push(String(beamXmlByNoteIndex.get(noteIndex)));
                        }
                        if (note.timeModification &&
                            Number.isFinite(note.timeModification.actual) &&
                            Number.isFinite(note.timeModification.normal) &&
                            Number(note.timeModification.actual) > 0 &&
                            Number(note.timeModification.normal) > 0) {
                            chunks.push(`<time-modification><actual-notes>${Math.round(Number(note.timeModification.actual))}</actual-notes><normal-notes>${Math.round(Number(note.timeModification.normal))}</normal-notes></time-modification>`);
                        }
                        if (note.accidentalText) {
                            chunks.push(`<accidental>${xmlEscape(String(note.accidentalText))}</accidental>`);
                        }
                        if (note.tieStart)
                            chunks.push('<tie type="start"/>');
                        if (note.tieStop)
                            chunks.push('<tie type="stop"/>');
                        if (note.tieStart ||
                            note.tieStop ||
                            note.slurStart ||
                            note.slurStop ||
                            note.trill ||
                            note.turnType ||
                            note.staccato ||
                            note.tupletStart ||
                            note.tupletStop) {
                            chunks.push("<notations>");
                            if (note.tieStart)
                                chunks.push('<tied type="start"/>');
                            if (note.tieStop)
                                chunks.push('<tied type="stop"/>');
                            if (note.slurStart)
                                chunks.push('<slur type="start"/>');
                            if (note.slurStop)
                                chunks.push('<slur type="stop"/>');
                            if (note.tupletStart)
                                chunks.push('<tuplet type="start"/>');
                            if (note.tupletStop)
                                chunks.push('<tuplet type="stop"/>');
                            if (note.trill) {
                                const trillParts = [];
                                trillParts.push("<trill-mark/>");
                                if (note.trillAccidentalText) {
                                    trillParts.push(`<accidental-mark>${xmlEscape(String(note.trillAccidentalText))}</accidental-mark>`);
                                }
                                chunks.push(`<ornaments>${trillParts.join("")}</ornaments>`);
                            }
                            if (note.turnType) {
                                const tag = note.turnType === "inverted-turn" ? "inverted-turn" : "turn";
                                chunks.push(`<ornaments><${tag}/></ornaments>`);
                            }
                            if (note.staccato)
                                chunks.push("<articulations><staccato/></articulations>");
                            chunks.push("</notations>");
                        }
                        chunks.push("</note>");
                        return chunks.join("");
                    })
                        .join("");
                })()
                : `<note><rest/><duration>${measureDurationDiv}</duration><voice>1</voice><type>${emptyMeasureRestType}</type></note>`;
            const xmlMeasureNumber = xmlEscape(String((measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.number) || measureNo));
            const implicitAttr = (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.implicit) ? ' implicit="yes"' : "";
            const repeatStartXml = (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.repeat) === "forward"
                ? '<barline location="left"><repeat direction="forward" winged="none"/></barline>'
                : "";
            const repeatEndXml = (measureMeta === null || measureMeta === void 0 ? void 0 : measureMeta.repeat) === "backward"
                ? `<barline location="right"><repeat direction="backward" winged="none"${Number.isFinite(measureMeta.repeatTimes) && Number(measureMeta.repeatTimes) > 1
                    ? ` times="${Math.round(Number(measureMeta.repeatTimes))}"`
                    : ""}/></barline>`
                : "";
            const debugMiscXml = debugMetadata ? buildAbcMeasureDebugMiscXml(notes, measureNo) : "";
            const diagMiscXml = partIndex === 0 && measureNo === 1
                ? buildAbcDiagMiscXml(((_f = parsed.diagnostics) !== null && _f !== void 0 ? _f : []).filter((diag) => !diag.voiceId || diag.voiceId === (part.voiceId || "")))
                : "";
            const sourceMiscXml = sourceMetadata && partIndex === 0 && measureNo === 1
                ? buildAbcSourceMiscXml(abcSource)
                : "";
            measuresXml.push(`<measure number="${xmlMeasureNumber}"${implicitAttr}>${repeatStartXml}${header}${debugMiscXml}${diagMiscXml}${sourceMiscXml}${notesXml}${repeatEndXml}</measure>`);
        }
        return `<part id="${xmlEscape(part.partId)}">${measuresXml.join("")}</part>`;
    })
        .join("");
    const xml = [
        '<?xml version="1.0" encoding="UTF-8"?>',
        '<score-partwise version="4.0">',
        `<work><work-title>${xmlEscape(title)}</work-title></work>`,
        `<identification><creator type="composer">${xmlEscape(composer)}</creator></identification>`,
        `<part-list>${partListXml}</part-list>`,
        partBodyXml,
        "</score-partwise>",
    ].join("");
    return debugPrettyPrint ? prettyPrintXml(xml) : xml;
};
const convertAbcToMusicXml = (abcSource, options = {}) => {
    const parsed = exports.AbcCompatParser.parseForMusicXml(abcSource, {
        defaultTitle: "mikuscore",
        defaultComposer: "Unknown",
        inferTransposeFromPartName: true,
        overfullCompatibilityMode: options.overfullCompatibilityMode !== false,
    });
    return buildMusicXmlFromAbcParsed(parsed, abcSource, options);
};
exports.convertAbcToMusicXml = convertAbcToMusicXml;

  },
  "core/timeIndex.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOccupiedTime = exports.getMeasureCapacity = exports.getMeasureTimingForVoice = void 0;
const xmlUtils_1 = require("./xmlUtils");
const getMeasureTimingForVoice = (noteInMeasure, voice) => {
    const measure = (0, xmlUtils_1.findAncestorMeasure)(noteInMeasure);
    if (!measure)
        return null;
    const capacity = (0, exports.getMeasureCapacity)(measure);
    if (capacity === null)
        return null;
    const occupied = (0, exports.getOccupiedTime)(measure, voice);
    return { capacity, occupied };
};
exports.getMeasureTimingForVoice = getMeasureTimingForVoice;
const getMeasureCapacity = (measure) => {
    const context = resolveTimingContext(measure);
    if (!context)
        return null;
    const { beats, beatType, divisions } = context;
    if (!Number.isFinite(beats) ||
        !Number.isFinite(beatType) ||
        !Number.isFinite(divisions) ||
        beatType <= 0) {
        return null;
    }
    const beatUnit = (4 / beatType) * divisions;
    return Math.round(beats * beatUnit);
};
exports.getMeasureCapacity = getMeasureCapacity;
const getOccupiedTime = (measure, voice) => {
    const directChildren = Array.from(measure.children);
    let cursor = 0;
    let occupied = 0;
    for (const child of directChildren) {
        if (child.tagName === "backup" || child.tagName === "forward") {
            const shift = (0, xmlUtils_1.getDurationValue)(child);
            if (shift === null)
                continue;
            cursor = child.tagName === "backup" ? Math.max(0, cursor - shift) : cursor + shift;
            continue;
        }
        if (child.tagName !== "note")
            continue;
        // Chord notes share onset with the previous note and must not advance time.
        if (Array.from(child.children).some((c) => c.tagName === "chord"))
            continue;
        const noteVoice = (0, xmlUtils_1.getVoiceText)(child);
        if (noteVoice !== voice)
            continue;
        const duration = (0, xmlUtils_1.getDurationValue)(child);
        if (duration === null)
            continue;
        const end = cursor + duration;
        occupied = Math.max(occupied, end);
        cursor = end;
    }
    return occupied;
};
exports.getOccupiedTime = getOccupiedTime;
const resolveTimingContext = (measure) => {
    var _a, _b, _c, _d, _e, _f;
    const part = measure.parentElement;
    if (!part || part.tagName !== "part")
        return null;
    let beats = null;
    let beatType = null;
    let divisions = null;
    const measures = Array.from(part.children).filter((child) => child.tagName === "measure");
    const measureIndex = measures.indexOf(measure);
    if (measureIndex < 0)
        return null;
    for (let i = measureIndex; i >= 0; i -= 1) {
        const candidate = measures[i];
        const attributes = candidate.querySelector("attributes");
        if (!attributes)
            continue;
        if (divisions === null) {
            const divisionsText = (_b = (_a = attributes.querySelector("divisions")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim();
            if (divisionsText)
                divisions = Number(divisionsText);
        }
        if (beats === null) {
            const beatsText = (_d = (_c = attributes.querySelector("time > beats")) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim();
            if (beatsText)
                beats = Number(beatsText);
        }
        if (beatType === null) {
            const beatTypeText = (_f = (_e = attributes
                .querySelector("time > beat-type")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim();
            if (beatTypeText)
                beatType = Number(beatTypeText);
        }
        if (beats !== null && beatType !== null && divisions !== null) {
            return { beats, beatType, divisions };
        }
    }
    return null;
};

  },
  "core/xmlUtils.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.measureHasBackupOrForward = exports.findAncestorMeasure = exports.replaceWithRestNote = exports.createRestElement = exports.createNoteElement = exports.isUnsupportedNoteKind = exports.setPitch = exports.getDurationNotationHint = exports.setDurationValue = exports.getDurationValue = exports.ensureVoiceValue = exports.getVoiceText = exports.reindexNodeIds = exports.serializeXml = exports.parseXml = void 0;
const SCORE_PARTWISE = "score-partwise";
const parseXml = (xmlText) => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(xmlText, "application/xml");
    const parserError = doc.querySelector("parsererror");
    if (parserError) {
        throw new Error("Invalid XML input.");
    }
    const root = doc.documentElement;
    if (!root || root.tagName !== SCORE_PARTWISE) {
        throw new Error("MusicXML root must be <score-partwise>.");
    }
    return doc;
};
exports.parseXml = parseXml;
const serializeXml = (doc) => new XMLSerializer().serializeToString(doc);
exports.serializeXml = serializeXml;
/**
 * Assigns stable-in-session node IDs without mutating XML.
 */
const reindexNodeIds = (doc, nodeToId, idToNode, nextId) => {
    idToNode.clear();
    const notes = doc.querySelectorAll("note");
    for (const note of notes) {
        const existing = nodeToId.get(note);
        const id = existing !== null && existing !== void 0 ? existing : nextId();
        nodeToId.set(note, id);
        idToNode.set(id, note);
    }
};
exports.reindexNodeIds = reindexNodeIds;
const getVoiceText = (note) => {
    var _a, _b;
    const voice = getDirectChild(note, "voice");
    return (_b = (_a = voice === null || voice === void 0 ? void 0 : voice.textContent) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : null;
};
exports.getVoiceText = getVoiceText;
const ensureVoiceValue = (note, fallbackVoice) => {
    var _a, _b;
    const normalizedFallback = String(fallbackVoice).trim() || "1";
    let voice = getDirectChild(note, "voice");
    if (!voice) {
        voice = note.ownerDocument.createElement("voice");
        voice.textContent = normalizedFallback;
        note.appendChild(voice);
        return normalizedFallback;
    }
    const current = (_b = (_a = voice.textContent) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
    if (current)
        return current;
    voice.textContent = normalizedFallback;
    return normalizedFallback;
};
exports.ensureVoiceValue = ensureVoiceValue;
const getDurationValue = (note) => {
    const duration = getDirectChild(note, "duration");
    if (!(duration === null || duration === void 0 ? void 0 : duration.textContent))
        return null;
    const n = Number(duration.textContent.trim());
    return Number.isFinite(n) ? n : null;
};
exports.getDurationValue = getDurationValue;
const setDurationValue = (note, duration) => {
    let durationNode = getDirectChild(note, "duration");
    if (!durationNode) {
        durationNode = note.ownerDocument.createElement("duration");
        note.appendChild(durationNode);
    }
    durationNode.textContent = String(duration);
    syncSimpleTypeFromDuration(note, duration);
};
exports.setDurationValue = setDurationValue;
const getDurationNotationHint = (note, duration) => {
    if (!Number.isInteger(duration) || duration <= 0)
        return null;
    const divisions = resolveEffectiveDivisions(note);
    if (divisions === null || !Number.isInteger(divisions) || divisions <= 0)
        return null;
    return durationToNotation(duration, divisions);
};
exports.getDurationNotationHint = getDurationNotationHint;
const setPitch = (note, pitch) => {
    const restNode = getDirectChild(note, "rest");
    if (restNode)
        restNode.remove();
    let pitchNode = getDirectChild(note, "pitch");
    if (!pitchNode) {
        pitchNode = note.ownerDocument.createElement("pitch");
        // Keep patch local by adding pitch near start, but do not reorder siblings.
        note.insertBefore(pitchNode, note.firstChild);
    }
    upsertSimpleChild(pitchNode, "step", pitch.step);
    if (typeof pitch.alter === "number") {
        upsertSimpleChild(pitchNode, "alter", String(pitch.alter));
        upsertSimpleChild(note, "accidental", accidentalFromAlter(pitch.alter));
    }
    else {
        const alter = getDirectChild(pitchNode, "alter");
        if (alter)
            alter.remove();
        const accidental = getDirectChild(note, "accidental");
        if (accidental)
            accidental.remove();
    }
    upsertSimpleChild(pitchNode, "octave", String(pitch.octave));
};
exports.setPitch = setPitch;
const isUnsupportedNoteKind = (note) => hasDirectChild(note, "grace") ||
    hasDirectChild(note, "cue") ||
    hasDirectChild(note, "chord") ||
    hasDirectChild(note, "rest");
exports.isUnsupportedNoteKind = isUnsupportedNoteKind;
const createNoteElement = (doc, voice, duration, pitch) => {
    const note = doc.createElement("note");
    const pitchNode = doc.createElement("pitch");
    upsertSimpleChild(pitchNode, "step", pitch.step);
    if (typeof pitch.alter === "number") {
        upsertSimpleChild(pitchNode, "alter", String(pitch.alter));
    }
    upsertSimpleChild(pitchNode, "octave", String(pitch.octave));
    note.appendChild(pitchNode);
    if (typeof pitch.alter === "number") {
        upsertSimpleChild(note, "accidental", accidentalFromAlter(pitch.alter));
    }
    const durationNode = doc.createElement("duration");
    durationNode.textContent = String(duration);
    note.appendChild(durationNode);
    const voiceNode = doc.createElement("voice");
    voiceNode.textContent = voice;
    note.appendChild(voiceNode);
    return note;
};
exports.createNoteElement = createNoteElement;
const createRestElement = (doc, voice, duration) => {
    const note = doc.createElement("note");
    const restNode = doc.createElement("rest");
    note.appendChild(restNode);
    const durationNode = doc.createElement("duration");
    durationNode.textContent = String(duration);
    note.appendChild(durationNode);
    const voiceNode = doc.createElement("voice");
    voiceNode.textContent = voice;
    note.appendChild(voiceNode);
    return note;
};
exports.createRestElement = createRestElement;
const replaceWithRestNote = (note, fallbackVoice = "1", forcedDuration) => {
    var _a;
    const doc = note.ownerDocument;
    const pitchNode = getDirectChild(note, "pitch");
    if (pitchNode)
        pitchNode.remove();
    const accidentalNode = getDirectChild(note, "accidental");
    if (accidentalNode)
        accidentalNode.remove();
    const chordNode = getDirectChild(note, "chord");
    if (chordNode)
        chordNode.remove();
    // Remove tie markers that no longer make sense after replacing with rest.
    Array.from(note.children)
        .filter((child) => child.tagName === "tie")
        .forEach((child) => child.remove());
    const notations = getDirectChild(note, "notations");
    if (notations) {
        Array.from(notations.children)
            .filter((child) => child.tagName === "tied")
            .forEach((child) => child.remove());
        if (notations.children.length === 0) {
            notations.remove();
        }
    }
    let restNode = getDirectChild(note, "rest");
    if (!restNode) {
        restNode = doc.createElement("rest");
        const durationNode = getDirectChild(note, "duration");
        if (durationNode) {
            note.insertBefore(restNode, durationNode);
        }
        else {
            note.insertBefore(restNode, note.firstChild);
        }
    }
    let durationNode = getDirectChild(note, "duration");
    if (!durationNode) {
        durationNode = doc.createElement("duration");
        note.appendChild(durationNode);
    }
    const duration = Number.isInteger(forcedDuration) && (forcedDuration !== null && forcedDuration !== void 0 ? forcedDuration : 0) > 0
        ? forcedDuration
        : ((_a = (0, exports.getDurationValue)(note)) !== null && _a !== void 0 ? _a : 1);
    durationNode.textContent = String(duration);
    let voiceNode = getDirectChild(note, "voice");
    if (!voiceNode) {
        voiceNode = doc.createElement("voice");
        voiceNode.textContent = fallbackVoice;
        note.appendChild(voiceNode);
    }
};
exports.replaceWithRestNote = replaceWithRestNote;
const findAncestorMeasure = (node) => {
    let cursor = node;
    while (cursor) {
        if (cursor.tagName === "measure")
            return cursor;
        cursor = cursor.parentElement;
    }
    return null;
};
exports.findAncestorMeasure = findAncestorMeasure;
const measureHasBackupOrForward = (measure) => Array.from(measure.children).some((child) => child.tagName === "backup" || child.tagName === "forward");
exports.measureHasBackupOrForward = measureHasBackupOrForward;
const upsertSimpleChild = (parent, tagName, value) => {
    let node = getDirectChild(parent, tagName);
    if (!node) {
        node = parent.ownerDocument.createElement(tagName);
        parent.appendChild(node);
    }
    node.textContent = value;
};
const hasDirectChild = (parent, tagName) => Array.from(parent.children).some((child) => child.tagName === tagName);
const getDirectChild = (parent, tagName) => { var _a; return (_a = Array.from(parent.children).find((child) => child.tagName === tagName)) !== null && _a !== void 0 ? _a : null; };
const accidentalFromAlter = (alter) => {
    if (alter <= -2)
        return "flat-flat";
    if (alter === -1)
        return "flat";
    if (alter === 0)
        return "natural";
    if (alter === 1)
        return "sharp";
    return "double-sharp";
};
const syncSimpleTypeFromDuration = (note, duration) => {
    if (!Number.isInteger(duration) || duration <= 0)
        return;
    const divisions = resolveEffectiveDivisions(note);
    if (divisions === null || !Number.isInteger(divisions) || divisions <= 0)
        return;
    const notation = durationToNotation(duration, divisions);
    if (!notation)
        return;
    upsertSimpleChild(note, "type", notation.type);
    Array.from(note.children)
        .filter((child) => child.tagName === "dot" || child.tagName === "time-modification")
        .forEach((child) => child.remove());
    for (let i = 0; i < notation.dotCount; i += 1) {
        const dot = note.ownerDocument.createElement("dot");
        note.appendChild(dot);
    }
    if (notation.triplet) {
        const tm = note.ownerDocument.createElement("time-modification");
        const actual = note.ownerDocument.createElement("actual-notes");
        actual.textContent = "3";
        const normal = note.ownerDocument.createElement("normal-notes");
        normal.textContent = "2";
        tm.appendChild(actual);
        tm.appendChild(normal);
        note.appendChild(tm);
    }
};
const resolveEffectiveDivisions = (note) => {
    var _a, _b, _c;
    const measure = (0, exports.findAncestorMeasure)(note);
    if (!measure)
        return null;
    const part = measure.parentElement;
    if (!part || part.tagName !== "part")
        return null;
    const measures = Array.from(part.children).filter((child) => child.tagName === "measure");
    const measureIndex = measures.indexOf(measure);
    if (measureIndex < 0)
        return null;
    let divisions = null;
    for (let i = measureIndex; i >= 0; i -= 1) {
        const candidate = measures[i];
        const text = (_c = (_b = (_a = candidate.querySelector("attributes > divisions")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
        const n = Number(text);
        if (Number.isInteger(n) && n > 0) {
            divisions = n;
            break;
        }
    }
    return divisions;
};
const durationToNotation = (duration, divisions) => {
    const defs = [
        { num: 4, den: 1, type: "whole", dotCount: 0, triplet: false },
        { num: 3, den: 1, type: "half", dotCount: 1, triplet: false },
        { num: 2, den: 1, type: "half", dotCount: 0, triplet: false },
        { num: 4, den: 3, type: "half", dotCount: 0, triplet: true },
        { num: 3, den: 2, type: "quarter", dotCount: 1, triplet: false },
        { num: 1, den: 1, type: "quarter", dotCount: 0, triplet: false },
        { num: 2, den: 3, type: "quarter", dotCount: 0, triplet: true },
        { num: 3, den: 4, type: "eighth", dotCount: 1, triplet: false },
        { num: 1, den: 2, type: "eighth", dotCount: 0, triplet: false },
        { num: 1, den: 3, type: "eighth", dotCount: 0, triplet: true },
        { num: 3, den: 8, type: "16th", dotCount: 1, triplet: false },
        { num: 1, den: 4, type: "16th", dotCount: 0, triplet: false },
        { num: 1, den: 6, type: "16th", dotCount: 0, triplet: true },
        { num: 1, den: 8, type: "32nd", dotCount: 0, triplet: false },
        { num: 1, den: 16, type: "64th", dotCount: 0, triplet: false },
    ];
    for (const def of defs) {
        const value = (divisions * def.num) / def.den;
        if (!Number.isInteger(value) || value <= 0)
            continue;
        if (duration === value) {
            return { type: def.type, dotCount: def.dotCount, triplet: def.triplet };
        }
    }
    return null;
};

  },
  "core/ScoreCore.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ScoreCore = void 0;
const commands_1 = require("./commands");
const timeIndex_1 = require("./timeIndex");
const xmlUtils_1 = require("./xmlUtils");
const validators_1 = require("./validators");
const staffClefPolicy_1 = require("./staffClefPolicy");
class ScoreCore {
    constructor(options = {}) {
        var _a;
        this.originalXml = "";
        this.doc = null;
        this.dirty = false;
        // Node identity is kept outside XML with WeakMap as required by spec.
        this.nodeToId = new WeakMap();
        this.idToNode = new Map();
        this.nodeCounter = 0;
        const rawEditableVoice = String((_a = options.editableVoice) !== null && _a !== void 0 ? _a : "").trim();
        this.editableVoice = rawEditableVoice || null;
    }
    load(xml) {
        this.originalXml = xml;
        this.doc = (0, xmlUtils_1.parseXml)(xml);
        this.dirty = false;
        this.reindex();
    }
    dispatch(command) {
        var _a;
        if (!this.doc) {
            return this.fail("MVP_SCORE_NOT_LOADED", "Score is not loaded.");
        }
        if ((0, commands_1.isUiOnlyCommand)(command)) {
            return {
                ok: true,
                dirtyChanged: false,
                changedNodeIds: [],
                affectedMeasureNumbers: [],
                diagnostics: [],
                warnings: [],
            };
        }
        const voiceDiagnostic = (0, validators_1.validateVoice)(command, this.editableVoice);
        if (voiceDiagnostic)
            return this.failWith(voiceDiagnostic);
        const payloadDiagnostic = (0, validators_1.validateCommandPayload)(command);
        if (payloadDiagnostic)
            return this.failWith(payloadDiagnostic);
        const targetId = (0, commands_1.getCommandNodeId)(command);
        if (!targetId) {
            return this.fail("MVP_COMMAND_TARGET_MISSING", "Command target is missing.");
        }
        const target = this.idToNode.get(targetId);
        if (!target)
            return this.fail("MVP_TARGET_NOT_FOUND", `Unknown nodeId: ${targetId}`);
        const noteKindDiagnostic = (0, validators_1.validateSupportedNoteKind)(command, target);
        if (noteKindDiagnostic)
            return this.failWith(noteKindDiagnostic);
        const targetVoiceDiagnostic = (0, validators_1.validateTargetVoiceMatch)(command, target);
        if (targetVoiceDiagnostic)
            return this.failWith(targetVoiceDiagnostic);
        const bfDiagnostic = (0, validators_1.validateBackupForwardBoundaryForStructuralEdit)(command, target);
        if (bfDiagnostic)
            return this.failWith(bfDiagnostic);
        const laneDiagnostic = (0, validators_1.validateInsertLaneBoundary)(command, target);
        if (laneDiagnostic)
            return this.failWith(laneDiagnostic);
        const snapshot = (0, xmlUtils_1.serializeXml)(this.doc);
        const warnings = [];
        let insertedNode = null;
        let removedNodeId = null;
        const affectedMeasureNumbers = this.collectAffectedMeasureNumbers(target);
        try {
            if (command.type === "change_to_pitch" ||
                command.type === "change_duration" ||
                command.type === "delete_note" ||
                command.type === "split_note") {
                (0, xmlUtils_1.ensureVoiceValue)(target, command.voice);
            }
            if (command.type === "change_to_pitch") {
                (0, xmlUtils_1.setPitch)(target, command.pitch);
                autoAssignGrandStaffByPitch(target);
            }
            else if (command.type === "change_duration") {
                const durationNotation = (0, xmlUtils_1.getDurationNotationHint)(target, command.duration);
                if ((durationNotation === null || durationNotation === void 0 ? void 0 : durationNotation.triplet) &&
                    !measureVoiceHasTupletContext(target, command.voice)) {
                    return this.fail("MVP_INVALID_COMMAND_PAYLOAD", "Tuplet durations are not allowed because this measure/voice has no tuplet context.");
                }
                const oldDuration = (_a = (0, xmlUtils_1.getDurationValue)(target)) !== null && _a !== void 0 ? _a : 0;
                const timing = (0, timeIndex_1.getMeasureTimingForVoice)(target, command.voice);
                let underfullDelta = 0;
                let projectedWarning = null;
                if (timing) {
                    const projected = timing.occupied - oldDuration + command.duration;
                    const overflow = projected - timing.capacity;
                    if (overflow > 0) {
                        const consumedAfter = consumeFollowingRestsForDurationExpansion(target, command.voice, overflow);
                        const remainingAfter = overflow - consumedAfter;
                        const consumedBefore = remainingAfter > 0
                            ? consumePrecedingRestsForDurationExpansion(target, command.voice, remainingAfter)
                            : 0;
                        const consumed = consumedAfter + consumedBefore;
                        if (consumed < overflow) {
                            const result = (0, validators_1.validateProjectedMeasureTiming)(target, command.voice, projected);
                            if (result.diagnostic) {
                                this.restoreFrom(snapshot);
                                return this.failWith(result.diagnostic);
                            }
                        }
                    }
                    const timingAfterRestAdjust = (0, timeIndex_1.getMeasureTimingForVoice)(target, command.voice);
                    const adjustedProjected = timingAfterRestAdjust
                        ? timingAfterRestAdjust.occupied - oldDuration + command.duration
                        : projected;
                    const result = (0, validators_1.validateProjectedMeasureTiming)(target, command.voice, adjustedProjected);
                    if (result.diagnostic) {
                        this.restoreFrom(snapshot);
                        return this.failWith(result.diagnostic);
                    }
                    projectedWarning = result.warning;
                    if (adjustedProjected < timing.capacity) {
                        underfullDelta = timing.capacity - adjustedProjected;
                    }
                }
                (0, xmlUtils_1.setDurationValue)(target, command.duration);
                if (underfullDelta > 0) {
                    const filled = fillUnderfullGapAfterTarget(target, command.voice, underfullDelta);
                    if (!filled && projectedWarning) {
                        warnings.push(projectedWarning);
                    }
                }
                else if (projectedWarning) {
                    warnings.push(projectedWarning);
                }
            }
            else if (command.type === "split_note") {
                const timingBeforeSplit = (0, timeIndex_1.getMeasureTimingForVoice)(target, command.voice);
                const currentDuration = (0, xmlUtils_1.getDurationValue)(target);
                if (!Number.isInteger(currentDuration) || (currentDuration !== null && currentDuration !== void 0 ? currentDuration : 0) <= 1) {
                    return this.fail("MVP_INVALID_COMMAND_PAYLOAD", "split_note requires duration >= 2.");
                }
                if (currentDuration % 2 !== 0) {
                    return this.fail("MVP_INVALID_COMMAND_PAYLOAD", "split_note requires an even duration value.");
                }
                const half = currentDuration / 2;
                const duplicated = target.cloneNode(true);
                // Attach clone first so duration->notation sync can resolve measure divisions.
                target.after(duplicated);
                (0, xmlUtils_1.setDurationValue)(target, half);
                (0, xmlUtils_1.setDurationValue)(duplicated, half);
                insertedNode = duplicated;
                if (timingBeforeSplit) {
                    const timingAfterSplit = (0, timeIndex_1.getMeasureTimingForVoice)(target, command.voice);
                    if (!timingAfterSplit) {
                        this.restoreFrom(snapshot);
                        return this.fail("MVP_COMMAND_EXECUTION_FAILED", "Failed to validate split timing.");
                    }
                    if (timingAfterSplit.occupied !== timingBeforeSplit.occupied) {
                        this.restoreFrom(snapshot);
                        return this.fail("MVP_COMMAND_EXECUTION_FAILED", "Split changed lane timing unexpectedly near backup/forward boundary.");
                    }
                    const timingValidation = (0, validators_1.validateProjectedMeasureTiming)(target, command.voice, timingAfterSplit.occupied);
                    if (timingValidation.diagnostic) {
                        this.restoreFrom(snapshot);
                        return this.failWith(timingValidation.diagnostic);
                    }
                }
            }
            else if (command.type === "insert_note_after") {
                const timing = (0, timeIndex_1.getMeasureTimingForVoice)(target, command.voice);
                if (timing) {
                    const projected = timing.occupied + command.note.duration;
                    const result = (0, validators_1.validateProjectedMeasureTiming)(target, command.voice, projected);
                    if (result.diagnostic)
                        return this.failWith(result.diagnostic);
                    if (result.warning)
                        warnings.push(result.warning);
                }
                const note = (0, xmlUtils_1.createNoteElement)(this.doc, command.voice, command.note.duration, command.note.pitch);
                target.after(note);
                insertedNode = note;
            }
            else if (command.type === "delete_note") {
                const nextChordTone = findImmediateNextChordTone(target);
                if (nextChordTone) {
                    // Deleting a chord head must not inject a timed rest.
                    // Promote the next chord tone to chord head and remove only target pitch.
                    const chordMarker = nextChordTone.querySelector(":scope > chord");
                    if (chordMarker)
                        chordMarker.remove();
                    target.remove();
                    removedNodeId = targetId;
                }
                else {
                    const duration = (0, xmlUtils_1.getDurationValue)(target);
                    if (duration === null || duration <= 0) {
                        return this.fail("MVP_INVALID_NOTE_DURATION", "Target note has invalid duration.");
                    }
                    (0, xmlUtils_1.replaceWithRestNote)(target, command.voice, duration);
                }
            }
        }
        catch (_b) {
            this.restoreFrom(snapshot);
            return this.fail("MVP_COMMAND_EXECUTION_FAILED", "Command failed unexpectedly.");
        }
        this.reindex();
        const dirtyBefore = this.dirty;
        this.dirty = true;
        const changedNodeIds = this.buildChangedNodeIds(command, targetId, insertedNode, removedNodeId);
        return {
            ok: true,
            dirtyChanged: !dirtyBefore,
            changedNodeIds,
            affectedMeasureNumbers,
            diagnostics: [],
            warnings,
        };
    }
    save() {
        if (!this.doc) {
            return {
                ok: false,
                mode: "original_noop",
                xml: "",
                diagnostics: [{ code: "MVP_SCORE_NOT_LOADED", message: "Score is not loaded." }],
            };
        }
        if (!this.dirty) {
            const integrityNoVoice = this.findInvalidNoteDiagnostic({ ignoreMissingVoice: true });
            if (integrityNoVoice) {
                return { ok: false, mode: "serialized_dirty", xml: "", diagnostics: [integrityNoVoice] };
            }
            const overfullNoop = this.findOverfullDiagnostic();
            if (overfullNoop) {
                return { ok: false, mode: "serialized_dirty", xml: "", diagnostics: [overfullNoop] };
            }
            return {
                ok: true,
                mode: "original_noop",
                xml: this.originalXml,
                diagnostics: [],
            };
        }
        const integrity = this.findInvalidNoteDiagnostic({ ignoreMissingVoice: false });
        if (integrity) {
            return { ok: false, mode: "serialized_dirty", xml: "", diagnostics: [integrity] };
        }
        const overfull = this.findOverfullDiagnostic();
        if (overfull) {
            return { ok: false, mode: "serialized_dirty", xml: "", diagnostics: [overfull] };
        }
        return {
            ok: true,
            mode: "serialized_dirty",
            xml: (0, xmlUtils_1.serializeXml)(this.doc),
            diagnostics: [],
        };
    }
    isDirty() {
        return this.dirty;
    }
    listNoteNodeIds() {
        return Array.from(this.idToNode.keys());
    }
    /**
     * Debug-only helper for UI diagnostics.
     * Returns current in-memory XML regardless of dirty/validation state.
     */
    debugSerializeCurrentXml() {
        if (!this.doc)
            return null;
        return (0, xmlUtils_1.serializeXml)(this.doc);
    }
    nextNodeId() {
        this.nodeCounter += 1;
        return `n${this.nodeCounter}`;
    }
    reindex() {
        if (!this.doc)
            return;
        (0, xmlUtils_1.reindexNodeIds)(this.doc, this.nodeToId, this.idToNode, () => this.nextNodeId());
    }
    restoreFrom(xmlSnapshot) {
        this.doc = (0, xmlUtils_1.parseXml)(xmlSnapshot);
        this.reindex();
    }
    findOverfullDiagnostic() {
        if (!this.doc)
            return null;
        const measures = this.doc.querySelectorAll("measure");
        for (const measure of measures) {
            const note = measure.querySelector("note");
            if (!note)
                continue;
            const voices = this.editableVoice
                ? [this.editableVoice]
                : Array.from(new Set(Array.from(measure.querySelectorAll("note"))
                    .map((measureNote) => (0, xmlUtils_1.getVoiceText)(measureNote))
                    .filter((voice) => Boolean(voice))));
            for (const voice of voices) {
                const timing = (0, timeIndex_1.getMeasureTimingForVoice)(note, voice);
                if (!timing)
                    continue;
                const tolerance = this.computeTupletRoundingTolerance(measure, voice);
                if (timing.occupied > timing.capacity + tolerance) {
                    return {
                        code: "MEASURE_OVERFULL",
                        message: `Occupied time ${timing.occupied} exceeds capacity ${timing.capacity}.`,
                    };
                }
            }
        }
        return null;
    }
    findInvalidNoteDiagnostic(options) {
        if (!this.doc)
            return null;
        const ignoreMissingVoice = Boolean(options === null || options === void 0 ? void 0 : options.ignoreMissingVoice);
        const notes = this.doc.querySelectorAll("note");
        for (const note of notes) {
            const voice = (0, xmlUtils_1.getVoiceText)(note);
            if (!voice && !ignoreMissingVoice) {
                return {
                    code: "MVP_INVALID_NOTE_VOICE",
                    message: "Note is missing a valid <voice> value.",
                };
            }
            const duration = (0, xmlUtils_1.getDurationValue)(note);
            const hasGrace = Array.from(note.children).some((c) => c.tagName === "grace");
            if (!hasGrace && (duration === null || duration <= 0)) {
                const context = this.describeNoteContext(note);
                const noteXml = this.compactNodeXml(note);
                if (typeof console !== "undefined") {
                    console.error("[mikuscore][save][invalid-duration]", context, noteXml);
                }
                return {
                    code: "MVP_INVALID_NOTE_DURATION",
                    message: `Note is missing a valid positive <duration> value. ${context}`,
                };
            }
            const pitchDiagnostic = this.validateNotePitch(note);
            if (pitchDiagnostic)
                return pitchDiagnostic;
        }
        return null;
    }
    computeTupletRoundingTolerance(measure, voice) {
        // Tuplet durations are integer-rounded in many MusicXML files.
        // Allow a small overrun proportional to the number of non-chord tuplet onsets.
        let tupletOnsetCount = 0;
        for (const note of Array.from(measure.querySelectorAll(":scope > note"))) {
            const noteVoice = (0, xmlUtils_1.getVoiceText)(note);
            if (noteVoice !== voice)
                continue;
            if (note.querySelector(":scope > chord"))
                continue;
            if (note.querySelector(":scope > time-modification") === null)
                continue;
            const duration = (0, xmlUtils_1.getDurationValue)(note);
            if (duration === null || duration <= 0)
                continue;
            tupletOnsetCount += 1;
        }
        if (tupletOnsetCount <= 0)
            return 0;
        return Math.floor(tupletOnsetCount / 2);
    }
    fail(code, message) {
        return this.failWith({ code, message });
    }
    describeNoteContext(note) {
        var _a, _b, _c;
        const measure = (0, xmlUtils_1.findAncestorMeasure)(note);
        const part = note.closest("part");
        const partId = ((_a = part === null || part === void 0 ? void 0 : part.getAttribute("id")) === null || _a === void 0 ? void 0 : _a.trim()) || "(unknown-part)";
        const measureNo = ((_b = measure === null || measure === void 0 ? void 0 : measure.getAttribute("number")) === null || _b === void 0 ? void 0 : _b.trim()) || "(unknown-measure)";
        const voice = (0, xmlUtils_1.getVoiceText)(note) || "(missing-voice)";
        const nodeId = (_c = this.nodeToId.get(note)) !== null && _c !== void 0 ? _c : "(no-node-id)";
        const hasGrace = Array.from(note.children).some((c) => c.tagName === "grace");
        const hasCue = Array.from(note.children).some((c) => c.tagName === "cue");
        const hasChord = Array.from(note.children).some((c) => c.tagName === "chord");
        const hasRest = Array.from(note.children).some((c) => c.tagName === "rest");
        return `part=${partId} measure=${measureNo} voice=${voice} nodeId=${nodeId} grace=${hasGrace} cue=${hasCue} rest=${hasRest} chord=${hasChord}`;
    }
    compactNodeXml(node) {
        const raw = node.outerHTML || "";
        const compact = raw.replace(/\s+/g, " ").trim();
        if (compact.length <= 280)
            return compact;
        return `${compact.slice(0, 280)}...`;
    }
    failWith(diagnostic) {
        return {
            ok: false,
            dirtyChanged: false,
            changedNodeIds: [],
            affectedMeasureNumbers: [],
            diagnostics: [diagnostic],
            warnings: [],
        };
    }
    collectAffectedMeasureNumbers(note) {
        var _a;
        const measure = (0, xmlUtils_1.findAncestorMeasure)(note);
        if (!measure)
            return [];
        const number = (_a = measure.getAttribute("number")) !== null && _a !== void 0 ? _a : "";
        return number ? [number] : [];
    }
    validateNotePitch(note) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        const hasRest = Array.from(note.children).some((c) => c.tagName === "rest");
        const hasChord = Array.from(note.children).some((c) => c.tagName === "chord");
        const pitch = (_a = Array.from(note.children).find((c) => c.tagName === "pitch")) !== null && _a !== void 0 ? _a : null;
        if (hasRest && hasChord) {
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Note must not contain both <rest> and <chord>.",
            };
        }
        if (hasRest && pitch) {
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Rest note must not contain <pitch>.",
            };
        }
        if (hasChord && !pitch) {
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Chord note must contain a valid <pitch>.",
            };
        }
        if (!pitch) {
            if (hasRest)
                return null;
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Non-rest note is missing a valid <pitch>.",
            };
        }
        const step = (_d = (_c = (_b = pitch.querySelector("step")) === null || _b === void 0 ? void 0 : _b.textContent) === null || _c === void 0 ? void 0 : _c.trim()) !== null && _d !== void 0 ? _d : "";
        if (!["A", "B", "C", "D", "E", "F", "G"].includes(step)) {
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Pitch step is invalid.",
            };
        }
        const octaveText = (_g = (_f = (_e = pitch.querySelector("octave")) === null || _e === void 0 ? void 0 : _e.textContent) === null || _f === void 0 ? void 0 : _f.trim()) !== null && _g !== void 0 ? _g : "";
        const octave = Number(octaveText);
        if (!Number.isInteger(octave)) {
            return {
                code: "MVP_INVALID_NOTE_PITCH",
                message: "Pitch octave is invalid.",
            };
        }
        const alterText = (_j = (_h = pitch.querySelector("alter")) === null || _h === void 0 ? void 0 : _h.textContent) === null || _j === void 0 ? void 0 : _j.trim();
        if (alterText !== undefined) {
            const alter = Number(alterText);
            if (!Number.isInteger(alter) || alter < -2 || alter > 2) {
                return {
                    code: "MVP_INVALID_NOTE_PITCH",
                    message: "Pitch alter is invalid.",
                };
            }
        }
        return null;
    }
    buildChangedNodeIds(command, targetId, insertedNode, removedNodeId) {
        var _a, _b;
        if (command.type === "insert_note_after") {
            const insertedId = insertedNode ? (_a = this.nodeToId.get(insertedNode)) !== null && _a !== void 0 ? _a : null : null;
            return insertedId ? [targetId, insertedId] : [targetId];
        }
        if (command.type === "delete_note") {
            return removedNodeId ? [removedNodeId] : [targetId];
        }
        if (command.type === "split_note") {
            const insertedId = insertedNode ? (_b = this.nodeToId.get(insertedNode)) !== null && _b !== void 0 ? _b : null : null;
            return insertedId ? [targetId, insertedId] : [targetId];
        }
        return [targetId];
    }
}
exports.ScoreCore = ScoreCore;
const hasDirectChild = (node, tagName) => Array.from(node.children).some((child) => child.tagName === tagName);
const findImmediateNextChordTone = (note) => {
    const next = note.nextElementSibling;
    if (!next || next.tagName !== "note")
        return null;
    if (!hasDirectChild(next, "chord"))
        return null;
    return next;
};
const consumeFollowingRestsForDurationExpansion = (target, voice, overflow) => {
    var _a;
    if (!Number.isInteger(overflow) || overflow <= 0)
        return 0;
    let remaining = overflow;
    let cursor = target.nextElementSibling;
    while (cursor && remaining > 0) {
        const next = cursor.nextElementSibling;
        if (cursor.tagName === "backup" || cursor.tagName === "forward")
            break;
        if (cursor.tagName !== "note") {
            cursor = next;
            continue;
        }
        const noteVoice = (0, xmlUtils_1.getVoiceText)(cursor);
        if (noteVoice !== voice) {
            cursor = next;
            continue;
        }
        const isRest = cursor.querySelector(":scope > rest") !== null;
        const isChord = cursor.querySelector(":scope > chord") !== null;
        const duration = (_a = (0, xmlUtils_1.getDurationValue)(cursor)) !== null && _a !== void 0 ? _a : 0;
        if (!isRest || isChord || duration <= 0) {
            cursor = next;
            continue;
        }
        if (duration <= remaining) {
            remaining -= duration;
            cursor.remove();
        }
        else {
            (0, xmlUtils_1.setDurationValue)(cursor, duration - remaining);
            remaining = 0;
        }
        cursor = next;
    }
    return overflow - remaining;
};
const consumePrecedingRestsForDurationExpansion = (target, voice, overflow) => {
    var _a;
    if (!Number.isInteger(overflow) || overflow <= 0)
        return 0;
    let remaining = overflow;
    let cursor = target.previousElementSibling;
    while (cursor && remaining > 0) {
        const prev = cursor.previousElementSibling;
        if (cursor.tagName === "backup" || cursor.tagName === "forward")
            break;
        if (cursor.tagName !== "note") {
            cursor = prev;
            continue;
        }
        const noteVoice = (0, xmlUtils_1.getVoiceText)(cursor);
        if (noteVoice !== voice) {
            cursor = prev;
            continue;
        }
        const isRest = cursor.querySelector(":scope > rest") !== null;
        const isChord = cursor.querySelector(":scope > chord") !== null;
        const duration = (_a = (0, xmlUtils_1.getDurationValue)(cursor)) !== null && _a !== void 0 ? _a : 0;
        if (!isRest || isChord || duration <= 0) {
            cursor = prev;
            continue;
        }
        if (duration <= remaining) {
            remaining -= duration;
            cursor.remove();
        }
        else {
            (0, xmlUtils_1.setDurationValue)(cursor, duration - remaining);
            remaining = 0;
        }
        cursor = prev;
    }
    return overflow - remaining;
};
const fillUnderfullGapAfterTarget = (target, voice, deficit) => {
    var _a;
    if (!Number.isInteger(deficit) || deficit <= 0)
        return true;
    const measure = (0, xmlUtils_1.findAncestorMeasure)(target);
    if (!measure)
        return false;
    if ((0, xmlUtils_1.measureHasBackupOrForward)(measure))
        return false;
    // Keep rhythmic gap close to the edited note to avoid visual/timing drift.
    const next = target.nextElementSibling;
    if (next && next.tagName === "note" && (0, xmlUtils_1.getVoiceText)(next) === voice) {
        const isRest = next.querySelector(":scope > rest") !== null;
        const isChord = next.querySelector(":scope > chord") !== null;
        if (isRest && !isChord) {
            const current = (_a = (0, xmlUtils_1.getDurationValue)(next)) !== null && _a !== void 0 ? _a : 0;
            (0, xmlUtils_1.setDurationValue)(next, current + deficit);
            return true;
        }
    }
    const rest = (0, xmlUtils_1.createRestElement)(target.ownerDocument, voice, deficit);
    target.after(rest);
    // Ensure notation metadata (<type>/<dot>/<time-modification>) is consistent for Verovio.
    (0, xmlUtils_1.setDurationValue)(rest, deficit);
    return true;
};
const measureVoiceHasTupletContext = (target, voice) => {
    const measure = (0, xmlUtils_1.findAncestorMeasure)(target);
    if (!measure)
        return false;
    const notes = Array.from(measure.children).filter((child) => child.tagName === "note");
    for (const note of notes) {
        if ((0, xmlUtils_1.getVoiceText)(note) !== voice)
            continue;
        if (note.querySelector(":scope > time-modification"))
            return true;
        if (note.querySelector(":scope > notations > tuplet"))
            return true;
    }
    return false;
};
const autoAssignGrandStaffByPitch = (note) => {
    var _a, _b;
    const context = resolveGrandStaffContext(note);
    if (!context)
        return;
    const midi = notePitchToMidi(note);
    if (midi === null)
        return;
    let staffNode = note.querySelector(":scope > staff");
    const existingStaffText = (_b = (_a = staffNode === null || staffNode === void 0 ? void 0 : staffNode.textContent) === null || _a === void 0 ? void 0 : _a.trim()) !== null && _b !== void 0 ? _b : "";
    const previousStaff = existingStaffText === "1" ? 1 : existingStaffText === "2" ? 2 : null;
    const desiredStaff = (0, staffClefPolicy_1.pickStaffByPitchWithHysteresis)(midi, previousStaff);
    if (!staffNode) {
        staffNode = note.ownerDocument.createElement("staff");
        note.appendChild(staffNode);
    }
    staffNode.textContent = String(desiredStaff);
};
const resolveGrandStaffContext = (note) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const measure = (0, xmlUtils_1.findAncestorMeasure)(note);
    if (!measure)
        return null;
    const part = measure.parentElement;
    if (!part || part.tagName !== "part")
        return null;
    const measures = Array.from(part.children).filter((child) => child.tagName === "measure");
    const targetIndex = measures.indexOf(measure);
    if (targetIndex < 0)
        return null;
    let staves = 1;
    let clef1 = "";
    let clef2 = "";
    for (let i = 0; i <= targetIndex; i += 1) {
        const attrs = measures[i].querySelector(":scope > attributes");
        if (!attrs)
            continue;
        const stavesText = (_c = (_b = (_a = attrs.querySelector(":scope > staves")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
        const parsedStaves = Number(stavesText);
        if (Number.isInteger(parsedStaves) && parsedStaves > 0) {
            staves = parsedStaves;
        }
        const nextClef1 = (_f = (_e = (_d = attrs.querySelector(':scope > clef[number="1"] > sign')) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
        const nextClef2 = (_j = (_h = (_g = attrs.querySelector(':scope > clef[number="2"] > sign')) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "";
        if (nextClef1)
            clef1 = nextClef1;
        if (nextClef2)
            clef2 = nextClef2;
    }
    if (staves < 2)
        return null;
    if (clef1 !== "G" || clef2 !== "F")
        return null;
    return { part, measure };
};
const notePitchToMidi = (note) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const pitch = note.querySelector(":scope > pitch");
    if (!pitch)
        return null;
    const step = (_c = (_b = (_a = pitch.querySelector(":scope > step")) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : "";
    const octaveText = (_f = (_e = (_d = pitch.querySelector(":scope > octave")) === null || _d === void 0 ? void 0 : _d.textContent) === null || _e === void 0 ? void 0 : _e.trim()) !== null && _f !== void 0 ? _f : "";
    const alterText = (_j = (_h = (_g = pitch.querySelector(":scope > alter")) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim()) !== null && _j !== void 0 ? _j : "0";
    const semitoneByStep = {
        C: 0,
        D: 2,
        E: 4,
        F: 5,
        G: 7,
        A: 9,
        B: 11,
    };
    const base = semitoneByStep[step];
    const octave = Number(octaveText);
    const alter = Number(alterText);
    if (base === undefined || !Number.isInteger(octave) || !Number.isFinite(alter))
        return null;
    return (octave + 1) * 12 + base + Math.round(alter);
};

  },
  "core/validators.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateProjectedMeasureTiming = exports.validateBackupForwardBoundaryForStructuralEdit = exports.validateInsertLaneBoundary = exports.validateTargetVoiceMatch = exports.validateSupportedNoteKind = exports.validateCommandPayload = exports.validateVoice = void 0;
const timeIndex_1 = require("./timeIndex");
const xmlUtils_1 = require("./xmlUtils");
const validateVoice = (command, editableVoice) => {
    if (command.type === "ui_noop")
        return null;
    if (!editableVoice)
        return null;
    if (command.voice === editableVoice)
        return null;
    return {
        code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
        message: `Voice ${command.voice} is not editable in MVP.`,
    };
};
exports.validateVoice = validateVoice;
const validateCommandPayload = (command) => {
    if (command.type === "ui_noop")
        return null;
    if (command.type === "change_duration") {
        if (!isPositiveInteger(command.duration)) {
            return {
                code: "MVP_INVALID_COMMAND_PAYLOAD",
                message: "change_duration.duration must be a positive integer.",
            };
        }
        return null;
    }
    if (command.type === "insert_note_after") {
        if (!isPositiveInteger(command.note.duration)) {
            return {
                code: "MVP_INVALID_COMMAND_PAYLOAD",
                message: "insert_note_after.note.duration must be a positive integer.",
            };
        }
        if (!isValidPitch(command.note.pitch)) {
            return {
                code: "MVP_INVALID_COMMAND_PAYLOAD",
                message: "insert_note_after.note.pitch is invalid.",
            };
        }
        return null;
    }
    if (command.type === "change_to_pitch") {
        if (!isValidPitch(command.pitch)) {
            return {
                code: "MVP_INVALID_COMMAND_PAYLOAD",
                message: "change_to_pitch.pitch is invalid.",
            };
        }
    }
    return null;
};
exports.validateCommandPayload = validateCommandPayload;
const validateSupportedNoteKind = (command, note) => {
    // Allow rest -> pitched note conversion via change_to_pitch.
    if (command.type === "change_to_pitch") {
        const hasUnsupportedExceptRest = note.querySelector(":scope > grace") !== null ||
            note.querySelector(":scope > cue") !== null ||
            note.querySelector(":scope > chord") !== null;
        if (!hasUnsupportedExceptRest)
            return null;
    }
    else if (!(0, xmlUtils_1.isUnsupportedNoteKind)(note)) {
        return null;
    }
    if (!(0, xmlUtils_1.isUnsupportedNoteKind)(note))
        return null;
    return {
        code: "MVP_UNSUPPORTED_NOTE_KIND",
        message: "Editing grace/cue/chord/rest notes is not supported in MVP.",
    };
};
exports.validateSupportedNoteKind = validateSupportedNoteKind;
const validateTargetVoiceMatch = (command, targetNote) => {
    if (command.type === "ui_noop")
        return null;
    const targetVoice = (0, xmlUtils_1.getVoiceText)(targetNote);
    if (!targetVoice)
        return null;
    if (targetVoice === command.voice)
        return null;
    return {
        code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
        message: `Target note voice (${targetVoice !== null && targetVoice !== void 0 ? targetVoice : "none"}) does not match command voice (${command.voice}).`,
    };
};
exports.validateTargetVoiceMatch = validateTargetVoiceMatch;
const validateInsertLaneBoundary = (command, anchorNote) => {
    if (command.type !== "insert_note_after")
        return null;
    const measure = (0, xmlUtils_1.findAncestorMeasure)(anchorNote);
    if (!measure)
        return null;
    const children = Array.from(measure.children);
    const anchorIndex = children.indexOf(anchorNote);
    if (anchorIndex < 0)
        return null;
    for (let i = anchorIndex + 1; i < children.length; i += 1) {
        const node = children[i];
        if (node.tagName !== "note")
            continue;
        const nextVoice = (0, xmlUtils_1.getVoiceText)(node);
        if (nextVoice !== command.voice) {
            return {
                code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
                message: "Insert is restricted to a continuous local voice lane in MVP.",
            };
        }
        break;
    }
    return null;
};
exports.validateInsertLaneBoundary = validateInsertLaneBoundary;
const validateBackupForwardBoundaryForStructuralEdit = (command, anchorOrTarget) => {
    if (command.type !== "insert_note_after" &&
        command.type !== "delete_note" &&
        command.type !== "split_note") {
        return null;
    }
    const prev = anchorOrTarget.previousElementSibling;
    const next = anchorOrTarget.nextElementSibling;
    if (command.type === "insert_note_after") {
        if (next && isBackupOrForward(next)) {
            return {
                code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
                message: "Insert point crosses a backup/forward boundary in MVP.",
            };
        }
        return null;
    }
    if (command.type === "split_note") {
        if (next && next.tagName === "forward") {
            return {
                code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
                message: "Split point crosses a forward boundary in MVP.",
            };
        }
        // Allow split immediately before <backup>. This is common in grand-staff lanes
        // where staff 1 content is followed by backup to start staff 2 at the same time.
        return null;
    }
    // delete_note
    if ((prev && isBackupOrForward(prev)) || (next && isBackupOrForward(next))) {
        return {
            code: "MVP_UNSUPPORTED_NON_EDITABLE_VOICE",
            message: "Delete point crosses a backup/forward boundary in MVP.",
        };
    }
    return null;
};
exports.validateBackupForwardBoundaryForStructuralEdit = validateBackupForwardBoundaryForStructuralEdit;
const validateProjectedMeasureTiming = (noteInMeasure, voice, projectedOccupiedTime) => {
    const timing = (0, timeIndex_1.getMeasureTimingForVoice)(noteInMeasure, voice);
    if (!timing)
        return { diagnostic: null, warning: null };
    if (projectedOccupiedTime > timing.capacity) {
        return {
            diagnostic: {
                code: "MEASURE_OVERFULL",
                message: `Projected occupied time ${projectedOccupiedTime} exceeds capacity ${timing.capacity}.`,
            },
            warning: null,
        };
    }
    if (projectedOccupiedTime < timing.capacity) {
        return {
            diagnostic: null,
            warning: {
                code: "MEASURE_UNDERFULL",
                message: `Projected occupied time ${projectedOccupiedTime} is below capacity ${timing.capacity}.`,
            },
        };
    }
    return { diagnostic: null, warning: null };
};
exports.validateProjectedMeasureTiming = validateProjectedMeasureTiming;
const isBackupOrForward = (node) => node.tagName === "backup" || node.tagName === "forward";
const isPositiveInteger = (value) => Number.isFinite(value) && Number.isInteger(value) && value > 0;
const isValidPitch = (pitch) => {
    const stepOk = ["A", "B", "C", "D", "E", "F", "G"].includes(pitch.step);
    if (!stepOk)
        return false;
    if (!Number.isFinite(pitch.octave) || !Number.isInteger(pitch.octave))
        return false;
    if (typeof pitch.alter === "number") {
        if (!Number.isInteger(pitch.alter))
            return false;
        if (pitch.alter < -2 || pitch.alter > 2)
            return false;
    }
    return true;
};

  },
  "core/commands.js": function (require, module, exports) {
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCommandNodeId = exports.isUiOnlyCommand = void 0;
const isUiOnlyCommand = (command) => command.type === "ui_noop";
exports.isUiOnlyCommand = isUiOnlyCommand;
const getCommandNodeId = (command) => {
    switch (command.type) {
        case "change_to_pitch":
        case "change_duration":
        case "delete_note":
        case "split_note":
            return command.targetNodeId;
        case "insert_note_after":
            return command.anchorNodeId;
        case "ui_noop":
            return null;
    }
};
exports.getCommandNodeId = getCommandNodeId;

  }
};

const cache = {};

function normalizePath(p) {
  const parts = [];
  for (const part of p.split('/')) {
    if (!part || part === '.') continue;
    if (part === '..') {
      parts.pop();
    } else {
      parts.push(part);
    }
  }
  return parts.join('/');
}

function resolve(fromId, specifier) {
  if (!specifier.startsWith('.')) {
    throw new Error('External module is not allowed in single-file build: ' + specifier);
  }
  const fromParts = fromId.split('/');
  fromParts.pop();
  const resolvedBase = normalizePath(fromParts.concat(specifier.split('/')).join('/'));
  const candidates = [resolvedBase + '.js', resolvedBase + '/index.js'];
  for (const c of candidates) {
    if (Object.prototype.hasOwnProperty.call(modules, c)) return c;
  }
  throw new Error('Cannot resolve module at runtime: ' + specifier + ' from ' + fromId);
}

function load(id) {
  if (cache[id]) return cache[id].exports;
  const factory = modules[id];
  if (!factory) throw new Error('Unknown module: ' + id);
  const module = { exports: {} };
  cache[id] = module;
  const localRequire = function (specifier) {
    return load(resolve(id, specifier));
  };
  factory(localRequire, module, module.exports);
  return module.exports;
}

load("src/ts/main.js");
})();
